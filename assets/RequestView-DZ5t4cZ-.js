import{r as O,_ as de}from"./index-Cfdjy00A.js";import{d as he,g as re,I as Ve,J as Ne,t as Ue,a8 as K,o as p,h as f,w as a,ad as k,q as P,l as e,i as H,aC as ne,aD as qe,a6 as u,E as we,X as ie,a4 as pe,ai as ce,aq as me,m as Fe,r as d,n as Se,e as ue,ab as Oe,ao as Te,N as se,F as Q,O as T,V as Pe,R as Re,ak as $e,a7 as Ae,ap as ze,$ as Be,a0 as De,aE as Ee,aF as Ke,aG as Me,aj as je,al as Le}from"./.pnpm-CWzuy1aI.js";const N={getList:i=>O({method:"get",url:"request/list",params:i}),getDetail:i=>O({method:"get",url:"request/detail",params:{id:i}}),remove:i=>O({method:"get",url:"request/remove",params:{id:i}}),add:i=>O({method:"post",url:"request/add",data:i}),update:i=>O({method:"post",url:"request/update",data:i}),run:(i,s)=>he({method:"get",url:"/prod/request/proxy",params:{id:i,paramsData:s}})},Ge={key:2,style:{display:"flex"}},Je=re({__name:"EditTable",props:Ve({columns:{},action:{type:Boolean,default:!0},height:{default:150}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const s=Ne(i,"modelValue");let R=i;const{columns:b,action:$}=Ue(R),M=K(()=>q("input")),U=K(()=>q("select")),A=K(()=>$.value?[...b.value,{title:"操作",dataIndex:"_action_"}]:b.value),j=m=>{var c;return((c=b.value.find(v=>v.dataIndex==m))==null?void 0:c.options)||[]},q=m=>b.value.filter(c=>c.type==m).map(c=>c.dataIndex),z=()=>{let m={};b.value.map(c=>{Reflect.set(m,c.dataIndex,"")}),s.value.push(m)},B=m=>{s.value.splice(m,1)};return(m,c)=>{const v=ie,x=pe,o=ce,I=me;return p(),f(I,{columns:A.value,"data-source":s.value,pagination:!1,rowKey:(_,y)=>y,size:"small",scroll:{y:m.height}},{bodyCell:a(({column:_,record:y,index:L})=>[M.value.includes(_.dataIndex)?(p(),f(v,{key:0,value:y[_.dataIndex],"onUpdate:value":C=>y[_.dataIndex]=C},null,8,["value","onUpdate:value"])):k("",!0),U.value.includes(_.dataIndex)?(p(),f(x,{key:1,value:y[_.dataIndex],"onUpdate:value":C=>y[_.dataIndex]=C,options:j(_.dataIndex)},null,8,["value","onUpdate:value","options"])):k("",!0),_.dataIndex=="_action_"?(p(),P("div",Ge,[e(H(ne),{class:"icon",onClick:c[0]||(c[0]=C=>z())}),e(H(qe),{class:"icon",onClick:C=>B(L)},null,8,["onClick"])])):k("",!0)]),emptyText:a(()=>[e(o,{type:"text",onClick:z,icon:we(H(ne))},{default:a(()=>[u(" 新增数据")]),_:1},8,["icon"])]),_:1},8,["columns","data-source","rowKey","scroll"])}}}),W=de(Je,[["__scopeId","data-v-5b9e8dbe"]]),Xe={class:"request"},He={class:"tools"},Qe=re({__name:"RequestView",setup(i){const s=Fe({keyword:"",pageNumber:1,pageSize:10,url:""}),R=d("params"),b=d([{value:"get",label:"GET"},{value:"post",label:"POST"}]),$=d([]),M=d([{title:"API名称",key:"apiName",dataIndex:"apiName"},{title:"请求地址",key:"url",dataIndex:"url"},{title:"请求方式",key:"method",dataIndex:"method",width:100},{title:"状态",key:"status",dataIndex:"status",width:100},{title:"创建时间",key:"createTime",dataIndex:"createTime"},{title:"备注",key:"desc",dataIndex:"desc"},{title:"操作",key:"action",dataIndex:"action"}]),U=d(!1),A=d([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),j=d([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"}]),q=d(),z=()=>{var n;(n=q.value)==null||n.resetFields(),v()},B=d(0),m=()=>{s.pageNumber=1,s.pageSize=10,v()},c=n=>{const{current:t,pageSize:r}=n;s.pageNumber=t,s.pageSize=r,v()},v=()=>{U.value=!0,N.getList(s).then(n=>{const{code:t,data:r}=n;t==200&&($.value=r.data,B.value=r.total),U.value=!1})};Se(()=>{v()});const x=d(!1),o=d({url:"",method:"get",apiName:"",params:[{key:"",value:"",var:""}],body:[{key:"",value:"",var:""}],headers:[{key:"",value:""}],status:1,desc:""}),I=d("add"),_=K(()=>({add:"新增API",edit:"编辑API"})[I.value]),y=d(),L=()=>{I.value="add",x.value=!0,o.value={url:"",method:"get",apiName:"",params:[{key:"",value:"",var:""}],body:[{key:"",value:"",var:""}],headers:[{key:"",value:""}],status:1,desc:""}},C=async n=>{const{code:t,data:r}=await N.getDetail(n.id);t==200&&(o.value=r,I.value="edit",x.value=!0)},_e=async n=>{const{code:t,msg:r,data:g}=await N.remove(n.id);t==200&&(ue.success(g),v())},Y=()=>{var n;(n=y.value)==null||n.resetFields()},ve=()=>{let n;I.value=="add"?n=N.add:n=N.update,n(o.value).then(t=>{const{code:r}=t;r==200&&(ue.success(I.value=="add"?"新增成功":"编辑成功"),v()),Y(),x.value=!1})},G=d(!1),D=d({apiName:"",url:"",method:"get",status:1}),Z=d(),J=d(!1),w=d(!1),fe=n=>{G.value=!0,D.value=n,J.value=!0,N.run(n.id).then(t=>{const{code:r}=t.data;J.value=!1,Z.value=t.data,r==200?w.value=!0:w.value=!1})};return(n,t)=>{const r=ie,g=Pe,V=ce,ee=Re,ae=Oe,F=$e,E=Ae,ye=ze,ke=me,te=Be,ge=De,be=pe,X=Ee,xe=Ke,le=Te,Ie=Me,S=je,Ce=Le;return p(),P("div",Xe,[e(ae,{class:"search-area"},{default:a(()=>[e(ee,{ref_key:"searchFormRef",ref:q,layout:"inline",model:s,onFinish:m},{default:a(()=>[e(g,{label:"API名称",prop:"keyword"},{default:a(()=>[e(r,{value:s.keyword,"onUpdate:value":t[0]||(t[0]=l=>s.keyword=l)},null,8,["value"])]),_:1}),e(g,{label:"地址",prop:"url"},{default:a(()=>[e(r,{value:s.url,"onUpdate:value":t[1]||(t[1]=l=>s.url=l)},null,8,["value"])]),_:1}),e(g,null,{default:a(()=>[e(V,{type:"primary","html-type":"submit"},{default:a(()=>[u("搜索")]),_:1}),e(V,{style:{margin:"0 8px"},onClick:z},{default:a(()=>[u(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(ae,null,{default:a(()=>[se("div",He,[e(V,{type:"primary",onClick:L},{default:a(()=>[u("新增")]),_:1})]),e(ke,{loading:U.value,columns:M.value,"data-source":$.value,scroll:{y:560},onChange:c,pagination:{current:s.pageNumber,total:B.value,showSizeChanger:!0,pageSize:s.pageSize}},{bodyCell:a(({column:l,record:h})=>[l.key=="status"?(p(),P(Q,{key:0},[h.status?(p(),f(F,{key:0,color:"#87d068"},{default:a(()=>[u("启用")]),_:1})):(p(),f(F,{key:1,color:"#f50"},{default:a(()=>[u("停用")]),_:1}))],64)):k("",!0),l.key=="action"?(p(),P(Q,{key:1},[h.status?(p(),f(V,{key:0,type:"link",onClick:oe=>fe(h)},{default:a(()=>[u("执行")]),_:2},1032,["onClick"])):k("",!0),e(E,{type:"vertical"}),e(V,{type:"link",onClick:oe=>C(h)},{default:a(()=>[u("编辑")]),_:2},1032,["onClick"]),e(E,{type:"vertical"}),e(ye,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:oe=>_e(h)},{default:a(()=>[e(V,{type:"link",danger:""},{default:a(()=>[u("删除")]),_:1})]),_:2},1032,["onConfirm"])],64)):k("",!0),l.key=="method"?(p(),P(Q,{key:2},[h.method=="get"?(p(),f(F,{key:0,color:"#2db7f5"},{default:a(()=>[u("GET")]),_:1})):k("",!0),h.method=="post"?(p(),f(F,{key:1,color:"#87d068"},{default:a(()=>[u("POST")]),_:1})):k("",!0)],64)):k("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),e(le,{open:x.value,"onUpdate:open":t[11]||(t[11]=l=>x.value=l),onOk:ve,title:_.value,onCancel:Y},{default:a(()=>[e(E,null,{default:a(()=>[u("API信息")]),_:1}),e(ee,{model:o.value,"label-col":{span:4},ref_key:"modalFormRef",ref:y},{default:a(()=>[e(g,{label:"API名"},{default:a(()=>[e(r,{value:o.value.apiName,"onUpdate:value":t[2]||(t[2]=l=>o.value.apiName=l)},null,8,["value"])]),_:1}),e(g,{label:"状态"},{default:a(()=>[e(ge,{value:o.value.status,"onUpdate:value":t[3]||(t[3]=l=>o.value.status=l),"button-style":"solid"},{default:a(()=>[e(te,{value:1},{default:a(()=>[u("启用 ")]),_:1}),e(te,{value:0},{default:a(()=>[u("停用 ")]),_:1})]),_:1},8,["value"])]),_:1}),e(g,{label:"备注"},{default:a(()=>[e(r,{value:o.value.desc,"onUpdate:value":t[4]||(t[4]=l=>o.value.desc=l)},null,8,["value"])]),_:1}),e(E,null,{default:a(()=>[u("接口定义")]),_:1}),e(r,{value:o.value.url,"onUpdate:value":t[6]||(t[6]=l=>o.value.url=l)},{addonBefore:a(()=>[e(be,{value:o.value.method,"onUpdate:value":t[5]||(t[5]=l=>o.value.method=l),options:b.value},null,8,["value","options"])]),_:1},8,["value"]),se("div",null,[e(xe,{activeKey:R.value,"onUpdate:activeKey":t[10]||(t[10]=l=>R.value=l)},{default:a(()=>[e(X,{key:"params",tab:"params"},{default:a(()=>[e(W,{columns:A.value,modelValue:o.value.params,"onUpdate:modelValue":t[7]||(t[7]=l=>o.value.params=l)},null,8,["columns","modelValue"])]),_:1}),e(X,{key:"headers",tab:"headers"},{default:a(()=>[e(W,{columns:j.value,modelValue:o.value.headers,"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.headers=l)},null,8,["columns","modelValue"])]),_:1}),e(X,{key:"body",tab:"body"},{default:a(()=>[e(W,{columns:A.value,modelValue:o.value.body,"onUpdate:modelValue":t[9]||(t[9]=l=>o.value.body=l)},null,8,["columns","modelValue"])]),_:1})]),_:1},8,["activeKey"])])]),_:1},8,["model"])]),_:1},8,["open","title"]),e(le,{open:G.value,"onUpdate:open":t[12]||(t[12]=l=>G.value=l),title:"执行结果",footer:null},{default:a(()=>[J.value?(p(),f(Ie,{key:0})):(p(),f(Ce,{key:1,layout:"horizontal"},{default:a(()=>[e(S,{label:"API名称",span:3},{default:a(()=>[u(T(D.value.apiName),1)]),_:1}),e(S,{label:"请求地址",span:3},{default:a(()=>[u(T(D.value.url),1)]),_:1}),e(S,{label:"请求方式",span:3},{default:a(()=>[u(T(D.value.method),1)]),_:1}),e(S,{label:"调用结果",span:3,contentStyle:{color:w.value?"#52c41a":"#f5222d"}},{default:a(()=>[e(F,{color:w.value?"success":"error"},{default:a(()=>[u(T(w.value?"成功":"失败"),1)]),_:1},8,["color"])]),_:1},8,["contentStyle"]),e(S,{label:"返回信息",contentStyle:{"max-height":"300px","overflow-y":"auto"},span:4},{default:a(()=>[u(T(Z.value),1)]),_:1})]),_:1}))]),_:1},8,["open"])])}}}),Ze=de(Qe,[["__scopeId","data-v-016e3ee5"]]);export{Ze as default};
