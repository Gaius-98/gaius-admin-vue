import{a8 as D,a9 as Te,d as me,A as Pe,B as De,r,w as Fe,aa as de,$ as qe,p as j,D as c,I as y,J as t,a3 as g,E as q,g as e,K as Z,S as d,Y as Re,F as _e,a1 as Se,b as Ue,a2 as re,V as ie,N as ee,U as F}from"./index-5uVo7gFH.js";import{_ as E}from"./lodash-CmFMvF3r.js";import{P as pe,M as Oe}from"./PlusCircleOutlined-DpkmawGF.js";import{I as ce,B as ve,_ as Ae,F as Be}from"./index-CpuAoWon.js";import{S as fe,_ as $e,a as Ke}from"./index-M8iWskMh.js";import{a as ye,_ as Me}from"./index-nftqSiLH.js";import{C as Ee,_ as je,a as ze,b as Le,T as Ge,S as Je}from"./index-C3PzdEku.js";import{M as Ye}from"./index-DdWyVrjF.js";import{T as He}from"./index-Bigpcaj9.js";import{D as Qe,a as We}from"./index-CRRvRRti.js";import{_ as Xe}from"./index-BB4RItaP.js";import"./index-C_zJiHiZ.js";import"./EllipsisOutlined-8LHnTuO9.js";import"./ActionButton-C4aYlXiL.js";import"./FolderOutlined-YWqvTW0i.js";import"./PlusOutlined-Dchd30vU.js";const V={getList:_=>D({method:"get",url:"request/list",params:_}),getDetail:_=>D({method:"get",url:"request/detail",params:{id:_}}),remove:_=>D({method:"get",url:"request/remove",params:{id:_}}),add:_=>D({method:"post",url:"request/add",data:_}),update:_=>D({method:"post",url:"request/update",data:_}),run:_=>Te({method:"get",url:"/prod/request/proxy",params:{id:_}})},Ze={key:2,style:{display:"flex"}},et=me({__name:"EditTable",props:Pe({columns:{},action:{type:Boolean,default:!0},height:{default:150}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(_){const m=De(_,"modelValue"),v=r([]);Fe(()=>m,()=>{v.value=m.value.map(s=>({_id_:de(),...s}))},{deep:!0,immediate:!0});let z=_;const{columns:k,action:L}=qe(z),w=j(()=>U("input")),R=j(()=>U("select")),G=j(()=>L.value?[...k.value,{title:"操作",dataIndex:"_action_"}]:k.value),S=s=>{var n;return((n=k.value.find(l=>l.dataIndex==s))==null?void 0:n.options)||[]},U=s=>k.value.filter(n=>n.type==s).map(n=>n.dataIndex),N=(s,n,l)=>{v.value.find(i=>i._id_==s)[n]=l,m.value=v.value.map(i=>{let C=E.cloneDeep(i);return Reflect.deleteProperty(C,"_id_"),C})},O=()=>{let s=de(),n=E.cloneDeep({_id_:s});k.value.map(l=>{Reflect.set(n,l.dataIndex,"")}),v.value.push(n)},J=s=>{let n=v.value.findIndex(l=>l._id_==s);v.value.splice(n,1),console.log(v.value.map(l=>{let i=E.cloneDeep(l);return Reflect.deleteProperty(i,"_id_"),i})),m.value=v.value.map(l=>{let i=E.cloneDeep(l);return Reflect.deleteProperty(i,"_id_"),i})};return(s,n)=>{const l=ce,i=fe,C=ve,A=ye;return c(),y(A,{columns:G.value,"data-source":v.value,pagination:!1,rowKey:f=>f._id_,size:"small",scroll:{y:s.height}},{bodyCell:t(({column:f,index:B,record:T})=>[w.value.includes(f.dataIndex)?(c(),y(l,{key:0,value:v.value[B][f.dataIndex],onChange:b=>N(T._id_,f.dataIndex,b.target.value)},null,8,["value","onChange"])):g("",!0),R.value.includes(f.dataIndex)?(c(),y(i,{key:1,value:v.value[B][f.dataIndex],options:S(f.dataIndex),onChange:b=>{N(T._id_,f.dataIndex,b)}},null,8,["value","options","onChange"])):g("",!0),f.dataIndex=="_action_"?(c(),q("div",Ze,[e(Z(pe),{class:"icon",onClick:n[0]||(n[0]=b=>O())}),e(Z(Oe),{class:"icon",onClick:b=>J(T._id_)},null,8,["onClick"])])):g("",!0)]),emptyText:t(()=>[e(C,{type:"text",onClick:O,icon:Re(Z(pe))},{default:t(()=>[d(" 新增数据")]),_:1},8,["icon"])]),_:1},8,["columns","data-source","rowKey","scroll"])}}}),te=_e(et,[["__scopeId","data-v-ea715308"]]),tt={class:"request"},at={class:"tools"},lt=me({__name:"RequestView",setup(_){const m=Se({keyword:"",pageNumber:1,pageSize:10,url:""}),v=r("params"),z=r([{value:"get",label:"GET"},{value:"post",label:"POST"}]),k=r([]),L=r([{title:"API名称",key:"apiName",dataIndex:"apiName"},{title:"请求地址",key:"url",dataIndex:"url"},{title:"请求方式",key:"method",dataIndex:"method",width:100},{title:"状态",key:"status",dataIndex:"status",width:100},{title:"创建时间",key:"createTime",dataIndex:"createTime"},{title:"备注",key:"desc",dataIndex:"desc"},{title:"操作",key:"action",dataIndex:"action"}]),w=r(!1),R=r([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),G=r([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"}]),S=r(),U=()=>{var u;(u=S.value)==null||u.resetFields(),s()},N=r(0),O=()=>{m.pageNumber=1,m.pageSize=10,s()},J=u=>{const{current:a,pageSize:p}=u;m.pageNumber=a,m.pageSize=p,s()},s=()=>{w.value=!0,V.getList(m).then(u=>{const{code:a,data:p}=u;a==200&&(k.value=p.data,N.value=p.total),w.value=!1})};Ue(()=>{s()});const n=r(!1),l=r({url:"",method:"get",apiName:"",params:[{key:"",value:"",var:""}],body:[{key:"",value:"",var:""}],headers:[{key:"",value:""}],status:1,desc:""}),i=r("add"),C=j(()=>({add:"新增API",edit:"编辑API"})[i.value]),A=r(),f=()=>{i.value="add",n.value=!0,l.value={url:"",method:"get",apiName:"",params:[{key:"",value:"",var:""}],body:[{key:"",value:"",var:""}],headers:[{key:"",value:""}],status:1,desc:""}},B=async u=>{const{code:a,data:p}=await V.getDetail(u.id);a==200&&(l.value=p,console.log(l.value),i.value="edit",n.value=!0)},T=async u=>{const{code:a,msg:p,data:x}=await V.remove(u.id);a==200&&(re.success(x),s())},b=()=>{var u;(u=A.value)==null||u.resetFields()},ge=()=>{let u;i.value=="add"?u=V.add:u=V.update,u(l.value).then(a=>{const{code:p}=a;p==200&&(re.success(i.value=="add"?"新增成功":"编辑成功"),s()),b(),n.value=!1})},Y=r(!1),$=r({apiName:"",url:"",method:"get",status:1}),ae=r(),H=r(!1),Q=r(!1),ke=u=>{Y.value=!0,$.value=u,H.value=!0,V.run(u.id).then(a=>{const{code:p}=a.data;H.value=!1,ae.value=a.data,p==200?Q.value=!0:Q.value=!1})};return(u,a)=>{const p=ce,x=Ae,W=je,h=ve,be=ze,le=Be,oe=Ee,K=He,M=Xe,xe=Me,Ie=ye,ne=$e,Ce=Ke,he=fe,X=Le,Ve=Ge,ue=Ye,we=Je,P=Qe,Ne=We;return c(),q("div",tt,[e(oe,{class:"search-area"},{default:t(()=>[e(le,{ref_key:"searchFormRef",ref:S,model:m,onFinish:O},{default:t(()=>[e(be,{gutter:24},{default:t(()=>[e(W,{span:4},{default:t(()=>[e(x,{label:"API名称",name:"keyword"},{default:t(()=>[e(p,{value:m.keyword,"onUpdate:value":a[0]||(a[0]=o=>m.keyword=o)},null,8,["value"])]),_:1})]),_:1}),e(W,{span:4},{default:t(()=>[e(x,{label:"地址",name:"url"},{default:t(()=>[e(p,{value:m.url,"onUpdate:value":a[1]||(a[1]=o=>m.url=o)},null,8,["value"])]),_:1})]),_:1}),e(W,{span:4,style:{"text-align":"right"}},{default:t(()=>[e(h,{type:"primary","html-type":"submit"},{default:t(()=>[d("搜索")]),_:1}),e(h,{style:{margin:"0 8px"},onClick:U},{default:t(()=>[d(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(oe,null,{default:t(()=>[ie("div",at,[e(h,{type:"primary",onClick:f},{default:t(()=>[d("新增")]),_:1})]),e(Ie,{loading:w.value,columns:L.value,"data-source":k.value,scroll:{y:440},onChange:J,pagination:{current:m.pageNumber,total:N.value}},{bodyCell:t(({column:o,record:I})=>[o.key=="status"?(c(),q(ee,{key:0},[I.status?(c(),y(K,{key:0,color:"#87d068"},{default:t(()=>[d("启用")]),_:1})):(c(),y(K,{key:1,color:"#f50"},{default:t(()=>[d("停用")]),_:1}))],64)):g("",!0),o.key=="action"?(c(),q(ee,{key:1},[I.status?(c(),y(h,{key:0,type:"link",onClick:se=>ke(I)},{default:t(()=>[d("执行")]),_:2},1032,["onClick"])):g("",!0),e(M,{type:"vertical"}),e(h,{type:"link",onClick:se=>B(I)},{default:t(()=>[d("编辑")]),_:2},1032,["onClick"]),e(M,{type:"vertical"}),e(xe,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:se=>T(I)},{default:t(()=>[e(h,{type:"link",danger:""},{default:t(()=>[d("删除")]),_:1})]),_:2},1032,["onConfirm"])],64)):g("",!0),o.key=="method"?(c(),q(ee,{key:2},[I.method=="get"?(c(),y(K,{key:0,color:"#2db7f5"},{default:t(()=>[d("GET")]),_:1})):g("",!0),I.method=="post"?(c(),y(K,{key:1,color:"#87d068"},{default:t(()=>[d("POST")]),_:1})):g("",!0)],64)):g("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),e(ue,{open:n.value,"onUpdate:open":a[11]||(a[11]=o=>n.value=o),onOk:ge,title:C.value,onCancel:b},{default:t(()=>[e(M,null,{default:t(()=>[d("API信息")]),_:1}),e(le,{model:l.value,"label-col":{span:4},ref_key:"modalFormRef",ref:A},{default:t(()=>[e(x,{label:"API名"},{default:t(()=>[e(p,{value:l.value.apiName,"onUpdate:value":a[2]||(a[2]=o=>l.value.apiName=o)},null,8,["value"])]),_:1}),e(x,{label:"状态"},{default:t(()=>[e(Ce,{value:l.value.status,"onUpdate:value":a[3]||(a[3]=o=>l.value.status=o),"button-style":"solid"},{default:t(()=>[e(ne,{value:1},{default:t(()=>[d("启用 ")]),_:1}),e(ne,{value:0},{default:t(()=>[d("停用 ")]),_:1})]),_:1},8,["value"])]),_:1}),e(x,{label:"备注"},{default:t(()=>[e(p,{value:l.value.desc,"onUpdate:value":a[4]||(a[4]=o=>l.value.desc=o)},null,8,["value"])]),_:1}),e(M,null,{default:t(()=>[d("接口定义")]),_:1}),e(p,{value:l.value.url,"onUpdate:value":a[6]||(a[6]=o=>l.value.url=o)},{addonBefore:t(()=>[e(he,{value:l.value.method,"onUpdate:value":a[5]||(a[5]=o=>l.value.method=o),options:z.value},null,8,["value","options"])]),_:1},8,["value"]),ie("div",null,[e(Ve,{activeKey:v.value,"onUpdate:activeKey":a[10]||(a[10]=o=>v.value=o)},{default:t(()=>[e(X,{key:"params",tab:"params"},{default:t(()=>[e(te,{columns:R.value,modelValue:l.value.params,"onUpdate:modelValue":a[7]||(a[7]=o=>l.value.params=o)},null,8,["columns","modelValue"])]),_:1}),e(X,{key:"headers",tab:"headers"},{default:t(()=>[e(te,{columns:G.value,modelValue:l.value.headers,"onUpdate:modelValue":a[8]||(a[8]=o=>l.value.headers=o)},null,8,["columns","modelValue"])]),_:1}),e(X,{key:"body",tab:"body"},{default:t(()=>[e(te,{columns:R.value,modelValue:l.value.body,"onUpdate:modelValue":a[9]||(a[9]=o=>l.value.body=o)},null,8,["columns","modelValue"])]),_:1})]),_:1},8,["activeKey"])])]),_:1},8,["model"])]),_:1},8,["open","title"]),e(ue,{open:Y.value,"onUpdate:open":a[12]||(a[12]=o=>Y.value=o),title:"执行结果",footer:null},{default:t(()=>[H.value?(c(),y(we,{key:0})):(c(),y(Ne,{key:1,layout:"horizontal"},{default:t(()=>[e(P,{label:"API名称",span:3},{default:t(()=>[d(F($.value.apiName),1)]),_:1}),e(P,{label:"请求地址",span:3},{default:t(()=>[d(F($.value.url),1)]),_:1}),e(P,{label:"请求方式",span:3},{default:t(()=>[d(F($.value.method),1)]),_:1}),e(P,{label:"调用结果",span:3},{default:t(()=>[d(F(Q.value?"成功":"失败"),1)]),_:1}),e(P,{label:"返回信息",contentStyle:{"max-height":"300px","overflow-y":"auto"},span:4},{default:t(()=>[d(F(ae.value),1)]),_:1})]),_:1}))]),_:1},8,["open"])])}}}),bt=_e(lt,[["__scopeId","data-v-44c41d3e"]]);export{bt as default};
