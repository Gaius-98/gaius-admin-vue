var ee=Object.defineProperty;var te=(n,o,e)=>o in n?ee(n,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[o]=e;var I=(n,o,e)=>te(n,typeof o!="symbol"?o+"":o,e);import{u as oe}from"./vue-router-iEIkon04.js";import{_ as P}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BeMZwvw0.js";import{d as ae,s as V}from"./pinia-DlKznUG5.js";import{v as ne}from"./uuid-CQkTLCs1.js";import{c as K,d as se}from"./lodash-es-PU94eZQX.js";import{r as x,d as N,V as g,W as $,c as u,a5 as f,u as v,a4 as T,ab as J,L as S,F as A,Z as R,af as W,I as Y,A as ie,H as le,X as y,a6 as j,a7 as ce,q as O,_ as E,aa as X}from"./@vue-BvA2MXdg.js";import{w as re,v as pe,u as de,z as ue,A as fe,L as me,B as _e,R as ve,t as he,T as ge}from"./ant-design-vue-BSZA2eEx.js";import{_ as B}from"./index-CgqLVpwJ.js";import{s as ye}from"./gaius-utils-DO2PX8Qd.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-MMs2D_ke.js";import"./common-BikFPhou.js";import"./form-BkS5If9Q.js";import"./@babel-BiFW4_mA.js";import"./@ant-design-yYwXvx57.js";import"./@ctrl-DOFZgDuz.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-B73STPP_.js";import"./throttle-debounce-CUWDS_la.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-C5fUfLeo.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-OW4gUFyn.js";/* empty css                      */import"./axios-BimPEqV4.js";import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-CbJ3uXWy.js";import"./echarts-DetEu2Tg.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CDo53BfZ.js";const be=[{name:"图片",type:"img",tag:"img",icon:"icon-image1",props:{src:"https://avatars.githubusercontent.com/u/59641156?v=4",draggable:!1},style:{width:"100%",height:"100%"},formId:"c0c67e96-858b-4303-999c-92d0d39cb792"},{name:"文本",type:"text",tag:"span",icon:"icon-text",props:{value:"text"}},{name:"视频",type:"video",tag:"video",icon:"icon-video",props:{src:"",controls:!0,draggable:!1},style:{position:"relative",width:"100%",height:"100%","object-fit":"fill","z-index":-1}},{name:"嵌入页",type:"iframe",tag:"iframe",icon:"icon-HTML",props:{src:"http://120.26.161.36:8080/",draggable:!1},style:{position:"relative",width:"100%",height:"100%","z-index":-1},formId:"6ba21979-d5ec-4715-831e-62046fbfb0d9"},{name:"柱状图",type:"bar",tag:"g-echart",icon:"icon-barchart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"bar"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"折线图",type:"line",tag:"g-echart",icon:"icon-linechart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"line"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"组",type:"group",tag:"visual-group",icon:"icon-deploymentunit",props:{data:[]}}];class Z{constructor(o,e){I(this,"name","组件");I(this,"id");I(this,"type");I(this,"tag");I(this,"icon");I(this,"props");I(this,"style");I(this,"formId","");I(this,"position",{top:0,left:0});I(this,"size",{width:0,height:0});this.id=e||ne(),this.type=o;const t=be.find(s=>s.type===o),a=K(t);t?(this.tag=a.tag,this.props=a.props,this.name=a.name,this.style=a.style,this.icon=a.icon,this.formId=a.formId):(this.tag="div",this.icon="icon")}}const xe=n=>{let o=null,e=null,t=0,a=0;return n.forEach(s=>{o=o==null?s.position.left:Math.min(o,s.position.left),e=e==null?s.position.top:Math.min(e,s.position.top),t=Math.max(t,s.position.left+s.size.width),a=Math.max(a,s.position.top+s.size.height)}),{left:o,top:e,width:t-o,height:a-e}},Ce=n=>{const{left:o,top:e,width:t,height:a}=xe(n),s=new Z("group");return s.position={top:e,left:o},s.size={width:t,height:a},s.props={data:n.map(m=>({...m,position:{left:m.position.left-o,top:m.position.top-e}}))},s},we=n=>{const{position:{left:o,top:e}}=n;return n.props.data.map(t=>(t.position.left=Number(t.position.left)+o,t.position.top=Number(t.position.top)+e,t))},De=(n,o,e)=>{const{height:t,width:a}=n,{height:s,width:m}=o,i=(m-a)/a,l=(s-t)/t,r=e.props.data;return e.props.data=r.map(h=>({...h,position:{left:(h.position.left*(1+i)).toFixed(2),top:(h.position.top*(1+l)).toFixed(2)},size:{width:(h.size.width*(1+i)).toFixed(2),height:(h.size.height*(1+l)).toFixed(2)}})),e},H=10,G=ae("visual",()=>{const n=x({componentData:[],name:"",id:"",img:"",height:1080,width:1920}),o=x({name:"",type:"",id:"",props:{},tag:"",position:{top:0,left:0},size:{width:0,height:0},formId:""}),e=x([]),t=x(0),a=()=>{e.value[t.value++]=K(n.value.componentData),e.value.length>H&&(e.value=e.value.slice(e.value.length-H),t.value=H)},s=()=>{t.value>0&&(t.value--,n.value.componentData=K(e.value[t.value]))},m=()=>{t.value<e.value.length-1&&(t.value++,n.value.componentData=K(e.value[t.value]))},i=_=>{const d=n.value.componentData.findIndex(b=>b.id===_.id);d!=-1&&(o.value=n.value.componentData[d])},l=_=>{n.value.componentData.push(_),i(_),a()},r=_=>{const d=n.value.componentData.findIndex(b=>b.id===_.id);d!=-1&&(n.value.componentData[d]=_,a())},h=_=>{const d=n.value.componentData.findIndex(b=>b.id===_.id);d!=-1&&(n.value.componentData.splice(d,1),a())},k=x([]),M=()=>{if(k.value.length){const _=n.value.componentData.filter(b=>k.value.includes(b.id)),d=Ce(_);_.forEach(b=>{h(b)}),l(d),z()}},C=()=>{const _=we(o.value);h(o.value),_&&_.map(d=>{l(d)})},z=()=>{k.value=[]};return{undo:s,redo:m,setSnapshot:a,onClickComp:i,visualData:n,curCompData:o,addComp:l,removeComp:h,snapshotData:e,curSnapshotIdx:t,updateComp:r,frameSelection:k,addGroup:M,reduceGroup:C}}),ke={class:"cfg"},Ie=N({__name:"CfgArea",setup(n){const o=G(),{visualData:e,curCompData:t}=V(o),a=x("position");return(s,m)=>{const i=pe,l=re;return g(),$("div",ke,[u(l,{activeKey:a.value,"onUpdate:activeKey":m[0]||(m[0]=r=>a.value=r)},{default:f(()=>[u(i,{key:"position",tab:"位置信息"},{default:f(()=>[u(P,{"form-data":v(t),id:"77c39b52-fde7-491f-9e94-9f2f1d65fb69"},null,8,["form-data"])]),_:1}),u(i,{key:"props",tab:"属性配置"},{default:f(()=>[v(t).formId?(g(),T(P,{"form-data":v(t),id:v(t).formId,key:v(t).formId},null,8,["form-data","id"])):J("",!0)]),_:1}),u(i,{key:"data",tab:"数据配置"},{default:f(()=>[S("Content of Tab 3")]),_:1})]),_:1},8,["activeKey"])])}}}),Se=B(Ie,[["__scopeId","data-v-f0d0ccaa"]]),ze=N({__name:"DesignArea",setup(n){const o=G(),{visualData:e,curCompData:t,frameSelection:a}=V(o),{onClickComp:s,setSnapshot:m,addComp:i,removeComp:l,updateComp:r,addGroup:h}=o,k=x(),M=x(!1),C=x({x:0,y:0}),z=x({x:0,y:0}),_=c=>{M.value=!0,C.value.x=c.offsetX,C.value.y=c.offsetY;const w=U=>{let D=U;z.value.x=D.offsetX,z.value.y=D.offsetY},p=()=>{document.querySelector(".container").removeEventListener("mousemove",w),document.querySelector(".container").removeEventListener("mouseup",p),d()};document.querySelector(".container").addEventListener("mousemove",w),document.querySelector(".container").addEventListener("mouseup",p)},d=()=>{e.value.componentData.map(c=>{c.position.left>=C.value.x&&c.position.left+c.size.width<=z.value.x&&c.position.top>=C.value.y&&c.position.top+c.size.height<=z.value.y&&a.value.push(c.id)}),z.value={x:0,y:0},C.value={x:0,y:0}},b=c=>{c.preventDefault()},F=c=>{c.preventDefault();let w=JSON.parse(c.dataTransfer.getData("componentData"));w&&(w=new Z(w.name),w.position={top:c.offsetY,left:c.offsetX},w.size={width:100,height:100},i(w))},L=x({}),q=c=>{L.value=c},Q=se(c=>{const{nodeKey:w}=c;let p=e.value.componentData.findIndex(U=>U.id===w);p!=-1&&e.value.componentData[p].type=="group"&&w==L.value.nodeKey&&r(De(L.value,c,e.value.componentData[p])),m()},100);return document.body.addEventListener("keydown",c=>{c.ctrlKey&&c.key==="g"&&(c.preventDefault(),h())}),(c,w)=>(g(),$("div",{ref_key:"container",ref:k,class:"container",onDragover:b,onDrop:F,onMousedown:_},[(g(!0),$(A,null,R(v(e).componentData,(p,U)=>(g(),T(v(ye),{key:p.id,minh:20,minw:20,width:p.size.width,"onUpdate:width":D=>p.size.width=D,height:p.size.height,"onUpdate:height":D=>p.size.height=D,top:p.position.top,"onUpdate:top":D=>p.position.top=D,left:p.position.left,"onUpdate:left":D=>p.position.left=D,"node-key":p.id,active:p.id==v(t).id||v(a).includes(p.id),class:"drag",style:W({zIndex:`${U+100}`}),wait:10,onUpdate:v(Q),onClick:Y(D=>v(s)(p),["stop"]),onMousedown:Y(D=>v(s)(p),["stop"]),onBeforeTransform:q},{default:f(()=>[(g(),T(j(p.tag),ce({ref_for:!0},p.props,{style:p.style||{}}),null,16,["style"]))]),_:2},1032,["width","onUpdate:width","height","onUpdate:height","top","onUpdate:top","left","onUpdate:left","node-key","active","style","onUpdate","onClick","onMousedown"]))),128)),ie(y("div",{class:"mask",style:W({width:z.value.x-C.value.x+"px",height:z.value.y-C.value.y+"px",top:C.value.y+"px",left:C.value.x+"px"})},null,4),[[le,M.value]])],544))}}),$e=B(ze,[["__scopeId","data-v-e8948fe6"]]),Me=["title"],Le=N({__name:"NodeRelationship",setup(n){const o=G(),{visualData:e}=V(o),{onClickComp:t}=o,a=(i,l)=>{t(l.node.dataRef)},s=i=>{let l={id:i.id,type:i.type,children:[],icon:i.icon,name:i.name};return l.type=="group"&&i.props.data.length>0&&(l.children=i.props.data.map(r=>s(r))),l},m=O(()=>{let i=[];return e.value.componentData.map(l=>{i.push(s(l))}),i});return(i,l)=>{const r=de;return g(),T(r,{class:"draggable-tree","block-node":"","tree-data":m.value,showIcon:!1,onSelect:a,fieldNames:{title:"name",key:"id",children:"children"}},{title:f(({name:h,data:k})=>[y("div",{title:`${h}(${k.id})`},[y("i",{class:E(["iconfont",k.icon])},null,2),S(" "+X(h),1)],8,Me)]),_:1},8,["tree-data"])}}}),Te=B(Le,[["__scopeId","data-v-2ebb698b"]]),Ae={class:"component-layout"},Ne=["data-component"],Be={class:"component-item-text"},Ue=N({__name:"MaterialArea",setup(n){const o=x(),e=[{title:"基础组件",value:"base",list:[{label:"图片",icon:"icon-image1",name:"img"},{label:"文本",icon:"icon-text",name:"text"},{label:"视频",name:"video",icon:"icon-video"},{label:"嵌入页",name:"iframe",icon:"icon-HTML"}]},{title:"图表",value:"echart",list:[{label:"柱状图",icon:"icon-barchart",name:"bar"},{label:"折线图",icon:"icon-linechart",name:"line"}]}],t=a=>{a&&a.target&&a.dataTransfer&&a.dataTransfer.setData("componentData",a.target.getAttribute("data-component"))};return(a,s)=>{const m=ue,i=fe;return g(),T(i,{activeKey:o.value,"onUpdate:activeKey":s[0]||(s[0]=l=>o.value=l),class:"material-area",ghost:!0},{default:f(()=>[(g(),$(A,null,R(e,l=>u(m,{header:l.title,key:l.value},{default:f(()=>[y("div",Ae,[(g(!0),$(A,null,R(l.list,r=>(g(),$("div",{class:"component-item",key:r.name,draggable:"true",onDragstart:t,"data-component":JSON.stringify(r)},[y("span",{class:E(["iconfont component-item-icon",r.icon])},null,2),y("span",Be,X(r.label),1)],40,Ne))),128))])]),_:2},1032,["header"])),64))]),_:1},8,["activeKey"])}}}),Ee=B(Ue,[["__scopeId","data-v-625d7f87"]]),Ke={class:"left-side-bar"},Re={class:"bar-top"},Ve=["title","onClick"],Ge={class:"header"},Fe={class:"title"},qe={class:"container"},He=N({__name:"LeftSideBar",setup(n){const o=[{label:"素材库",value:"componentLib",icon:"appstoreadd",component:Ee},{label:"节点关系",value:"nodeRelationship",icon:"link",component:Te}],e=x(),t=x(!0),a=()=>{t.value=!t.value},s=i=>{e.value=i},m=()=>{e.value=void 0};return(i,l)=>(g(),$(A,null,[y("div",Ke,[y("ul",Re,[(g(),$(A,null,R(o,r=>y("li",{key:r.value,title:r.label,class:E([`iconfont icon-${r.icon}`,e.value&&e.value.value===r.value?"active":""]),onClick:h=>s(r)},null,10,Ve)),64))])]),e.value?(g(),$("div",{class:E(["left-part",t.value?"affix":""]),key:e.value.value},[y("div",Ge,[y("div",Fe,X(e.value.label),1),y("div",{class:E(["affix iconfont",t.value?"icon-pushpin-fill":"icon-pushpin"]),onClick:a},null,2),y("div",{class:"close iconfont icon-close",onClick:m})]),y("div",qe,[(g(),T(j(e.value.component)))])],2)):J("",!0)],64))}}),Oe=B(He,[["__scopeId","data-v-28502db2"]]),Xe={class:"design-container"},Pe=N({__name:"VisualEditor",setup(n){const o=G(),{undo:e,redo:t,addGroup:a,reduceGroup:s}=o,{curCompData:m,frameSelection:i}=V(o),l=oe(),r=O(()=>"title"),h=O(()=>"desc"),k=()=>{},M=()=>{},C=()=>{l.go(-1)};return(z,_)=>{const d=_e,b=ve,F=he,L=ge,q=me;return g(),$(A,null,[u(q,{title:r.value,subTitle:h.value,onBack:C,ghost:!1,style:{padding:"10px 24px"}},{extra:f(()=>[u(F,null,{default:f(()=>[u(b,null,{default:f(()=>[u(d,{disabled:!v(i).length,onClick:v(a)},{default:f(()=>[S(" 成组 ")]),_:1},8,["disabled","onClick"]),u(d,{disabled:v(m).type!="group",onClick:v(s)},{default:f(()=>[S(" 取消分组 ")]),_:1},8,["disabled","onClick"])]),_:1}),u(b,null,{default:f(()=>[u(d,{onClick:v(e)},{default:f(()=>[S("撤销")]),_:1},8,["onClick"]),u(d,{onClick:v(t)},{default:f(()=>[S("重做")]),_:1},8,["onClick"])]),_:1}),u(d,null,{default:f(()=>[S("加载外部组件")]),_:1}),u(d,{onClick:k,class:"variable-btn"},{default:f(()=>[S(" 变量池配置 ")]),_:1}),u(d,{onClick:M,type:"primary",class:"save-btn"},{default:f(()=>[S(" 保存 ")]),_:1})]),_:1})]),tags:f(()=>[u(L,{color:"#87d068"},{default:f(()=>[S("启用")]),_:1}),u(L,{color:"#f50"},{default:f(()=>[S("停用")]),_:1})]),_:1},8,["title","subTitle"]),y("div",Xe,[u(Oe,{class:"left-sider"}),u($e),u(Se)])],64)}}}),zt=B(Pe,[["__scopeId","data-v-cf4f0c0b"]]);export{zt as default};
