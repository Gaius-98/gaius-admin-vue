import{g as h,s as b}from"./index-Ov7V3_zZ.js";import{t as j,U as E,r as P,V as $,W as c,X as L,Y as N,$ as V,a0 as R,a1 as F,a2 as U,a3 as q,a4 as K,a5 as T,a6 as W,a7 as X,a8 as Y,a9 as z}from"./.pnpm-8LtkOrH2.js";const A=n=>{const e=/\$\{([^}]+)\}/g,t=n.match(e);return t?t.map(a=>{const l=a.trim().replace(/formData./g,"");return l.substring(2,l.length-1)}):[]},B=(n,e)=>{const t=/\$\{([^}]+)\}/g;return n.replace(t,(l,u)=>{const s=u.trim();return h({formData:e},s)})},O=(n,e)=>{const t=B(n,e);return new Function(`return ${t}`)()},G=(n,e,t,a,l)=>{let u;switch(t){case"string":u=c(F,{...l,value:h(n,e),onChange:s=>{b(n,e,s.target.value),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s.target.value})}});break;case"textarea":u=c(z,{...l,value:h(n,e),onChange:s=>{b(n,e,s.target.value),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s.target.value})}});break;case"select":u=c(Y,{...l,options:a.options[e]||[],value:h(n,e),onChange:s=>{b(n,e,s),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s})}});break;case"number":u=c(X,{...l,value:h(n,e),onChange:s=>{b(n,e,s),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s})}});break;case"date":u=c(W,{...l,value:h(n,e),onChange:s=>{b(n,e,s),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s})}});break;case"tree":u=c(T,{...l,options:a.options[e]||[],value:h(n,e),onChange:s=>{b(n,e,s),a.onChange({formData:n,field:e,value:s})}});break;case"radio":u=c(K,{...l,value:h(n,e),onChange:s=>{b(n,e,s.target.value),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s.target.value})}},{default:()=>(a.options[e]||[]).map(s=>c(q,{value:s.value,key:s.value},{default:()=>s.label}))});break;case"switch":u=c(U,{checked:h(n,e),onChange(s){b(n,e,s),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s})}});break;default:u=c(F,{...l,value:h(n,e),onChange:s=>{b(n,e,s.target.value),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s.target.value})}});break}return u},H=(n,e,t,a)=>{const{type:l,label:u,component:s,rules:C,tooltip:w}=t;let d;if(s!=null&&s.name){const{name:v}=s,S=V(s);if(Reflect.deleteProperty(S,"onChange"),!a.sfProvideEL[v])throw new Error(`${v} is not registered,provide('sfProvideEL','${v}',Component)`);d=c(a.sfProvideEL[v],{...S,formData:n,value:h(n,e),onChange:_=>{if(n[e]=_,b(n,e,_),s.onChange)try{s.onChange(_,n,e)}catch(g){throw new Error(g)}}})}else d=G(n,e,l,a,s);return a.visibleInfo[e]&&c(R,{label:u,name:e,rules:C,tooltip:w},{default:()=>[d]})},J={name:"SchemaForm",props:{layout:{type:Object},properties:{type:Object},formData:{type:Object,required:!0}},setup(n){const{layout:e,properties:t,formData:a}=j(n),l=E("sfProvideEL"),u=P({}),s=Object.entries(t.value).filter(([,o])=>{var r,i;return((r=o==null?void 0:o.component)==null?void 0:r.dataSource)||((i=o==null?void 0:o.component)==null?void 0:i.asyncData)}),C=async(o,r)=>{const{dataSource:i,asyncData:p}=r.component;i?u.value[o]=i:u.value[o]=await p(a.value,o)};s.map(async([o,r])=>{await C(o,r)});const w=o=>{const[r,i]=Object.entries(t.value).find(([p])=>o==p);i&&C(r,i)},d=new $,v=o=>{var p,f;const{field:r}=o,i=(f=(p=t.value[r])==null?void 0:p.component)==null?void 0:f.onChange;i&&i(o)},S=N(),_=()=>{Object.entries(t.value).map(([o,r])=>{if(typeof r.show>"u")g.value[o]=!0;else if(typeof r.show=="boolean")g.value[o]=r.show;else if(typeof r.show=="string"){const i=r.show;g.value[o]=O(i,a.value),A(i).map(f=>{d.onSubscribe(f,()=>{g.value[o]=O(i,a.value)})})}})},g=P({});return _(),{layout:e,properties:t,refreshOption:w,formData:a,options:u,visibleInfo:g,pubSub:d,sfProvideEL:l,onChange:v,expose:S}},render:n=>c(L,{...n.layout},{default:()=>[...Object.entries(n.properties).map(([e,t])=>H(n.formData,e,t,n))]})},Z=J;export{Z as S};
