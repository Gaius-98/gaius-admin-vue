import{ay as ue,r as i,aw as ce,R as pe,d as q,B as J,p as j,D as y,I as F,E as T,F as a,U as H,g as e,G as n,M as b,S as $,Z as de,N as me,V as Y,aC as fe,au as _e,aD as ve,aE as ge,h as W,K as be,v as ye,ax as he,O as X,a0 as Se,a1 as Ce}from"./index-Cq8ALRAC.js";import{S as P}from"./SchemaForm-qzZeooyj.js";import{D as De}from"./DragTableHeader-BrfOOlPw.js";import{h as we}from"./http-3qxdZzfw.js";import{t as E}from"./table-CpzgOonY.js";import"./html2canvas.esm-BfYXEYrK.js";import{_ as ke}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BoPyR6Hq.js";import{C as xe,_ as Ie,a as Ve,T as Te,b as Ue}from"./index-D9kNgwu2.js";import{S as Re}from"./SyncOutlined-C9ShVASm.js";import{B as ee,_ as Fe}from"./index-Dm_lgmPP.js";import{I as $e}from"./index-aIXwfiX9.js";import{_ as Oe}from"./index-shavymTP.js";import{E as ze}from"./EditTable-Cqq7bAPf.js";import{M as Ae}from"./index-xAwEVU3F.js";import{S as Be}from"./index-V4X8t6ob.js";import{T as Ne}from"./index-CHt5pdN2.js";import{a as Pe}from"./LowCodeForm.vue_vue_type_script_setup_true_lang-BrxHCIH2.js";import{_ as Ee}from"./index-BUyU8qsm.js";import"./index-B_2L_z_B.js";import"./SwapRightOutlined-rRDcYFwa.js";import"./index-DD_NySnd.js";import"./index-Cm1MbGpq.js";import"./index-BdqCsRYR.js";import"./vue-draggable-next.esm-bundler-C-UANJdr.js";import"./SwapOutlined-Byyryh5r.js";import"./DeleteOutlined-7WKDT7On.js";import"./form-CnxAt-Qx.js";import"./index-DqWLH9mZ.js";import"./PlusOutlined-DGl1G9RV.js";import"./FolderOutlined-iU2bDNCJ.js";import"./PlusCircleOutlined-C4dWWtUB.js";import"./ActionButton-j3S83rQ2.js";import"./ArrowRightOutlined-Cso8Hjmj.js";import"./index-LtVkyVXa.js";import"./index-CwmgX1of.js";import"./common-Czp8UCrs.js";const Z=ue("tableDesign",()=>{const D=i([]),m=i({name:"",description:"",status:1,columns:[],global:{bordered:!1,pagination:{current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),u=i({}),h=()=>{const o=new Date().getTime().toString().slice(-4);m.value.columns.push({id:ce(),dataIndex:"field"+o,title:"列"+o})},t=(o,l)=>{const r=l.findIndex(p=>p.id===o);r!=-1&&(u.value=l[r])},w=(o,l)=>{const r=l.findIndex(p=>p.id===o);r!=-1&&l.splice(r,1)},x=()=>{const o={};return m.value.variablePool.reduce((l,r)=>(l[r.key]=r.defaultValue,l),o),o},S=async o=>{try{const l=await we.run(m.value.dataSource.interfaceUrl,x());return new Function("res",o||m.value.dataSource.handlerFunc)(l.data)}catch(l){return l}},g=i(!1);return{tableCfg:m,currentColumn:u,onSelectColumn:t,onRemoveColumn:w,onAddColumn:h,tableData:D,onRefreshData:S,saveLoading:g,onSave:async()=>{g.value=!0;const{code:o,msg:l}=await E.add(m.value);o==200&&pe.success(l),g.value=!1}}}),Ke={class:"table-design-container"},Le={class:"tools"},Me=["href"],Ge=q({__name:"TableDesign",setup(D){const m=Z(),{tableCfg:u,tableData:h}=J(m),{onSelectColumn:t,onRemoveColumn:w,onAddColumn:x,onRefreshData:S}=m,g=_=>{t(_.id,u.value.columns)},c=_=>{w(_.id,u.value.columns)},o=i(0),l=()=>{S().then(_=>{const{data:v,total:C}=_;v&&(h.value=v),C&&(o.value=C)})},r=j(()=>{var _,v;return((_=u.value.global.filterCfg)==null?void 0:_.show)&&((v=u.value.global.filterCfg)==null?void 0:v.formId)}),p=i({});return(_,v)=>{const C=ee,O=Ie,K=Ve,z=xe,I=$e,A=Oe;return y(),F("div",Ke,[r.value?(y(),T(z,{key:0,class:"filter-panel"},{default:a(()=>[e(ke,{formData:p.value,"onUpdate:formData":v[0]||(v[0]=f=>p.value=f),id:n(u).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),e(K,null,{default:a(()=>[e(O,{span:24,style:{"text-align":"right"}},{default:a(()=>[e(C,{type:"primary","html-type":"submit"},{default:a(()=>[b("搜索")]),_:1}),e(C,{style:{margin:"0 8px"}},{default:a(()=>[b("重置")]),_:1})]),_:1})]),_:1})]),_:1})):H("",!0),e(z,{class:"table-container"},{default:a(()=>[$("div",Le,[e(C,{type:"primary",onClick:n(x)},{default:a(()=>[b("新增列")]),_:1},8,["onClick"]),e(C,{icon:de(n(Re)),type:"link",title:"刷新数据",style:{float:"right"},onClick:l},null,8,["icon"])]),e(De,{modelValue:n(u).columns,"onUpdate:modelValue":v[1]||(v[1]=f=>n(u).columns=f),onOnClick:g,onOnRemove:c},null,8,["modelValue"]),e(A,{showHeader:!1,columns:n(u).columns,"data-source":n(h),scroll:{y:r.value?300:500},pagination:{total:o.value}},{bodyCell:a(({column:f,record:U})=>[f&&f.type=="image"?(y(),T(I,{key:0,src:`${U[f.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):H("",!0),f&&f.type=="link"?(y(),F("a",{key:1,href:`${U[f.dataIndex]}`,target:"_blank"},me(U[f.dataIndex]),9,Me)):H("",!0)]),_:1},8,["columns","data-source","scroll","pagination"])]),_:1})])}}}),He=Y(Ge,[["__scopeId","data-v-dfb4f893"]]),je={key:1},qe=q({__name:"TableCfg",setup(D){const m=Z(),u=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"string",label:"字段名"},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左固定"},{value:"right",label:"右固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),h=i("column"),t=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"pagination.pageSize":{type:"number",label:"每页条数"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(c=>{setTimeout(()=>{c(w.value)},100)})}}}}),w=i([]);E.getFormList().then(g=>{const{code:c,data:o,msg:l}=g;c==200&&(w.value=o.map(r=>({value:r.id,label:r.name})))});const{tableCfg:x,currentColumn:S}=J(m);return(g,c)=>{const o=fe,l=Ue,r=Te;return y(),T(r,{activeKey:h.value,"onUpdate:activeKey":c[0]||(c[0]=p=>h.value=p)},{default:a(()=>[e(l,{key:"column",tab:"列配置"},{default:a(()=>[n(S).id?(y(),T(n(P),{layout:u.value.layout,properties:u.value.properties,formData:n(S),key:n(S).id},null,8,["layout","properties","formData"])):(y(),F("div",je,[e(o)]))]),_:1}),e(l,{key:"global",tab:"全局配置"},{default:a(()=>[e(n(P),{layout:t.value.layout,properties:t.value.properties,formData:n(x).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),ae=D=>(Se("data-v-c6a95449"),D=D(),Ce(),D),Je={class:"table-design"},Ze={class:"left-part"},Qe={class:"right-part"},We=ae(()=>$("span",null,"(res)=>{",-1)),Xe=ae(()=>$("span",null,"}",-1)),Ye=q({__name:"TableEditor",props:{id:{}},setup(D){const m=D,{id:u}=_e(m),h=Z(),{tableCfg:t,tableData:w,saveLoading:x}=J(h),{onRefreshData:S,onSave:g}=h,c=i({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),o=i("");u.value?E.getDetail(u.value).then(V=>{const{code:s,data:k,msg:R}=V;s==200&&(t.value=k,S().then(B=>{const{data:N}=B;N&&(w.value=N)}))}):(t.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,pagination:{current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{add:{show:!1,formId:""},edit:{show:!1,formId:""},view:{show:!1,formId:""}},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"}]},c.value=t.value.dataSource);const l=j(()=>t.value.name?t.value.name:"新建表格"),r=j(()=>t.value.description?t.value.description:""),p=i(!1),_=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),v=()=>{p.value=!0},C=ve(),O=()=>{C.go(-1)},K=()=>{g(),p.value=!1,O()},z=()=>{C.push({path:"/low-code/preview-table",query:{id:t.value.id}})},I=i(!1),A=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:V,data:s,msg:k}=await E.getApiList();return V==200?s.map(R=>({value:R.id,label:R.apiName})):[]}}}}}),f=()=>{c.value=t.value.dataSource,I.value=!0},U=()=>{t.value.dataSource=c.value,Q()},Q=()=>{I.value=!1},L=i(!1),te=async()=>await S(),oe=async()=>{L.value=!0;const V=await te();L.value=!1,o.value=JSON.stringify(V,null,2)},M=i(!1),le=i([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),ne=()=>{M.value=!0};return(V,s)=>{const k=ee,R=Be,B=Ne,N=Pe,G=Ae,se=Fe,re=Ee,ie=ge("loading");return y(),F(be,null,[e(N,{title:l.value,subTitle:r.value,onBack:O,ghost:!1,style:{padding:"10px 24px"}},{extra:a(()=>[e(R,null,{default:a(()=>[e(k,{onClick:f},{default:a(()=>[b(" 数据源配置 ")]),_:1}),e(k,{onClick:ne},{default:a(()=>[b(" 变量池配置 ")]),_:1}),W(e(k,{onClick:z},{default:a(()=>[b(" 预览 ")]),_:1},512),[[ye,n(t).id]]),e(k,{onClick:v,type:"primary"},{default:a(()=>[b(" 保存 ")]),_:1})]),_:1})]),tags:a(()=>[n(t).status?(y(),T(B,{key:0,color:"#87d068"},{default:a(()=>[b("启用")]),_:1})):(y(),T(B,{key:1,color:"#f50"},{default:a(()=>[b("停用")]),_:1}))]),_:1},8,["title","subTitle"]),W((y(),F("div",Je,[$("div",Ze,[e(He)]),$("div",Qe,[e(qe)])])),[[ie,n(x),void 0,{fullscreen:!0}]]),e(G,{open:p.value,"onUpdate:open":s[1]||(s[1]=d=>p.value=d),title:"保存",onOk:K},{default:a(()=>[e(n(P),{formData:n(t),"onUpdate:formData":s[0]||(s[0]=d=>he(t)?t.value=d:null),layout:_.value.layout,properties:_.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e(G,{open:I.value,"onUpdate:open":s[5]||(s[5]=d=>I.value=d),title:"数据源配置",onOk:U,onCancel:Q},{default:a(()=>[e(n(P),{layout:A.value.layout,properties:A.value.properties,formData:c.value,"onUpdate:formData":s[2]||(s[2]=d=>c.value=d)},null,8,["layout","properties","formData"]),e(se,{label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}"},{default:a(()=>[We,e(X,{height:200,modelValue:c.value.handlerFunc,"onUpdate:modelValue":s[3]||(s[3]=d=>c.value.handlerFunc=d)},null,8,["modelValue"]),Xe]),_:1}),e(re,null,{default:a(()=>[b("结果区")]),_:1}),e(k,{type:"primary",style:{"margin-bottom":"5px"},onClick:oe,loading:L.value},{default:a(()=>[b("运行")]),_:1},8,["loading"]),e(X,{height:200,disabled:"",modelValue:o.value,"onUpdate:modelValue":s[4]||(s[4]=d=>o.value=d)},null,8,["modelValue"])]),_:1},8,["open"]),e(G,{title:"变量池配置",open:M.value,footer:!1,onCancel:s[7]||(s[7]=d=>M.value=!1)},{default:a(()=>[e(ze,{columns:le.value,modelValue:n(t).variablePool,"onUpdate:modelValue":s[6]||(s[6]=d=>n(t).variablePool=d)},null,8,["columns","modelValue"])]),_:1},8,["open"])],64)}}}),Aa=Y(Ye,[["__scopeId","data-v-c6a95449"]]);export{Aa as default};
