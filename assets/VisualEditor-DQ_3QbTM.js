var tt=Object.defineProperty;var et=(n,o,t)=>o in n?tt(n,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[o]=t;var I=(n,o,t)=>et(n,typeof o!="symbol"?o+"":o,t);import{u as ot}from"./vue-router-BsaqgHAe.js";import{_ as P}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-CrL2wMqF.js";import{d as at,s as V}from"./pinia-DZPz60mG.js";import{v as nt}from"./uuid-CQkTLCs1.js";import{c as G,d as st}from"./lodash-es-PU94eZQX.js";import{r as x,d as N,U as g,V as $,c as u,a5 as f,u as v,a4 as L,ad as J,J as S,F as A,Y as K,af as W,G as X,x as it,E as lt,W as y,aa as j,a7 as ct,m as q,Z as E,a6 as H}from"./@vue-CeHXljvD.js";import{w as rt,v as pt,u as dt,z as ut,A as ft,L as mt,B as _t,Q as vt,t as ht,T as gt}from"./ant-design-vue-D_mFXu_Y.js";import{b as B}from"./index-XMdY5bGJ.js";import{s as yt}from"./gaius-utils-BQYB1CTP.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-Dhts3hgW.js";import"./common-DOxWEkEw.js";import"./form-B-FrzaDA.js";import"./@babel-BiFW4_mA.js";import"./@ant-design-D3E7U7HN.js";import"./@ctrl-DOFZgDuz.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-X-x4l2Bb.js";import"./throttle-debounce-CUWDS_la.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-C5fUfLeo.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";/* empty css                      */import"./axios-DsPaXkF5.js";import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-N9TsG8xj.js";import"./vue-codemirror-DAixPvWe.js";import"./codemirror-D_HKGbp9.js";import"./@codemirror-BNYy9MjX.js";import"./@lezer-Cp1Os4ub.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./echarts-DetEu2Tg.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CDo53BfZ.js";const bt=[{name:"图片",type:"img",tag:"img",icon:"icon-image1",props:{src:"https://avatars.githubusercontent.com/u/59641156?v=4",draggable:!1},style:{width:"100%",height:"100%"},formId:"c0c67e96-858b-4303-999c-92d0d39cb792"},{name:"文本",type:"text",tag:"span",icon:"icon-text",props:{value:"text"}},{name:"视频",type:"video",tag:"video",icon:"icon-video",props:{src:"",controls:!0,draggable:!1},style:{position:"relative",width:"100%",height:"100%","object-fit":"fill","z-index":-1}},{name:"嵌入页",type:"iframe",tag:"iframe",icon:"icon-HTML",props:{src:"http://120.26.161.36:8080/",draggable:!1},style:{position:"relative",width:"100%",height:"100%","z-index":-1},formId:"6ba21979-d5ec-4715-831e-62046fbfb0d9"},{name:"柱状图",type:"bar",tag:"g-echart",icon:"icon-barchart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"bar"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"折线图",type:"line",tag:"g-echart",icon:"icon-linechart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"line"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"组",type:"group",tag:"visual-group",icon:"icon-deploymentunit",props:{data:[]}}];class Q{constructor(o,t){I(this,"name","组件");I(this,"id");I(this,"type");I(this,"tag");I(this,"icon");I(this,"props");I(this,"style");I(this,"formId","");I(this,"position",{top:0,left:0});I(this,"size",{width:0,height:0});this.id=t||nt(),this.type=o;const e=bt.find(s=>s.type===o),a=G(e);e?(this.tag=a.tag,this.props=a.props,this.name=a.name,this.style=a.style,this.icon=a.icon,this.formId=a.formId):(this.tag="div",this.icon="icon")}}const xt=n=>{let o=null,t=null,e=0,a=0;return n.forEach(s=>{o=o==null?s.position.left:Math.min(o,s.position.left),t=t==null?s.position.top:Math.min(t,s.position.top),e=Math.max(e,s.position.left+s.size.width),a=Math.max(a,s.position.top+s.size.height)}),{left:o,top:t,width:e-o,height:a-t}},Ct=n=>{const{left:o,top:t,width:e,height:a}=xt(n),s=new Q("group");return s.position={top:t,left:o},s.size={width:e,height:a},s.props={data:n.map(m=>({...m,position:{left:m.position.left-o,top:m.position.top-t}}))},s},wt=n=>{const{position:{left:o,top:t}}=n;return n.props.data.map(e=>(e.position.left=Number(e.position.left)+o,e.position.top=Number(e.position.top)+t,e))},Dt=(n,o,t)=>{const{height:e,width:a}=n,{height:s,width:m}=o,i=(m-a)/a,l=(s-e)/e,r=t.props.data;return t.props.data=r.map(h=>({...h,position:{left:(h.position.left*(1+i)).toFixed(2),top:(h.position.top*(1+l)).toFixed(2)},size:{width:(h.size.width*(1+i)).toFixed(2),height:(h.size.height*(1+l)).toFixed(2)}})),t},Y=10,R=at("visual",()=>{const n=x({componentData:[],name:"",id:"",img:"",height:1080,width:1920}),o=x({name:"",type:"",id:"",props:{},tag:"",position:{top:0,left:0},size:{width:0,height:0},formId:""}),t=x([]),e=x(0),a=()=>{t.value[e.value++]=G(n.value.componentData),t.value.length>Y&&(t.value=t.value.slice(t.value.length-Y),e.value=Y)},s=()=>{e.value>0&&(e.value--,n.value.componentData=G(t.value[e.value]))},m=()=>{e.value<t.value.length-1&&(e.value++,n.value.componentData=G(t.value[e.value]))},i=_=>{const d=n.value.componentData.findIndex(b=>b.id===_.id);d!=-1&&(o.value=n.value.componentData[d])},l=_=>{n.value.componentData.push(_),i(_),a()},r=_=>{const d=n.value.componentData.findIndex(b=>b.id===_.id);d!=-1&&(n.value.componentData[d]=_,a())},h=_=>{const d=n.value.componentData.findIndex(b=>b.id===_.id);d!=-1&&(n.value.componentData.splice(d,1),a())},k=x([]),M=()=>{if(k.value.length){const _=n.value.componentData.filter(b=>k.value.includes(b.id)),d=Ct(_);_.forEach(b=>{h(b)}),l(d),z()}},C=()=>{const _=wt(o.value);h(o.value),_&&_.map(d=>{l(d)})},z=()=>{k.value=[]};return{undo:s,redo:m,setSnapshot:a,onClickComp:i,visualData:n,curCompData:o,addComp:l,removeComp:h,snapshotData:t,curSnapshotIdx:e,updateComp:r,frameSelection:k,addGroup:M,reduceGroup:C}}),kt={class:"cfg"},It=N({__name:"CfgArea",setup(n){const o=R(),{visualData:t,curCompData:e}=V(o),a=x("position");return(s,m)=>{const i=pt,l=rt;return g(),$("div",kt,[u(l,{activeKey:a.value,"onUpdate:activeKey":m[0]||(m[0]=r=>a.value=r)},{default:f(()=>[u(i,{key:"position",tab:"位置信息"},{default:f(()=>[u(P,{"form-data":v(e),id:"77c39b52-fde7-491f-9e94-9f2f1d65fb69"},null,8,["form-data"])]),_:1}),u(i,{key:"props",tab:"属性配置"},{default:f(()=>[v(e).formId?(g(),L(P,{"form-data":v(e),id:v(e).formId,key:v(e).formId},null,8,["form-data","id"])):J("",!0)]),_:1}),u(i,{key:"data",tab:"数据配置"},{default:f(()=>[S("Content of Tab 3")]),_:1})]),_:1},8,["activeKey"])])}}}),St=B(It,[["__scopeId","data-v-f0d0ccaa"]]),zt=N({__name:"DesignArea",setup(n){const o=R(),{visualData:t,curCompData:e,frameSelection:a}=V(o),{onClickComp:s,setSnapshot:m,addComp:i,removeComp:l,updateComp:r,addGroup:h}=o,k=x(),M=x(!1),C=x({x:0,y:0}),z=x({x:0,y:0}),_=c=>{M.value=!0,C.value.x=c.offsetX,C.value.y=c.offsetY;const w=U=>{let D=U;z.value.x=D.offsetX,z.value.y=D.offsetY},p=()=>{document.querySelector(".container").removeEventListener("mousemove",w),document.querySelector(".container").removeEventListener("mouseup",p),d()};document.querySelector(".container").addEventListener("mousemove",w),document.querySelector(".container").addEventListener("mouseup",p)},d=()=>{t.value.componentData.map(c=>{c.position.left>=C.value.x&&c.position.left+c.size.width<=z.value.x&&c.position.top>=C.value.y&&c.position.top+c.size.height<=z.value.y&&a.value.push(c.id)}),z.value={x:0,y:0},C.value={x:0,y:0}},b=c=>{c.preventDefault()},F=c=>{c.preventDefault();let w=JSON.parse(c.dataTransfer.getData("componentData"));w&&(w=new Q(w.name),w.position={top:c.offsetY,left:c.offsetX},w.size={width:100,height:100},i(w))},T=x({}),O=c=>{T.value=c},Z=st(c=>{const{nodeKey:w}=c;let p=t.value.componentData.findIndex(U=>U.id===w);p!=-1&&t.value.componentData[p].type=="group"&&w==T.value.nodeKey&&r(Dt(T.value,c,t.value.componentData[p])),m()},100);return document.body.addEventListener("keydown",c=>{c.ctrlKey&&c.key==="g"&&(c.preventDefault(),h())}),(c,w)=>(g(),$("div",{ref_key:"container",ref:k,class:"container",onDragover:b,onDrop:F,onMousedown:_},[(g(!0),$(A,null,K(v(t).componentData,(p,U)=>(g(),L(v(yt),{key:p.id,minh:20,minw:20,width:p.size.width,"onUpdate:width":D=>p.size.width=D,height:p.size.height,"onUpdate:height":D=>p.size.height=D,top:p.position.top,"onUpdate:top":D=>p.position.top=D,left:p.position.left,"onUpdate:left":D=>p.position.left=D,"node-key":p.id,active:p.id==v(e).id||v(a).includes(p.id),class:"drag",style:W({zIndex:`${U+100}`}),wait:10,onUpdate:v(Z),onClick:X(D=>v(s)(p),["stop"]),onMousedown:X(D=>v(s)(p),["stop"]),onBeforeTransform:O},{default:f(()=>[(g(),L(j(p.tag),ct({ref_for:!0},p.props,{style:p.style||{}}),null,16,["style"]))]),_:2},1032,["width","onUpdate:width","height","onUpdate:height","top","onUpdate:top","left","onUpdate:left","node-key","active","style","onUpdate","onClick","onMousedown"]))),128)),it(y("div",{class:"mask",style:W({width:z.value.x-C.value.x+"px",height:z.value.y-C.value.y+"px",top:C.value.y+"px",left:C.value.x+"px"})},null,4),[[lt,M.value]])],544))}}),$t=B(zt,[["__scopeId","data-v-e8948fe6"]]),Mt=["title"],Tt=N({__name:"NodeRelationship",setup(n){const o=R(),{visualData:t}=V(o),{onClickComp:e}=o,a=(i,l)=>{e(l.node.dataRef)},s=i=>{let l={id:i.id,type:i.type,children:[],icon:i.icon,name:i.name};return l.type=="group"&&i.props.data.length>0&&(l.children=i.props.data.map(r=>s(r))),l},m=q(()=>{let i=[];return t.value.componentData.map(l=>{i.push(s(l))}),i});return(i,l)=>{const r=dt;return g(),L(r,{class:"draggable-tree","block-node":"","tree-data":m.value,showIcon:!1,onSelect:a,fieldNames:{title:"name",key:"id",children:"children"}},{title:f(({name:h,data:k})=>[y("div",{title:`${h}(${k.id})`},[y("i",{class:E(["iconfont",k.icon])},null,2),S(" "+H(h),1)],8,Mt)]),_:1},8,["tree-data"])}}}),Lt=B(Tt,[["__scopeId","data-v-2ebb698b"]]),At={class:"component-layout"},Nt=["data-component"],Bt={class:"component-item-text"},Ut=N({__name:"MaterialArea",setup(n){const o=x(),t=[{title:"基础组件",value:"base",list:[{label:"图片",icon:"icon-image1",name:"img"},{label:"文本",icon:"icon-text",name:"text"},{label:"视频",name:"video",icon:"icon-video"},{label:"嵌入页",name:"iframe",icon:"icon-HTML"}]},{title:"图表",value:"echart",list:[{label:"柱状图",icon:"icon-barchart",name:"bar"},{label:"折线图",icon:"icon-linechart",name:"line"}]}],e=a=>{a&&a.target&&a.dataTransfer&&a.dataTransfer.setData("componentData",a.target.getAttribute("data-component"))};return(a,s)=>{const m=ut,i=ft;return g(),L(i,{activeKey:o.value,"onUpdate:activeKey":s[0]||(s[0]=l=>o.value=l),class:"material-area",ghost:!0},{default:f(()=>[(g(),$(A,null,K(t,l=>u(m,{header:l.title,key:l.value},{default:f(()=>[y("div",At,[(g(!0),$(A,null,K(l.list,r=>(g(),$("div",{class:"component-item",key:r.name,draggable:"true",onDragstart:e,"data-component":JSON.stringify(r)},[y("span",{class:E(["iconfont component-item-icon",r.icon])},null,2),y("span",Bt,H(r.label),1)],40,Nt))),128))])]),_:2},1032,["header"])),64))]),_:1},8,["activeKey"])}}}),Et=B(Ut,[["__scopeId","data-v-625d7f87"]]),Gt={class:"left-side-bar"},Kt={class:"bar-top"},Vt=["title","onClick"],Rt={class:"header"},Ft={class:"title"},Ot={class:"container"},Yt=N({__name:"LeftSideBar",setup(n){const o=[{label:"素材库",value:"componentLib",icon:"appstoreadd",component:Et},{label:"节点关系",value:"nodeRelationship",icon:"link",component:Lt}],t=x(),e=x(!0),a=()=>{e.value=!e.value},s=i=>{t.value=i},m=()=>{t.value=void 0};return(i,l)=>(g(),$(A,null,[y("div",Gt,[y("ul",Kt,[(g(),$(A,null,K(o,r=>y("li",{key:r.value,title:r.label,class:E([`iconfont icon-${r.icon}`,t.value&&t.value.value===r.value?"active":""]),onClick:h=>s(r)},null,10,Vt)),64))])]),t.value?(g(),$("div",{class:E(["left-part",e.value?"affix":""]),key:t.value.value},[y("div",Rt,[y("div",Ft,H(t.value.label),1),y("div",{class:E(["affix iconfont",e.value?"icon-pushpin-fill":"icon-pushpin"]),onClick:a},null,2),y("div",{class:"close iconfont icon-close",onClick:m})]),y("div",Ot,[(g(),L(j(t.value.component)))])],2)):J("",!0)],64))}}),qt=B(Yt,[["__scopeId","data-v-28502db2"]]),Ht={class:"design-container"},Pt=N({__name:"VisualEditor",setup(n){const o=R(),{undo:t,redo:e,addGroup:a,reduceGroup:s}=o,{curCompData:m,frameSelection:i}=V(o),l=ot(),r=q(()=>"title"),h=q(()=>"desc"),k=()=>{},M=()=>{},C=()=>{l.go(-1)};return(z,_)=>{const d=_t,b=vt,F=ht,T=gt,O=mt;return g(),$(A,null,[u(O,{title:r.value,subTitle:h.value,onBack:C,ghost:!1,style:{padding:"10px 24px"}},{extra:f(()=>[u(F,null,{default:f(()=>[u(b,null,{default:f(()=>[u(d,{disabled:!v(i).length,onClick:v(a)},{default:f(()=>[S(" 成组 ")]),_:1},8,["disabled","onClick"]),u(d,{disabled:v(m).type!="group",onClick:v(s)},{default:f(()=>[S(" 取消分组 ")]),_:1},8,["disabled","onClick"])]),_:1}),u(b,null,{default:f(()=>[u(d,{onClick:v(t)},{default:f(()=>[S("撤销")]),_:1},8,["onClick"]),u(d,{onClick:v(e)},{default:f(()=>[S("重做")]),_:1},8,["onClick"])]),_:1}),u(d,null,{default:f(()=>[S("加载外部组件")]),_:1}),u(d,{onClick:k,class:"variable-btn"},{default:f(()=>[S(" 变量池配置 ")]),_:1}),u(d,{onClick:M,type:"primary",class:"save-btn"},{default:f(()=>[S(" 保存 ")]),_:1})]),_:1})]),tags:f(()=>[u(T,{color:"#87d068"},{default:f(()=>[S("启用")]),_:1}),u(T,{color:"#f50"},{default:f(()=>[S("停用")]),_:1})]),_:1},8,["title","subTitle"]),y("div",Ht,[u(qt,{class:"left-sider"}),u($t),u(St)])],64)}}}),Be=B(Pt,[["__scopeId","data-v-cf4f0c0b"]]);export{Be as default};
