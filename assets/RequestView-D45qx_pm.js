import{a9 as D,aa as Pe,d as me,L as Te,M as qe,e as r,w as De,ab as Fe,h as z,N as _,O as w,U as y,a7 as Oe,W as ee,a5 as g,k as e,V as t,Z as E,Q as _e,a2 as Re,B as Ue,a3 as de,a0 as d,a4 as re,a1 as F}from"./index-zZenVJyi.js";import{_ as j}from"./lodash-CmFMvF3r.js";import{v as ie}from"./v4-CQkTLCs1.js";import{P as pe,M as Se}from"./PlusCircleOutlined-DoB8XZfW.js";import{B as ce,I as ve,_ as Ae,F as Be}from"./index-D9b0YG0K.js";import{S as fe,T as Me,_ as $e,a as Ke}from"./index-DK8MMHZs.js";import{b as ye,_ as je,a as ze}from"./index-CULPYIt3.js";import{C as Ee,_ as Le,a as Ge,b as Qe,T as We,S as Ze}from"./index-Dcq4Csls.js";import{M as He}from"./index-D7FkeaBf.js";import{D as Je,a as Xe}from"./index-BJQtoqRf.js";import"./index-D8Wg6yGu.js";import"./PlusOutlined-jRU3ZTOg.js";import"./FolderOutlined-BasV0p63.js";const V={getList:c=>D({method:"get",url:"request/list",params:c}),getDetail:c=>D({method:"get",url:"request/detail",params:{id:c}}),remove:c=>D({method:"get",url:"request/remove",params:{id:c}}),add:c=>D({method:"post",url:"request/add",data:c}),update:c=>D({method:"post",url:"request/update",data:c}),run:c=>Pe({method:"get",url:"/prod/request/proxy",params:{id:c}})},Ye={key:2,style:{display:"flex"}},et=me({__name:"EditTable",props:Te({columns:{},action:{type:Boolean,default:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const m=qe(c,"modelValue"),v=r([]);De(()=>m,()=>{v.value=m.value.map(s=>({_id_:ie(),...s}))},{deep:!0,immediate:!0});let L=c;const{columns:k,action:G}=Fe(L),N=z(()=>U("input")),O=z(()=>U("select")),Q=z(()=>G.value?[...k.value,{title:"操作",dataIndex:"_action_"}]:k.value),R=s=>{var n;return((n=k.value.find(l=>l.dataIndex==s))==null?void 0:n.options)||[]},U=s=>k.value.filter(n=>n.type==s).map(n=>n.dataIndex),P=(s,n,l)=>{v.value.find(i=>i._id_==s)[n]=l,m.value=v.value.map(i=>{let I=j.cloneDeep(i);return Reflect.deleteProperty(I,"_id_"),I})},S=()=>{let s=ie(),n=j.cloneDeep({_id_:s});k.value.map(l=>{Reflect.set(n,l.dataIndex,"")}),v.value.push(n)},W=s=>{let n=v.value.findIndex(l=>l._id_==s);v.value.splice(n,1),console.log(v.value.map(l=>{let i=j.cloneDeep(l);return Reflect.deleteProperty(i,"_id_"),i})),m.value=v.value.map(l=>{let i=j.cloneDeep(l);return Reflect.deleteProperty(i,"_id_"),i})};return(s,n)=>{const l=ce,i=ve,I=fe,A=ye;return _(),w(E,null,[v.value.length==0?(_(),y(l,{key:0,type:"text",onClick:S,icon:Oe(ee(pe))},null,8,["icon"])):g("",!0),e(A,{columns:Q.value,"data-source":v.value,pagination:!1,rowKey:f=>f._id_,size:"small",scroll:{y:150}},{bodyCell:t(({column:f,index:B,record:T})=>[N.value.includes(f.dataIndex)?(_(),y(i,{key:0,value:v.value[B][f.dataIndex],onChange:b=>P(T._id_,f.dataIndex,b.target.value)},null,8,["value","onChange"])):g("",!0),O.value.includes(f.dataIndex)?(_(),y(I,{key:1,value:v.value[B][f.dataIndex],options:R(f.dataIndex),onChange:b=>{P(T._id_,f.dataIndex,b)}},null,8,["value","options","onChange"])):g("",!0),f.dataIndex=="_action_"?(_(),w("div",Ye,[e(ee(pe),{class:"icon",onClick:n[0]||(n[0]=b=>S())}),e(ee(Se),{class:"icon",onClick:b=>W(T._id_)},null,8,["onClick"])])):g("",!0)]),_:1},8,["columns","data-source","rowKey"])],64)}}}),te=_e(et,[["__scopeId","data-v-3f93f8dc"]]),tt={class:"request"},at={class:"tools"},lt=me({__name:"RequestView",setup(c){const m=Re({keyword:"",pageNumber:1,pageSize:10,url:""}),v=r("params"),L=r([{value:"get",label:"GET"},{value:"post",label:"POST"}]),k=r([]),G=r([{title:"API名称",key:"apiName",dataIndex:"apiName"},{title:"请求地址",key:"url",dataIndex:"url"},{title:"请求方式",key:"method",dataIndex:"method",width:100},{title:"状态",key:"status",dataIndex:"status",width:100},{title:"创建时间",key:"createTime",dataIndex:"createTime"},{title:"备注",key:"desc",dataIndex:"desc"},{title:"操作",key:"action",dataIndex:"action"}]),N=r(!1),O=r([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),Q=r([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"}]),R=r(),U=()=>{var u;(u=R.value)==null||u.resetFields(),s()},P=r(0),S=()=>{m.pageNumber=1,m.pageSize=10,s()},W=u=>{const{current:a,pageSize:p}=u;m.pageNumber=a,m.pageSize=p,s()},s=()=>{N.value=!0,V.getList(m).then(u=>{const{code:a,data:p}=u;a==200&&(k.value=p.data,P.value=p.total),N.value=!1})};Ue(()=>{s()});const n=r(!1),l=r({url:"",method:"get",apiName:"",params:[{key:"",value:"",var:""}],body:[{key:"",value:"",var:""}],headers:[{key:"",value:""}],status:1,desc:""}),i=r("add"),I=z(()=>({add:"新增API",edit:"编辑API"})[i.value]),A=r(),f=()=>{i.value="add",n.value=!0,l.value={url:"",method:"get",apiName:"",params:[{key:"",value:"",var:""}],body:[{key:"",value:"",var:""}],headers:[{key:"",value:""}],status:1,desc:""}},B=async u=>{const{code:a,data:p}=await V.getDetail(u.id);a==200&&(l.value=p,console.log(l.value),i.value="edit",n.value=!0)},T=async u=>{const{code:a,msg:p,data:x}=await V.remove(u.id);a==200&&(de.success(x),s())},b=()=>{var u;(u=A.value)==null||u.resetFields()},ge=()=>{let u;i.value=="add"?u=V.add:u=V.update,u(l.value).then(a=>{const{code:p}=a;p==200&&(de.success(i.value=="add"?"新增成功":"编辑成功"),s()),b(),n.value=!1})},Z=r(!1),M=r({apiName:"",url:"",method:"get",status:1}),ae=r(),H=r(!1),J=r(!1),ke=u=>{Z.value=!0,M.value=u,H.value=!0,V.run(u.id).then(a=>{const{code:p}=a.data;H.value=!1,ae.value=a.data,p==200?J.value=!0:J.value=!1})};return(u,a)=>{const p=ve,x=Ae,X=Le,h=ce,be=Ge,le=Be,oe=Ee,$=Me,K=je,xe=ze,Ce=ye,ne=$e,Ie=Ke,he=fe,Y=Qe,Ve=We,ue=He,we=Ze,q=Je,Ne=Xe;return _(),w("div",tt,[e(oe,{class:"search-area"},{default:t(()=>[e(le,{ref_key:"searchFormRef",ref:R,model:m,onFinish:S},{default:t(()=>[e(be,{gutter:24},{default:t(()=>[e(X,{span:4},{default:t(()=>[e(x,{label:"API名称",name:"keyword"},{default:t(()=>[e(p,{value:m.keyword,"onUpdate:value":a[0]||(a[0]=o=>m.keyword=o)},null,8,["value"])]),_:1})]),_:1}),e(X,{span:4},{default:t(()=>[e(x,{label:"地址",name:"url"},{default:t(()=>[e(p,{value:m.url,"onUpdate:value":a[1]||(a[1]=o=>m.url=o)},null,8,["value"])]),_:1})]),_:1}),e(X,{span:4,style:{"text-align":"right"}},{default:t(()=>[e(h,{type:"primary","html-type":"submit"},{default:t(()=>[d("搜索")]),_:1}),e(h,{style:{margin:"0 8px"},onClick:U},{default:t(()=>[d(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(oe,null,{default:t(()=>[re("div",at,[e(h,{type:"primary",onClick:f},{default:t(()=>[d("新增")]),_:1})]),e(Ce,{loading:N.value,columns:G.value,"data-source":k.value,scroll:{y:440},onChange:W,pagination:{current:m.pageNumber,total:P.value}},{bodyCell:t(({column:o,record:C})=>[o.key=="status"?(_(),w(E,{key:0},[C.status?(_(),y($,{key:0,color:"#87d068"},{default:t(()=>[d("启用")]),_:1})):(_(),y($,{key:1,color:"#f50"},{default:t(()=>[d("停用")]),_:1}))],64)):g("",!0),o.key=="action"?(_(),w(E,{key:1},[C.status?(_(),y(h,{key:0,type:"link",onClick:se=>ke(C)},{default:t(()=>[d("执行")]),_:2},1032,["onClick"])):g("",!0),e(K,{type:"vertical"}),e(h,{type:"link",onClick:se=>B(C)},{default:t(()=>[d("编辑")]),_:2},1032,["onClick"]),e(K,{type:"vertical"}),e(xe,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:se=>T(C)},{default:t(()=>[e(h,{type:"link",danger:""},{default:t(()=>[d("删除")]),_:1})]),_:2},1032,["onConfirm"])],64)):g("",!0),o.key=="method"?(_(),w(E,{key:2},[C.method=="get"?(_(),y($,{key:0,color:"#2db7f5"},{default:t(()=>[d("GET")]),_:1})):g("",!0),C.method=="post"?(_(),y($,{key:1,color:"#87d068"},{default:t(()=>[d("POST")]),_:1})):g("",!0)],64)):g("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),e(ue,{open:n.value,"onUpdate:open":a[11]||(a[11]=o=>n.value=o),onOk:ge,title:I.value,onCancel:b},{default:t(()=>[e(K,null,{default:t(()=>[d("API信息")]),_:1}),e(le,{model:l.value,"label-col":{span:4},ref_key:"modalFormRef",ref:A},{default:t(()=>[e(x,{label:"API名"},{default:t(()=>[e(p,{value:l.value.apiName,"onUpdate:value":a[2]||(a[2]=o=>l.value.apiName=o)},null,8,["value"])]),_:1}),e(x,{label:"状态"},{default:t(()=>[e(Ie,{value:l.value.status,"onUpdate:value":a[3]||(a[3]=o=>l.value.status=o),"button-style":"solid"},{default:t(()=>[e(ne,{value:1},{default:t(()=>[d("启用 ")]),_:1}),e(ne,{value:0},{default:t(()=>[d("停用 ")]),_:1})]),_:1},8,["value"])]),_:1}),e(x,{label:"备注"},{default:t(()=>[e(p,{value:l.value.desc,"onUpdate:value":a[4]||(a[4]=o=>l.value.desc=o)},null,8,["value"])]),_:1}),e(K,null,{default:t(()=>[d("接口定义")]),_:1}),e(p,{value:l.value.url,"onUpdate:value":a[6]||(a[6]=o=>l.value.url=o)},{addonBefore:t(()=>[e(he,{value:l.value.method,"onUpdate:value":a[5]||(a[5]=o=>l.value.method=o),options:L.value},null,8,["value","options"])]),_:1},8,["value"]),re("div",null,[e(Ve,{activeKey:v.value,"onUpdate:activeKey":a[10]||(a[10]=o=>v.value=o)},{default:t(()=>[e(Y,{key:"params",tab:"params"},{default:t(()=>[e(te,{columns:O.value,modelValue:l.value.params,"onUpdate:modelValue":a[7]||(a[7]=o=>l.value.params=o)},null,8,["columns","modelValue"])]),_:1}),e(Y,{key:"headers",tab:"headers"},{default:t(()=>[e(te,{columns:Q.value,modelValue:l.value.headers,"onUpdate:modelValue":a[8]||(a[8]=o=>l.value.headers=o)},null,8,["columns","modelValue"])]),_:1}),e(Y,{key:"body",tab:"body"},{default:t(()=>[e(te,{columns:O.value,modelValue:l.value.body,"onUpdate:modelValue":a[9]||(a[9]=o=>l.value.body=o)},null,8,["columns","modelValue"])]),_:1})]),_:1},8,["activeKey"])])]),_:1},8,["model"])]),_:1},8,["open","title"]),e(ue,{open:Z.value,"onUpdate:open":a[12]||(a[12]=o=>Z.value=o),title:"执行结果",footer:null},{default:t(()=>[H.value?(_(),y(we,{key:0})):(_(),y(Ne,{key:1,layout:"horizontal"},{default:t(()=>[e(q,{label:"API名称",span:3},{default:t(()=>[d(F(M.value.apiName),1)]),_:1}),e(q,{label:"请求地址",span:3},{default:t(()=>[d(F(M.value.url),1)]),_:1}),e(q,{label:"请求方式",span:3},{default:t(()=>[d(F(M.value.method),1)]),_:1}),e(q,{label:"调用结果",span:3},{default:t(()=>[d(F(J.value?"成功":"失败"),1)]),_:1}),e(q,{label:"返回信息",contentStyle:{"max-height":"300px","overflow-y":"auto"},span:4},{default:t(()=>[d(F(ae.value),1)]),_:1})]),_:1}))]),_:1},8,["open"])])}}}),yt=_e(lt,[["__scopeId","data-v-44c41d3e"]]);export{yt as default};
