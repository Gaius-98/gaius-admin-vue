import{b as j}from"./gaius-utils-Bpz_sNTY.js";import{F as E,i as L,h as P,A as N,o as $,p as V,q as m,G as q,r as R,f as A}from"./ant-design-vue-CaKXcGcF.js";import{c as G}from"./lodash-es-PU94eZQX.js";import{L as K,i as T,r as F,h as c,ag as U}from"./@vue-fHF42jnH.js";const z=n=>{const e=/\$\{([^}]+)\}/g,a=n.match(e);return a?a.map(o=>{const u=o.trim().replace(/formData./g,"");return u.substring(2,u.length-1)}):[]},B=(n,e)=>{const a=/\$\{([^}]+)\}/g;return n.replace(a,(u,r)=>{const s=r.trim();return h({formData:e},s)})},O=(n,e)=>{const a=B(n,e);return new Function(`return ${a}`)()},h=(n,e)=>e.split(".").reduce((o,u)=>o[u],n),b=(n,e,a)=>{const o=e.split(".");o.reduce((u,r,s)=>(s===o.length-1&&(u[r]=a),u[r]),n)},H=(n,e,a,o,u)=>{let r;switch(a){case"string":r=c(P,{...u,value:h(n,e),onChange:s=>{b(n,e,s.target.value),o.pubSub.onPublish(e),o.onChange({formData:n,field:e,value:s.target.value})}});break;case"select":r=c(A,{...u,options:o.options[e]||[],value:h(n,e),onChange:s=>{b(n,e,s),o.pubSub.onPublish(e),o.onChange({formData:n,field:e,value:s})}});break;case"number":r=c(R,{...u,value:h(n,e),onChange:s=>{b(n,e,s),o.pubSub.onPublish(e),o.onChange({formData:n,field:e,value:s})}});break;case"date":r=c(q,{...u,value:h(n,e),onChange:s=>{b(n,e,s),o.pubSub.onPublish(e),o.onChange({formData:n,field:e,value:s})}});break;case"tree":r=c(m,{...u,options:o.options[e]||[],value:h(n,e),onChange:s=>{b(n,e,s),o.onChange({formData:n,field:e,value:s})}});break;case"radio":r=c(V,{...u,value:h(n,e),onChange:s=>{b(n,e,s.target.value),o.pubSub.onPublish(e),o.onChange({formData:n,field:e,value:s.target.value})}},(o.options[e]||[]).map(s=>c($,{value:s.value,key:s.value},s.label)));break;case"switch":r=c(N,{checked:h(n,e),onChange(s){b(n,e,s),o.pubSub.onPublish(e),o.onChange({formData:n,field:e,value:s})}});break;default:r=c(P,{...u,value:h(n,e),onChange:s=>{b(n,e,s.target.value),o.pubSub.onPublish(e),o.onChange({formData:n,field:e,value:s.target.value})}});break}return r},J=(n,e,a,o)=>{const{type:u,label:r,component:s,rules:_,tooltip:w}=a;let d;if(s!=null&&s.name){const{name:v}=s,f=G(s);if(Reflect.deleteProperty(f,"onChange"),!o.sfProvideEL[v])throw new Error(`${v} is not registered,provide('sfProvideEL','${v}',Component)`);d=c(o.sfProvideEL[v],{...f,formData:n,value:h(n,e),onChange:C=>{if(n[e]=C,b(n,e,C),s.onChange)try{s.onChange(C,n,e)}catch(p){throw new Error(p)}}})}else d=H(n,e,u,o,s);return o.visibleInfo[e]&&c(L,{label:r,name:e,rules:_,tooltip:w},[d])},Y={name:"SchemaForm",props:{layout:{type:Object},properties:{type:Object},formData:{type:Object,required:!0}},setup(n){const{layout:e,properties:a,formData:o}=K(n),u=T("sfProvideEL"),r=F({}),s=Object.entries(a.value).filter(([,t])=>{var i,l;return((i=t==null?void 0:t.component)==null?void 0:i.dataSource)||((l=t==null?void 0:t.component)==null?void 0:l.asyncData)}),_=async(t,i)=>{const{dataSource:l,asyncData:g}=i.component;l?r.value[t]=l:r.value[t]=await g(o.value,t)};s.map(async([t,i])=>{await _(t,i)});const w=t=>{const[i,l]=Object.entries(a.value).find(([g])=>t==g);l&&_(i,l)},d=new j,v=t=>{var g,S;const{field:i}=t,l=(S=(g=a.value[i])==null?void 0:g.component)==null?void 0:S.onChange;l&&l(t)},f=U(),C=()=>{Object.entries(a.value).map(([t,i])=>{if(typeof i.show>"u")p.value[t]=!0;else if(typeof i.show=="boolean")p.value[t]=i.show;else if(typeof i.show=="string"){const l=i.show;p.value[t]=O(l,o.value),z(l).map(S=>{d.onSubscribe(S,()=>{p.value[t]=O(l,o.value)})})}})},p=F({});return C(),{layout:e,properties:a,refreshOption:w,formData:o,options:r,visibleInfo:p,pubSub:d,sfProvideEL:u,onChange:v,expose:f}},render:n=>c(E,{...n.layout},[...Object.entries(n.properties).map(([e,a])=>J(n.formData,e,a,n))])};export{Y as S};
