import{S as x}from"./SchemaForm-BaKynltK.js";import{D as ae}from"./DragTableHeader-BC65qH81.js";import{ay as oe,r as s,d as F,B as O,D as S,I as z,g as e,F as o,G as u,V as M,E as k,aC as le,au as ne,p as A,aD as se,S as C,K as re,M as v,O as E,a0 as ue,a1 as ie}from"./index-BZm-G3qC.js";import{C as pe,T as ce,_ as de}from"./ActionButton-C-Y7yChP.js";import{_ as me}from"./index-CGCozVeK.js";import{a as K}from"./table-D9g1ddpq.js";import{E as _e,h as fe}from"./EditTable-Btif7e7q.js";import{M as ve}from"./index-D162Q-Nj.js";import{B as be,_ as ye}from"./index-3qYqREXO.js";import{S as ge}from"./index-B37gRTvt.js";import{T as Se}from"./index-CtcC0UuT.js";import{_ as he}from"./index-CesQT6ol.js";import{_ as Ce}from"./index-LEy6n2xF.js";import"./index-D63AmW28.js";import"./index-CBy0NfVU.js";import"./SwapRightOutlined-VfCAuDaY.js";import"./index-BnisaXkq.js";import"./vue-draggable-next.esm-bundler-B-eJqFr4.js";import"./SwapOutlined-xKrs91O3.js";import"./index-Uecf5EQ1.js";import"./PlusOutlined-BUd1TO6A.js";import"./FolderOutlined-CDIT3Chu.js";import"./PlusCircleOutlined-4b4HhWCK.js";import"./ArrowRightOutlined-y8B3w9DY.js";import"./index-D-V1eNSy.js";const B=oe("tableDesign",()=>{const d=s({name:"",description:"",status:1,columns:[{id:"1",title:"测试",dataIndex:"test",type:"text"},{id:"2",title:"测试3",dataIndex:"test4",type:"text"}],global:{bordered:!1,pagination:{show:!1,current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[],img:""}),m=s({});return{tableCfg:d,currentColumn:m,onSelectColumn:(a,l)=>{const n=l.findIndex(_=>_.id===a);n!=-1&&(m.value=l[n])},onRemoveColumn:(a,l)=>{const n=l.findIndex(_=>_.id===a);n!=-1&&l.splice(n,1)}}}),De={class:"table-design-container"},we=F({__name:"TableDesign",setup(d){const m=B(),{tableCfg:p}=O(m),{onSelectColumn:b}=m,a=s([{test:1,test4:"e"}]),l=n=>{b(n.id,p.value.columns)};return(n,_)=>{const y=pe,f=me;return S(),z("div",De,[e(y,{class:"filter-panel"}),e(y,{class:"table-container"},{default:o(()=>[e(ae,{modelValue:u(p).columns,"onUpdate:modelValue":_[0]||(_[0]=g=>u(p).columns=g),onOnClick:l},null,8,["modelValue"]),e(f,{showHeader:!1,columns:u(p).columns,"data-source":a.value},null,8,["columns","data-source"])]),_:1})])}}}),xe=M(we,[["__scopeId","data-v-2c841b33"]]),ke={key:1},Ve=F({__name:"TableCfg",setup(d){const m=B(),p=s({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"string",label:"字段名"},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左固定"},{value:"right",label:"右固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),b=s("column"),a=s({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"pagination.show":{type:"switch",label:"是否分页"},"pagination.pageSize":{type:"number",label:"每页条数",show:"${formData.pagination.show}"}}}),{tableCfg:l,currentColumn:n}=O(m);return(_,y)=>{const f=le,g=de,V=ce;return S(),k(V,{activeKey:b.value,"onUpdate:activeKey":y[0]||(y[0]=T=>b.value=T)},{default:o(()=>[e(g,{key:"column",tab:"列配置"},{default:o(()=>[u(n).id?(S(),k(u(x),{layout:p.value.layout,properties:p.value.properties,formData:u(n),key:u(n).id},null,8,["layout","properties","formData"])):(S(),z("div",ke,[e(f)]))]),_:1}),e(g,{key:"global",tab:"全局配置"},{default:o(()=>[e(u(x),{layout:a.value.layout,properties:a.value.properties,formData:u(l).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),N=d=>(ue("data-v-902a8920"),d=d(),ie(),d),Te={class:"table-design"},Ie={class:"left-part"},Ue={class:"right-part"},Fe=N(()=>C("span",null,"(res)=>{",-1)),Oe=N(()=>C("span",null,"}",-1)),ze=F({__name:"TableEditor",props:{id:{}},setup(d){const m=d,{id:p}=ne(m),b=B(),{tableCfg:a}=O(b),l=s({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),n=s("");p.value?K.getDetail(p.value).then(c=>{const{code:t,data:i,msg:h}=c;t==200&&(a.value=i)}):(a.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,pagination:{show:!1,current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},img:"",variablePool:[]},l.value=a.value.dataSource);const _=A(()=>a.value.name?a.value.name:"新建表格"),y=A(()=>a.value.description?a.value.description:""),f=s(!1),g=s({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),V=()=>{f.value=!0},T=se(),G=()=>{T.go(-1)},H=()=>{f.value=!1},I=s(!1);s({});const j=()=>{I.value=!0},D=s(!1),$=s({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:c,data:t,msg:i}=await K.getApiList();return c==200?t.map(h=>({value:h.id,label:h.apiName})):[]}}}}}),J=()=>{D.value=!0},L=()=>{a.value.dataSource=l.value,P()},P=()=>{l.value={type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},D.value=!1},q=()=>{let c={};return a.value.variablePool.reduce((t,i)=>(t[i.key]=i.defaultValue,t),c),c},Q=async()=>{const c=await fe.run(a.value.dataSource.interfaceUrl,q());return new Function("res",`${l.value.handlerFunc}`)(c.data)},W=async()=>{const c=await Q();n.value=JSON.stringify(c,null,2)},U=s(!1),X=s([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),Y=()=>{U.value=!0};return(c,t)=>{const i=be,h=ge,R=Se,Z=he,w=ve,ee=ye,te=Ce;return S(),z(re,null,[e(Z,{title:_.value,subTitle:y.value,onBack:G,ghost:!1,style:{padding:"10px 24px"}},{extra:o(()=>[e(h,null,{default:o(()=>[e(i,{onClick:J},{default:o(()=>[v(" 数据源配置 ")]),_:1}),e(i,{onClick:Y},{default:o(()=>[v(" 变量池配置 ")]),_:1}),e(i,{onClick:j},{default:o(()=>[v(" 预览 ")]),_:1}),e(i,{onClick:V,type:"primary"},{default:o(()=>[v(" 保存 ")]),_:1})]),_:1})]),tags:o(()=>[u(a).status?(S(),k(R,{key:0,color:"#87d068"},{default:o(()=>[v("启用")]),_:1})):(S(),k(R,{key:1,color:"#f50"},{default:o(()=>[v("停用")]),_:1}))]),_:1},8,["title","subTitle"]),C("div",Te,[C("div",Ie,[e(xe)]),C("div",Ue,[e(Ve)])]),e(w,{open:f.value,"onUpdate:open":t[0]||(t[0]=r=>f.value=r),title:"保存",onOk:H},{default:o(()=>[e(u(x),{layout:g.value.layout,properties:g.value.properties},null,8,["layout","properties"])]),_:1},8,["open"]),e(w,{open:I.value,"onUpdate:open":t[1]||(t[1]=r=>I.value=r),title:"预览"},null,8,["open"]),e(w,{open:D.value,"onUpdate:open":t[5]||(t[5]=r=>D.value=r),title:"数据源配置",onOk:L,onCancel:P},{default:o(()=>[e(u(x),{layout:$.value.layout,properties:$.value.properties,formData:l.value,"onUpdate:formData":t[2]||(t[2]=r=>l.value=r)},null,8,["layout","properties","formData"]),e(ee,{label:"数据预处理"},{default:o(()=>[Fe,e(E,{height:200,modelValue:l.value.handlerFunc,"onUpdate:modelValue":t[3]||(t[3]=r=>l.value.handlerFunc=r)},null,8,["modelValue"]),Oe]),_:1}),e(te,null,{default:o(()=>[v("结果区")]),_:1}),e(i,{type:"primary",style:{"margin-bottom":"5px"},onClick:W},{default:o(()=>[v("运行")]),_:1}),e(E,{height:200,disabled:"",modelValue:n.value,"onUpdate:modelValue":t[4]||(t[4]=r=>n.value=r)},null,8,["modelValue"])]),_:1},8,["open"]),e(w,{title:"变量池配置",open:U.value,footer:!1,onCancel:t[7]||(t[7]=r=>U.value=!1)},{default:o(()=>[e(_e,{columns:X.value,modelValue:u(a).variablePool,"onUpdate:modelValue":t[6]||(t[6]=r=>u(a).variablePool=r)},null,8,["columns","modelValue"])]),_:1},8,["open"])],64)}}}),nt=M(ze,[["__scopeId","data-v-902a8920"]]);export{nt as default};
