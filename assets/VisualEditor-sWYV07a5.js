var Z=Object.defineProperty;var ee=(n,o,e)=>o in n?Z(n,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[o]=e;var I=(n,o,e)=>ee(n,typeof o!="symbol"?o+"":o,e);import{u as te}from"./vue-router-C97ZxxSg.js";import{_ as oe}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-CoTtsdbZ.js";import{d as ae,s as R}from"./pinia-DZOJpVRk.js";import{v as ne}from"./uuid-CQkTLCs1.js";import{c as G,d as se}from"./lodash-es-PU94eZQX.js";import{r as w,d as N,U as g,V as M,u as v,a4 as A,ad as X,F as T,Y as V,a5 as m,af as P,G as W,x as ie,E as le,W as y,aa as J,a7 as ce,m as q,Z as U,J as z,a6 as H,c as h}from"./@vue-Ckf1Z535.js";import{b as B}from"./index-BNs7Cx_y.js";import{s as re}from"./gaius-utils-Zl0NLw_z.js";import{u as pe,z as de,A as ue,L as fe,B as me,Q as he,t as ve,T as _e}from"./ant-design-vue-CR-lDAfp.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-BLXUvuFI.js";import"./common-E0crLNiy.js";import"./form-CUiZJUzf.js";/* empty css                      */import"./axios-B4uVmeYG.js";import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-BDAzFyRD.js";import"./vue-codemirror-y6ZO4XMM.js";import"./codemirror-UNZxU4nK.js";import"./@codemirror-nPtzVHb7.js";import"./@lezer-mHvIgKxJ.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./@ant-design-C9fRTiaf.js";import"./@ctrl-DOFZgDuz.js";import"./echarts-DetEu2Tg.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CDo53BfZ.js";import"./@babel-BiFW4_mA.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-X-x4l2Bb.js";import"./throttle-debounce-CUWDS_la.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-C5fUfLeo.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";const ge=[{name:"图片",type:"img",tag:"img",icon:"icon-image1",props:{src:"https://avatars.githubusercontent.com/u/59641156?v=4",draggable:!1},style:{width:"100%",height:"100%"},formId:"c0c67e96-858b-4303-999c-92d0d39cb792"},{name:"文本",type:"text",tag:"span",icon:"icon-text",props:{value:"text"}},{name:"视频",type:"video",tag:"video",icon:"icon-video",props:{src:"",controls:!0,draggable:!1},style:{position:"relative",width:"100%",height:"100%","object-fit":"fill","z-index":-1}},{name:"嵌入页",type:"iframe",tag:"iframe",icon:"icon-HTML",props:{src:"http://120.26.161.36:8080/",draggable:!1},style:{position:"relative",width:"100%",height:"100%","z-index":-1},formId:"6ba21979-d5ec-4715-831e-62046fbfb0d9"},{name:"柱状图",type:"bar",tag:"g-echart",icon:"icon-barchart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"bar"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"折线图",type:"line",tag:"g-echart",icon:"icon-linechart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"line"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"组",type:"group",tag:"visual-group",icon:"icon-deploymentunit",props:{data:[]}}];class j{constructor(o,e){I(this,"name","组件");I(this,"id");I(this,"type");I(this,"tag");I(this,"icon");I(this,"props");I(this,"style");I(this,"formId","");I(this,"position",{top:0,left:0});I(this,"size",{width:0,height:0});this.id=e||ne(),this.type=o;const t=ge.find(s=>s.type===o),a=G(t);t?(this.tag=a.tag,this.props=a.props,this.name=a.name,this.style=a.style,this.icon=a.icon,this.formId=a.formId):(this.tag="div",this.icon="icon")}}const ye=n=>{let o=null,e=null,t=0,a=0;return n.forEach(s=>{o=o==null?s.position.left:Math.min(o,s.position.left),e=e==null?s.position.top:Math.min(e,s.position.top),t=Math.max(t,s.position.left+s.size.width),a=Math.max(a,s.position.top+s.size.height)}),{left:o,top:e,width:t-o,height:a-e}},xe=n=>{const{left:o,top:e,width:t,height:a}=ye(n),s=new j("group");return s.position={top:e,left:o},s.size={width:t,height:a},s.props={data:n.map(d=>({...d,position:{left:d.position.left-o,top:d.position.top-e}}))},s},be=n=>{const{position:{left:o,top:e}}=n;return n.props.data.map(t=>(t.position.left=Number(t.position.left)+o,t.position.top=Number(t.position.top)+e,t))},Ce=(n,o,e)=>{const{height:t,width:a}=n,{height:s,width:d}=o,_=(d-a)/a,i=(s-t)/t,l=e.props.data;return e.props.data=l.map(u=>({...u,position:{left:(u.position.left*(1+_)).toFixed(2),top:(u.position.top*(1+i)).toFixed(2)},size:{width:(u.size.width*(1+_)).toFixed(2),height:(u.size.height*(1+i)).toFixed(2)}})),e},Y=10,F=ae("visual",()=>{const n=w({componentData:[],name:"",id:"",img:"",height:1080,width:1920}),o=w({name:"",type:"",id:"",props:{},tag:"",position:{top:0,left:0},size:{width:0,height:0},formId:""}),e=w([]),t=w(0),a=()=>{e.value[t.value++]=G(n.value.componentData),e.value.length>Y&&(e.value=e.value.slice(e.value.length-Y),t.value=Y)},s=()=>{t.value>0&&(t.value--,n.value.componentData=G(e.value[t.value]))},d=()=>{t.value<e.value.length-1&&(t.value++,n.value.componentData=G(e.value[t.value]))},_=f=>{const p=n.value.componentData.findIndex(x=>x.id===f.id);p!=-1&&(o.value=n.value.componentData[p])},i=f=>{n.value.componentData.push(f),_(f),a()},l=f=>{const p=n.value.componentData.findIndex(x=>x.id===f.id);p!=-1&&(n.value.componentData[p]=f,a())},u=f=>{const p=n.value.componentData.findIndex(x=>x.id===f.id);p!=-1&&(n.value.componentData.splice(p,1),a())},k=w([]),$=()=>{if(k.value.length){const f=n.value.componentData.filter(x=>k.value.includes(x.id)),p=xe(f);f.forEach(x=>{u(x)}),i(p),S()}},b=()=>{const f=be(o.value);u(o.value),f&&f.map(p=>{i(p)})},S=()=>{k.value=[]};return{undo:s,redo:d,setSnapshot:a,onClickComp:_,visualData:n,curCompData:o,addComp:i,removeComp:u,snapshotData:e,curSnapshotIdx:t,updateComp:l,frameSelection:k,addGroup:$,reduceGroup:b}}),we={class:"cfg"},De=N({__name:"CfgArea",setup(n){const o=F(),{visualData:e,curCompData:t}=R(o);return(a,s)=>(g(),M("div",we,[v(t).formId?(g(),A(oe,{"form-data":v(t),id:v(t).formId,key:v(t).formId},null,8,["form-data","id"])):X("",!0)]))}}),ke=B(De,[["__scopeId","data-v-4dd99f10"]]),Ie=N({__name:"DesignArea",setup(n){const o=F(),{visualData:e,curCompData:t,frameSelection:a}=R(o),{onClickComp:s,setSnapshot:d,addComp:_,removeComp:i,updateComp:l,addGroup:u}=o,k=w(),$=w(!1),b=w({x:0,y:0}),S=w({x:0,y:0}),f=c=>{$.value=!0,b.value.x=c.offsetX,b.value.y=c.offsetY;const C=E=>{let D=E;S.value.x=D.offsetX,S.value.y=D.offsetY},r=()=>{document.querySelector(".container").removeEventListener("mousemove",C),document.querySelector(".container").removeEventListener("mouseup",r),p()};document.querySelector(".container").addEventListener("mousemove",C),document.querySelector(".container").addEventListener("mouseup",r)},p=()=>{e.value.componentData.map(c=>{c.position.left>=b.value.x&&c.position.left+c.size.width<=S.value.x&&c.position.top>=b.value.y&&c.position.top+c.size.height<=S.value.y&&a.value.push(c.id)}),S.value={x:0,y:0},b.value={x:0,y:0}},x=c=>{c.preventDefault()},K=c=>{c.preventDefault();let C=JSON.parse(c.dataTransfer.getData("componentData"));C&&(C=new j(C.name),C.position={top:c.offsetY,left:c.offsetX},C.size={width:100,height:100},_(C))},L=w({}),O=c=>{L.value=c},Q=se(c=>{const{nodeKey:C}=c;let r=e.value.componentData.findIndex(E=>E.id===C);r!=-1&&e.value.componentData[r].type=="group"&&C==L.value.nodeKey&&l(Ce(L.value,c,e.value.componentData[r])),d()},100);return document.body.addEventListener("keydown",c=>{c.ctrlKey&&c.key==="g"&&(c.preventDefault(),u())}),(c,C)=>(g(),M("div",{ref_key:"container",ref:k,class:"container",onDragover:x,onDrop:K,onMousedown:f},[(g(!0),M(T,null,V(v(e).componentData,(r,E)=>(g(),A(v(re),{key:r.id,minh:20,minw:20,width:r.size.width,"onUpdate:width":D=>r.size.width=D,height:r.size.height,"onUpdate:height":D=>r.size.height=D,top:r.position.top,"onUpdate:top":D=>r.position.top=D,left:r.position.left,"onUpdate:left":D=>r.position.left=D,"node-key":r.id,active:r.id==v(t).id||v(a).includes(r.id),class:"drag",style:P({zIndex:`${E+100}`}),wait:10,onUpdate:v(Q),onClick:W(D=>v(s)(r),["stop"]),onMousedown:W(D=>v(s)(r),["stop"]),onBeforeTransform:O},{default:m(()=>[(g(),A(J(r.tag),ce({ref_for:!0},r.props,{style:r.style||{}}),null,16,["style"]))]),_:2},1032,["width","onUpdate:width","height","onUpdate:height","top","onUpdate:top","left","onUpdate:left","node-key","active","style","onUpdate","onClick","onMousedown"]))),128)),ie(y("div",{class:"mask",style:P({width:S.value.x-b.value.x+"px",height:S.value.y-b.value.y+"px",top:b.value.y+"px",left:b.value.x+"px"})},null,4),[[le,$.value]])],544))}}),Se=B(Ie,[["__scopeId","data-v-e8948fe6"]]),ze=["title"],Me=N({__name:"NodeRelationship",setup(n){const o=F(),{visualData:e}=R(o),{onClickComp:t}=o,a=(i,l)=>{t(l.node.dataRef)},s=i=>{},d=i=>{let l={id:i.id,type:i.type,children:[],icon:i.icon,name:i.name};return l.type=="group"&&i.props.data.length>0&&(l.children=i.props.data.map(u=>d(u))),l},_=q(()=>{let i=[];return e.value.componentData.map(l=>{i.push(d(l))}),i});return(i,l)=>{const u=pe;return g(),A(u,{class:"draggable-tree",draggable:"","block-node":"","tree-data":_.value,showIcon:!1,onSelect:a,onDrop:s,fieldNames:{title:"name",key:"id",children:"children"}},{title:m(({name:k,data:$})=>[y("div",{title:`${k}(${$.id})`},[y("i",{class:U(["iconfont",$.icon])},null,2),z(" "+H(k),1)],8,ze)]),_:1},8,["tree-data"])}}}),$e=B(Me,[["__scopeId","data-v-d6059f81"]]),Le={class:"component-layout"},Ae=["data-component"],Te={class:"component-item-text"},Ne=N({__name:"MaterialArea",setup(n){const o=w(),e=[{title:"基础组件",value:"base",list:[{label:"图片",icon:"icon-image1",name:"img"},{label:"文本",icon:"icon-text",name:"text"},{label:"视频",name:"video",icon:"icon-video"},{label:"嵌入页",name:"iframe",icon:"icon-HTML"}]},{title:"图表",value:"echart",list:[{label:"柱状图",icon:"icon-barchart",name:"bar"},{label:"折线图",icon:"icon-linechart",name:"line"}]}],t=a=>{a&&a.target&&a.dataTransfer&&a.dataTransfer.setData("componentData",a.target.getAttribute("data-component"))};return(a,s)=>{const d=de,_=ue;return g(),A(_,{activeKey:o.value,"onUpdate:activeKey":s[0]||(s[0]=i=>o.value=i),class:"material-area",ghost:!0},{default:m(()=>[(g(),M(T,null,V(e,i=>h(d,{header:i.title,key:i.value},{default:m(()=>[y("div",Le,[(g(!0),M(T,null,V(i.list,l=>(g(),M("div",{class:"component-item",key:l.name,draggable:"true",onDragstart:t,"data-component":JSON.stringify(l)},[y("span",{class:U(["iconfont component-item-icon",l.icon])},null,2),y("span",Te,H(l.label),1)],40,Ae))),128))])]),_:2},1032,["header"])),64))]),_:1},8,["activeKey"])}}}),Be=B(Ne,[["__scopeId","data-v-625d7f87"]]),Ee={class:"left-side-bar"},Ue={class:"bar-top"},Ge=["title","onClick"],Ve={class:"header"},Re={class:"title"},Fe={class:"container"},Ke=N({__name:"LeftSideBar",setup(n){const o=[{label:"素材库",value:"componentLib",icon:"appstoreadd",component:Be},{label:"节点关系",value:"nodeRelationship",icon:"link",component:$e}],e=w(),t=w(!1),a=()=>{t.value=!t.value},s=_=>{e.value=_},d=()=>{e.value=void 0};return(_,i)=>(g(),M(T,null,[y("div",Ee,[y("ul",Ue,[(g(),M(T,null,V(o,l=>y("li",{key:l.value,title:l.label,class:U([`iconfont icon-${l.icon}`,e.value&&e.value.value===l.value?"active":""]),onClick:u=>s(l)},null,10,Ge)),64))])]),e.value?(g(),M("div",{class:U(["left-part",t.value?"affix":""]),key:e.value.value},[y("div",Ve,[y("div",Re,H(e.value.label),1),y("div",{class:U(["affix iconfont",t.value?"icon-pushpin-fill":"icon-pushpin"]),onClick:a},null,2),y("div",{class:"close iconfont icon-close",onClick:d})]),y("div",Fe,[(g(),A(J(e.value.component)))])],2)):X("",!0)],64))}}),Oe=B(Ke,[["__scopeId","data-v-49c5d324"]]),Ye={class:"design-container"},qe=N({__name:"VisualEditor",setup(n){const o=F(),{undo:e,redo:t,addGroup:a,reduceGroup:s}=o,{curCompData:d,frameSelection:_}=R(o),i=te(),l=q(()=>"title"),u=q(()=>"desc"),k=()=>{},$=()=>{},b=()=>{i.go(-1)};return(S,f)=>{const p=me,x=he,K=ve,L=_e,O=fe;return g(),M(T,null,[h(O,{title:l.value,subTitle:u.value,onBack:b,ghost:!1,style:{padding:"10px 24px"}},{extra:m(()=>[h(K,null,{default:m(()=>[h(x,null,{default:m(()=>[h(p,{disabled:!v(_).length,onClick:v(a)},{default:m(()=>[z(" 成组 ")]),_:1},8,["disabled","onClick"]),h(p,{disabled:v(d).type!="group",onClick:v(s)},{default:m(()=>[z(" 取消分组 ")]),_:1},8,["disabled","onClick"])]),_:1}),h(x,null,{default:m(()=>[h(p,{onClick:v(e)},{default:m(()=>[z("撤销")]),_:1},8,["onClick"]),h(p,{onClick:v(t)},{default:m(()=>[z("重做")]),_:1},8,["onClick"])]),_:1}),h(p,null,{default:m(()=>[z("加载外部组件")]),_:1}),h(p,{onClick:k,class:"variable-btn"},{default:m(()=>[z(" 变量池配置 ")]),_:1}),h(p,{onClick:$,type:"primary",class:"save-btn"},{default:m(()=>[z(" 保存 ")]),_:1})]),_:1})]),tags:m(()=>[h(L,{color:"#87d068"},{default:m(()=>[z("启用")]),_:1}),h(L,{color:"#f50"},{default:m(()=>[z("停用")]),_:1})]),_:1},8,["title","subTitle"]),y("div",Ye,[h(Oe,{class:"left-sider"}),h(Se),h(ke)])],64)}}}),Tt=B(qe,[["__scopeId","data-v-cf4f0c0b"]]);export{Tt as default};
