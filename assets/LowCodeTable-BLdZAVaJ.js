import{_ as J}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BeQCJfYO.js";import{t as ea}from"./table-BpMYzYZ7.js";import{h as ta}from"./http-CNoS_fJm.js";import{d as oa,ak as na,r,t as Q,w as X,J as c,L as D,a2 as V,U,M as s,a3 as I,g as l,R as T,a0 as j,a1 as la,as as ra,O as F,aa as Z,Q as A,X as B,a9 as G,Z as sa,ah as ia,a6 as ua}from"./index-WygQ6GTr.js";import{C as ca,_ as pa,a as ma}from"./index-Db1QJNWF.js";import{U as da}from"./index-CbOnQqH9.js";import{D as fa}from"./index-BEJX6f1I.js";import{S as _a}from"./index-DVltyFKK.js";import{S as va}from"./SyncOutlined-Ct2UqlNm.js";import{_ as ga,a as ya}from"./index-DGxLlZMB.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-Czmenc8-.js";import"./common-CsMbJs6O.js";import"./index-B4yLT25j.js";import"./index-DWpMSmtV.js";import"./index-B9G4MpOS.js";import"./SwapRightOutlined-BBt0i-Rw.js";import"./index-C_hcLp1K.js";import"./form-qedlrhg5.js";import"./index-DLNUyKMM.js";import"./EllipsisOutlined-BYkT9j9O.js";import"./index-D2-KKtI7.js";import"./index-BDrIS7bW.js";import"./FolderOutlined-YnMB68S4.js";import"./useBreakpoint-CQlYkPU6.js";import"./index-DuyXPHaZ.js";const ha=p=>{const _={};return p.reduce((m,e)=>(m[e.key]=e.defaultValue,m),_),_},ka=async(p,_,m)=>{try{const e=await ta.run(p.interfaceUrl,{..._,...m});let v;return p.handlerFunc?v=new Function("res",p.handlerFunc)(e.data):v=e,v}catch(e){return e}},S={getProxyData:ka,transformParamsData:ha},Ca={class:"low-code-table"},ba={style:{"font-size":"12px"}},wa={class:"tools"},xa=["href"],Da=oa({__name:"LowCodeTable",props:{id:{}},setup(p){const _=p,{id:m}=na(_),e=r({}),v=r([]),w=r({}),P=r(!1),K=()=>{w.value={},h()},y=r(!1),M=Q(()=>{var t,a,n,d,i,u;return((n=(a=(t=e.value)==null?void 0:t.global)==null?void 0:a.filterCfg)==null?void 0:n.show)&&((u=(i=(d=e.value)==null?void 0:d.global)==null?void 0:i.filterCfg)==null?void 0:u.formId)}),W=Q(()=>N.value.length>0?[...e.value.columns,{title:"操作",dataIndex:"_action",key:"_action",width:200,fixed:"right"}]:e.value.columns),g=r({}),R=r([]),N=r([]);X(()=>m.value,()=>{ea.getDetail(m.value).then(t=>{var i;const{code:a,data:n,msg:d}=t;a==200&&(e.value=n,e.value.global.actionCfg&&((i=e.value.global.actionCfg)==null?void 0:i.length)>0&&e.value.global.actionCfg.map(f=>{f.position=="header"?R.value.push(f):N.value.push(f)}),g.value=S.transformParamsData(e.value.variablePool),h())})},{immediate:!0}),X(()=>g.value,()=>{h()},{deep:!0});const q=r(0),h=async()=>{P.value=!0;try{const{data:t,total:a}=await S.getProxyData(e.value.dataSource,g.value,w.value);v.value=t,a&&(q.value=a)}catch(t){j.error("获取数据失败:"+t)}P.value=!1},x=r(!1),k=r({}),O=r({}),E=async(t,a)=>{const{formId:n,event:d,interfaceUrl:i,AfterHandleFunc:u,request:f,linkUrl:$,actionCfg:C}=t;if(f){const z=await S.getProxyData({type:"dynamic",interfaceUrl:i,handlerFunc:u},{},{...a});k.value=z}else k.value=a||{};switch(d){case"modal":O.value={id:n,modalUrl:C==null?void 0:C.interfaceUrl},x.value=!0;break;case"link":window.open($,"_blank");break}},H=()=>{k.value={},x.value=!1},Y=()=>{S.getProxyData({type:"dynamic",interfaceUrl:O.value.modalUrl,handlerFunc:""},{},{...k.value}).then(t=>{var a;j.info((a=t==null?void 0:t.data)==null?void 0:a.msg),H()}).catch(t=>{j.error(t)})};return(t,a)=>{const n=sa,d=pa,i=ma,u=ca,f=_a,$=ia,C=ga,z=ya,aa=la;return c(),D(T,null,[V("div",Ca,[M.value?(c(),U(u,{key:0,class:"filter-panel"},{default:s(()=>[l(J,{formData:w.value,id:e.value.global.filterCfg.formId,class:ra(["filter-form",y.value?"expand":""])},null,8,["formData","id","class"]),l(i,null,{default:s(()=>[l(d,{span:24,style:{"text-align":"right"}},{default:s(()=>[l(n,{type:"primary","html-type":"submit",onClick:h},{default:s(()=>[F("搜索")]),_:1}),l(n,{style:{margin:"0 8px"},onClick:K},{default:s(()=>[F("重置")]),_:1}),l(n,{type:"link",icon:Z(y.value?A(da):A(fa)),onClick:a[0]||(a[0]=o=>y.value=!y.value)},{default:s(()=>[V("span",ba,B(y.value?"收起":"展开"),1)]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})):I("",!0),l(u,{class:"table-container"},{default:s(()=>[V("div",wa,[l(f,null,{default:s(()=>[(c(!0),D(T,null,G(R.value,o=>(c(),U(n,{key:o.id,onClick:b=>E(o)},{default:s(()=>[F(B(o.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),l(n,{icon:Z(A(va)),type:"link",title:"刷新数据",style:{float:"right"},onClick:h},null,8,["icon"])]),l(C,{columns:W.value,"data-source":v.value,scroll:{y:M.value?470:670},loading:P.value,pagination:!1},{bodyCell:s(({column:o,record:b})=>[o.type=="image"?(c(),U($,{key:0,src:`${b[o.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):I("",!0),o.type=="link"?(c(),D("a",{key:1,href:`${b[o.dataIndex]}`,target:"_blank"},B(b[o.dataIndex]),9,xa)):I("",!0),o.key=="_action"?(c(!0),D(T,{key:2},G(N.value,L=>(c(),U(n,{type:"link",onClick:Ua=>E(L,b),key:L.id},{default:s(()=>[F(B(L.name),1)]),_:2},1032,["onClick"]))),128)):I("",!0)]),_:1},8,["columns","data-source","scroll","loading"]),l(z,{style:{display:"flex","justify-content":"flex-end","margin-top":"20px"},current:g.value.pageNumber,"onUpdate:current":a[1]||(a[1]=o=>g.value.pageNumber=o),pageSize:g.value.pageSize||10,total:q.value,"show-less-items":""},null,8,["current","pageSize","total"])]),_:1})]),l(aa,{open:x.value,"onUpdate:open":a[2]||(a[2]=o=>x.value=o),onOk:Y,onCancel:H},{default:s(()=>[l(J,{formData:k.value,id:O.value.id},null,8,["formData","id"])]),_:1},8,["open"])],64)}}}),Wa=ua(Da,[["__scopeId","data-v-be405861"]]);export{Wa as default};
