import{r as h,c as E,_ as de}from"./index-bp98ELWv.js";/* empty css                                                                    */import{g as ie,m as ue,r as p,n as $,a8 as pe,o as u,q as w,l as t,w as l,e as j,ab as re,ao as ve,ac as ce,h as v,ad as _,a6 as m,N as me,L as O,F as C,O as _e,X as ge,V as be,a4 as ye,a1 as fe,ai as Ie,R as ke,ak as xe,a7 as he,ap as we,aq as Te,a2 as De}from"./.pnpm-CWzuy1aI.js";const T={getList:c=>h({method:"get",url:"business/device/list",params:c}),getDetail:c=>h({method:"get",url:"business/device/detail/noMqtt",params:{id:c}}),remove:c=>h({method:"get",url:"business/device/remove",params:{id:c}}),add:c=>h({method:"post",url:"business/device/add",data:c}),update:c=>h({method:"post",url:"business/device/update",data:c})},Ce={class:"device"},Fe={class:"tools"},Ne=ie({__name:"DeviceView",setup(c){const d=ue({keyword:"",pageNumber:1,pageSize:10,type:""}),z=p([]),A=p([{title:"设备编号",key:"deviceId",dataIndex:"deviceId",width:"250px"},{title:"入网编号",key:"netNumber",dataIndex:"netNumber",width:"250px"},{title:"所属类型",key:"belongType",dataIndex:"belongType",width:"100px"},{title:"所属人/机构",key:"belongId",dataIndex:"belongId",width:"200px"},{title:"保修状态",key:"isExpired",dataIndex:"isExpired",width:"100px"},{title:"保修截至日期",key:"expireDate",dataIndex:"expireDate"},{title:"操作",key:"action",dataIndex:"action",width:"250px"}]),F=p(!1),B=p(),X=()=>{var o;(o=B.value)==null||o.resetFields(),b()},P=p(0),G=()=>{d.pageNumber=1,d.pageSize=10,b()},H=o=>{const{current:e,pageSize:s}=o;d.pageNumber=e,d.pageSize=s,b()},b=()=>{F.value=!0,T.getList(d).then(o=>{const{code:e,data:s}=o;e==200&&(z.value=s.data,P.value=s.total),F.value=!1})},y=p([]),J=p({}),N=p([]),U=p([]);$(()=>{b(),E.getOrgTree().then(o=>{const{code:e,data:s,msg:i}=o;e==200&&(N.value=s)}),E.getAllUser().then(o=>{const{code:e,data:s,msg:i}=o;e==200&&(U.value=s)}),E.getDict(["deviceBelongType"]).then(o=>{const{code:e,data:s,msg:i}=o;e==200&&(y.value=s.deviceBelongType,J.value=y.value.reduce((g,k)=>(g[k.value]=k.label,g),{}))})});const f=p(!1),n=p({deviceId:"",netNumber:"",belongId:"",belongType:"",expireDate:"",isExpired:""}),I=p("add"),K=pe(()=>({add:"新增设备",edit:"编辑设备"})[I.value]),q=p(),Q=()=>{I.value="add",f.value=!0,n.value={deviceId:"",netNumber:"",belongId:"",belongType:"",expireDate:"",isExpired:""}},W=async o=>{const{code:e,data:s}=await T.getDetail(o.deviceId);e==200&&(n.value=s,I.value="edit",f.value=!0)},Z=async o=>{const{code:e,msg:s,data:i}=await T.remove(o.deviceId);e==200&&(j.success(i),b())},V=()=>{var o;(o=q.value)==null||o.resetFields()},ee=()=>{var o;(o=q.value)==null||o.validate().then(()=>{let e;I.value=="add"?e=T.add:e=T.update,e(n.value).then(s=>{const{code:i}=s;i==200&&(j.success(I.value=="add"?"新增成功":"编辑成功"),b()),V(),f.value=!1})})};return $(()=>{}),(o,e)=>{const s=ge,i=be,g=ye,k=fe,x=Ie,L=ke,M=re,D=xe,ae=he,te=we,le=Te,oe=De,ne=ve,S=ce("has-perm");return u(),w("div",Ce,[t(M,{class:"search-area"},{default:l(()=>[t(L,{ref_key:"searchFormRef",ref:B,model:d,layout:"inline",onFinish:G},{default:l(()=>[t(i,{label:"设备编号",prop:"deviceId"},{default:l(()=>[t(s,{value:d.deviceId,"onUpdate:value":e[0]||(e[0]=a=>d.deviceId=a),options:y.value,"show-search":"",allowClear:"",optionFilterProp:"label",style:{width:"200px"}},null,8,["value","options"])]),_:1}),t(i,{label:"所属类型",prop:"belongType"},{default:l(()=>[t(g,{value:d.belongType,"onUpdate:value":e[1]||(e[1]=a=>d.belongType=a),options:y.value,"show-search":"",allowClear:"",optionFilterProp:"label",style:{width:"200px"}},null,8,["value","options"])]),_:1}),d.belongType=="1"?(u(),v(i,{key:0,label:"所属机构",prop:"belongId"},{default:l(()=>[t(k,{value:d.belongId,"onUpdate:value":e[2]||(e[2]=a=>d.belongId=a),"tree-node-filter-prop":"label","show-search":"","allow-clear":"",treeData:N.value,"field-names":{children:"children",label:"name",value:"id"},style:{width:"200px"}},null,8,["value","treeData"])]),_:1})):_("",!0),d.belongType=="0"?(u(),v(i,{key:1,label:"所属人",prop:"belongId"},{default:l(()=>[t(g,{value:d.belongId,"onUpdate:value":e[3]||(e[3]=a=>d.belongId=a),options:U.value,"show-search":"",allowClear:"",optionFilterProp:"label",style:{width:"200px"}},null,8,["value","options"])]),_:1})):_("",!0),t(i,null,{default:l(()=>[t(x,{type:"primary","html-type":"submit"},{default:l(()=>[m("搜索")]),_:1}),t(x,{style:{margin:"0 8px"},onClick:X},{default:l(()=>[m(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(M,null,{default:l(()=>[me("div",Fe,[O((u(),v(x,{type:"primary",onClick:Q},{default:l(()=>[m("新增")]),_:1})),[[S,"business:device:add"]])]),t(le,{loading:F.value,columns:A.value,"data-source":z.value,scroll:{y:560},onChange:H,pagination:{current:d.pageNumber,total:P.value,showSizeChanger:!0,pageSize:d.pageSize}},{bodyCell:l(({column:a,record:r})=>{var R,Y;return[a.key=="isExpired"?(u(),w(C,{key:0},[r.isExpired=="0"?(u(),v(D,{key:0,color:"#87d068"},{default:l(()=>[m("未过保")]),_:1})):(u(),v(D,{key:1,color:"#f50"},{default:l(()=>[m("已过保")]),_:1}))],64)):_("",!0),a.key=="belongId"?(u(),w(C,{key:1},[m(_e(r.belongType=="1"?(R=r==null?void 0:r.orgInfo)==null?void 0:R.name:(Y=r==null?void 0:r.userInfo)==null?void 0:Y.username),1)],64)):_("",!0),a.key=="belongType"?(u(),w(C,{key:2},[r.belongType=="1"?(u(),v(D,{key:0,color:"#87d068"},{default:l(()=>[m("机构")]),_:1})):(u(),v(D,{key:1,color:"#2db7f5"},{default:l(()=>[m("个人")]),_:1}))],64)):_("",!0),a.key=="action"?(u(),w(C,{key:3},[O((u(),v(x,{type:"link",onClick:se=>W(r)},{default:l(()=>[m("编辑")]),_:2},1032,["onClick"])),[[S,"business:device:update"]]),t(ae,{type:"vertical"}),t(te,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:se=>Z(r)},{default:l(()=>[O((u(),v(x,{type:"link",danger:""},{default:l(()=>[m("删除")]),_:1})),[[S,"business:device:remove"]])]),_:2},1032,["onConfirm"])],64)):_("",!0)]}),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),t(ne,{open:f.value,"onUpdate:open":e[11]||(e[11]=a=>f.value=a),onOk:ee,title:K.value,onCancel:V},{default:l(()=>[t(L,{model:n.value,"label-col":{span:8},ref_key:"modalFormRef",ref:q},{default:l(()=>[t(i,{label:"设备编号",required:"",prop:"deviceId"},{default:l(()=>[t(s,{value:n.value.deviceId,"onUpdate:value":e[4]||(e[4]=a=>n.value.deviceId=a)},null,8,["value"])]),_:1}),t(i,{label:"设备入网编号",required:"",prop:"netNumber"},{default:l(()=>[t(s,{value:n.value.netNumber,"onUpdate:value":e[5]||(e[5]=a=>n.value.netNumber=a)},null,8,["value"])]),_:1}),t(i,{label:"设备所属类型",required:"",prop:"belongType"},{default:l(()=>[t(g,{value:n.value.belongType,"onUpdate:value":e[6]||(e[6]=a=>n.value.belongType=a),options:y.value,onChange:e[7]||(e[7]=a=>n.value.belongId="")},null,8,["value","options"])]),_:1}),n.value.belongType=="0"?(u(),v(i,{key:0,label:"所属人",required:"",prop:"belongId"},{default:l(()=>[t(g,{value:n.value.belongId,"onUpdate:value":e[8]||(e[8]=a=>n.value.belongId=a),options:U.value,"show-search":"",allowClear:"",optionFilterProp:"label"},null,8,["value","options"])]),_:1})):_("",!0),n.value.belongType=="1"?(u(),v(i,{key:1,label:"所属机构",required:"",prop:"belongId"},{default:l(()=>[t(k,{value:n.value.belongId,"onUpdate:value":e[9]||(e[9]=a=>n.value.belongId=a),"tree-node-filter-prop":"label","show-search":"","allow-clear":"",treeData:N.value,"field-names":{children:"children",label:"name",value:"id"},style:{width:"200px"}},null,8,["value","treeData"])]),_:1})):_("",!0),t(i,{label:"保修截至日期",prop:"expireDate",required:""},{default:l(()=>[t(oe,{value:n.value.expireDate,"onUpdate:value":e[10]||(e[10]=a=>n.value.expireDate=a),valueFormat:"YYYY-MM-DD"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),Ee=de(Ne,[["__scopeId","data-v-6ab9a250"]]);export{Ee as default};
