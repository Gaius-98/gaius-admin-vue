import{_ as R}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-D2ycdfoG.js";import{t as ea}from"./table-BiYlTMM-.js";import{h as ta}from"./http-CWnmbdQK.js";import{a as j,f as oa,M as na,B as la,h as ra,i as sa,t as ia,r as ua,k as ca,P as pa}from"./ant-design-vue-yNpjrsH-.js";import{U as ma,D as da,a0 as fa}from"./@ant-design-IRTEbH5T.js";import{d as _a,L as va,r as l,m as W,w as Y,U as p,V as I,W as A,a4 as w,a5 as r,ab as B,c as s,F as M,Z as ga,J as P,h as Z,u as S,aa as $,Y as G}from"./@vue-erW_et9m.js";import{_ as ya}from"./index-YzsO31sV.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-CzCXd7ir.js";import"./uuid-CQkTLCs1.js";import"./common-DMKYhMw2.js";import"./form-NzLB6Y4Y.js";import"./axios-C8DqakIB.js";import"./@babel-BiFW4_mA.js";import"./lodash-es-PU94eZQX.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-B73STPP_.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-C5fUfLeo.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-OW4gUFyn.js";import"./pinia-DOycVbUI.js";/* empty css                      */import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-DFKns4fX.js";import"./vue-router-CjQMd8cK.js";import"./echarts-DetEu2Tg.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CDo53BfZ.js";import"./gaius-utils-FbSzq_Sh.js";const ha=i=>{const m={};return i.reduce((u,a)=>(u[a.key]=a.defaultValue,u),m),m},ka=async(i,m,u)=>{try{const a=await ta.run(i.interfaceUrl,{...m,...u});let v;return i.handlerFunc?v=new Function("res",i.handlerFunc)(a.data):v=a,v}catch(a){return a}},Ca=(i,m)=>i.replace(/\${(.*?)}/g,(u,a)=>m[a.trim()]),x={getProxyData:ka,transformParamsData:ha,parseString:Ca},ba={class:"low-code-table"},wa={style:{"font-size":"12px"}},xa={class:"tools"},Da=["href"],Ua=_a({__name:"LowCodeTable",props:{id:{}},setup(i){const m=i,{id:u}=va(m),a=l({}),v=l([]),D=l({}),N=l(!1),K=()=>{D.value={},k()},h=l(!1),q=W(()=>{var t,e,n,f,c,d;return((n=(e=(t=a.value)==null?void 0:t.global)==null?void 0:e.filterCfg)==null?void 0:n.show)&&((d=(c=(f=a.value)==null?void 0:f.global)==null?void 0:c.filterCfg)==null?void 0:d.formId)}),Q=W(()=>U.value.length>0?[...a.value.columns,{title:"操作",dataIndex:"_action",key:"_action",width:200,fixed:"right"}]:a.value.columns),g=l({}),V=l([]),U=l([]);Y(()=>u.value,()=>{V.value=[],U.value=[],ea.getDetail(u.value).then(t=>{var c;const{code:e,data:n,msg:f}=t;e==200&&(a.value=n,a.value.global.actionCfg&&((c=a.value.global.actionCfg)==null?void 0:c.length)>0&&a.value.global.actionCfg.map(_=>{_.position=="header"?V.value.push(_):U.value.push(_)}),g.value=x.transformParamsData(a.value.variablePool),k())})},{immediate:!0}),Y(()=>g.value,()=>{k()},{deep:!0});const E=l(0),k=async()=>{N.value=!0;try{const{data:t,total:e}=await x.getProxyData(a.value.dataSource,g.value,D.value);v.value=t,e&&(E.value=e)}catch(t){j.error("获取数据失败:"+t)}N.value=!1},F=l(!1),y=l({}),z=l({}),H=async(t,e)=>{const{formId:n,event:f,interfaceUrl:c,AfterHandleFunc:d,request:_,linkUrl:L,actionCfg:C}=t;if(_){const O=await x.getProxyData({type:"dynamic",interfaceUrl:c,handlerFunc:d},{},{...e});y.value=O}else y.value=e||{};switch(f){case"modal":z.value={id:n,modalUrl:C==null?void 0:C.interfaceUrl},F.value=!0;break;case"link":window.open(x.parseString(L,y.value),"_blank");break}},J=()=>{y.value={},F.value=!1},X=()=>{x.getProxyData({type:"dynamic",interfaceUrl:z.value.modalUrl,handlerFunc:""},{},{...y.value}).then(t=>{var e;j.info((e=t==null?void 0:t.data)==null?void 0:e.msg),J()}).catch(t=>{j.error(t)})};return(t,e)=>{const n=la,f=ra,c=sa,d=oa,_=ia,L=ua,C=ca,O=pa,aa=na;return p(),I(M,null,[A("div",ba,[q.value?(p(),w(d,{key:0,class:"filter-panel"},{default:r(()=>[s(R,{formData:D.value,id:a.value.global.filterCfg.formId,class:ga(["filter-form",h.value?"expand":""])},null,8,["formData","id","class"]),s(c,null,{default:r(()=>[s(f,{span:24,style:{"text-align":"right"}},{default:r(()=>[s(n,{type:"primary","html-type":"submit",onClick:k},{default:r(()=>[P("搜索")]),_:1}),s(n,{style:{margin:"0 8px"},onClick:K},{default:r(()=>[P("重置")]),_:1}),s(n,{type:"link",icon:Z(h.value?S(ma):S(da)),onClick:e[0]||(e[0]=o=>h.value=!h.value)},{default:r(()=>[A("span",wa,$(h.value?"收起":"展开"),1)]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})):B("",!0),s(d,{class:"table-container"},{default:r(()=>[A("div",xa,[s(_,null,{default:r(()=>[(p(!0),I(M,null,G(V.value,o=>(p(),w(n,{key:o.id,onClick:b=>H(o)},{default:r(()=>[P($(o.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),s(n,{icon:Z(S(fa)),type:"link",title:"刷新数据",style:{float:"right"},onClick:k},null,8,["icon"])]),(p(),w(C,{columns:Q.value,"data-source":v.value,scroll:{y:q.value?400:650},loading:N.value,pagination:!1,key:S(u)},{bodyCell:r(({column:o,record:b})=>[o.type=="image"?(p(),w(L,{key:0,src:`${b[o.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):B("",!0),o.type=="link"?(p(),I("a",{key:1,href:`${b[o.dataIndex]}`,target:"_blank"},$(b[o.dataIndex]),9,Da)):B("",!0),o.key=="_action"?(p(!0),I(M,{key:2},G(U.value,T=>(p(),w(n,{type:"link",onClick:Fa=>H(T,b),key:T.id},{default:r(()=>[P($(T.name),1)]),_:2},1032,["onClick"]))),128)):B("",!0)]),_:1},8,["columns","data-source","scroll","loading"])),s(O,{style:{display:"flex","justify-content":"flex-end","margin-top":"20px"},current:g.value.pageNumber,"onUpdate:current":e[1]||(e[1]=o=>g.value.pageNumber=o),pageSize:g.value.pageSize||10,total:E.value,"show-less-items":""},null,8,["current","pageSize","total"])]),_:1})]),s(aa,{open:F.value,"onUpdate:open":e[2]||(e[2]=o=>F.value=o),onOk:X,onCancel:J},{default:r(()=>[s(R,{formData:y.value,id:z.value.id},null,8,["formData","id"])]),_:1},8,["open"])],64)}}}),ie=ya(Ua,[["__scopeId","data-v-66544863"]]);export{ie as default};
