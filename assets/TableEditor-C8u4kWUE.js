import{aD as me,r,aB as fe,a0 as G,d as Q,I as X,t as H,J as S,L as B,U as R,M as a,a3 as J,g as e,Q as s,O as g,a2 as U,aa as _e,X as ve,Z as ae,ah as be,a6 as te,w as ye,h as L,v as q,aI as ge,an as he,aJ as Ce,aK as Se,R as we,a1 as De,aC as ke,Y as ee,a4 as xe,ay as Ie,az as Ve}from"./index-Dj3POpsG.js";import{S as N}from"./SchemaForm-BUW3Itdz.js";import{D as Fe}from"./DragTableHeader-7DMTvhXS.js";import{h as Te}from"./http-BfyTF0RA.js";import{t as z}from"./table-Cw3msdoM.js";import{_ as Re}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BXsjcquF.js";import{C as Ue,_ as Oe,a as $e,T as Ae,b as Pe}from"./index-DnJg9MFn.js";import{S as Be}from"./SyncOutlined-DkxJ8-zo.js";import{_ as Le}from"./index-D_QDGmHl.js";import{E as Ne}from"./EditTable-KEZXn-rM.js";import{S as ze}from"./index-MZBRq2tE.js";import{T as Ke}from"./index-CEM1xkL1.js";import{_ as Ee}from"./index-DYfWSluE.js";import{_ as Me}from"./index-BWzd_wUN.js";import"./index-CxcUTHT-.js";import"./SwapRightOutlined-DUInWHUO.js";import"./index-CByPIuvY.js";import"./index-B5XhjUt8.js";import"./index-D6dehNLH.js";import"./index-DUrCVYDk.js";import"./index-CG3nCT6E.js";import"./vue-draggable-next.esm-bundler-DeGatXwY.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-wK1c5kwH.js";import"./common-BAtz7NXV.js";import"./form-CM2YoDAC.js";import"./index-D2GI_bYf.js";import"./EllipsisOutlined-C0g_OMcx.js";import"./index-BVFApEuh.js";import"./FolderOutlined-DDu9cnxr.js";import"./useBreakpoint-DuWh4azy.js";import"./index-BK2eXQ_d.js";import"./PlusCircleOutlined-Csm74Lln.js";import"./ArrowRightOutlined-CdCxAUCB.js";import"./index-BXQPwvFn.js";import"./index-BCxK-16O.js";const Y=me("tableDesign",()=>{const w=r([]),m=r({name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),d=r([]),f=r({}),o=()=>{const t=new Date().getTime().toString().slice(-4);m.value.columns.push({id:fe(),dataIndex:"field"+t,title:"列"+t})},D=(t,n)=>{const u=n.findIndex(_=>_.id===t);u!=-1&&(f.value=n[u])},h=(t,n)=>{const u=n.findIndex(_=>_.id===t);u!=-1&&n.splice(u,1)},k=()=>{const t={};return m.value.variablePool.reduce((n,u)=>(n[u.key]=u.defaultValue,n),t),t},x=async t=>{try{const n=await Te.run(m.value.dataSource.interfaceUrl,k());return new Function("res",t||m.value.dataSource.handlerFunc)(n.data)}catch(n){return n}},C=r(!1);return{tableCfg:m,currentColumn:f,onSelectColumn:D,onRemoveColumn:h,onAddColumn:o,tableData:w,onRefreshData:x,saveLoading:C,onSave:async()=>{C.value=!0;const{code:t,msg:n}=await z.add(m.value);t==200&&G.success(n),C.value=!1},columnFields:d}}),je={class:"table-design-container"},Je={class:"tools",style:{"margin-bottom":"5px"}},He=["href"],qe=Q({__name:"TableDesign",setup(w){const m=Y(),{tableCfg:d,tableData:f,columnFields:o}=X(m),{onSelectColumn:D,onRemoveColumn:h,onAddColumn:k,onRefreshData:x}=m,C=c=>{D(c.id,d.value.columns)},i=c=>{h(c.id,d.value.columns)},t=r(0),n=()=>{x().then(c=>{const{data:v,total:I}=c;if(v){f.value=v;try{o.value=Object.keys(v[0]).map(V=>({value:V,label:V}))}catch{G.warning("接口数据解析失败")}}I&&(t.value=I)})},u=H(()=>{var c,v;return((c=d.value.global.filterCfg)==null?void 0:c.show)&&((v=d.value.global.filterCfg)==null?void 0:v.formId)}),_=r({});return(c,v)=>{const I=ae,V=Oe,A=$e,P=Ue,K=be,T=Le;return S(),B("div",je,[u.value?(S(),R(P,{key:0,class:"filter-panel"},{default:a(()=>[e(Re,{formData:_.value,id:s(d).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),e(A,null,{default:a(()=>[e(V,{span:24,style:{"text-align":"right"}},{default:a(()=>[e(I,{type:"primary","html-type":"submit"},{default:a(()=>[g("搜索")]),_:1}),e(I,{style:{margin:"0 8px"}},{default:a(()=>[g("重置")]),_:1})]),_:1})]),_:1})]),_:1})):J("",!0),e(P,{class:"table-container"},{default:a(()=>[U("div",Je,[e(I,{type:"primary",onClick:s(k)},{default:a(()=>[g("新增列")]),_:1},8,["onClick"]),e(I,{icon:_e(s(Be)),type:"link",title:"刷新数据",style:{float:"right"},onClick:n},null,8,["icon"])]),e(Fe,{modelValue:s(d).columns,"onUpdate:modelValue":v[0]||(v[0]=b=>s(d).columns=b),onOnClick:C,onOnRemove:i},null,8,["modelValue"]),e(T,{showHeader:!1,columns:s(d).columns,"data-source":s(f),scroll:{y:u.value?300:500},pagination:{total:t.value}},{bodyCell:a(({column:b,record:O})=>[b&&b.type=="image"?(S(),R(K,{key:0,src:`${O[b.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):J("",!0),b&&b.type=="link"?(S(),B("a",{key:1,href:`${O[b.dataIndex]}`,target:"_blank"},ve(O[b.dataIndex]),9,He)):J("",!0)]),_:1},8,["columns","data-source","scroll","pagination"])]),_:1})])}}}),Ge=te(qe,[["__scopeId","data-v-5ca6551a"]]),Qe=Q({__name:"TableCfg",setup(w){const m=Y(),{tableCfg:d,currentColumn:f,columnFields:o}=X(m),D=r({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(i=>{setTimeout(()=>{i(o.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:!1,label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),h=r();ye(()=>o,()=>{h.value&&(console.log("columnForm",h.value),h.value.refreshOption("dataIndex"))},{deep:!0,immediate:!0});const k=r("column"),x=r({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(i=>{setTimeout(()=>{i(C.value)},100)})}}}}),C=r([]);return z.getFormList().then(i=>{const{code:t,data:n,msg:u}=i;t==200&&(C.value=n.map(_=>({value:_.id,label:_.name})))}),(i,t)=>{const n=ge,u=Pe,_=Ae;return S(),R(_,{activeKey:k.value,"onUpdate:activeKey":t[0]||(t[0]=c=>k.value=c)},{default:a(()=>[e(u,{key:"column",tab:"列配置"},{default:a(()=>[L((S(),R(s(N),{layout:D.value.layout,properties:D.value.properties,formData:s(f),key:s(f).id,ref_key:"columnForm",ref:h},null,8,["layout","properties","formData"])),[[q,s(f).id]]),L(U("div",null,[e(n)],512),[[q,!s(f).id]])]),_:1}),e(u,{key:"global",tab:"全局配置"},{default:a(()=>[e(s(N),{layout:x.value.layout,properties:x.value.properties,formData:s(d).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),oe=w=>(Ie("data-v-91cb5b86"),w=w(),Ve(),w),Xe={class:"table-design"},Ye={class:"left-part"},Ze={class:"right-part"},We=oe(()=>U("span",null,"(res)=>{",-1)),ea=oe(()=>U("span",null,"}",-1)),aa=Q({__name:"TableEditor",props:{id:{}},setup(w){const m=w,{id:d}=he(m),f=Y(),{tableCfg:o,tableData:D,saveLoading:h,columnFields:k}=X(f),{onRefreshData:x,onSave:C}=f,i=r({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),t=r(""),n=()=>{x().then(F=>{const{data:l}=F;if(l){D.value=l;try{k.value=Object.keys(l[0]).map(y=>({value:y,label:y}))}catch{G.warning("接口数据解析失败")}}})};d.value?z.getDetail(d.value).then(F=>{const{code:l,data:y,msg:$}=F;l==200&&(o.value=y,n())}):(o.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:{add:{show:!1,formId:""},edit:{show:!1,formId:""},view:{show:!1,formId:""}},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"},{key:"pageSize",defaultValue:"10"}]},i.value=o.value.dataSource,D.value=[],k.value=[]);const u=H(()=>o.value.name?o.value.name:"新建表格"),_=H(()=>o.value.description?o.value.description:""),c=r(!1),v=r({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),I=()=>{c.value=!0},V=Ce(),A=()=>{V.go(-1)},P=()=>{C(),c.value=!1,A()},K=()=>{V.push({path:"/low-code/preview-table",query:{id:o.value.id}})},T=r(!1),b=r({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:F,data:l,msg:y}=await z.getApiList();return F==200?l.map($=>({value:$.id,label:$.apiName})):[]}}}}}),O=()=>{i.value=o.value.dataSource,T.value=!0},le=()=>{o.value.dataSource=i.value,n(),Z()},Z=()=>{T.value=!1},E=r(!1),ne=async()=>await x(),se=async()=>{E.value=!0;const F=await ne();E.value=!1,t.value=JSON.stringify(F,null,2)},M=r(!1),re=r([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),ue=()=>{M.value=!0};return(F,l)=>{const y=ae,$=ze,W=Ke,ie=Ee,j=De,ce=xe,de=Me,pe=Se("loading");return S(),B(we,null,[e(ie,{title:u.value,subTitle:_.value,onBack:A,ghost:!1,style:{padding:"10px 24px"}},{extra:a(()=>[e($,null,{default:a(()=>[e(y,{onClick:O},{default:a(()=>[g(" 数据源配置 ")]),_:1}),e(y,{onClick:ue},{default:a(()=>[g(" 变量池配置 ")]),_:1}),L(e(y,{onClick:K},{default:a(()=>[g(" 预览 ")]),_:1},512),[[q,s(o).id]]),e(y,{onClick:I,type:"primary"},{default:a(()=>[g(" 保存 ")]),_:1})]),_:1})]),tags:a(()=>[s(o).status?(S(),R(W,{key:0,color:"#87d068"},{default:a(()=>[g("启用")]),_:1})):(S(),R(W,{key:1,color:"#f50"},{default:a(()=>[g("停用")]),_:1}))]),_:1},8,["title","subTitle"]),L((S(),B("div",Xe,[U("div",Ye,[e(Ge)]),U("div",Ze,[e(Qe)])])),[[pe,s(h),void 0,{fullscreen:!0}]]),e(j,{open:c.value,"onUpdate:open":l[1]||(l[1]=p=>c.value=p),title:"保存",onOk:P},{default:a(()=>[e(s(N),{formData:s(o),"onUpdate:formData":l[0]||(l[0]=p=>ke(o)?o.value=p:null),layout:v.value.layout,properties:v.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e(j,{open:T.value,"onUpdate:open":l[5]||(l[5]=p=>T.value=p),title:"数据源配置",onOk:le,onCancel:Z},{default:a(()=>[e(s(N),{layout:b.value.layout,properties:b.value.properties,formData:i.value,"onUpdate:formData":l[2]||(l[2]=p=>i.value=p)},null,8,["layout","properties","formData"]),e(ce,{label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}"},{default:a(()=>[We,e(ee,{height:200,modelValue:i.value.handlerFunc,"onUpdate:modelValue":l[3]||(l[3]=p=>i.value.handlerFunc=p)},null,8,["modelValue"]),ea]),_:1}),e(de,null,{default:a(()=>[g("结果区")]),_:1}),e(y,{type:"primary",style:{"margin-bottom":"5px"},onClick:se,loading:E.value},{default:a(()=>[g("运行")]),_:1},8,["loading"]),e(ee,{height:200,disabled:"",modelValue:t.value,"onUpdate:modelValue":l[4]||(l[4]=p=>t.value=p)},null,8,["modelValue"])]),_:1},8,["open"]),e(j,{title:"变量池配置",open:M.value,footer:!1,onCancel:l[7]||(l[7]=p=>M.value=!1)},{default:a(()=>[e(Ne,{columns:re.value,modelValue:s(o).variablePool,"onUpdate:modelValue":l[6]||(l[6]=p=>s(o).variablePool=p)},null,8,["columns","modelValue"])]),_:1},8,["open"])],64)}}}),Ba=te(aa,[["__scopeId","data-v-91cb5b86"]]);export{Ba as default};
