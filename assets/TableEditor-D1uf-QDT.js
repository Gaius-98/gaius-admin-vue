import{ao as we,r as l,am as ce,a0 as le,d as ne,I as se,t as te,J as S,L as K,a2 as V,U as A,M as t,a3 as ee,g as e,R as ae,a1 as pe,Q as u,O as C,aa as De,X as ke,a9 as xe,Z as de,ah as Ie,a6 as me,w as $e,h as G,v as oe,at as Fe,ak as Ue,au as Te,av as Ve,an as Re,Y as ue,a4 as Ae,ai as Oe,aj as Le}from"./index-WygQ6GTr.js";import{S as z}from"./SchemaForm-DtUMg_L-.js";import{D as Pe}from"./DragTableHeader-CQwpNOza.js";import{h as qe}from"./http-CNoS_fJm.js";import{t as O}from"./table-BpMYzYZ7.js";import{_ as Ne}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BeQCJfYO.js";import{C as Be,_ as Ee,a as Ke,b as fe,T as ve}from"./index-Db1QJNWF.js";import{S as ze}from"./SyncOutlined-Ct2UqlNm.js";import{S as _e}from"./index-DVltyFKK.js";import{_ as Me}from"./index-DGxLlZMB.js";import{E as je}from"./EditTable-BjfZMiwN.js";import{T as He}from"./index-B9G4MpOS.js";import{_ as Je}from"./index-DxQYgRdA.js";import{_ as Ge}from"./index-CnomNRon.js";import{_ as Qe}from"./index-C_hcLp1K.js";import"./index-DWpMSmtV.js";import"./SwapRightOutlined-BBt0i-Rw.js";import"./index-BEJX6f1I.js";import"./index-B4yLT25j.js";import"./index-D2-KKtI7.js";import"./index-Dkzcsjmu.js";import"./index-CbOnQqH9.js";import"./vue-draggable-next.esm-bundler-C-OLplu8.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-Czmenc8-.js";import"./common-CsMbJs6O.js";import"./form-qedlrhg5.js";import"./index-DLNUyKMM.js";import"./EllipsisOutlined-BYkT9j9O.js";import"./index-BDrIS7bW.js";import"./FolderOutlined-YnMB68S4.js";import"./useBreakpoint-CQlYkPU6.js";import"./index-DuyXPHaZ.js";import"./PlusCircleOutlined-VNK8N4LU.js";import"./ArrowRightOutlined-CefLCLRl.js";import"./index-DzAlF2Vr.js";import"./index-DzfjN8cT.js";const re=we("tableDesign",()=>{const k=l([]),b=l({name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:[],filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),c=l([]),y=l({}),s=()=>{const r=new Date().getTime().toString().slice(-4);b.value.columns.push({id:ce(),dataIndex:"field"+r,title:"列"+r})},x=(r,p)=>{const i=p.findIndex(_=>_.id===r);i!=-1&&(y.value=p[i])},w=(r,p)=>{const i=p.findIndex(_=>_.id===r);i!=-1&&p.splice(i,1)},I=()=>{const r={};return b.value.variablePool.reduce((p,i)=>(p[i.key]=i.defaultValue,p),r),r},$=async r=>{try{const p=await qe.run(b.value.dataSource.interfaceUrl,I());return new Function("res",r||b.value.dataSource.handlerFunc)(p.data)}catch(p){return p}},D=l(!1);return{tableCfg:b,currentColumn:y,onSelectColumn:x,onRemoveColumn:w,onAddColumn:s,tableData:k,onRefreshData:$,saveLoading:D,onSave:async()=>{D.value=!0;const{code:r,msg:p}=await O.add(b.value);r==200&&le.success(p),D.value=!1},columnFields:c}}),Xe={class:"table-design-container"},Ye={class:"tools",style:{"margin-bottom":"5px"}},Ze=["href"],We={class:"action-container"},et=ne({__name:"TableDesign",setup(k){const b=re(),{tableCfg:c,tableData:y,columnFields:s}=se(b),{onSelectColumn:x,onRemoveColumn:w,onAddColumn:I,onRefreshData:$}=b,D=n=>{x(n.id,c.value.columns)},g=n=>{w(n.id,c.value.columns)},r=l(0),p=()=>{$().then(n=>{const{data:a,total:f}=n;if(a){y.value=a;try{s.value=Object.keys(a[0]).map(m=>({value:m,label:m}))}catch{le.warning("接口数据解析失败")}}f&&(r.value=f)})},i=te(()=>{var n,a;return((n=c.value.global.filterCfg)==null?void 0:n.show)&&((a=c.value.global.filterCfg)==null?void 0:a.formId)}),_=l({}),U=l(!1),M=l({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{id:{type:"string",label:"按钮标识",component:{disabled:!0}},name:{type:"string",label:"按钮名称"},position:{type:"radio",label:"按钮位置",component:{dataSource:[{value:"row",label:"行内"},{value:"header",label:"表头"}],buttonStyle:"solid"}},request:{type:"switch",label:"请求接口",tooltip:"是否在点击按钮后请求接口获取数据"},interfaceUrl:{show:"${formData.request}",type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:n,data:a,msg:f}=await O.getApiList();return n==200?a.map(m=>({value:m.id,label:m.apiName})):[]}}},AfterHandleFunc:{show:"${formData.request}",type:"string",label:"处理函数",tooltip:"处理接口返回的数据,数据用于表单渲染或地址拼接",component:{name:"code-editor",height:100,prepend:"()=>{",append:"}"}},event:{type:"radio",label:"触发事件",component:{dataSource:[{value:"modal",label:"弹窗"},{value:"link",label:"链接"}],buttonStyle:"solid"}},linkUrl:{show:"'${formData.event}' == 'link'",type:"string",label:"链接地址",tooltip:"可以通过${name}的方式拼接变量,name为变量名称"},formId:{show:"'${formData.event}' == 'modal'",type:"select",label:"表单",component:{asyncData:async()=>await new Promise(n=>{setTimeout(()=>{n(P.value)},100)})}},"actionCfg.interfaceUrl":{show:"'${formData.event}' == 'modal'",type:"select",label:"接口地址",tooltip:"一般用于提交数据,新增后保存当前的表单数据",component:{asyncData:async()=>{const{code:n,data:a,msg:f}=await O.getApiList();return n==200?a.map(m=>({value:m.id,label:m.apiName})):[]}}}}}),F=l(""),L=()=>{F.value=ce(),c.value.global.actionCfg.push({name:"按钮",id:F.value,actionCfg:{interfaceUrl:""}})},j=n=>{let a=0;c.value.global.actionCfg.forEach((f,m)=>{f.id===n&&(a=m-1)}),c.value.global.actionCfg=c.value.global.actionCfg.filter(f=>f.id!==n),c.value.global.actionCfg.length&&F.value===n&&(a>=0?F.value=c.value.global.actionCfg[a].id:F.value=c.value.global.actionCfg[0].id)},Q=(n,a)=>{a==="add"?L():j(n)},P=l([]);return O.getFormList().then(n=>{const{code:a,data:f,msg:m}=n;a==200&&(P.value=f.map(R=>({value:R.id,label:R.name})))}),(n,a)=>{const f=de,m=Ee,R=Ke,H=Be,X=_e,J=Ie,q=Me,Y=fe,Z=ve,N=pe;return S(),K(ae,null,[V("div",Xe,[i.value?(S(),A(H,{key:0,class:"filter-panel"},{default:t(()=>[e(Ne,{formData:_.value,id:u(c).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),e(R,null,{default:t(()=>[e(m,{span:24,style:{"text-align":"right"}},{default:t(()=>[e(f,{type:"primary","html-type":"submit"},{default:t(()=>[C("搜索")]),_:1}),e(f,{style:{margin:"0 8px"}},{default:t(()=>[C("重置")]),_:1})]),_:1})]),_:1})]),_:1})):ee("",!0),e(H,{class:"table-container"},{default:t(()=>[V("div",Ye,[e(X,null,{default:t(()=>[e(f,{type:"primary",onClick:u(I)},{default:t(()=>[C("新增列")]),_:1},8,["onClick"]),e(f,{type:"primary",onClick:a[0]||(a[0]=d=>U.value=!0)},{default:t(()=>[C("交互配置")]),_:1})]),_:1}),e(f,{icon:De(u(ze)),type:"link",title:"刷新数据",style:{float:"right"},onClick:p},null,8,["icon"])]),e(Pe,{modelValue:u(c).columns,"onUpdate:modelValue":a[1]||(a[1]=d=>u(c).columns=d),onOnClick:D,onOnRemove:g},null,8,["modelValue"]),e(q,{showHeader:!1,columns:u(c).columns,"data-source":u(y),scroll:{y:i.value?300:500},pagination:{total:r.value}},{bodyCell:t(({column:d,record:B})=>[d&&d.type=="image"?(S(),A(J,{key:0,src:`${B[d.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):ee("",!0),d&&d.type=="link"?(S(),K("a",{key:1,href:`${B[d.dataIndex]}`,target:"_blank"},ke(B[d.dataIndex]),9,Ze)):ee("",!0)]),_:1},8,["columns","data-source","scroll","pagination"])]),_:1})]),e(N,{open:U.value,"onUpdate:open":a[3]||(a[3]=d=>U.value=d),footer:null,title:"交互配置"},{default:t(()=>[e(Z,{activeKey:F.value,"onUpdate:activeKey":a[2]||(a[2]=d=>F.value=d),type:"editable-card",onEdit:Q},{default:t(()=>[(S(!0),K(ae,null,xe(u(c).global.actionCfg,d=>(S(),A(Y,{key:d.id,tab:d.name},{default:t(()=>[V("div",We,[e(u(z),{layout:M.value.layout,properties:M.value.properties,formData:d},null,8,["layout","properties","formData"])])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])]),_:1},8,["open"])],64)}}}),tt=me(et,[["__scopeId","data-v-42f1550b"]]),at=ne({__name:"TableCfg",setup(k){const b=re(),{tableCfg:c,currentColumn:y,columnFields:s}=se(b),x=l({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(g=>{setTimeout(()=>{g(s.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:!1,label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),w=l();$e(()=>s,()=>{w.value&&(console.log("columnForm",w.value),w.value.refreshOption("dataIndex"))},{deep:!0,immediate:!0});const I=l("column"),$=l({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(g=>{setTimeout(()=>{g(D.value)},100)})}}}}),D=l([]);return O.getFormList().then(g=>{const{code:r,data:p,msg:i}=g;r==200&&(D.value=p.map(_=>({value:_.id,label:_.name})))}),(g,r)=>{const p=Fe,i=fe,_=ve;return S(),A(_,{activeKey:I.value,"onUpdate:activeKey":r[0]||(r[0]=U=>I.value=U)},{default:t(()=>[e(i,{key:"column",tab:"列配置"},{default:t(()=>[G((S(),A(u(z),{layout:x.value.layout,properties:x.value.properties,formData:u(y),key:u(y).id,ref_key:"columnForm",ref:w},null,8,["layout","properties","formData"])),[[oe,u(y).id]]),G(V("div",null,[e(p)],512),[[oe,!u(y).id]])]),_:1}),e(i,{key:"global",tab:"全局配置"},{default:t(()=>[e(u(z),{layout:$.value.layout,properties:$.value.properties,formData:u(c).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),be=k=>(Oe("data-v-d826e7fa"),k=k(),Le(),k),ot={class:"table-design"},lt={class:"left-part"},nt={class:"right-part"},st=be(()=>V("span",null,"(res)=>{",-1)),rt=be(()=>V("span",null,"}",-1)),it=ne({__name:"TableEditor",props:{id:{}},setup(k){const b=k,{id:c}=Ue(b),y=re(),{tableCfg:s,tableData:x,saveLoading:w,columnFields:I}=se(y),{onRefreshData:$,onSave:D}=y,g=l(!1),r=l(0),p=[{title:"数据配置",description:"在开始配置列表前，请先配置数据源",target:()=>document.querySelector(".data-source-btn")},{title:"变量配置",description:"配置数据源后,为保证数据源的正常获取数据,还需要配置对应的参数",target:()=>document.querySelector(".variable-btn")},{title:"表格布局区",description:"现在可以通过新增列,来增加表格的列,支持拖拽表头改变列的位置及列宽",target:()=>document.querySelector(".left-part")},{title:"配置区",description:"可以对表格整体或者表格单独的列进行配置,满足您的需求",target:()=>document.querySelector(".right-part")},{title:"最后",description:"保存您刚刚的配置",target:()=>document.querySelector(".save-btn")}],i=l({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),_=l(""),U=()=>{$().then(T=>{const{data:o}=T;if(o){x.value=o;try{I.value=Object.keys(o[0]).map(h=>({value:h,label:h}))}catch{le.warning("接口数据解析失败")}}})};c.value?O.getDetail(c.value).then(T=>{const{code:o,data:h,msg:E}=T;o==200&&(s.value=h,U())}):(s.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:[],filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"},{key:"pageSize",defaultValue:"10"}]},i.value=s.value.dataSource,x.value=[],I.value=[],g.value=!0);const M=te(()=>s.value.name?s.value.name:"新建表格"),F=te(()=>s.value.description?s.value.description:""),L=l(!1),j=l({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),Q=()=>{L.value=!0},P=Te(),n=()=>{P.go(-1)},a=()=>{D(),L.value=!1,n()},f=()=>{P.push({path:"/low-code/preview-table",query:{id:s.value.id}})},m=l(!1),R=l({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:T,data:o,msg:h}=await O.getApiList();return T==200?o.map(E=>({value:E.id,label:E.apiName})):[]}}}}}),H=()=>{i.value=s.value.dataSource,m.value=!0},X=()=>{s.value.dataSource=i.value,U(),J()},J=()=>{m.value=!1},q=l(!1),Y=async()=>await $(),Z=async()=>{q.value=!0;const T=await Y();q.value=!1,_.value=JSON.stringify(T,null,2)},N=l(!1),d=l([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),B=()=>{N.value=!0};return(T,o)=>{const h=de,E=_e,ie=He,ye=Je,W=pe,ge=Ae,he=Qe,Ce=Ge,Se=Ve("loading");return S(),K(ae,null,[e(ye,{title:M.value,subTitle:F.value,onBack:n,ghost:!1,style:{padding:"10px 24px"}},{extra:t(()=>[e(E,null,{default:t(()=>[e(h,{onClick:H,class:"data-source-btn"},{default:t(()=>[C(" 数据源配置 ")]),_:1}),e(h,{onClick:B,class:"variable-btn"},{default:t(()=>[C(" 变量池配置 ")]),_:1}),G(e(h,{onClick:f},{default:t(()=>[C(" 预览 ")]),_:1},512),[[oe,u(s).id]]),e(h,{onClick:Q,type:"primary",class:"save-btn"},{default:t(()=>[C(" 保存 ")]),_:1})]),_:1})]),tags:t(()=>[u(s).status?(S(),A(ie,{key:0,color:"#87d068"},{default:t(()=>[C("启用")]),_:1})):(S(),A(ie,{key:1,color:"#f50"},{default:t(()=>[C("停用")]),_:1}))]),_:1},8,["title","subTitle"]),G((S(),K("div",ot,[V("div",lt,[e(tt)]),V("div",nt,[e(at)])])),[[Se,u(w),void 0,{fullscreen:!0}]]),e(W,{open:L.value,"onUpdate:open":o[1]||(o[1]=v=>L.value=v),title:"保存",onOk:a},{default:t(()=>[e(u(z),{formData:u(s),"onUpdate:formData":o[0]||(o[0]=v=>Re(s)?s.value=v:null),layout:j.value.layout,properties:j.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e(W,{open:m.value,"onUpdate:open":o[5]||(o[5]=v=>m.value=v),title:"数据源配置",onOk:X,onCancel:J},{default:t(()=>[e(u(z),{layout:R.value.layout,properties:R.value.properties,formData:i.value,"onUpdate:formData":o[2]||(o[2]=v=>i.value=v)},null,8,["layout","properties","formData"]),e(ge,{label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}"},{default:t(()=>[st,e(ue,{height:200,modelValue:i.value.handlerFunc,"onUpdate:modelValue":o[3]||(o[3]=v=>i.value.handlerFunc=v)},null,8,["modelValue"]),rt]),_:1}),e(he,null,{default:t(()=>[C("结果区")]),_:1}),e(h,{type:"primary",style:{"margin-bottom":"5px"},onClick:Z,loading:q.value},{default:t(()=>[C("运行")]),_:1},8,["loading"]),e(ue,{height:200,disabled:"",modelValue:_.value,"onUpdate:modelValue":o[4]||(o[4]=v=>_.value=v)},null,8,["modelValue"])]),_:1},8,["open"]),e(W,{title:"变量池配置",open:N.value,footer:!1,onCancel:o[7]||(o[7]=v=>N.value=!1)},{default:t(()=>[e(je,{columns:d.value,modelValue:u(s).variablePool,"onUpdate:modelValue":o[6]||(o[6]=v=>u(s).variablePool=v)},null,8,["columns","modelValue"])]),_:1},8,["open"]),e(Ce,{current:r.value,"onUpdate:current":o[8]||(o[8]=v=>r.value=v),open:g.value,steps:p,onClose:o[9]||(o[9]=v=>g.value=!1)},null,8,["current","open"])],64)}}}),jt=me(it,[["__scopeId","data-v-d826e7fa"]]);export{jt as default};
