import{ao as be,r as s,am as ye,a0 as Q,d as X,I as Y,t as J,J as w,L as N,U as T,M as a,a3 as H,g as e,Q as u,O as g,a2 as R,aa as ge,X as he,Z as oe,ah as Se,a6 as le,w as Ce,h as q,v as G,at as we,ak as De,au as ke,av as xe,R as Ie,a1 as Ve,an as Fe,Y as ae,a4 as Te,ai as Re,aj as Ue}from"./index-CzelzMQJ.js";import{S as z}from"./SchemaForm-BZ9icFD4.js";import{D as $e}from"./DragTableHeader-CXXxmUyS.js";import{h as Oe}from"./http-Cn86aXve.js";import{t as E}from"./table-Cj_d6A-O.js";import{_ as Ae}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-DAg96F4A.js";import{C as Pe,_ as Be,a as Le,T as Ne,b as qe}from"./index-DX7cZ1Kl.js";import{S as ze}from"./SyncOutlined-B0wvBRG6.js";import{_ as Ee}from"./index-DwRMzfDT.js";import{E as Ke}from"./EditTable-D9v0NScR.js";import{S as Me}from"./index-DDkGi3Nf.js";import{T as je}from"./index-CfLrriRL.js";import{_ as He}from"./index-DBlq5KJn.js";import{_ as Je}from"./index-376my1aw.js";import{_ as Ge}from"./index-B8oT49x8.js";import"./index-7IiASWw4.js";import"./SwapRightOutlined-7KhGb9HL.js";import"./index-C7-CaDGj.js";import"./index-CppiTnXO.js";import"./index-yhHRFUlj.js";import"./index-Dve5HS5W.js";import"./index-5vq3_wmj.js";import"./vue-draggable-next.esm-bundler-BjAUru0s.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-BHboF8uw.js";import"./common-CKOHMUiV.js";import"./form-DGhxy3Sx.js";import"./index-CL1QDFj9.js";import"./EllipsisOutlined-BcTlHlCj.js";import"./index-CdqAQdpp.js";import"./FolderOutlined-CCYsddpI.js";import"./useBreakpoint-WiGz0Go8.js";import"./index-Bd-6WYyP.js";import"./PlusCircleOutlined-Bl1m6bTz.js";import"./ArrowRightOutlined-DK69hxgy.js";import"./index-CdVsK5dJ.js";import"./index-DmsUqssw.js";const Z=be("tableDesign",()=>{const D=s([]),m=s({name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),c=s([]),f=s({}),o=()=>{const l=new Date().getTime().toString().slice(-4);m.value.columns.push({id:ye(),dataIndex:"field"+l,title:"列"+l})},k=(l,r)=>{const n=r.findIndex(p=>p.id===l);n!=-1&&(f.value=r[n])},h=(l,r)=>{const n=r.findIndex(p=>p.id===l);n!=-1&&r.splice(n,1)},x=()=>{const l={};return m.value.variablePool.reduce((r,n)=>(r[n.key]=n.defaultValue,r),l),l},I=async l=>{try{const r=await Oe.run(m.value.dataSource.interfaceUrl,x());return new Function("res",l||m.value.dataSource.handlerFunc)(r.data)}catch(r){return r}},S=s(!1);return{tableCfg:m,currentColumn:f,onSelectColumn:k,onRemoveColumn:h,onAddColumn:o,tableData:D,onRefreshData:I,saveLoading:S,onSave:async()=>{S.value=!0;const{code:l,msg:r}=await E.add(m.value);l==200&&Q.success(r),S.value=!1},columnFields:c}}),Qe={class:"table-design-container"},Xe={class:"tools",style:{"margin-bottom":"5px"}},Ye=["href"],Ze=X({__name:"TableDesign",setup(D){const m=Z(),{tableCfg:c,tableData:f,columnFields:o}=Y(m),{onSelectColumn:k,onRemoveColumn:h,onAddColumn:x,onRefreshData:I}=m,S=d=>{k(d.id,c.value.columns)},_=d=>{h(d.id,c.value.columns)},l=s(0),r=()=>{I().then(d=>{const{data:b,total:V}=d;if(b){f.value=b;try{o.value=Object.keys(b[0]).map(C=>({value:C,label:C}))}catch{Q.warning("接口数据解析失败")}}V&&(l.value=V)})},n=J(()=>{var d,b;return((d=c.value.global.filterCfg)==null?void 0:d.show)&&((b=c.value.global.filterCfg)==null?void 0:b.formId)}),p=s({});return(d,b)=>{const V=oe,C=Be,O=Le,A=Pe,P=Se,B=Ee;return w(),N("div",Qe,[n.value?(w(),T(A,{key:0,class:"filter-panel"},{default:a(()=>[e(Ae,{formData:p.value,id:u(c).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),e(O,null,{default:a(()=>[e(C,{span:24,style:{"text-align":"right"}},{default:a(()=>[e(V,{type:"primary","html-type":"submit"},{default:a(()=>[g("搜索")]),_:1}),e(V,{style:{margin:"0 8px"}},{default:a(()=>[g("重置")]),_:1})]),_:1})]),_:1})]),_:1})):H("",!0),e(A,{class:"table-container"},{default:a(()=>[R("div",Xe,[e(V,{type:"primary",onClick:u(x)},{default:a(()=>[g("新增列")]),_:1},8,["onClick"]),e(V,{icon:ge(u(ze)),type:"link",title:"刷新数据",style:{float:"right"},onClick:r},null,8,["icon"])]),e($e,{modelValue:u(c).columns,"onUpdate:modelValue":b[0]||(b[0]=y=>u(c).columns=y),onOnClick:S,onOnRemove:_},null,8,["modelValue"]),e(B,{showHeader:!1,columns:u(c).columns,"data-source":u(f),scroll:{y:n.value?300:500},pagination:{total:l.value}},{bodyCell:a(({column:y,record:U})=>[y&&y.type=="image"?(w(),T(P,{key:0,src:`${U[y.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):H("",!0),y&&y.type=="link"?(w(),N("a",{key:1,href:`${U[y.dataIndex]}`,target:"_blank"},he(U[y.dataIndex]),9,Ye)):H("",!0)]),_:1},8,["columns","data-source","scroll","pagination"])]),_:1})])}}}),We=le(Ze,[["__scopeId","data-v-5ca6551a"]]),et=X({__name:"TableCfg",setup(D){const m=Z(),{tableCfg:c,currentColumn:f,columnFields:o}=Y(m),k=s({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(_=>{setTimeout(()=>{_(o.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:!1,label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),h=s();Ce(()=>o,()=>{h.value&&(console.log("columnForm",h.value),h.value.refreshOption("dataIndex"))},{deep:!0,immediate:!0});const x=s("column"),I=s({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(_=>{setTimeout(()=>{_(S.value)},100)})}}}}),S=s([]);return E.getFormList().then(_=>{const{code:l,data:r,msg:n}=_;l==200&&(S.value=r.map(p=>({value:p.id,label:p.name})))}),(_,l)=>{const r=we,n=qe,p=Ne;return w(),T(p,{activeKey:x.value,"onUpdate:activeKey":l[0]||(l[0]=d=>x.value=d)},{default:a(()=>[e(n,{key:"column",tab:"列配置"},{default:a(()=>[q((w(),T(u(z),{layout:k.value.layout,properties:k.value.properties,formData:u(f),key:u(f).id,ref_key:"columnForm",ref:h},null,8,["layout","properties","formData"])),[[G,u(f).id]]),q(R("div",null,[e(r)],512),[[G,!u(f).id]])]),_:1}),e(n,{key:"global",tab:"全局配置"},{default:a(()=>[e(u(z),{layout:I.value.layout,properties:I.value.properties,formData:u(c).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),ne=D=>(Re("data-v-82ee1c6b"),D=D(),Ue(),D),tt={class:"table-design"},at={class:"left-part"},ot={class:"right-part"},lt=ne(()=>R("span",null,"(res)=>{",-1)),nt=ne(()=>R("span",null,"}",-1)),st=X({__name:"TableEditor",props:{id:{}},setup(D){const m=D,{id:c}=De(m),f=Z(),{tableCfg:o,tableData:k,saveLoading:h,columnFields:x}=Y(f),{onRefreshData:I,onSave:S}=f,_=s(!1),l=s(0),r=[{title:"数据配置",description:"在开始配置列表前，请先配置数据源",target:()=>document.querySelector(".data-source-btn")},{title:"变量配置",description:"配置数据源后,为保证数据源的正常获取数据,还需要配置对应的参数",target:()=>document.querySelector(".variable-btn")},{title:"表格布局区",description:"现在可以通过新增列,来增加表格的列,支持拖拽表头改变列的位置及列宽",target:()=>document.querySelector(".left-part")},{title:"配置区",description:"可以对表格整体或者表格单独的列进行配置,满足您的需求",target:()=>document.querySelector(".right-part")},{title:"最后",description:"保存您刚刚的配置",target:()=>document.querySelector(".save-btn")}],n=s({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),p=s(""),d=()=>{I().then(F=>{const{data:t}=F;if(t){k.value=t;try{x.value=Object.keys(t[0]).map(v=>({value:v,label:v}))}catch{Q.warning("接口数据解析失败")}}})};c.value?E.getDetail(c.value).then(F=>{const{code:t,data:v,msg:$}=F;t==200&&(o.value=v,d())}):(o.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:{add:{show:!1,formId:""},edit:{show:!1,formId:""},view:{show:!1,formId:""}},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"},{key:"pageSize",defaultValue:"10"}]},n.value=o.value.dataSource,k.value=[],x.value=[],_.value=!0);const b=J(()=>o.value.name?o.value.name:"新建表格"),V=J(()=>o.value.description?o.value.description:""),C=s(!1),O=s({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),A=()=>{C.value=!0},P=ke(),B=()=>{P.go(-1)},y=()=>{S(),C.value=!1,B()},U=()=>{P.push({path:"/low-code/preview-table",query:{id:o.value.id}})},L=s(!1),W=s({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:F,data:t,msg:v}=await E.getApiList();return F==200?t.map($=>({value:$.id,label:$.apiName})):[]}}}}}),se=()=>{n.value=o.value.dataSource,L.value=!0},re=()=>{o.value.dataSource=n.value,d(),ee()},ee=()=>{L.value=!1},K=s(!1),ue=async()=>await I(),ie=async()=>{K.value=!0;const F=await ue();K.value=!1,p.value=JSON.stringify(F,null,2)},M=s(!1),ce=s([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),pe=()=>{M.value=!0};return(F,t)=>{const v=oe,$=Me,te=je,de=He,j=Ve,me=Te,fe=Ge,_e=Je,ve=xe("loading");return w(),N(Ie,null,[e(de,{title:b.value,subTitle:V.value,onBack:B,ghost:!1,style:{padding:"10px 24px"}},{extra:a(()=>[e($,null,{default:a(()=>[e(v,{onClick:se,class:"data-source-btn"},{default:a(()=>[g(" 数据源配置 ")]),_:1}),e(v,{onClick:pe,class:"variable-btn"},{default:a(()=>[g(" 变量池配置 ")]),_:1}),q(e(v,{onClick:U},{default:a(()=>[g(" 预览 ")]),_:1},512),[[G,u(o).id]]),e(v,{onClick:A,type:"primary",class:"save-btn"},{default:a(()=>[g(" 保存 ")]),_:1})]),_:1})]),tags:a(()=>[u(o).status?(w(),T(te,{key:0,color:"#87d068"},{default:a(()=>[g("启用")]),_:1})):(w(),T(te,{key:1,color:"#f50"},{default:a(()=>[g("停用")]),_:1}))]),_:1},8,["title","subTitle"]),q((w(),N("div",tt,[R("div",at,[e(We)]),R("div",ot,[e(et)])])),[[ve,u(h),void 0,{fullscreen:!0}]]),e(j,{open:C.value,"onUpdate:open":t[1]||(t[1]=i=>C.value=i),title:"保存",onOk:y},{default:a(()=>[e(u(z),{formData:u(o),"onUpdate:formData":t[0]||(t[0]=i=>Fe(o)?o.value=i:null),layout:O.value.layout,properties:O.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e(j,{open:L.value,"onUpdate:open":t[5]||(t[5]=i=>L.value=i),title:"数据源配置",onOk:re,onCancel:ee},{default:a(()=>[e(u(z),{layout:W.value.layout,properties:W.value.properties,formData:n.value,"onUpdate:formData":t[2]||(t[2]=i=>n.value=i)},null,8,["layout","properties","formData"]),e(me,{label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}"},{default:a(()=>[lt,e(ae,{height:200,modelValue:n.value.handlerFunc,"onUpdate:modelValue":t[3]||(t[3]=i=>n.value.handlerFunc=i)},null,8,["modelValue"]),nt]),_:1}),e(fe,null,{default:a(()=>[g("结果区")]),_:1}),e(v,{type:"primary",style:{"margin-bottom":"5px"},onClick:ie,loading:K.value},{default:a(()=>[g("运行")]),_:1},8,["loading"]),e(ae,{height:200,disabled:"",modelValue:p.value,"onUpdate:modelValue":t[4]||(t[4]=i=>p.value=i)},null,8,["modelValue"])]),_:1},8,["open"]),e(j,{title:"变量池配置",open:M.value,footer:!1,onCancel:t[7]||(t[7]=i=>M.value=!1)},{default:a(()=>[e(Ke,{columns:ce.value,modelValue:u(o).variablePool,"onUpdate:modelValue":t[6]||(t[6]=i=>u(o).variablePool=i)},null,8,["columns","modelValue"])]),_:1},8,["open"]),e(_e,{current:l.value,"onUpdate:current":t[8]||(t[8]=i=>l.value=i),open:_.value,steps:r,onClose:t[9]||(t[9]=i=>_.value=!1)},null,8,["current","open"])],64)}}}),Kt=le(st,[["__scopeId","data-v-82ee1c6b"]]);export{Kt as default};
