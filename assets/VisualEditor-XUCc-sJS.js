var j=Object.defineProperty;var Z=(i,e,t)=>e in i?j(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var b=(i,e,t)=>Z(i,typeof e!="symbol"?e+"":e,t);import{u as Q}from"./vue-router-C97ZxxSg.js";import{_ as tt}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BcEjXg7B.js";import{d as et,s as G}from"./pinia-DMSgKyd8.js";import{c as A}from"./lodash-es-PU94eZQX.js";import{r as C,d as M,U as m,V as w,u as D,a4 as I,ad as F,F as S,Y as T,a5 as h,af as O,G as q,x as ot,E as at,W as v,aa as Y,a7 as nt,m as R,Z as z,J as k,a6 as K,c as g}from"./@vue-Ckf1Z535.js";import{b as $}from"./index-CiSVSn52.js";import{o as st}from"./gaius-utils-B5cUlySA.js";import{v as it}from"./uuid-CQkTLCs1.js";import{u as lt,z as ct,A as rt,L as pt,B as dt,t as ut,T as mt}from"./ant-design-vue-nZFTCpdE.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-BZ-RyzXc.js";import"./common-uhxXp2z5.js";import"./form-EWSwfiRT.js";/* empty css                      */import"./axios-B4uVmeYG.js";import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-BDAzFyRD.js";import"./vue-codemirror-CVO3ucIx.js";import"./codemirror-CwY5MT_v.js";import"./@codemirror-BgatmlGX.js";import"./@lezer-CciglqRQ.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./@ant-design-C9fRTiaf.js";import"./@ctrl-DOFZgDuz.js";import"./echarts-DetEu2Tg.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CDo53BfZ.js";import"./@babel-BiFW4_mA.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-X-x4l2Bb.js";import"./throttle-debounce-CUWDS_la.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-C5fUfLeo.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";const V=10,B=et("visual",()=>{const i=C({componentData:[],name:"",id:"",img:"",height:1080,width:1920}),e=C({name:"",type:"",id:"",props:{},tag:"",position:{top:0,left:0},size:{width:0,height:0},formId:""}),t=C([]),o=C(0),a=()=>{t.value[o.value++]=A(i.value.componentData),t.value.length>V&&(t.value=t.value.slice(t.value.length-V),o.value=V)},n=()=>{o.value>0&&(o.value--,i.value.componentData=A(t.value[o.value]))},u=()=>{o.value<t.value.length-1&&(o.value++,i.value.componentData=A(t.value[o.value]))},_=f=>{const d=i.value.componentData.findIndex(p=>p.id===f.id);d!=-1&&(e.value=i.value.componentData[d])};return{undo:n,redo:u,setSnapshot:a,onClickComp:_,visualData:i,curCompData:e,addComp:f=>{i.value.componentData.push(f),_(f),a()},removeComp:f=>{const d=i.value.componentData.findIndex(p=>p.id===f.id);d!=-1&&(i.value.componentData.splice(d,1),a())},snapshotData:t,curSnapshotIdx:o}}),ft={class:"cfg"},vt=M({__name:"CfgArea",setup(i){const e=B(),{visualData:t,curCompData:o}=G(e);return(a,n)=>(m(),w("div",ft,[D(o).formId?(m(),I(tt,{"form-data":D(o),id:D(o).formId,key:D(o).formId},null,8,["form-data","id"])):F("",!0)]))}}),ht=$(vt,[["__scopeId","data-v-4dd99f10"]]),_t=[{name:"图片",type:"img",tag:"img",icon:"icon-image1",props:{src:"https://avatars.githubusercontent.com/u/59641156?v=4",draggable:!1},style:{width:"100%",height:"100%"},formId:"c0c67e96-858b-4303-999c-92d0d39cb792"},{name:"文本",type:"text",tag:"span",icon:"icon-text",props:{value:"text"}},{name:"视频",type:"video",tag:"video",icon:"icon-video",props:{src:"",controls:!0,draggable:!1},style:{position:"relative",width:"100%",height:"100%","object-fit":"fill","z-index":-1}},{name:"嵌入页",type:"iframe",tag:"iframe",icon:"icon-HTML",props:{src:"http://120.26.161.36:8080/",draggable:!1},style:{position:"relative",width:"100%",height:"100%","z-index":-1},formId:"6ba21979-d5ec-4715-831e-62046fbfb0d9"},{name:"柱状图",type:"bar",tag:"g-echart",icon:"icon-barchart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"bar"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"折线图",type:"line",tag:"g-echart",icon:"icon-linechart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"line"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"组",type:"group",tag:"visual-group",icon:"icon-deploymentunit",props:{data:[]}}];class H{constructor(e,t){b(this,"name","组件");b(this,"id");b(this,"type");b(this,"tag");b(this,"icon");b(this,"props");b(this,"style");b(this,"formId","");b(this,"position",{top:0,left:0});b(this,"size",{width:0,height:0});this.id=t||it(),this.type=e;const o=_t.find(n=>n.type===e),a=A(o);o?(this.tag=a.tag,this.props=a.props,this.name=a.name,this.style=a.style,this.icon=a.icon,this.formId=a.formId):(this.tag="div",this.icon="icon")}}const gt=i=>{let e=null,t=null,o=0,a=0;return i.forEach(n=>{e=e==null?n.position.left:Math.min(e,n.position.left),t=t==null?n.position.top:Math.min(t,n.position.top),o=Math.max(o,n.position.left+n.size.width),a=Math.max(a,n.position.top+n.size.height)}),{left:e,top:t,width:o-e,height:a-t}},yt=i=>{const{left:e,top:t,width:o,height:a}=gt(i),n=new H("group");return n.position={top:t,left:e},n.size={width:o,height:a},n.props={data:i.map(u=>({...u,position:{left:u.position.left-e,top:u.position.top-t}}))},n},xt=M({__name:"DesignArea",setup(i){const e=B(),{visualData:t,curCompData:o}=G(e),{onClickComp:a,setSnapshot:n,addComp:u,removeComp:_}=e,c=C(),s=C([]),f=C(!1),d=C({x:0,y:0}),p=C({x:0,y:0}),E=l=>{f.value=!0,d.value.x=l.offsetX,d.value.y=l.offsetY;const y=U=>{let x=U;p.value.x=x.offsetX,p.value.y=x.offsetY},r=()=>{document.querySelector(".container").removeEventListener("mousemove",y),document.querySelector(".container").removeEventListener("mouseup",r),L()};document.querySelector(".container").addEventListener("mousemove",y),document.querySelector(".container").addEventListener("mouseup",r)},L=()=>{t.value.componentData.map(l=>{l.position.left>=d.value.x&&l.position.left+l.size.width<=p.value.x&&l.position.top>=d.value.y&&l.position.top+l.size.height<=p.value.y&&s.value.push(l.id)}),p.value={x:0,y:0},d.value={x:0,y:0}},N=()=>{s.value=[]},J=l=>{l.preventDefault()},W=l=>{l.preventDefault();let y=JSON.parse(l.dataTransfer.getData("componentData"));y&&(y=new H(y.name),y.position={top:l.offsetY,left:l.offsetX},y.size={width:100,height:100},u(y))},X=()=>{n()},P=()=>{if(s.value.length){let l=t.value.componentData.filter(r=>s.value.includes(r.id));const y=yt(l);l.forEach(r=>{_(r)}),u(y),N()}};return document.body.addEventListener("keydown",l=>{l.ctrlKey&&l.key==="g"&&(l.preventDefault(),P())}),(l,y)=>(m(),w("div",{ref_key:"container",ref:c,class:"container",onDragover:J,onDrop:W,onMousedown:E},[(m(!0),w(S,null,T(D(t).componentData,(r,U)=>(m(),I(D(st),{key:r.id,minh:20,minw:20,width:r.size.width,"onUpdate:width":x=>r.size.width=x,height:r.size.height,"onUpdate:height":x=>r.size.height=x,top:r.position.top,"onUpdate:top":x=>r.position.top=x,left:r.position.left,"onUpdate:left":x=>r.position.left=x,"node-key":r.id,active:r.id==D(o).id||s.value.includes(r.id),class:"drag",style:O({zIndex:`${U+100}`}),wait:10,onUpdate:X,onClick:q(x=>D(a)(r),["stop"]),onMousedown:q(x=>D(a)(r),["stop"])},{default:h(()=>[(m(),I(Y(r.tag),nt({ref_for:!0},r.props,{style:r.style||{}}),null,16,["style"]))]),_:2},1032,["width","onUpdate:width","height","onUpdate:height","top","onUpdate:top","left","onUpdate:left","node-key","active","style","onClick","onMousedown"]))),128)),ot(v("div",{class:"mask",style:O({width:p.value.x-d.value.x+"px",height:p.value.y-d.value.y+"px",top:d.value.y+"px",left:d.value.x+"px"})},null,4),[[at,f.value]])],544))}}),Ct=$(xt,[["__scopeId","data-v-c53f5514"]]),bt=["title"],Dt=M({__name:"NodeRelationship",setup(i){const e=B(),{visualData:t}=G(e),{onClickComp:o}=e,a=(c,s)=>{o(s.node.dataRef)},n=c=>{},u=c=>{let s={id:c.id,type:c.type,children:[],icon:c.icon,name:c.name};return s.type=="group"&&c.props.data.length>0&&(s.children=c.props.data.map(f=>u(f))),s},_=R(()=>{let c=[];return t.value.componentData.map(s=>{c.push(u(s))}),c});return(c,s)=>{const f=lt;return m(),I(f,{class:"draggable-tree",draggable:"","block-node":"","tree-data":_.value,showIcon:!1,onSelect:a,onDrop:n,fieldNames:{title:"name",key:"id",children:"children"}},{title:h(({name:d,data:p})=>[v("div",{title:`${d}(${p.id})`},[v("i",{class:z(["iconfont",p.icon])},null,2),k(" "+K(d),1)],8,bt)]),_:1},8,["tree-data"])}}}),wt=$(Dt,[["__scopeId","data-v-d6059f81"]]),kt={class:"component-layout"},It=["data-component"],St={class:"component-item-text"},Mt=M({__name:"MaterialArea",setup(i){const e=C(),t=[{title:"基础组件",value:"base",list:[{label:"图片",icon:"icon-image1",name:"img"},{label:"文本",icon:"icon-text",name:"text"},{label:"视频",name:"video",icon:"icon-video"},{label:"嵌入页",name:"iframe",icon:"icon-HTML"}]},{title:"图表",value:"echart",list:[{label:"柱状图",icon:"icon-barchart",name:"bar"},{label:"折线图",icon:"icon-linechart",name:"line"}]}],o=a=>{a&&a.target&&a.dataTransfer&&a.dataTransfer.setData("componentData",a.target.getAttribute("data-component"))};return(a,n)=>{const u=ct,_=rt;return m(),I(_,{activeKey:e.value,"onUpdate:activeKey":n[0]||(n[0]=c=>e.value=c),class:"material-area",ghost:!0},{default:h(()=>[(m(),w(S,null,T(t,c=>g(u,{header:c.title,key:c.value},{default:h(()=>[v("div",kt,[(m(!0),w(S,null,T(c.list,s=>(m(),w("div",{class:"component-item",key:s.name,draggable:"true",onDragstart:o,"data-component":JSON.stringify(s)},[v("span",{class:z(["iconfont component-item-icon",s.icon])},null,2),v("span",St,K(s.label),1)],40,It))),128))])]),_:2},1032,["header"])),64))]),_:1},8,["activeKey"])}}}),$t=$(Mt,[["__scopeId","data-v-625d7f87"]]),zt={class:"left-side-bar"},Lt={class:"bar-top"},At=["title","onClick"],Tt={class:"header"},Bt={class:"title"},Et={class:"container"},Nt=M({__name:"LeftSideBar",setup(i){const e=[{label:"素材库",value:"componentLib",icon:"appstoreadd",component:$t},{label:"节点关系",value:"nodeRelationship",icon:"link",component:wt}],t=C(),o=C(!1),a=()=>{o.value=!o.value},n=_=>{t.value=_},u=()=>{t.value=void 0};return(_,c)=>(m(),w(S,null,[v("div",zt,[v("ul",Lt,[(m(),w(S,null,T(e,s=>v("li",{key:s.value,title:s.label,class:z([`iconfont icon-${s.icon}`,t.value&&t.value.value===s.value?"active":""]),onClick:f=>n(s)},null,10,At)),64))])]),t.value?(m(),w("div",{class:z(["left-part",o.value?"affix":""]),key:t.value.value},[v("div",Tt,[v("div",Bt,K(t.value.label),1),v("div",{class:z(["affix iconfont",o.value?"icon-pushpin-fill":"icon-pushpin"]),onClick:a},null,2),v("div",{class:"close iconfont icon-close",onClick:u})]),v("div",Et,[(m(),I(Y(t.value.component)))])],2)):F("",!0)],64))}}),Ut=$(Nt,[["__scopeId","data-v-49c5d324"]]),Vt={class:"design-container"},Rt=M({__name:"VisualEditor",setup(i){const e=B(),{undo:t,redo:o}=e,a=Q(),n=R(()=>"title"),u=R(()=>"desc"),_=()=>{},c=()=>{},s=()=>{a.go(-1)};return(f,d)=>{const p=dt,E=ut,L=mt,N=pt;return m(),w(S,null,[g(N,{title:n.value,subTitle:u.value,onBack:s,ghost:!1,style:{padding:"10px 24px"}},{extra:h(()=>[g(E,null,{default:h(()=>[g(p,{onClick:D(t)},{default:h(()=>[k("撤销")]),_:1},8,["onClick"]),g(p,{onClick:D(o)},{default:h(()=>[k("重做")]),_:1},8,["onClick"]),g(p,null,{default:h(()=>[k("加载外部组件")]),_:1}),g(p,{onClick:_,class:"variable-btn"},{default:h(()=>[k(" 变量池配置 ")]),_:1}),g(p,{onClick:c,type:"primary",class:"save-btn"},{default:h(()=>[k(" 保存 ")]),_:1})]),_:1})]),tags:h(()=>[g(L,{color:"#87d068"},{default:h(()=>[k("启用")]),_:1}),g(L,{color:"#f50"},{default:h(()=>[k("停用")]),_:1})]),_:1},8,["title","subTitle"]),v("div",Vt,[g(Ut,{class:"left-sider"}),g(Ct),g(ht)])],64)}}}),Ie=$(Rt,[["__scopeId","data-v-97ca49e8"]]);export{Ie as default};
