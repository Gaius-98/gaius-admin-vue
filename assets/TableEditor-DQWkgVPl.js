import{ay as ue,r as i,aw as ce,R as pe,d as q,B as J,p as j,D as b,I as F,E as T,F as t,U as H,g as e,G as n,M as g,S as $,Z as de,N as me,V as Y,aC as fe,au as _e,aD as ve,aE as ge,h as W,K as be,v as ye,ax as he,O as X,a0 as Se,a1 as Ce}from"./index-bmd1BFpa.js";import{S as P}from"./SchemaForm-BDSTFj4F.js";import{D as De}from"./DragTableHeader-BQcKQMHq.js";import{h as we}from"./http-DhmzCzHk.js";import{t as E}from"./table-Ce98BZqw.js";import"./html2canvas.esm-BfYXEYrK.js";import{_ as ke}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-CnZ-1Il3.js";import{C as xe,_ as Ie,a as Ve,T as Te,b as Re}from"./index-CHgE4CQh.js";import{S as Ue}from"./SyncOutlined-Dm7Rv4YH.js";import{B as ee,_ as Fe}from"./index-ccK5NkPn.js";import{I as $e}from"./index-BK2y0-Qq.js";import{_ as Oe}from"./index-DtiKgdxz.js";import{E as ze}from"./EditTable-w99qw0sU.js";import{M as Ae}from"./index-CrUghFyL.js";import{S as Be}from"./index-_zUWzMOO.js";import{T as Ne}from"./index--nVjuQ_Y.js";import{_ as Pe}from"./index-7c7TDP6-.js";import{_ as Ee}from"./index-Cq9WKtO8.js";import"./index-B6bQoHWO.js";import"./SwapRightOutlined-DUaVRxMa.js";import"./index-CwNMyvuk.js";import"./index-Cg1wufYO.js";import"./index-6ZzqSCih.js";import"./index-BtZ359FT.js";import"./vue-draggable-next.esm-bundler-BSmVTR9C.js";import"./SwapOutlined-TcDKE0fZ.js";import"./DeleteOutlined-CY1dZxNL.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-CEhB9v52.js";import"./index-D8JELHeK.js";import"./common-BPfWHcpG.js";import"./form-CMdEH94D.js";import"./index-Dt-PmioO.js";import"./PlusOutlined-N7c1luKh.js";import"./index-CKZFhYXA.js";import"./FolderOutlined-Ngg1a1-D.js";import"./useBreakpoint-HC6Nlkir.js";import"./PlusCircleOutlined-BeFr6FAr.js";import"./ActionButton-Cn8iBn1C.js";import"./useDestroyed-C_53bEg2.js";import"./ArrowRightOutlined-CAlSanQc.js";import"./index-DRvELAbR.js";import"./index-D38tsNJ2.js";const Z=ue("tableDesign",()=>{const D=i([]),d=i({name:"",description:"",status:1,columns:[],global:{bordered:!1,pagination:{current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),u=i({}),y=()=>{const o=new Date().getTime().toString().slice(-4);d.value.columns.push({id:ce(),dataIndex:"field"+o,title:"列"+o})},a=(o,l)=>{const r=l.findIndex(m=>m.id===o);r!=-1&&(u.value=l[r])},w=(o,l)=>{const r=l.findIndex(m=>m.id===o);r!=-1&&l.splice(r,1)},x=()=>{const o={};return d.value.variablePool.reduce((l,r)=>(l[r.key]=r.defaultValue,l),o),o},h=async o=>{try{const l=await we.run(d.value.dataSource.interfaceUrl,x());return new Function("res",o||d.value.dataSource.handlerFunc)(l.data)}catch(l){return l}},_=i(!1);return{tableCfg:d,currentColumn:u,onSelectColumn:a,onRemoveColumn:w,onAddColumn:y,tableData:D,onRefreshData:h,saveLoading:_,onSave:async()=>{_.value=!0;const{code:o,msg:l}=await E.add(d.value);o==200&&pe.success(l),_.value=!1}}}),Ke={class:"table-design-container"},Le={class:"tools"},Me=["href"],Ge=q({__name:"TableDesign",setup(D){const d=Z(),{tableCfg:u,tableData:y}=J(d),{onSelectColumn:a,onRemoveColumn:w,onAddColumn:x,onRefreshData:h}=d,_=f=>{a(f.id,u.value.columns)},c=f=>{w(f.id,u.value.columns)},o=i(0),l=()=>{h().then(f=>{const{data:S,total:C}=f;S&&(y.value=S),C&&(o.value=C)})},r=j(()=>{var f,S;return((f=u.value.global.filterCfg)==null?void 0:f.show)&&((S=u.value.global.filterCfg)==null?void 0:S.formId)}),m=i({});return(f,S)=>{const C=ee,O=Ie,K=Ve,z=xe,I=$e,A=Oe;return b(),F("div",Ke,[r.value?(b(),T(z,{key:0,class:"filter-panel"},{default:t(()=>[e(ke,{formData:m.value,id:n(u).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),e(K,null,{default:t(()=>[e(O,{span:24,style:{"text-align":"right"}},{default:t(()=>[e(C,{type:"primary","html-type":"submit"},{default:t(()=>[g("搜索")]),_:1}),e(C,{style:{margin:"0 8px"}},{default:t(()=>[g("重置")]),_:1})]),_:1})]),_:1})]),_:1})):H("",!0),e(z,{class:"table-container"},{default:t(()=>[$("div",Le,[e(C,{type:"primary",onClick:n(x)},{default:t(()=>[g("新增列")]),_:1},8,["onClick"]),e(C,{icon:de(n(Ue)),type:"link",title:"刷新数据",style:{float:"right"},onClick:l},null,8,["icon"])]),e(De,{modelValue:n(u).columns,"onUpdate:modelValue":S[0]||(S[0]=v=>n(u).columns=v),onOnClick:_,onOnRemove:c},null,8,["modelValue"]),e(A,{showHeader:!1,columns:n(u).columns,"data-source":n(y),scroll:{y:r.value?300:500},pagination:{total:o.value}},{bodyCell:t(({column:v,record:R})=>[v&&v.type=="image"?(b(),T(I,{key:0,src:`${R[v.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):H("",!0),v&&v.type=="link"?(b(),F("a",{key:1,href:`${R[v.dataIndex]}`,target:"_blank"},me(R[v.dataIndex]),9,Me)):H("",!0)]),_:1},8,["columns","data-source","scroll","pagination"])]),_:1})])}}}),He=Y(Ge,[["__scopeId","data-v-1f8accd1"]]),je={key:1},qe=q({__name:"TableCfg",setup(D){const d=Z(),u=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"string",label:"字段名"},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左固定"},{value:"right",label:"右固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),y=i("column"),a=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"pagination.pageSize":{type:"number",label:"每页条数"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(c=>{setTimeout(()=>{c(w.value)},100)})}}}}),w=i([]);E.getFormList().then(_=>{const{code:c,data:o,msg:l}=_;c==200&&(w.value=o.map(r=>({value:r.id,label:r.name})))});const{tableCfg:x,currentColumn:h}=J(d);return(_,c)=>{const o=fe,l=Re,r=Te;return b(),T(r,{activeKey:y.value,"onUpdate:activeKey":c[0]||(c[0]=m=>y.value=m)},{default:t(()=>[e(l,{key:"column",tab:"列配置"},{default:t(()=>[n(h).id?(b(),T(n(P),{layout:u.value.layout,properties:u.value.properties,formData:n(h),key:n(h).id},null,8,["layout","properties","formData"])):(b(),F("div",je,[e(o)]))]),_:1}),e(l,{key:"global",tab:"全局配置"},{default:t(()=>[e(n(P),{layout:a.value.layout,properties:a.value.properties,formData:n(x).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),te=D=>(Se("data-v-c6a95449"),D=D(),Ce(),D),Je={class:"table-design"},Ze={class:"left-part"},Qe={class:"right-part"},We=te(()=>$("span",null,"(res)=>{",-1)),Xe=te(()=>$("span",null,"}",-1)),Ye=q({__name:"TableEditor",props:{id:{}},setup(D){const d=D,{id:u}=_e(d),y=Z(),{tableCfg:a,tableData:w,saveLoading:x}=J(y),{onRefreshData:h,onSave:_}=y,c=i({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),o=i("");u.value?E.getDetail(u.value).then(V=>{const{code:s,data:k,msg:U}=V;s==200&&(a.value=k,h().then(B=>{const{data:N}=B;N&&(w.value=N)}))}):(a.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,pagination:{current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{add:{show:!1,formId:""},edit:{show:!1,formId:""},view:{show:!1,formId:""}},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"}]},c.value=a.value.dataSource);const l=j(()=>a.value.name?a.value.name:"新建表格"),r=j(()=>a.value.description?a.value.description:""),m=i(!1),f=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),S=()=>{m.value=!0},C=ve(),O=()=>{C.go(-1)},K=()=>{_(),m.value=!1,O()},z=()=>{C.push({path:"/low-code/preview-table",query:{id:a.value.id}})},I=i(!1),A=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:V,data:s,msg:k}=await E.getApiList();return V==200?s.map(U=>({value:U.id,label:U.apiName})):[]}}}}}),v=()=>{c.value=a.value.dataSource,I.value=!0},R=()=>{a.value.dataSource=c.value,Q()},Q=()=>{I.value=!1},L=i(!1),ae=async()=>await h(),oe=async()=>{L.value=!0;const V=await ae();L.value=!1,o.value=JSON.stringify(V,null,2)},M=i(!1),le=i([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),ne=()=>{M.value=!0};return(V,s)=>{const k=ee,U=Be,B=Ne,N=Pe,G=Ae,se=Fe,re=Ee,ie=ge("loading");return b(),F(be,null,[e(N,{title:l.value,subTitle:r.value,onBack:O,ghost:!1,style:{padding:"10px 24px"}},{extra:t(()=>[e(U,null,{default:t(()=>[e(k,{onClick:v},{default:t(()=>[g(" 数据源配置 ")]),_:1}),e(k,{onClick:ne},{default:t(()=>[g(" 变量池配置 ")]),_:1}),W(e(k,{onClick:z},{default:t(()=>[g(" 预览 ")]),_:1},512),[[ye,n(a).id]]),e(k,{onClick:S,type:"primary"},{default:t(()=>[g(" 保存 ")]),_:1})]),_:1})]),tags:t(()=>[n(a).status?(b(),T(B,{key:0,color:"#87d068"},{default:t(()=>[g("启用")]),_:1})):(b(),T(B,{key:1,color:"#f50"},{default:t(()=>[g("停用")]),_:1}))]),_:1},8,["title","subTitle"]),W((b(),F("div",Je,[$("div",Ze,[e(He)]),$("div",Qe,[e(qe)])])),[[ie,n(x),void 0,{fullscreen:!0}]]),e(G,{open:m.value,"onUpdate:open":s[1]||(s[1]=p=>m.value=p),title:"保存",onOk:K},{default:t(()=>[e(n(P),{formData:n(a),"onUpdate:formData":s[0]||(s[0]=p=>he(a)?a.value=p:null),layout:f.value.layout,properties:f.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e(G,{open:I.value,"onUpdate:open":s[5]||(s[5]=p=>I.value=p),title:"数据源配置",onOk:R,onCancel:Q},{default:t(()=>[e(n(P),{layout:A.value.layout,properties:A.value.properties,formData:c.value,"onUpdate:formData":s[2]||(s[2]=p=>c.value=p)},null,8,["layout","properties","formData"]),e(se,{label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}"},{default:t(()=>[We,e(X,{height:200,modelValue:c.value.handlerFunc,"onUpdate:modelValue":s[3]||(s[3]=p=>c.value.handlerFunc=p)},null,8,["modelValue"]),Xe]),_:1}),e(re,null,{default:t(()=>[g("结果区")]),_:1}),e(k,{type:"primary",style:{"margin-bottom":"5px"},onClick:oe,loading:L.value},{default:t(()=>[g("运行")]),_:1},8,["loading"]),e(X,{height:200,disabled:"",modelValue:o.value,"onUpdate:modelValue":s[4]||(s[4]=p=>o.value=p)},null,8,["modelValue"])]),_:1},8,["open"]),e(G,{title:"变量池配置",open:M.value,footer:!1,onCancel:s[7]||(s[7]=p=>M.value=!1)},{default:t(()=>[e(ze,{columns:le.value,modelValue:n(a).variablePool,"onUpdate:modelValue":s[6]||(s[6]=p=>n(a).variablePool=p)},null,8,["columns","modelValue"])]),_:1},8,["open"])],64)}}}),Lt=Y(Ye,[["__scopeId","data-v-c6a95449"]]);export{Lt as default};
