import{_ as J}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-Ds_H49JG.js";import{t as te}from"./table-CTxkn6Uv.js";import{h as ae}from"./http-mvvmmAzB.js";import{a as O,g as oe,M as ne,B as le,j as re,k as se,t as ie,I as ue,n as ce,N as pe}from"./ant-design-vue-CaKXcGcF.js";import{U as me,D as de,a1 as fe}from"./@ant-design-0mnrYJ2t.js";import{d as _e,L as ve,r,m as W,w as Z,R as d,S as U,U as j,W as I,a8 as s,Z as F,c as l,F as T,_ as ge,J as B,h as G,u as A,V as S,a1 as K}from"./@vue-fHF42jnH.js";import{b as ye}from"./index-BiYaJyuZ.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-B8l-Dj0n.js";import"./uuid-CQkTLCs1.js";import"./common-DY7zZKah.js";import"./form-Dd7uUe7w.js";import"./axios-B4uVmeYG.js";import"./@babel-BiFW4_mA.js";import"./lodash-es-PU94eZQX.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-X-x4l2Bb.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-C5fUfLeo.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";import"./pinia-DfzYFrYR.js";/* empty css                      */import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-D7-wZPRK.js";import"./vue-router-D1iaMedC.js";import"./vue-codemirror-CQ4kpRVU.js";import"./codemirror-XzAVIbiy.js";import"./@codemirror-ByA7djrN.js";import"./@lezer-Bb8aRhbX.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";const he=i=>{const c={};return i.reduce((p,e)=>(p[e.key]=e.defaultValue,p),c),c},ke=async(i,c,p)=>{try{const e=await ae.run(i.interfaceUrl,{...c,...p});let v;return i.handlerFunc?v=new Function("res",i.handlerFunc)(e.data):v=e,v}catch(e){return e}},Ce=(i,c)=>i.replace(/\${(.*?)}/g,(p,e)=>c[e.trim()]),w={getProxyData:ke,transformParamsData:he,parseString:Ce},be={class:"low-code-table"},we={style:{"font-size":"12px"}},xe={class:"tools"},De=["href"],Ue=_e({__name:"LowCodeTable",props:{id:{}},setup(i){const c=i,{id:p}=ve(c),e=r({}),v=r([]),x=r({}),N=r(!1),Q=()=>{x.value={},k()},h=r(!1),M=W(()=>{var a,t,n,f,u,m;return((n=(t=(a=e.value)==null?void 0:a.global)==null?void 0:t.filterCfg)==null?void 0:n.show)&&((m=(u=(f=e.value)==null?void 0:f.global)==null?void 0:u.filterCfg)==null?void 0:m.formId)}),X=W(()=>P.value.length>0?[...e.value.columns,{title:"操作",dataIndex:"_action",key:"_action",width:200,fixed:"right"}]:e.value.columns),g=r({}),R=r([]),P=r([]);Z(()=>p.value,()=>{te.getDetail(p.value).then(a=>{var u;const{code:t,data:n,msg:f}=a;t==200&&(e.value=n,e.value.global.actionCfg&&((u=e.value.global.actionCfg)==null?void 0:u.length)>0&&e.value.global.actionCfg.map(_=>{_.position=="header"?R.value.push(_):P.value.push(_)}),g.value=w.transformParamsData(e.value.variablePool),k())})},{immediate:!0}),Z(()=>g.value,()=>{k()},{deep:!0});const q=r(0),k=async()=>{N.value=!0;try{const{data:a,total:t}=await w.getProxyData(e.value.dataSource,g.value,x.value);v.value=a,t&&(q.value=t)}catch(a){O.error("获取数据失败:"+a)}N.value=!1},D=r(!1),y=r({}),$=r({}),E=async(a,t)=>{const{formId:n,event:f,interfaceUrl:u,AfterHandleFunc:m,request:_,linkUrl:V,actionCfg:C}=a;if(_){const z=await w.getProxyData({type:"dynamic",interfaceUrl:u,handlerFunc:m},{},{...t});y.value=z}else y.value=t||{};switch(f){case"modal":$.value={id:n,modalUrl:C==null?void 0:C.interfaceUrl},D.value=!0;break;case"link":window.open(w.parseString(V,y.value),"_blank");break}},H=()=>{y.value={},D.value=!1},Y=()=>{w.getProxyData({type:"dynamic",interfaceUrl:$.value.modalUrl,handlerFunc:""},{},{...y.value}).then(a=>{var t;O.info((t=a==null?void 0:a.data)==null?void 0:t.msg),H()}).catch(a=>{O.error(a)})};return(a,t)=>{const n=le,f=re,u=se,m=oe,_=ie,V=ue,C=ce,z=pe,ee=ne;return d(),U(T,null,[j("div",be,[M.value?(d(),I(m,{key:0,class:"filter-panel"},{default:s(()=>[l(J,{formData:x.value,id:e.value.global.filterCfg.formId,class:ge(["filter-form",h.value?"expand":""])},null,8,["formData","id","class"]),l(u,null,{default:s(()=>[l(f,{span:24,style:{"text-align":"right"}},{default:s(()=>[l(n,{type:"primary","html-type":"submit",onClick:k},{default:s(()=>[B("搜索")]),_:1}),l(n,{style:{margin:"0 8px"},onClick:Q},{default:s(()=>[B("重置")]),_:1}),l(n,{type:"link",icon:G(h.value?A(me):A(de)),onClick:t[0]||(t[0]=o=>h.value=!h.value)},{default:s(()=>[j("span",we,S(h.value?"收起":"展开"),1)]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})):F("",!0),l(m,{class:"table-container"},{default:s(()=>[j("div",xe,[l(_,null,{default:s(()=>[(d(!0),U(T,null,K(R.value,o=>(d(),I(n,{key:o.id,onClick:b=>E(o)},{default:s(()=>[B(S(o.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),l(n,{icon:G(A(fe)),type:"link",title:"刷新数据",style:{float:"right"},onClick:k},null,8,["icon"])]),l(C,{columns:X.value,"data-source":v.value,scroll:{y:M.value?400:650},loading:N.value,pagination:!1},{bodyCell:s(({column:o,record:b})=>[o.type=="image"?(d(),I(V,{key:0,src:`${b[o.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):F("",!0),o.type=="link"?(d(),U("a",{key:1,href:`${b[o.dataIndex]}`,target:"_blank"},S(b[o.dataIndex]),9,De)):F("",!0),o.key=="_action"?(d(!0),U(T,{key:2},K(P.value,L=>(d(),I(n,{type:"link",onClick:Ie=>E(L,b),key:L.id},{default:s(()=>[B(S(L.name),1)]),_:2},1032,["onClick"]))),128)):F("",!0)]),_:1},8,["columns","data-source","scroll","loading"]),l(z,{style:{display:"flex","justify-content":"flex-end","margin-top":"20px"},current:g.value.pageNumber,"onUpdate:current":t[1]||(t[1]=o=>g.value.pageNumber=o),pageSize:g.value.pageSize||10,total:q.value,"show-less-items":""},null,8,["current","pageSize","total"])]),_:1})]),l(ee,{open:D.value,"onUpdate:open":t[2]||(t[2]=o=>D.value=o),onOk:Y,onCancel:H},{default:s(()=>[l(J,{formData:y.value,id:$.value.id},null,8,["formData","id"])]),_:1},8,["open"])],64)}}}),pt=ye(Ue,[["__scopeId","data-v-fb8602ee"]]);export{pt as default};
