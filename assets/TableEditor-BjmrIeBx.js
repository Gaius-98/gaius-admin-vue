import{S as F}from"./SchemaForm-DPaHjFeH.js";import{D as ue}from"./DragTableHeader-BJJbSqVo.js";import{ay as ce,r,aw as pe,R as de,d as K,B as M,D as b,I,g as e,F as n,S as T,G as s,M as h,Z as me,E as U,U as j,N as fe,V as q,aC as _e,au as ve,p as J,aD as be,aE as ge,h as ye,K as he,ax as Se,O as Z,a0 as Ce,a1 as De}from"./index-BKVUJ49Y.js";import{h as we,E as ke}from"./EditTable-DVn_uPmY.js";import{a as P}from"./table-DB9fWxSG.js";import{_ as xe}from"./html2canvas.esm-Z2nexxoG.js";import{C as Ve,T as Ie,_ as Te}from"./ActionButton-CJJ0zyet.js";import{S as Ue}from"./SyncOutlined-CwtkfCSg.js";import{B as Q,_ as Re}from"./index-BHY8-qA4.js";import{I as Oe}from"./index-w_usrKqC.js";import{_ as $e}from"./index-BjNiSnK7.js";import{M as Fe}from"./index-lN2lfoOB.js";import{S as ze}from"./index-BNu7rJFq.js";import{T as Be}from"./index-KTZ4ZaWk.js";import{_ as Ae}from"./index-OY7l33W6.js";import"./index-C6L_XfkU.js";import"./index-BiMXlLES.js";import"./SwapRightOutlined-CvrqlWKA.js";import"./index-C8iWyXjd.js";import"./vue-draggable-next.esm-bundler-209fPSDV.js";import"./DeleteOutlined-DGgL8aQX.js";import"./PlusCircleOutlined-BC5BVVy0.js";import"./ArrowRightOutlined-BBBrtYbM.js";import"./index-CzOiOUBF.js";import"./PlusOutlined-B1JrIy6C.js";import"./index-ByRX77fU.js";import"./FolderOutlined-BRoMlcnB.js";const L=ce("tableDesign",()=>{const g=r([]),p=r({name:"",description:"",status:1,columns:[],global:{bordered:!1,pagination:{show:!1,current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),c=r({}),f=()=>{const o=new Date().getTime().toString().slice(-4);p.value.columns.push({id:pe(),dataIndex:"field"+o,title:"列"+o})},t=(o,a)=>{const i=a.findIndex(m=>m.id===o);i!=-1&&(c.value=a[i])},C=(o,a)=>{const i=a.findIndex(m=>m.id===o);i!=-1&&a.splice(i,1)},y=()=>{const o={};return p.value.variablePool.reduce((a,i)=>(a[i.key]=i.defaultValue,a),o),o},D=async o=>{try{const a=await we.run(p.value.dataSource.interfaceUrl,y());return new Function("res",o||p.value.dataSource.handlerFunc)(a.data)}catch(a){return a}},_=r(!1);return{tableCfg:p,currentColumn:c,onSelectColumn:t,onRemoveColumn:C,onAddColumn:f,tableData:g,onRefreshData:D,saveLoading:_,onSave:async()=>{_.value=!0;const{code:o,msg:a}=await P.add(p.value);o==200&&de.success(a),_.value=!1}}}),Ee={class:"table-design-container"},Ne={class:"tools"},Pe=["href"],Ke=K({__name:"TableDesign",setup(g){const p=L(),{tableCfg:c,tableData:f}=M(p),{onSelectColumn:t,onRemoveColumn:C,onAddColumn:y,onRefreshData:D}=p,_=a=>{t(a.id,c.value.columns)},d=a=>{C(a.id,c.value.columns)},o=()=>{D().then(a=>{f.value=a})};return(a,i)=>{const m=Ve,k=Q,z=Oe,B=$e;return b(),I("div",Ee,[e(m,{class:"filter-panel"}),e(m,{class:"table-container preview-table"},{default:n(()=>[T("div",Ne,[e(k,{type:"primary",onClick:s(y)},{default:n(()=>[h("新增列")]),_:1},8,["onClick"]),e(k,{icon:me(s(Ue)),type:"link",ghost:"",title:"刷新数据",style:{float:"right"},onClick:o},null,8,["icon"])]),e(ue,{modelValue:s(c).columns,"onUpdate:modelValue":i[0]||(i[0]=v=>s(c).columns=v),onOnClick:_,onOnRemove:d},null,8,["modelValue"]),e(B,{showHeader:!1,columns:s(c).columns,"data-source":s(f),scroll:{y:"515px"}},{bodyCell:n(({column:v,record:x})=>[v.type=="image"?(b(),U(z,{key:0,src:`${x[v.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):j("",!0),v.type=="link"?(b(),I("a",{key:1,href:`${x[v.dataIndex]}`,target:"_blank"},fe(x[v.dataIndex]),9,Pe)):j("",!0)]),_:1},8,["columns","data-source"])]),_:1})])}}}),Me=q(Ke,[["__scopeId","data-v-4dfa7f70"]]),Le={key:1},Ge=K({__name:"TableCfg",setup(g){const p=L(),c=r({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"string",label:"字段名"},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左固定"},{value:"right",label:"右固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),f=r("column"),t=r({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"pagination.show":{type:"switch",label:"是否分页"},"pagination.pageSize":{type:"number",label:"每页条数",show:"${formData.pagination.show}"}}}),{tableCfg:C,currentColumn:y}=M(p);return(D,_)=>{const d=_e,o=Te,a=Ie;return b(),U(a,{activeKey:f.value,"onUpdate:activeKey":_[0]||(_[0]=i=>f.value=i)},{default:n(()=>[e(o,{key:"column",tab:"列配置"},{default:n(()=>[s(y).id?(b(),U(s(F),{layout:c.value.layout,properties:c.value.properties,formData:s(y),key:s(y).id},null,8,["layout","properties","formData"])):(b(),I("div",Le,[e(d)]))]),_:1}),e(o,{key:"global",tab:"全局配置"},{default:n(()=>[e(s(F),{layout:t.value.layout,properties:t.value.properties,formData:s(C).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),W=g=>(Ce("data-v-61290c0e"),g=g(),De(),g),He={class:"table-design"},je={class:"left-part"},Je={class:"right-part"},Ze=W(()=>T("span",null,"(res)=>{",-1)),qe=W(()=>T("span",null,"}",-1)),Qe=K({__name:"TableEditor",props:{id:{}},setup(g){const p=g,{id:c}=ve(p),f=L(),{tableCfg:t,tableData:C,saveLoading:y}=M(f),{onRefreshData:D,onSave:_}=f,d=r({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),o=r("");c.value?P.getDetail(c.value).then(w=>{const{code:l,data:S,msg:V}=w;l==200&&(t.value=S,D().then(O=>{C.value=O}))}):(t.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,pagination:{show:!1,current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[]},d.value=t.value.dataSource);const a=J(()=>t.value.name?t.value.name:"新建表格"),i=J(()=>t.value.description?t.value.description:""),m=r(!1),k=r({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),z=()=>{m.value=!0},B=be(),v=()=>{B.go(-1)},x=()=>{_(),m.value=!1,v()},A=r(!1),X=()=>{A.value=!0},R=r(!1),G=r({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:w,data:l,msg:S}=await P.getApiList();return w==200?l.map(V=>({value:V.id,label:V.apiName})):[]}}}}}),Y=()=>{d.value=t.value.dataSource,R.value=!0},ee=()=>{t.value.dataSource=d.value,H()},H=()=>{R.value=!1},E=r(!1),ae=async()=>await D(),te=async()=>{E.value=!0;const w=await ae();E.value=!1,o.value=JSON.stringify(w,null,2)},N=r(!1),oe=r([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),le=()=>{N.value=!0};return(w,l)=>{const S=Q,V=ze,O=Be,ne=xe,$=Fe,se=Re,re=Ae,ie=ge("loading");return b(),I(he,null,[e(ne,{title:a.value,subTitle:i.value,onBack:v,ghost:!1,style:{padding:"10px 24px"}},{extra:n(()=>[e(V,null,{default:n(()=>[e(S,{onClick:Y},{default:n(()=>[h(" 数据源配置 ")]),_:1}),e(S,{onClick:le},{default:n(()=>[h(" 变量池配置 ")]),_:1}),e(S,{onClick:X},{default:n(()=>[h(" 预览 ")]),_:1}),e(S,{onClick:z,type:"primary"},{default:n(()=>[h(" 保存 ")]),_:1})]),_:1})]),tags:n(()=>[s(t).status?(b(),U(O,{key:0,color:"#87d068"},{default:n(()=>[h("启用")]),_:1})):(b(),U(O,{key:1,color:"#f50"},{default:n(()=>[h("停用")]),_:1}))]),_:1},8,["title","subTitle"]),ye((b(),I("div",He,[T("div",je,[e(Me)]),T("div",Je,[e(Ge)])])),[[ie,s(y),void 0,{fullscreen:!0}]]),e($,{open:m.value,"onUpdate:open":l[1]||(l[1]=u=>m.value=u),title:"保存",onOk:x},{default:n(()=>[e(s(F),{formData:s(t),"onUpdate:formData":l[0]||(l[0]=u=>Se(t)?t.value=u:null),layout:k.value.layout,properties:k.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e($,{open:A.value,"onUpdate:open":l[2]||(l[2]=u=>A.value=u),title:"预览"},null,8,["open"]),e($,{open:R.value,"onUpdate:open":l[6]||(l[6]=u=>R.value=u),title:"数据源配置",onOk:ee,onCancel:H},{default:n(()=>[e(s(F),{layout:G.value.layout,properties:G.value.properties,formData:d.value,"onUpdate:formData":l[3]||(l[3]=u=>d.value=u)},null,8,["layout","properties","formData"]),e(se,{label:"数据预处理"},{default:n(()=>[Ze,e(Z,{height:200,modelValue:d.value.handlerFunc,"onUpdate:modelValue":l[4]||(l[4]=u=>d.value.handlerFunc=u)},null,8,["modelValue"]),qe]),_:1}),e(re,null,{default:n(()=>[h("结果区")]),_:1}),e(S,{type:"primary",style:{"margin-bottom":"5px"},onClick:te,loading:E.value},{default:n(()=>[h("运行")]),_:1},8,["loading"]),e(Z,{height:200,disabled:"",modelValue:o.value,"onUpdate:modelValue":l[5]||(l[5]=u=>o.value=u)},null,8,["modelValue"])]),_:1},8,["open"]),e($,{title:"变量池配置",open:N.value,footer:!1,onCancel:l[8]||(l[8]=u=>N.value=!1)},{default:n(()=>[e(ke,{columns:oe.value,modelValue:s(t).variablePool,"onUpdate:modelValue":l[7]||(l[7]=u=>s(t).variablePool=u)},null,8,["columns","modelValue"])]),_:1},8,["open"])],64)}}}),wa=q(Qe,[["__scopeId","data-v-61290c0e"]]);export{wa as default};
