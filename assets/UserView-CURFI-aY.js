import{b as g,c as ie,_ as pe}from"./index-DiwTyEDS.js";import ce from"./ImagePicker-DdyZYAEB.js";import{g as me,m as ve,r,n as q,L as fe,U as ge,o as u,q as w,P as F,l as a,w as t,e as A,ac as ye,ad as ke,V as be,W as Ie,J as d,X as N,i as p,F as T,Y as c,R as he,$ as we,a0 as xe,a1 as Ce,a2 as Ue,a3 as De,a4 as Fe,a5 as Ne,ae as Te,a6 as Se,a7 as $e,af as Ve,T as Oe,aa as Re,a8 as Be,a9 as ze}from"./.pnpm-DZa05fHr.js";import"./resource-CmV_96AJ.js";/* empty css                                                                    */const Le={class:"container"},Pe={class:"search-tree"},je={class:"user"},Ee={class:"tools"},Me=me({__name:"UserView",setup(qe){const _=ve({keyword:"",pageNumber:1,pageSize:10,orgId:null}),S=r([]),J=r([{title:"用户名",key:"username",dataIndex:"username"},{title:"头像",key:"avatar",dataIndex:"avatar"},{title:"昵称",key:"name",dataIndex:"name"},{title:"邮箱",key:"email",dataIndex:"email"},{title:"电话",key:"phone",dataIndex:"phone"},{title:"状态",key:"status",dataIndex:"status"},{title:"操作",key:"action",dataIndex:"action",width:"250px"}]),x=r(!1),$=r(),W=n=>{_.orgId=n[0],O()},X=()=>{var n;(n=$.value)==null||n.resetFields(),v()},V=r(0),O=()=>{_.pageNumber=1,_.pageSize=10,v()},Y=n=>{const{current:e,pageSize:s}=n;_.pageNumber=e,_.pageSize=s,v()},v=()=>{x.value=!0,g.getList(_).then(n=>{const{code:e,data:s}=n;e==200&&(S.value=s.data,V.value=s.total),x.value=!1})},C=r([]),U=r(""),R=()=>{ie.getOrgTree(U.value).then(n=>{const{code:e,data:s,msg:k}=n;e==200&&(C.value=s)})};q(()=>{v(),R()});const y=r(!1),o=r({username:"",name:"",password:"",email:"",avatar:"",roleIds:[],phone:"",status:"1",orgId:0}),f=r("add"),G=fe(()=>({add:"新增用户",edit:"编辑用户"})[f.value]),B=r(),H=()=>{f.value="add",y.value=!0,o.value={username:"",name:"",password:"",email:"",avatar:"",roleIds:[],phone:"",status:"1",orgId:0}},K=async n=>{const{code:e,data:s}=await g.getDetail(n.userId);e==200&&(o.value=s,f.value="edit",y.value=!0)},Q=async n=>{const{code:e,msg:s,data:k}=await g.remove(n.userId);e==200&&(A.success(k),v())},z=()=>{var n;(n=B.value)==null||n.resetFields()},Z=()=>{let n;f.value=="add"?n=g.add:n=g.update,n(o.value).then(e=>{const{code:s}=e;s==200&&(A.success(f.value=="add"?"新增成功":"编辑成功"),v()),z(),y.value=!1})},L=r([]),ee=()=>{g.getRoleDict().then(n=>{const{code:e,data:s,msg:k}=n;e==200&&(L.value=s)})};return q(()=>{ee()}),(n,e)=>{const s=ye,k=ke,b=we,i=xe,P=Ce,I=Ue,ae=De,j=Fe,E=be,h=Ne,te=Te,le=Se,ne=$e,oe=Ve,se=Oe,ue=Re,M=Be,re=ze,de=Ie,D=ge("has-perm");return u(),w("div",Le,[F("div",Pe,[a(s,{value:U.value,"onUpdate:value":e[0]||(e[0]=l=>U.value=l),style:{"margin-bottom":"8px"},placeholder:"请输入机构名称",onSearch:R},null,8,["value"]),a(k,{"tree-data":C.value,selectable:"",fieldNames:{title:"name",key:"id",children:"children"},style:{height:"calc(100% - 30px)"},onSelect:W},null,8,["tree-data"])]),F("div",je,[a(E,{class:"search-area"},{default:t(()=>[a(j,{ref_key:"searchFormRef",ref:$,model:_,onFinish:O},{default:t(()=>[a(ae,{gutter:24},{default:t(()=>[a(P,{span:4},{default:t(()=>[a(i,{label:"用户名",name:"keyword"},{default:t(()=>[a(b,{value:_.keyword,"onUpdate:value":e[1]||(e[1]=l=>_.keyword=l)},null,8,["value"])]),_:1})]),_:1}),a(P,{span:4,style:{"text-align":"right"}},{default:t(()=>[a(I,{type:"primary","html-type":"submit"},{default:t(()=>[d("搜索")]),_:1}),a(I,{style:{margin:"0 8px"},onClick:X},{default:t(()=>[d(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(E,null,{default:t(()=>[F("div",Ee,[N((u(),p(I,{type:"primary",onClick:H},{default:t(()=>[d("新增")]),_:1})),[[D,"system:user:add"]])]),a(ne,{loading:x.value,columns:J.value,"data-source":S.value,scroll:{y:510},onChange:Y,pagination:{current:_.pageNumber,total:V.value}},{bodyCell:t(({column:l,record:m})=>[l.key=="status"?(u(),w(T,{key:0},[m.status=="1"?(u(),p(h,{key:0,color:"#87d068"},{default:t(()=>[d("启用")]),_:1})):(u(),p(h,{key:1,color:"#f50"},{default:t(()=>[d("停用")]),_:1}))],64)):c("",!0),l.key=="avatar"?(u(),p(te,{key:1,src:`${m.avatar}`,height:"30px",width:"30px",preview:!1},null,8,["src"])):c("",!0),l.key=="role"?(u(),p(h,{key:2},{default:t(()=>[d(he(m.role),1)]),_:2},1024)):c("",!0),l.key=="action"?(u(),w(T,{key:3},[N((u(),p(I,{type:"link",onClick:_e=>K(m)},{default:t(()=>[d("编辑")]),_:2},1032,["onClick"])),[[D,"system:user:update"]]),a(le,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:_e=>Q(m)},{default:t(()=>[N((u(),p(I,{type:"link",danger:""},{default:t(()=>[d("删除")]),_:1})),[[D,"system:user:remove"]])]),_:2},1032,["onConfirm"])],64)):c("",!0),l.key=="userType"?(u(),w(T,{key:4},[m.userType=="app"?(u(),p(h,{key:0,color:"#2db7f5"},{default:t(()=>[d("菜单")]),_:1})):c("",!0),m.userType=="directory"?(u(),p(h,{key:1,color:"#87d068"},{default:t(()=>[d("目录")]),_:1})):c("",!0)],64)):c("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),a(de,{open:y.value,"onUpdate:open":e[11]||(e[11]=l=>y.value=l),onOk:Z,title:G.value,onCancel:z},{default:t(()=>[a(j,{model:o.value,"label-col":{span:8},ref_key:"modalFormRef",ref:B},{default:t(()=>[a(i,{label:"用户名"},{default:t(()=>[a(b,{value:o.value.username,"onUpdate:value":e[2]||(e[2]=l=>o.value.username=l)},null,8,["value"])]),_:1}),f.value=="add"?(u(),p(i,{key:0,label:"密码"},{default:t(()=>[a(oe,{value:o.value.password,"onUpdate:value":e[3]||(e[3]=l=>o.value.password=l)},null,8,["value"])]),_:1})):c("",!0),a(i,{label:"角色"},{default:t(()=>[a(se,{value:o.value.roleIds,"onUpdate:value":e[4]||(e[4]=l=>o.value.roleIds=l),fieldNames:{label:"roleName",value:"roleId"},mode:"multiple",options:L.value},null,8,["value","options"])]),_:1}),a(i,{label:"所属机构",name:"orgId"},{default:t(()=>[a(ue,{value:o.value.orgId,"onUpdate:value":e[5]||(e[5]=l=>o.value.orgId=l),"tree-node-filter-prop":"label","show-search":"","allow-clear":"",treeData:C.value,"field-names":{children:"children",label:"name",value:"id"}},null,8,["value","treeData"])]),_:1}),a(i,{label:"头像"},{default:t(()=>[a(ce,{value:o.value.avatar,"onUpdate:value":e[6]||(e[6]=l=>o.value.avatar=l)},null,8,["value"])]),_:1}),a(i,{label:"状态"},{default:t(()=>[a(re,{value:o.value.status,"onUpdate:value":e[7]||(e[7]=l=>o.value.status=l),"button-style":"solid"},{default:t(()=>[a(M,{value:"1"},{default:t(()=>[d("启用 ")]),_:1}),a(M,{value:"0"},{default:t(()=>[d("停用 ")]),_:1})]),_:1},8,["value"])]),_:1}),a(i,{label:"名称"},{default:t(()=>[a(b,{value:o.value.name,"onUpdate:value":e[8]||(e[8]=l=>o.value.name=l)},null,8,["value"])]),_:1}),a(i,{label:"邮箱"},{default:t(()=>[a(b,{value:o.value.email,"onUpdate:value":e[9]||(e[9]=l=>o.value.email=l)},null,8,["value"])]),_:1}),a(i,{label:"电话"},{default:t(()=>[a(b,{value:o.value.phone,"onUpdate:value":e[10]||(e[10]=l=>o.value.phone=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])])}}}),Ge=pe(Me,[["__scopeId","data-v-b2018099"]]);export{Ge as default};
