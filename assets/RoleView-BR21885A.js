import{r as k,c as se,_ as ue}from"./index-B3PcRcrs.js";import{a as re}from"./menu-BWq2WKke.js";import{g as de,m as ce,r,n as L,L as _e,U as ie,o as d,q as w,l as a,w as t,e as z,V as me,W as pe,J as c,P as F,X as M,i as m,F as K,Y as h,$ as ve,a0 as fe,a1 as ye,a2 as ge,a3 as ke,a4 as he,a5 as be,a6 as xe,a7 as we,a8 as Ce,a9 as Ne,an as Fe,T as Me}from"./.pnpm-HZTHv14e.js";const b={getList:_=>k({method:"get",url:"role/list",params:_}),getDetail:_=>k({method:"get",url:"role/detail",params:{id:_}}),remove:_=>k({method:"get",url:"role/remove",params:{id:_}}),add:_=>k({method:"post",url:"role/add",data:_}),update:_=>k({method:"post",url:"role/update",data:_})},Ke={class:"role"},Pe={class:"tools"},De={style:{height:"200px","overflow-y":"auto"}},Ie={style:{height:"200px","overflow-y":"auto"}},Te=de({__name:"RoleView",setup(_){const i=ce({keyword:"",pageNumber:1,pageSize:10}),P=r([]),A=r([{title:"角色名",key:"roleName",dataIndex:"roleName",width:"200px"},{title:"状态",key:"status",dataIndex:"status",width:"100px"},{title:"备注",key:"remark",dataIndex:"remark"},{title:"操作",key:"action",dataIndex:"action",width:"250px"}]),C=r(!1),D=r(),j=()=>{var o;(o=D.value)==null||o.resetFields(),p()},I=r(0),q=()=>{i.pageNumber=1,i.pageSize=10,p()},E=o=>{const{current:e,pageSize:s}=o;i.pageNumber=e,i.pageSize=s,p()},p=()=>{C.value=!0,b.getList(i).then(o=>{const{code:e,data:s}=o;e==200&&(P.value=s.data,I.value=s.total),C.value=!1})},T=r([]);L(()=>{p(),se.getDict(["dataPerm"]).then(o=>{const{code:e,data:s,msg:u}=o;e==200&&(T.value=s.dataPerm)})});const v=r(!1),l=r({roleName:"",roleKey:"",status:1,remark:"",roleMenus:[],dataPerm:"1"}),f=r("add"),J=_e(()=>({add:"新增角色",edit:"编辑角色"})[f.value]),U=r(),W=()=>{f.value="add",v.value=!0,l.value={roleName:"",roleKey:"",status:1,remark:"",roleMenus:[],dataPerm:"1"}},X=async o=>{const{code:e,data:s}=await b.getDetail(o.roleId);e==200&&(l.value=s,f.value="edit",v.value=!0)},Y=async o=>{const{code:e,msg:s,data:u}=await b.remove(o.roleId);e==200&&(z.success(u),p())},V=()=>{var o;(o=U.value)==null||o.resetFields()},G=()=>{let o;f.value=="add"?o=b.add:o=b.update,l.value.roleMenus instanceof Array||(l.value.roleMenus=l.value.roleMenus.checked),o(l.value).then(e=>{const{code:s}=e;s==200&&(z.success(f.value=="add"?"新增成功":"编辑成功"),p()),V(),v.value=!1})},O=r([]),H=()=>{re.getAllMenu().then(o=>{const{code:e,data:s,msg:u}=o;e==200&&(O.value=s)})};return L(()=>{H()}),(o,e)=>{const s=ve,u=fe,R=ye,y=ge,Q=ke,S=he,$=me,x=be,Z=xe,ee=we,B=Ce,te=Ne,ae=Fe,oe=Me,le=pe,N=ie("has-perm");return d(),w("div",Ke,[a($,{class:"search-area"},{default:t(()=>[a(S,{ref_key:"searchFormRef",ref:D,model:i,onFinish:q},{default:t(()=>[a(Q,{gutter:24},{default:t(()=>[a(R,{span:4},{default:t(()=>[a(u,{label:"角色名称",name:"keyword"},{default:t(()=>[a(s,{value:i.keyword,"onUpdate:value":e[0]||(e[0]=n=>i.keyword=n)},null,8,["value"])]),_:1})]),_:1}),a(R,{span:4,style:{"text-align":"right"}},{default:t(()=>[a(y,{type:"primary","html-type":"submit"},{default:t(()=>[c("搜索")]),_:1}),a(y,{style:{margin:"0 8px"},onClick:j},{default:t(()=>[c(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a($,null,{default:t(()=>[F("div",Pe,[M((d(),m(y,{type:"primary",onClick:W},{default:t(()=>[c("新增")]),_:1})),[[N,"system:role:add"]])]),a(ee,{loading:C.value,columns:A.value,"data-source":P.value,scroll:{y:440},onChange:E,pagination:{current:i.pageNumber,total:I.value}},{bodyCell:t(({column:n,record:g})=>[n.key=="status"?(d(),w(K,{key:0},[g.status=="1"?(d(),m(x,{key:0,color:"#87d068"},{default:t(()=>[c("启用")]),_:1})):(d(),m(x,{key:1,color:"#f50"},{default:t(()=>[c("停用")]),_:1}))],64)):h("",!0),n.key=="action"?(d(),w(K,{key:1},[M((d(),m(y,{type:"link",onClick:ne=>X(g)},{default:t(()=>[c("编辑")]),_:2},1032,["onClick"])),[[N,"system:role:update"]]),a(Z,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:ne=>Y(g)},{default:t(()=>[M((d(),m(y,{type:"link",danger:""},{default:t(()=>[c("删除")]),_:1})),[[N,"system:role:remove"]])]),_:2},1032,["onConfirm"])],64)):h("",!0),n.key=="roleType"?(d(),w(K,{key:2},[g.roleType=="app"?(d(),m(x,{key:0,color:"#2db7f5"},{default:t(()=>[c("菜单")]),_:1})):h("",!0),g.roleType=="directory"?(d(),m(x,{key:1,color:"#87d068"},{default:t(()=>[c("目录")]),_:1})):h("",!0)],64)):h("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),a(le,{open:v.value,"onUpdate:open":e[7]||(e[7]=n=>v.value=n),onOk:G,title:J.value,onCancel:V},{default:t(()=>[a(S,{model:l.value,"label-col":{span:8},ref_key:"modalFormRef",ref:U},{default:t(()=>[a(u,{label:"角色名"},{default:t(()=>[a(s,{value:l.value.roleName,"onUpdate:value":e[1]||(e[1]=n=>l.value.roleName=n)},null,8,["value"])]),_:1}),a(u,{label:"角色ID"},{default:t(()=>[a(s,{value:l.value.roleKey,"onUpdate:value":e[2]||(e[2]=n=>l.value.roleKey=n)},null,8,["value"])]),_:1}),a(u,{label:"状态"},{default:t(()=>[a(te,{value:l.value.status,"onUpdate:value":e[3]||(e[3]=n=>l.value.status=n),"button-style":"solid"},{default:t(()=>[a(B,{value:"1"},{default:t(()=>[c("启用 ")]),_:1}),a(B,{value:"0"},{default:t(()=>[c("停用 ")]),_:1})]),_:1},8,["value"])]),_:1}),a(u,{label:"菜单权限"},{default:t(()=>[F("div",De,[a(ae,{checkedKeys:l.value.roleMenus,"onUpdate:checkedKeys":e[4]||(e[4]=n=>l.value.roleMenus=n),"tree-data":O.value,checkStrictly:!0,checkable:"","field-names":{children:"children",title:"label",key:"id"}},null,8,["checkedKeys","tree-data"])])]),_:1}),a(u,{label:"数据权限"},{default:t(()=>[F("div",Ie,[a(oe,{checkedKeys:l.value.dataPerm,"onUpdate:checkedKeys":e[5]||(e[5]=n=>l.value.dataPerm=n),options:T.value},null,8,["checkedKeys","options"])])]),_:1}),a(u,{label:"备注"},{default:t(()=>[a(s,{value:l.value.remark,"onUpdate:value":e[6]||(e[6]=n=>l.value.remark=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),Re=ue(Te,[["__scopeId","data-v-fa42d630"]]);export{Re as default};
