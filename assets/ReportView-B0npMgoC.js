import{r as _,c as I,d as oe,_ as le}from"./index-DHr4AJ_f.js";import{g as ne,m as re,r as d,n as z,L as se,o as b,q as N,l as t,w as o,e as V,ad as ue,ae as de,af as ie,J as y,F as pe,R as F,h as D,ag as me,aE as ce,a1 as ve,ah as _e,Y as fe,K as ge,aj as be,ak as ye,a2 as ke,a7 as Te}from"./.pnpm-DwIV1MCi.js";const f={getList:i=>_({method:"get",url:"business/report/list",params:i}),getDetail:i=>_({method:"get",url:"business/report/detail",params:{id:i}}),remove:i=>_({method:"get",url:"business/report/remove",params:{id:i}}),add:i=>_({method:"post",url:"business/report/add",data:i}),update:i=>_({method:"post",url:"business/report/update",data:i}),export:i=>_({method:"post",url:"business/report/export",data:{id:i},headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"blob"})},he={class:"report"},xe=ne({__name:"ReportView",setup(i){const u=re({keyword:"",pageNumber:1,pageSize:10,startTime:"",endTime:""}),m=d(""),L=()=>{m.value?(u.startTime=m.value[0],u.endTime=m.value[1]):(u.startTime="",u.endTime="")},U=d([]),P=d([{title:"采集设备编号",key:"deviceId",dataIndex:"deviceId",width:"250px"},{title:"PM2.5浓度",key:"pm",dataIndex:"pm"},{title:"甲醛浓度",key:"fa",dataIndex:"fa"},{title:"TOVC",key:"tovc",dataIndex:"tovc"},{title:"温度",key:"temp",dataIndex:"temp"},{title:"湿度",key:"rh",dataIndex:"rh"},{title:"采集时间",key:"createTime",dataIndex:"createTime"},{title:"操作",key:"action",dataIndex:"action",width:"250px"}]),h=d(!1),q=d(),$=()=>{var a;(a=q.value)==null||a.resetFields(),u.startTime="",u.endTime="",m.value="",c()},M=d(0),E=()=>{u.pageNumber=1,u.pageSize=10,c()},j=a=>{const{current:e,pageSize:n}=a;u.pageNumber=e,u.pageSize=n,c()},c=()=>{h.value=!0,f.getList(u).then(a=>{const{code:e,data:n}=a;e==200&&(U.value=n.data,M.value=n.total),h.value=!1})},Y=d([]),H=d({}),A=d([]),J=d([]);z(()=>{c(),I.getOrgTree().then(a=>{const{code:e,data:n,msg:s}=a;e==200&&(A.value=n)}),I.getAllUser().then(a=>{const{code:e,data:n,msg:s}=a;e==200&&(J.value=n)}),I.getDict(["reportBelongType"]).then(a=>{const{code:e,data:n,msg:s}=a;e==200&&(Y.value=n.reportBelongType,H.value=Y.value.reduce((p,g)=>(p[g.value]=g.label,p),{}))})});const k=d(!1),r=d({deviceId:"",fa:"",rh:"",temp:"",createTime:"",tovc:"",pm:""}),T=d("add"),K=se(()=>({add:"新增记录",edit:"编辑记录"})[T.value]),x=d(),G=async a=>{const{code:e,data:n}=await f.getDetail(a.id);e==200&&(r.value=n,T.value="edit",k.value=!0)},Q=async a=>{const{code:e,msg:n,data:s}=await f.remove(a.id);e==200&&(V.success(s),c())},B=()=>{var a;(a=x.value)==null||a.resetFields()},W=()=>{var a;(a=x.value)==null||a.validate().then(()=>{let e;T.value=="add"?e=f.add:e=f.update,e(r.value).then(n=>{const{code:s}=n;s==200&&(V.success(T.value=="add"?"新增成功":"编辑成功"),c()),B(),k.value=!1})})},X=a=>{const{id:e}=a;f.export(e).then(n=>{oe(n,"空气检验报告","doc")})};return z(()=>{}),(a,e)=>{const n=ce,s=ve,p=_e,g=fe,O=ue,R=ge,Z=be,ee=ye,v=ke,te=Te,ae=de,C=ie("has-perm");return b(),N("div",he,[t(O,{class:"search-area"},{default:o(()=>[t(g,{ref_key:"searchFormRef",ref:q,model:u,layout:"inline",onFinish:E},{default:o(()=>[t(s,{label:"记录时间"},{default:o(()=>[t(n,{value:m.value,"onUpdate:value":e[0]||(e[0]=l=>m.value=l),valueFormat:"YYYY-MM-DD",onChange:e[1]||(e[1]=l=>L())},null,8,["value"])]),_:1}),t(s,null,{default:o(()=>[t(p,{type:"primary","html-type":"submit"},{default:o(()=>[y("搜索")]),_:1}),t(p,{style:{margin:"0 8px"},onClick:$},{default:o(()=>[y(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(O,null,{default:o(()=>[t(ee,{loading:h.value,columns:P.value,"data-source":U.value,scroll:{y:560},onChange:j,pagination:{current:u.pageNumber,total:M.value,showSizeChanger:!0,pageSize:u.pageSize}},{bodyCell:o(({column:l,record:w})=>[l.key=="action"?(b(),N(pe,{key:0},[F((b(),D(p,{type:"link",onClick:S=>G(w)},{default:o(()=>[y("编辑")]),_:2},1032,["onClick"])),[[C,"business:report:update"]]),t(R,{type:"vertical"}),F((b(),D(p,{type:"link",onClick:S=>X(w)},{default:o(()=>[y("导出")]),_:2},1032,["onClick"])),[[C,"business:report:export"]]),t(R,{type:"vertical"}),t(Z,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:S=>Q(w)},{default:o(()=>[F((b(),D(p,{type:"link",danger:""},{default:o(()=>[y("删除")]),_:1})),[[C,"business:report:remove"]])]),_:2},1032,["onConfirm"])],64)):me("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),t(ae,{open:k.value,"onUpdate:open":e[9]||(e[9]=l=>k.value=l),onOk:W,title:K.value,onCancel:B},{default:o(()=>[t(g,{model:r.value,"label-col":{span:8},ref_key:"modalFormRef",ref:x},{default:o(()=>[t(s,{label:"采集设备编号",required:"",prop:"deviceId"},{default:o(()=>[t(v,{value:r.value.deviceId,"onUpdate:value":e[2]||(e[2]=l=>r.value.deviceId=l),disabled:""},null,8,["value"])]),_:1}),t(s,{label:"PM2.5浓度",required:"",prop:"pm"},{default:o(()=>[t(v,{value:r.value.pm,"onUpdate:value":e[3]||(e[3]=l=>r.value.pm=l)},null,8,["value"])]),_:1}),t(s,{label:"甲醛浓度",required:"",prop:"fa"},{default:o(()=>[t(v,{value:r.value.fa,"onUpdate:value":e[4]||(e[4]=l=>r.value.fa=l)},null,8,["value"])]),_:1}),t(s,{label:"TOVC",required:"",prop:"tovc"},{default:o(()=>[t(v,{value:r.value.tovc,"onUpdate:value":e[5]||(e[5]=l=>r.value.tovc=l)},null,8,["value"])]),_:1}),t(s,{label:"温度",required:"",prop:"temp"},{default:o(()=>[t(v,{value:r.value.temp,"onUpdate:value":e[6]||(e[6]=l=>r.value.temp=l)},null,8,["value"])]),_:1}),t(s,{label:"湿度",required:"",prop:"rh"},{default:o(()=>[t(v,{value:r.value.rh,"onUpdate:value":e[7]||(e[7]=l=>r.value.rh=l)},null,8,["value"])]),_:1}),t(s,{label:"采集时间",prop:"createTime",required:""},{default:o(()=>[t(te,{value:r.value.createTime,"onUpdate:value":e[8]||(e[8]=l=>r.value.createTime=l),valueFormat:"YYYY-MM-DD HH:mm:ss",showTime:"",disabled:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),Ie=le(xe,[["__scopeId","data-v-2896d8cb"]]);export{Ie as default};
