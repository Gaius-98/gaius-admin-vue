import{r as k,_ as le}from"./index-DkuvX3NQ.js";import{a as ne}from"./menu-D3ACzvvJ.js";import{g as se,aa as ue,m as re,r as c,n as B,L as de,U as ce,o as u,q as w,l as a,w as e,e as $,V as _e,W as ie,J as r,P as z,X as F,i as m,F as M,Y as h,$ as me,a0 as pe,a1 as ve,a2 as fe,a3 as ye,a4 as ge,a6 as ke,a5 as he,a7 as be,a8 as xe,a9 as we,am as Ce}from"./.pnpm-DmAI0IVr.js";const b={getList:d=>k({method:"get",url:"role/list",params:d}),getDetail:d=>k({method:"get",url:"role/detail",params:{id:d}}),remove:d=>k({method:"get",url:"role/remove",params:{id:d}}),add:d=>k({method:"post",url:"role/add",data:d}),update:d=>k({method:"post",url:"role/update",data:d})},Ne={class:"role"},Fe={class:"tools"},Me={style:{height:"200px","overflow-y":"auto"}},Ie=se({__name:"RoleView",setup(d){ue.SHOW_ALL;const _=re({keyword:"",pageNumber:1,pageSize:10}),I=c([]),A=c([{title:"角色名",key:"roleName",dataIndex:"roleName",width:"200px"},{title:"状态",key:"status",dataIndex:"status",width:"100px"},{title:"备注",key:"remark",dataIndex:"remark"},{title:"操作",key:"action",dataIndex:"action",width:"250px"}]),C=c(!1),T=c(),P=()=>{var o;(o=T.value)==null||o.resetFields(),p()},D=c(0),j=()=>{_.pageNumber=1,_.pageSize=10,p()},q=o=>{const{current:t,pageSize:s}=o;_.pageNumber=t,_.pageSize=s,p()},p=()=>{C.value=!0,b.getList(_).then(o=>{const{code:t,data:s}=o;t==200&&(I.value=s.data,D.value=s.total),C.value=!1})};B(()=>{p()});const v=c(!1),l=c({roleName:"",roleKey:"",status:1,remark:"",roleMenus:[]}),f=c("add"),E=de(()=>({add:"新增角色",edit:"编辑角色"})[f.value]),S=c(),W=()=>{f.value="add",v.value=!0,l.value={roleName:"",roleKey:"",status:1,remark:"",roleMenus:[]}},H=async o=>{const{code:t,data:s}=await b.getDetail(o.roleId);t==200&&(l.value=s,f.value="edit",v.value=!0)},J=async o=>{const{code:t,msg:s,data:i}=await b.remove(o.roleId);t==200&&($.success(i),p())},U=()=>{var o;(o=S.value)==null||o.resetFields()},X=()=>{let o;f.value=="add"?o=b.add:o=b.update,l.value.roleMenus instanceof Array||(l.value.roleMenus=l.value.roleMenus.checked),o(l.value).then(t=>{const{code:s}=t;s==200&&($.success(f.value=="add"?"新增成功":"编辑成功"),p()),U(),v.value=!1})},K=c([]),Y=()=>{ne.getAllMenu().then(o=>{const{code:t,data:s,msg:i}=o;t==200&&(K.value=s)})};return B(()=>{Y()}),(o,t)=>{const s=me,i=pe,O=ve,y=fe,G=ye,V=ge,L=_e,x=ke,Q=he,Z=be,R=xe,ee=we,te=Ce,ae=ie,N=ce("has-perm");return u(),w("div",Ne,[a(L,{class:"search-area"},{default:e(()=>[a(V,{ref_key:"searchFormRef",ref:T,model:_,onFinish:j},{default:e(()=>[a(G,{gutter:24},{default:e(()=>[a(O,{span:4},{default:e(()=>[a(i,{label:"角色名称",name:"keyword"},{default:e(()=>[a(s,{value:_.keyword,"onUpdate:value":t[0]||(t[0]=n=>_.keyword=n)},null,8,["value"])]),_:1})]),_:1}),a(O,{span:4,style:{"text-align":"right"}},{default:e(()=>[a(y,{type:"primary","html-type":"submit"},{default:e(()=>[r("搜索")]),_:1}),a(y,{style:{margin:"0 8px"},onClick:P},{default:e(()=>[r(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(L,null,{default:e(()=>[z("div",Fe,[F((u(),m(y,{type:"primary",onClick:W},{default:e(()=>[r("新增")]),_:1})),[[N,"system:role:add"]])]),a(Z,{loading:C.value,columns:A.value,"data-source":I.value,scroll:{y:440},onChange:q,pagination:{current:_.pageNumber,total:D.value}},{bodyCell:e(({column:n,record:g})=>[n.key=="status"?(u(),w(M,{key:0},[g.status?(u(),m(x,{key:0,color:"#87d068"},{default:e(()=>[r("启用")]),_:1})):(u(),m(x,{key:1,color:"#f50"},{default:e(()=>[r("停用")]),_:1}))],64)):h("",!0),n.key=="action"?(u(),w(M,{key:1},[F((u(),m(y,{type:"link",onClick:oe=>H(g)},{default:e(()=>[r("编辑")]),_:2},1032,["onClick"])),[[N,"system:role:update"]]),a(Q,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:oe=>J(g)},{default:e(()=>[F((u(),m(y,{type:"link",danger:""},{default:e(()=>[r("删除")]),_:1})),[[N,"system:role:remove"]])]),_:2},1032,["onConfirm"])],64)):h("",!0),n.key=="roleType"?(u(),w(M,{key:2},[g.roleType=="app"?(u(),m(x,{key:0,color:"#2db7f5"},{default:e(()=>[r("菜单")]),_:1})):h("",!0),g.roleType=="directory"?(u(),m(x,{key:1,color:"#87d068"},{default:e(()=>[r("目录")]),_:1})):h("",!0)],64)):h("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),a(ae,{open:v.value,"onUpdate:open":t[6]||(t[6]=n=>v.value=n),onOk:X,title:E.value,onCancel:U},{default:e(()=>[a(V,{model:l.value,"label-col":{span:8},ref_key:"modalFormRef",ref:S},{default:e(()=>[a(i,{label:"角色名"},{default:e(()=>[a(s,{value:l.value.roleName,"onUpdate:value":t[1]||(t[1]=n=>l.value.roleName=n)},null,8,["value"])]),_:1}),a(i,{label:"角色ID"},{default:e(()=>[a(s,{value:l.value.roleKey,"onUpdate:value":t[2]||(t[2]=n=>l.value.roleKey=n)},null,8,["value"])]),_:1}),a(i,{label:"状态"},{default:e(()=>[a(ee,{value:l.value.status,"onUpdate:value":t[3]||(t[3]=n=>l.value.status=n),"button-style":"solid"},{default:e(()=>[a(R,{value:1},{default:e(()=>[r("启用 ")]),_:1}),a(R,{value:0},{default:e(()=>[r("停用 ")]),_:1})]),_:1},8,["value"])]),_:1}),a(i,{label:"权限"},{default:e(()=>[z("div",Me,[a(te,{checkedKeys:l.value.roleMenus,"onUpdate:checkedKeys":t[4]||(t[4]=n=>l.value.roleMenus=n),"tree-data":K.value,checkStrictly:!0,checkable:"","field-names":{children:"children",title:"label",key:"id"}},null,8,["checkedKeys","tree-data"])])]),_:1}),a(i,{label:"备注"},{default:e(()=>[a(s,{value:l.value.remark,"onUpdate:value":t[5]||(t[5]=n=>l.value.remark=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),Ue=le(Ie,[["__scopeId","data-v-2f9ddb97"]]);export{Ue as default};
