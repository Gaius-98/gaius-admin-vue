import{r as i,d as B,N as le,V as T,W as z,c as t,u as o,X as A,aa as Se,a5 as n,_ as De,af as ue,S as ie,U as xe,q as G,a4 as N,ab as ke,F as ae,L as I,h as Ie,Z as Te,w as $e,A as W,H as oe,B as Fe,M as Re}from"./@vue-BvA2MXdg.js";import{S as M}from"./SchemaForm-CVtfoq04.js";import{d as Ue,s as J}from"./pinia-DlKznUG5.js";import{h as Ae}from"./http-DU6ZIpjU.js";import{t as V}from"./table-Bivb9vDb.js";import{v as ce}from"./uuid-CQkTLCs1.js";import{a as ne,j as Ve,f as Ne,M as de,B as me,h as Oe,i as Pe,t as pe,P as Le,v as fe,w as ve,K as qe,L as ze,N as Me,T as Be,_ as Ee}from"./ant-design-vue-CYBwGk2d.js";import{_ as Ke}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BPCSMz-9.js";import"./ag-grid-community-pc37hWba.js";import{A as je}from"./ag-grid-vue3-CeGLuGwf.js";import{d as He}from"./gaius-utils-DO2PX8Qd.js";import{s as Ge,N as We,a0 as Je}from"./@ant-design-DjS9GqSD.js";import{_ as se}from"./index-BXhzo4w4.js";import{u as Xe}from"./vue-router-iEIkon04.js";import{_ as Ze}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-DFzCptQN.js";import{E as Qe}from"./EditTable-CxzEuh14.js";import"./lodash-es-PU94eZQX.js";import"./axios-BimPEqV4.js";import"./@babel-BiFW4_mA.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-B73STPP_.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-C5fUfLeo.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-OW4gUFyn.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-C6m58ZEB.js";import"./common-DM2tda8e.js";import"./form-EHJJ0luJ.js";/* empty css                      */import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-CbJ3uXWy.js";import"./echarts-DetEu2Tg.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CDo53BfZ.js";import"./vue-codemirror-BENg5eLO.js";import"./codemirror-DbSqjR0q.js";import"./@codemirror-Bw0AUzsQ.js";import"./@lezer-Cp1Os4ub.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";const X=Ue("tableDesign",()=>{const $=i([]),_=i({name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:[],filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),a=i([]),f=i({}),r=()=>{const u=new Date().getTime().toString().slice(-4);_.value.columns.push({id:ce(),dataIndex:"field"+u,title:"列"+u,width:200})},b=(u,e)=>{const l=e.findIndex(m=>m.id===u);l!=-1&&(f.value=e[l])},D=(u,e)=>{const l=e.findIndex(m=>m.id===u);l!=-1&&e.splice(l,1)},x=()=>{const u={};return _.value.variablePool.reduce((e,l)=>(e[l.key]=l.defaultValue,e),u),u},w=async u=>{try{const e=await Ae.run(_.value.dataSource.interfaceUrl,x());return new Function("res",u||_.value.dataSource.handlerFunc)(e.data)}catch(e){return e}},h=i(!1);return{tableCfg:_,currentColumn:f,onSelectColumn:b,onRemoveColumn:D,onAddColumn:r,tableData:$,onRefreshData:w,saveLoading:h,onSave:async()=>{h.value=!0;const{code:u,msg:e}=await V.add(_.value);u==200&&ne.success(e),h.value=!1},columnFields:a}}),_e=new He,Ye={class:"custom-header-label",style:{flex:"1"}},et=B({__name:"CustomTableHeader",props:{params:{}},emits:["onRemove"],setup($,{emit:_}){const a=X(),{currentColumn:f}=J(a),r=$,{params:b}=le(r),D=()=>{_e.onPublish("removeEvent",b.value)};return(x,w)=>{const h=Ve;return T(),z("div",{class:De(["custom-header-item",o(f).dataIndex==o(b).column.getColId()?"active":""]),style:ue([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:o(f).dataIndex==o(b).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[t(o(Ge),{class:"move",style:{width:"20px",cursor:"move"}}),A("div",Ye,Se(o(b).displayName),1),t(h,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:w[0]||(w[0]=g=>D())},{default:n(()=>[t(o(We),{class:"remove",style:{width:"20px"}})]),_:1})],6)}}}),tt=B({__name:"AgTable",props:ie({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:ie(["onRemove","onClick"],["update:columns"]),setup($,{emit:_}){_e.onSubscribe("removeEvent",e=>{let l=e.column.getColId(),m=a.value.find(y=>y.dataIndex==l);m&&g(m)});const a=xe($,"columns"),f=$,{columnId:r,tableData:b}=le(f),D=G(()=>a.value.map(e=>({field:e.dataIndex,colId:e.dataIndex,headerName:e.title,pinned:e.fixed,lockVisible:!0,headerComponent:et}))),x=e=>{if(!e.finished)return;let l=e.api.getColumnState().map(m=>a.value.find(y=>y.dataIndex==m.colId));a.value=l},w=e=>{if(!e.finished)return;let l=e.column.getColId(),m=a.value.findIndex(y=>y.dataIndex==l);m!=-1&&(a.value[m].width=e.column.getActualWidth())},h=_,g=e=>{h("onRemove",e)},u=e=>{let l=e.column.getId(),m=a.value.find(y=>y.dataIndex==l);h("onClick",m)};return(e,l)=>(T(),N(o(je),{rowData:o(b),columnDefs:D.value,style:ue({height:e.height+"px"}),class:"ag-theme-quartz",onColumnMoved:x,onColumnResized:w,onColumnHeaderClicked:u},null,8,["rowData","columnDefs","style"]))}}),at=se(tt,[["__scopeId","data-v-04d5d6ae"]]),ot={class:"table-design-container"},lt={class:"tools",style:{"margin-bottom":"5px"}},nt={class:"action-container"},st=B({__name:"TableDesign",setup($){const _=X(),{tableCfg:a,tableData:f,columnFields:r}=J(_),{onSelectColumn:b,onRemoveColumn:D,onAddColumn:x,onRefreshData:w}=_,h=c=>{b(c.id,a.value.columns)},g=c=>{D(c.id,a.value.columns)},u=i(0),e=()=>{w().then(c=>{const{data:s,total:v}=c;if(s){f.value=s;try{r.value=Object.keys(s[0]).map(p=>({value:p,label:p}))}catch{ne.warning("接口数据解析失败")}}v&&(u.value=v)})},l=G(()=>{var c,s;return((c=a.value.global.filterCfg)==null?void 0:c.show)&&((s=a.value.global.filterCfg)==null?void 0:s.formId)}),m=i({}),y=i(!1),E=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{id:{type:"string",label:"按钮标识",component:{disabled:!0}},name:{type:"string",label:"按钮名称"},position:{type:"radio",label:"按钮位置",component:{dataSource:[{value:"row",label:"行内"},{value:"header",label:"表头"}],buttonStyle:"solid"}},request:{type:"switch",label:"请求接口",tooltip:"是否在点击按钮后请求接口获取数据"},interfaceUrl:{show:"${formData.request}",type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:c,data:s,msg:v}=await V.getApiList();return c==200?s.map(p=>({value:p.id,label:p.apiName})):[]}}},AfterHandleFunc:{show:"${formData.request}",type:"string",label:"处理函数",tooltip:"处理接口返回的数据,数据用于表单渲染或地址拼接",component:{name:"code-editor",height:100,prepend:"(res)=>{",append:"}"}},event:{type:"radio",label:"触发事件",component:{dataSource:[{value:"modal",label:"弹窗"},{value:"link",label:"链接"}],buttonStyle:"solid"}},linkUrl:{show:"'${formData.event}' == 'link'",type:"string",label:"链接地址",tooltip:"可以通过${name}的方式拼接变量,name为变量名称"},formId:{show:"'${formData.event}' == 'modal'",type:"select",label:"表单",component:{asyncData:async()=>await new Promise(c=>{setTimeout(()=>{c(P.value)},100)})}},"actionCfg.interfaceUrl":{show:"'${formData.event}' == 'modal'",type:"select",label:"接口地址",tooltip:"一般用于提交数据,新增后保存当前的表单数据",component:{asyncData:async()=>{const{code:c,data:s,msg:v}=await V.getApiList();return c==200?s.map(p=>({value:p.id,label:p.apiName})):[]}}}}}),F=i(""),O=()=>{F.value=ce(),a.value.global.actionCfg.push({name:"按钮",id:F.value,actionCfg:{interfaceUrl:""}})},K=c=>{let s=0;a.value.global.actionCfg.forEach((v,p)=>{v.id===c&&(s=p-1)}),a.value.global.actionCfg=a.value.global.actionCfg.filter(v=>v.id!==c),a.value.global.actionCfg.length&&F.value===c&&(s>=0?F.value=a.value.global.actionCfg[s].id:F.value=a.value.global.actionCfg[0].id)},Z=(c,s)=>{s==="add"?O():K(c)},P=i([]);return V.getFormList().then(c=>{const{code:s,data:v,msg:p}=c;s==200&&(P.value=v.map(U=>({value:U.id,label:U.name})))}),(c,s)=>{const v=me,p=Oe,U=Pe,j=Ne,Q=pe,H=Le,L=fe,Y=ve,ee=de;return T(),z(ae,null,[A("div",ot,[l.value?(T(),N(j,{key:0,class:"filter-panel"},{default:n(()=>[t(Ke,{formData:m.value,id:o(a).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),t(U,null,{default:n(()=>[t(p,{span:24,style:{"text-align":"right"}},{default:n(()=>[t(v,{type:"primary","html-type":"submit"},{default:n(()=>[I("搜索")]),_:1}),t(v,{style:{margin:"0 8px"}},{default:n(()=>[I("重置")]),_:1})]),_:1})]),_:1})]),_:1})):ke("",!0),t(j,{class:"table-container"},{default:n(()=>[A("div",lt,[t(Q,null,{default:n(()=>[t(v,{type:"primary",onClick:o(x)},{default:n(()=>[I("新增列")]),_:1},8,["onClick"]),t(v,{type:"primary",onClick:s[0]||(s[0]=S=>y.value=!0)},{default:n(()=>[I("交互配置")]),_:1})]),_:1}),t(v,{icon:Ie(o(Je)),type:"link",title:"刷新数据",style:{float:"right"},onClick:e},null,8,["icon"])]),t(at,{columns:o(a).columns,"onUpdate:columns":s[1]||(s[1]=S=>o(a).columns=S),"table-data":o(f),height:l.value?400:600,onOnRemove:g,onOnClick:h},null,8,["columns","table-data","height"]),t(H,{total:u.value,"show-less-items":"",style:{"margin-top":"10px",float:"right"}},null,8,["total"])]),_:1})]),t(ee,{open:y.value,"onUpdate:open":s[3]||(s[3]=S=>y.value=S),footer:null,title:"交互配置"},{default:n(()=>[t(Y,{activeKey:F.value,"onUpdate:activeKey":s[2]||(s[2]=S=>F.value=S),type:"editable-card",onEdit:Z},{default:n(()=>[(T(!0),z(ae,null,Te(o(a).global.actionCfg,S=>(T(),N(L,{key:S.id,tab:S.name},{default:n(()=>[A("div",nt,[t(o(M),{layout:E.value.layout,properties:E.value.properties,formData:S},null,8,["layout","properties","formData"])])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])]),_:1},8,["open"])],64)}}}),rt=se(st,[["__scopeId","data-v-c8aa18ac"]]),it=B({__name:"TableCfg",setup($){const _=X(),{tableCfg:a,currentColumn:f,columnFields:r}=J(_),b=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(g=>{setTimeout(()=>{g(r.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:!1,label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),D=i();$e(()=>r,()=>{D.value&&D.value.refreshOption("dataIndex")},{deep:!0,immediate:!0});const x=i("column"),w=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(g=>{setTimeout(()=>{g(h.value)},100)})}}}}),h=i([]);return V.getFormList().then(g=>{const{code:u,data:e,msg:l}=g;u==200&&(h.value=e.map(m=>({value:m.id,label:m.name})))}),(g,u)=>{const e=qe,l=fe,m=ve;return T(),N(m,{activeKey:x.value,"onUpdate:activeKey":u[0]||(u[0]=y=>x.value=y)},{default:n(()=>[t(l,{key:"column",tab:"列配置"},{default:n(()=>[W((T(),N(o(M),{layout:b.value.layout,properties:b.value.properties,formData:o(f),key:o(f).id,ref_key:"columnForm",ref:D},null,8,["layout","properties","formData"])),[[oe,o(f).id]]),W(A("div",null,[t(e)],512),[[oe,!o(f).id]])]),_:1}),t(l,{key:"global",tab:"全局配置"},{default:n(()=>[t(o(M),{layout:w.value.layout,properties:w.value.properties,formData:o(a).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),ut={class:"table-design"},ct={class:"left-part"},dt={class:"right-part"},mt=B({__name:"TableEditor",props:{id:{}},setup($){const _=$,{id:a}=le(_),f=X(),{tableCfg:r,tableData:b,saveLoading:D,columnFields:x}=J(f),{onRefreshData:w,onSave:h}=f,g=i(!1),u=i(0),e=[{title:"数据配置",description:"在开始配置列表前，请先配置数据源",target:()=>document.querySelector(".data-source-btn")},{title:"变量配置",description:"配置数据源后,为保证数据源的正常获取数据,还需要配置对应的参数",target:()=>document.querySelector(".variable-btn")},{title:"表格布局区",description:"现在可以通过新增列,来增加表格的列,支持拖拽表头改变列的位置及列宽",target:()=>document.querySelector(".left-part")},{title:"配置区",description:"可以对表格整体或者表格单独的列进行配置,满足您的需求",target:()=>document.querySelector(".right-part")},{title:"最后",description:"保存您刚刚的配置",target:()=>document.querySelector(".save-btn")}],l=i({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),m=i(""),y=()=>{w().then(R=>{const{data:d}=R;if(d){b.value=d;try{x.value=Object.keys(d[0]).map(k=>({value:k,label:k}))}catch{ne.warning("接口数据解析失败")}}})};a.value?V.getDetail(a.value).then(R=>{const{code:d,data:k,msg:q}=R;d==200&&(r.value=k,y())}):(r.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:[],filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"},{key:"pageSize",defaultValue:"10"}]},l.value=r.value.dataSource,b.value=[],x.value=[],g.value=!0);const E=G(()=>r.value.name?r.value.name:"新建表格"),F=G(()=>r.value.description?r.value.description:""),O=i(!1),K=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),Z=()=>{O.value=!0},P=Xe(),c=()=>{P.go(-1)},s=()=>{h(),O.value=!1,c()},v=()=>{P.push({path:"/low-code/preview-table",query:{id:r.value.id}})},p=i(!1),U=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:5}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:R,data:d,msg:k}=await V.getApiList();return R==200?d.map(q=>({value:q.id,label:q.apiName})):[]}}},handlerFunc:{type:"string",label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}",component:{name:"code-editor",height:200,prepend:"(res)=>{",append:"}"}}}}),j=()=>{l.value=r.value.dataSource,p.value=!0},Q=()=>{r.value.dataSource=l.value,y(),H()},H=()=>{p.value=!1},L=i(!1),Y=async()=>await w(),ee=async()=>{L.value=!0;const R=await Y();L.value=!1,m.value=JSON.stringify(R,null,2)},S=i(!1),be=i([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),ge=()=>{S.value=!0};return(R,d)=>{const k=me,q=pe,re=Be,ye=ze,te=de,he=Ee,Ce=Me,we=Fe("loading");return T(),z(ae,null,[t(ye,{title:E.value,subTitle:F.value,onBack:c,ghost:!1,style:{padding:"10px 24px"}},{extra:n(()=>[t(q,null,{default:n(()=>[t(k,{onClick:j,class:"data-source-btn"},{default:n(()=>[I(" 数据源配置 ")]),_:1}),t(k,{onClick:ge,class:"variable-btn"},{default:n(()=>[I(" 变量池配置 ")]),_:1}),W(t(k,{onClick:v},{default:n(()=>[I(" 预览 ")]),_:1},512),[[oe,o(r).id]]),t(k,{onClick:Z,type:"primary",class:"save-btn"},{default:n(()=>[I(" 保存 ")]),_:1})]),_:1})]),tags:n(()=>[o(r).status?(T(),N(re,{key:0,color:"#87d068"},{default:n(()=>[I("启用")]),_:1})):(T(),N(re,{key:1,color:"#f50"},{default:n(()=>[I("停用")]),_:1}))]),_:1},8,["title","subTitle"]),W((T(),z("div",ut,[A("div",ct,[t(rt)]),A("div",dt,[t(it)])])),[[we,o(D),void 0,{fullscreen:!0}]]),t(te,{open:O.value,"onUpdate:open":d[1]||(d[1]=C=>O.value=C),title:"保存",onOk:s},{default:n(()=>[t(o(M),{formData:o(r),"onUpdate:formData":d[0]||(d[0]=C=>Re(r)?r.value=C:null),layout:K.value.layout,properties:K.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),t(te,{open:p.value,"onUpdate:open":d[4]||(d[4]=C=>p.value=C),title:"数据源配置",onOk:Q,onCancel:H},{default:n(()=>[t(o(M),{layout:U.value.layout,properties:U.value.properties,formData:l.value,"onUpdate:formData":d[2]||(d[2]=C=>l.value=C)},null,8,["layout","properties","formData"]),t(he,null,{default:n(()=>[I("结果区")]),_:1}),t(k,{type:"primary",style:{"margin-bottom":"5px"},onClick:ee,loading:L.value},{default:n(()=>[I("运行")]),_:1},8,["loading"]),t(Ze,{height:200,disabled:"",value:m.value,"onUpdate:value":d[3]||(d[3]=C=>m.value=C)},null,8,["value"])]),_:1},8,["open"]),t(te,{title:"变量池配置",open:S.value,footer:!1,onCancel:d[6]||(d[6]=C=>S.value=!1)},{default:n(()=>[t(Qe,{columns:be.value,modelValue:o(r).variablePool,"onUpdate:modelValue":d[5]||(d[5]=C=>o(r).variablePool=C)},null,8,["columns","modelValue"])]),_:1},8,["open"]),t(Ce,{current:u.value,"onUpdate:current":d[7]||(d[7]=C=>u.value=C),open:g.value,steps:e,onClose:d[8]||(d[8]=C=>g.value=!1)},null,8,["current","open"])],64)}}}),na=se(mt,[["__scopeId","data-v-0fa3ecde"]]);export{na as default};
