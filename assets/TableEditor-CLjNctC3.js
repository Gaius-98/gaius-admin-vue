import{ao as he,r as o,am as ue,a0 as le,d as ne,I as re,t as te,J as S,L as K,a2 as O,U as R,M as t,a3 as ee,g as e,R as ae,a1 as ce,Q as i,O as C,aa as Ce,X as Se,a9 as we,Z as pe,ah as De,a6 as de,w as ke,h as G,v as oe,at as xe,ak as Fe,au as Ie,av as Te,an as Ue,Y as $e}from"./index-CmoA2GoM.js";import{S as z}from"./SchemaForm-CNyDtwkd.js";import{D as Re}from"./DragTableHeader-CJf3vmSm.js";import{h as Ve}from"./http-3ejIjt6G.js";import{t as V}from"./table-CCxx-qIx.js";import{_ as Ae}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-rHrAS001.js";import{C as Oe,_ as Le,a as Pe,b as me,T as fe}from"./index-BYYPv9R6.js";import{S as qe}from"./SyncOutlined-CCr3qcmk.js";import{S as ve}from"./index-D8YaMPtN.js";import{_ as Ne}from"./index-woSD_LuY.js";import{E as Be}from"./EditTable-BwM7LlWx.js";import{T as Ee}from"./index-C77IJ5XB.js";import{_ as Ke}from"./index-DfUF_WvU.js";import{_ as ze}from"./index-BHhOkwZY.js";import{_ as Me}from"./index-BaP_Y1ip.js";import"./index-BX-Z-4ni.js";import"./SwapRightOutlined-BHEHd6Zu.js";import"./index-DjDljBPH.js";import"./index-BNogs11-.js";import"./index-C_nXjZ5F.js";import"./shallowequal-CXRC2vtV.js";import"./index-BLePi1r2.js";import"./eagerComputed-BQoZFmQi.js";import"./index-C6rf5fLW.js";import"./index-nyZGTlKN.js";import"./vue-draggable-next.esm-bundler-BEE3Wefn.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-qOIAhxHQ.js";import"./common-Brfrth6Y.js";import"./form-MGfbEYZd.js";import"./index-BwFnDrPT.js";import"./EllipsisOutlined-DtdE-UCA.js";import"./Dropdown-Fepi5Sce.js";import"./index-ne0OhhUv.js";import"./FolderOutlined-DEA9pzxq.js";import"./useBreakpoint-C5eZpta0.js";import"./index-B9RKzsGX.js";import"./dropdown-DEmaYe-4.js";import"./PlusCircleOutlined-Cw28LGff.js";import"./ArrowRightOutlined-CN_cmre0.js";import"./index-hEGmwokD.js";import"./index-DOeiordB.js";const se=he("tableDesign",()=>{const L=o([]),b=o({name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:[],filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),u=o([]),y=o({}),r=()=>{const s=new Date().getTime().toString().slice(-4);b.value.columns.push({id:ue(),dataIndex:"field"+s,title:"列"+s})},k=(s,c)=>{const p=c.findIndex(v=>v.id===s);p!=-1&&(y.value=c[p])},w=(s,c)=>{const p=c.findIndex(v=>v.id===s);p!=-1&&c.splice(p,1)},x=()=>{const s={};return b.value.variablePool.reduce((c,p)=>(c[p.key]=p.defaultValue,c),s),s},F=async s=>{try{const c=await Ve.run(b.value.dataSource.interfaceUrl,x());return new Function("res",s||b.value.dataSource.handlerFunc)(c.data)}catch(c){return c}},D=o(!1);return{tableCfg:b,currentColumn:y,onSelectColumn:k,onRemoveColumn:w,onAddColumn:r,tableData:L,onRefreshData:F,saveLoading:D,onSave:async()=>{D.value=!0;const{code:s,msg:c}=await V.add(b.value);s==200&&le.success(c),D.value=!1},columnFields:u}}),je={class:"table-design-container"},He={class:"tools",style:{"margin-bottom":"5px"}},Je=["href"],Ge={class:"action-container"},Qe=ne({__name:"TableDesign",setup(L){const b=se(),{tableCfg:u,tableData:y,columnFields:r}=re(b),{onSelectColumn:k,onRemoveColumn:w,onAddColumn:x,onRefreshData:F}=b,D=l=>{k(l.id,u.value.columns)},g=l=>{w(l.id,u.value.columns)},s=o(0),c=()=>{F().then(l=>{const{data:a,total:f}=l;if(a){y.value=a;try{r.value=Object.keys(a[0]).map(m=>({value:m,label:m}))}catch{le.warning("接口数据解析失败")}}f&&(s.value=f)})},p=te(()=>{var l,a;return((l=u.value.global.filterCfg)==null?void 0:l.show)&&((a=u.value.global.filterCfg)==null?void 0:a.formId)}),v=o({}),T=o(!1),M=o({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{id:{type:"string",label:"按钮标识",component:{disabled:!0}},name:{type:"string",label:"按钮名称"},position:{type:"radio",label:"按钮位置",component:{dataSource:[{value:"row",label:"行内"},{value:"header",label:"表头"}],buttonStyle:"solid"}},request:{type:"switch",label:"请求接口",tooltip:"是否在点击按钮后请求接口获取数据"},interfaceUrl:{show:"${formData.request}",type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:l,data:a,msg:f}=await V.getApiList();return l==200?a.map(m=>({value:m.id,label:m.apiName})):[]}}},AfterHandleFunc:{show:"${formData.request}",type:"string",label:"处理函数",tooltip:"处理接口返回的数据,数据用于表单渲染或地址拼接",component:{name:"code-editor",height:100,prepend:"(res)=>{",append:"}"}},event:{type:"radio",label:"触发事件",component:{dataSource:[{value:"modal",label:"弹窗"},{value:"link",label:"链接"}],buttonStyle:"solid"}},linkUrl:{show:"'${formData.event}' == 'link'",type:"string",label:"链接地址",tooltip:"可以通过${name}的方式拼接变量,name为变量名称"},formId:{show:"'${formData.event}' == 'modal'",type:"select",label:"表单",component:{asyncData:async()=>await new Promise(l=>{setTimeout(()=>{l(P.value)},100)})}},"actionCfg.interfaceUrl":{show:"'${formData.event}' == 'modal'",type:"select",label:"接口地址",tooltip:"一般用于提交数据,新增后保存当前的表单数据",component:{asyncData:async()=>{const{code:l,data:a,msg:f}=await V.getApiList();return l==200?a.map(m=>({value:m.id,label:m.apiName})):[]}}}}}),I=o(""),A=()=>{I.value=ue(),u.value.global.actionCfg.push({name:"按钮",id:I.value,actionCfg:{interfaceUrl:""}})},j=l=>{let a=0;u.value.global.actionCfg.forEach((f,m)=>{f.id===l&&(a=m-1)}),u.value.global.actionCfg=u.value.global.actionCfg.filter(f=>f.id!==l),u.value.global.actionCfg.length&&I.value===l&&(a>=0?I.value=u.value.global.actionCfg[a].id:I.value=u.value.global.actionCfg[0].id)},Q=(l,a)=>{a==="add"?A():j(l)},P=o([]);return V.getFormList().then(l=>{const{code:a,data:f,msg:m}=l;a==200&&(P.value=f.map($=>({value:$.id,label:$.name})))}),(l,a)=>{const f=pe,m=Le,$=Pe,H=Oe,X=ve,J=De,q=Ne,Y=me,Z=fe,N=ce;return S(),K(ae,null,[O("div",je,[p.value?(S(),R(H,{key:0,class:"filter-panel"},{default:t(()=>[e(Ae,{formData:v.value,id:i(u).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),e($,null,{default:t(()=>[e(m,{span:24,style:{"text-align":"right"}},{default:t(()=>[e(f,{type:"primary","html-type":"submit"},{default:t(()=>[C("搜索")]),_:1}),e(f,{style:{margin:"0 8px"}},{default:t(()=>[C("重置")]),_:1})]),_:1})]),_:1})]),_:1})):ee("",!0),e(H,{class:"table-container"},{default:t(()=>[O("div",He,[e(X,null,{default:t(()=>[e(f,{type:"primary",onClick:i(x)},{default:t(()=>[C("新增列")]),_:1},8,["onClick"]),e(f,{type:"primary",onClick:a[0]||(a[0]=d=>T.value=!0)},{default:t(()=>[C("交互配置")]),_:1})]),_:1}),e(f,{icon:Ce(i(qe)),type:"link",title:"刷新数据",style:{float:"right"},onClick:c},null,8,["icon"])]),e(Re,{modelValue:i(u).columns,"onUpdate:modelValue":a[1]||(a[1]=d=>i(u).columns=d),onOnClick:D,onOnRemove:g},null,8,["modelValue"]),e(q,{showHeader:!1,columns:i(u).columns,"data-source":i(y),scroll:{y:p.value?300:500},pagination:{total:s.value}},{bodyCell:t(({column:d,record:B})=>[d&&d.type=="image"?(S(),R(J,{key:0,src:`${B[d.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):ee("",!0),d&&d.type=="link"?(S(),K("a",{key:1,href:`${B[d.dataIndex]}`,target:"_blank"},Se(B[d.dataIndex]),9,Je)):ee("",!0)]),_:1},8,["columns","data-source","scroll","pagination"])]),_:1})]),e(N,{open:T.value,"onUpdate:open":a[3]||(a[3]=d=>T.value=d),footer:null,title:"交互配置"},{default:t(()=>[e(Z,{activeKey:I.value,"onUpdate:activeKey":a[2]||(a[2]=d=>I.value=d),type:"editable-card",onEdit:Q},{default:t(()=>[(S(!0),K(ae,null,we(i(u).global.actionCfg,d=>(S(),R(Y,{key:d.id,tab:d.name},{default:t(()=>[O("div",Ge,[e(i(z),{layout:M.value.layout,properties:M.value.properties,formData:d},null,8,["layout","properties","formData"])])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])]),_:1},8,["open"])],64)}}}),Xe=de(Qe,[["__scopeId","data-v-00902517"]]),Ye=ne({__name:"TableCfg",setup(L){const b=se(),{tableCfg:u,currentColumn:y,columnFields:r}=re(b),k=o({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(g=>{setTimeout(()=>{g(r.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:!1,label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),w=o();ke(()=>r,()=>{w.value&&(console.log("columnForm",w.value),w.value.refreshOption("dataIndex"))},{deep:!0,immediate:!0});const x=o("column"),F=o({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(g=>{setTimeout(()=>{g(D.value)},100)})}}}}),D=o([]);return V.getFormList().then(g=>{const{code:s,data:c,msg:p}=g;s==200&&(D.value=c.map(v=>({value:v.id,label:v.name})))}),(g,s)=>{const c=xe,p=me,v=fe;return S(),R(v,{activeKey:x.value,"onUpdate:activeKey":s[0]||(s[0]=T=>x.value=T)},{default:t(()=>[e(p,{key:"column",tab:"列配置"},{default:t(()=>[G((S(),R(i(z),{layout:k.value.layout,properties:k.value.properties,formData:i(y),key:i(y).id,ref_key:"columnForm",ref:w},null,8,["layout","properties","formData"])),[[oe,i(y).id]]),G(O("div",null,[e(c)],512),[[oe,!i(y).id]])]),_:1}),e(p,{key:"global",tab:"全局配置"},{default:t(()=>[e(i(z),{layout:F.value.layout,properties:F.value.properties,formData:i(u).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),Ze={class:"table-design"},We={class:"left-part"},et={class:"right-part"},tt=ne({__name:"TableEditor",props:{id:{}},setup(L){const b=L,{id:u}=Fe(b),y=se(),{tableCfg:r,tableData:k,saveLoading:w,columnFields:x}=re(y),{onRefreshData:F,onSave:D}=y,g=o(!1),s=o(0),c=[{title:"数据配置",description:"在开始配置列表前，请先配置数据源",target:()=>document.querySelector(".data-source-btn")},{title:"变量配置",description:"配置数据源后,为保证数据源的正常获取数据,还需要配置对应的参数",target:()=>document.querySelector(".variable-btn")},{title:"表格布局区",description:"现在可以通过新增列,来增加表格的列,支持拖拽表头改变列的位置及列宽",target:()=>document.querySelector(".left-part")},{title:"配置区",description:"可以对表格整体或者表格单独的列进行配置,满足您的需求",target:()=>document.querySelector(".right-part")},{title:"最后",description:"保存您刚刚的配置",target:()=>document.querySelector(".save-btn")}],p=o({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),v=o(""),T=()=>{F().then(U=>{const{data:n}=U;if(n){k.value=n;try{x.value=Object.keys(n[0]).map(h=>({value:h,label:h}))}catch{le.warning("接口数据解析失败")}}})};u.value?V.getDetail(u.value).then(U=>{const{code:n,data:h,msg:E}=U;n==200&&(r.value=h,T())}):(r.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:[],filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"},{key:"pageSize",defaultValue:"10"}]},p.value=r.value.dataSource,k.value=[],x.value=[],g.value=!0);const M=te(()=>r.value.name?r.value.name:"新建表格"),I=te(()=>r.value.description?r.value.description:""),A=o(!1),j=o({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),Q=()=>{A.value=!0},P=Ie(),l=()=>{P.go(-1)},a=()=>{D(),A.value=!1,l()},f=()=>{P.push({path:"/low-code/preview-table",query:{id:r.value.id}})},m=o(!1),$=o({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:5}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:U,data:n,msg:h}=await V.getApiList();return U==200?n.map(E=>({value:E.id,label:E.apiName})):[]}}},handlerFunc:{type:"string",label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}",component:{name:"code-editor",height:200,prepend:"(res)=>{",append:"}"}}}}),H=()=>{p.value=r.value.dataSource,m.value=!0},X=()=>{r.value.dataSource=p.value,T(),J()},J=()=>{m.value=!1},q=o(!1),Y=async()=>await F(),Z=async()=>{q.value=!0;const U=await Y();q.value=!1,v.value=JSON.stringify(U,null,2)},N=o(!1),d=o([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),B=()=>{N.value=!0};return(U,n)=>{const h=pe,E=ve,ie=Ee,_e=Ke,W=ce,be=Me,ye=ze,ge=Te("loading");return S(),K(ae,null,[e(_e,{title:M.value,subTitle:I.value,onBack:l,ghost:!1,style:{padding:"10px 24px"}},{extra:t(()=>[e(E,null,{default:t(()=>[e(h,{onClick:H,class:"data-source-btn"},{default:t(()=>[C(" 数据源配置 ")]),_:1}),e(h,{onClick:B,class:"variable-btn"},{default:t(()=>[C(" 变量池配置 ")]),_:1}),G(e(h,{onClick:f},{default:t(()=>[C(" 预览 ")]),_:1},512),[[oe,i(r).id]]),e(h,{onClick:Q,type:"primary",class:"save-btn"},{default:t(()=>[C(" 保存 ")]),_:1})]),_:1})]),tags:t(()=>[i(r).status?(S(),R(ie,{key:0,color:"#87d068"},{default:t(()=>[C("启用")]),_:1})):(S(),R(ie,{key:1,color:"#f50"},{default:t(()=>[C("停用")]),_:1}))]),_:1},8,["title","subTitle"]),G((S(),K("div",Ze,[O("div",We,[e(Xe)]),O("div",et,[e(Ye)])])),[[ge,i(w),void 0,{fullscreen:!0}]]),e(W,{open:A.value,"onUpdate:open":n[1]||(n[1]=_=>A.value=_),title:"保存",onOk:a},{default:t(()=>[e(i(z),{formData:i(r),"onUpdate:formData":n[0]||(n[0]=_=>Ue(r)?r.value=_:null),layout:j.value.layout,properties:j.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e(W,{open:m.value,"onUpdate:open":n[4]||(n[4]=_=>m.value=_),title:"数据源配置",onOk:X,onCancel:J},{default:t(()=>[e(i(z),{layout:$.value.layout,properties:$.value.properties,formData:p.value,"onUpdate:formData":n[2]||(n[2]=_=>p.value=_)},null,8,["layout","properties","formData"]),e(be,null,{default:t(()=>[C("结果区")]),_:1}),e(h,{type:"primary",style:{"margin-bottom":"5px"},onClick:Z,loading:q.value},{default:t(()=>[C("运行")]),_:1},8,["loading"]),e($e,{height:200,disabled:"",value:v.value,"onUpdate:value":n[3]||(n[3]=_=>v.value=_)},null,8,["value"])]),_:1},8,["open"]),e(W,{title:"变量池配置",open:N.value,footer:!1,onCancel:n[6]||(n[6]=_=>N.value=!1)},{default:t(()=>[e(Be,{columns:d.value,modelValue:i(r).variablePool,"onUpdate:modelValue":n[5]||(n[5]=_=>i(r).variablePool=_)},null,8,["columns","modelValue"])]),_:1},8,["open"]),e(ye,{current:s.value,"onUpdate:current":n[7]||(n[7]=_=>s.value=_),open:g.value,steps:c,onClose:n[8]||(n[8]=_=>g.value=!1)},null,8,["current","open"])],64)}}}),zt=de(tt,[["__scopeId","data-v-0fa3ecde"]]);export{zt as default};
