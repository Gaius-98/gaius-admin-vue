import{aD as ue,r as i,aB as ce,a0 as pe,d as q,I as G,t as j,J as y,L as $,U as T,M as a,a3 as H,g as e,Q as n,O as b,a2 as F,aa as de,X as me,Z as W,ah as fe,a6 as ee,aI as _e,an as ve,aJ as be,aK as ye,h as Y,R as ge,a1 as he,v as Ce,aC as Se,Y as Z,a4 as De,ay as we,az as ke}from"./index-UcyKtJhV.js";import{S as L}from"./SchemaForm-BbJh0pB4.js";import{D as xe}from"./DragTableHeader-CpEPsgOV.js";import{h as Ie}from"./http-CAyEoOqt.js";import{t as N}from"./table-D2JHSEw3.js";import{_ as Ve}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-Bvignf4K.js";import{C as Te,_ as Re,a as Ue,T as $e,b as Fe}from"./index-DdDnDLv5.js";import{S as Oe}from"./SyncOutlined-CpnOG5DD.js";import{_ as Ae}from"./index-DgwEnZmz.js";import{E as Be}from"./EditTable-IWoGWXbA.js";import{S as Pe}from"./index-yYhy1Fyr.js";import{T as ze}from"./index-B0m6czRM.js";import{_ as Le}from"./index-CDzzHJ6e.js";import{_ as Ne}from"./index-BgjFvMef.js";import"./index-C5CmMc0o.js";import"./SwapRightOutlined-p3F-dMOo.js";import"./index-CCkp0GpB.js";import"./index-RpgdHoyq.js";import"./index-PrskqlXj.js";import"./index-C5ptzyk1.js";import"./index-DjrWP9VL.js";import"./vue-draggable-next.esm-bundler-d-_O9m5F.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-CHjIR6nU.js";import"./common-CEXgJWth.js";import"./form-xuNZB4c7.js";import"./index-D8lGRPz2.js";import"./EllipsisOutlined-DCXt9jPE.js";import"./index-Blk_YMO7.js";import"./FolderOutlined-BCA1edsU.js";import"./useBreakpoint-D4tBTyuq.js";import"./index-BR60m0r6.js";import"./PlusCircleOutlined-B02fmz7C.js";import"./ArrowRightOutlined-Cy0OEx5V.js";import"./index-6kjyojbI.js";import"./index-ChbQcKRP.js";const Q=ue("tableDesign",()=>{const D=i([]),d=i({name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),u=i({}),g=()=>{const o=new Date().getTime().toString().slice(-4);d.value.columns.push({id:ce(),dataIndex:"field"+o,title:"列"+o})},t=(o,l)=>{const r=l.findIndex(m=>m.id===o);r!=-1&&(u.value=l[r])},w=(o,l)=>{const r=l.findIndex(m=>m.id===o);r!=-1&&l.splice(r,1)},x=()=>{const o={};return d.value.variablePool.reduce((l,r)=>(l[r.key]=r.defaultValue,l),o),o},h=async o=>{try{const l=await Ie.run(d.value.dataSource.interfaceUrl,x());return new Function("res",o||d.value.dataSource.handlerFunc)(l.data)}catch(l){return l}},_=i(!1);return{tableCfg:d,currentColumn:u,onSelectColumn:t,onRemoveColumn:w,onAddColumn:g,tableData:D,onRefreshData:h,saveLoading:_,onSave:async()=>{_.value=!0;const{code:o,msg:l}=await N.add(d.value);o==200&&pe.success(l),_.value=!1}}}),Ke={class:"table-design-container"},Ee={class:"tools",style:{"margin-bottom":"5px"}},Me=["href"],Je=q({__name:"TableDesign",setup(D){const d=Q(),{tableCfg:u,tableData:g}=G(d),{onSelectColumn:t,onRemoveColumn:w,onAddColumn:x,onRefreshData:h}=d,_=f=>{t(f.id,u.value.columns)},c=f=>{w(f.id,u.value.columns)},o=i(0),l=()=>{h().then(f=>{const{data:C,total:S}=f;C&&(g.value=C),S&&(o.value=S)})},r=j(()=>{var f,C;return((f=u.value.global.filterCfg)==null?void 0:f.show)&&((C=u.value.global.filterCfg)==null?void 0:C.formId)}),m=i({});return(f,C)=>{const S=W,O=Re,K=Ue,A=Te,I=fe,B=Ae;return y(),$("div",Ke,[r.value?(y(),T(A,{key:0,class:"filter-panel"},{default:a(()=>[e(Ve,{formData:m.value,id:n(u).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),e(K,null,{default:a(()=>[e(O,{span:24,style:{"text-align":"right"}},{default:a(()=>[e(S,{type:"primary","html-type":"submit"},{default:a(()=>[b("搜索")]),_:1}),e(S,{style:{margin:"0 8px"}},{default:a(()=>[b("重置")]),_:1})]),_:1})]),_:1})]),_:1})):H("",!0),e(A,{class:"table-container"},{default:a(()=>[F("div",Ee,[e(S,{type:"primary",onClick:n(x)},{default:a(()=>[b("新增列")]),_:1},8,["onClick"]),e(S,{icon:de(n(Oe)),type:"link",title:"刷新数据",style:{float:"right"},onClick:l},null,8,["icon"])]),e(xe,{modelValue:n(u).columns,"onUpdate:modelValue":C[0]||(C[0]=v=>n(u).columns=v),onOnClick:_,onOnRemove:c},null,8,["modelValue"]),e(B,{showHeader:!1,columns:n(u).columns,"data-source":n(g),scroll:{y:r.value?300:500},pagination:{total:o.value}},{bodyCell:a(({column:v,record:R})=>[v&&v.type=="image"?(y(),T(I,{key:0,src:`${R[v.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):H("",!0),v&&v.type=="link"?(y(),$("a",{key:1,href:`${R[v.dataIndex]}`,target:"_blank"},me(R[v.dataIndex]),9,Me)):H("",!0)]),_:1},8,["columns","data-source","scroll","pagination"])]),_:1})])}}}),He=ee(Je,[["__scopeId","data-v-e747d4c1"]]),je={key:1},qe=q({__name:"TableCfg",setup(D){const d=Q(),u=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"string",label:"字段名"},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:!1,label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),g=i("column"),t=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"pagination.pageSize":{type:"number",label:"每页条数"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(c=>{setTimeout(()=>{c(w.value)},100)})}}}}),w=i([]);N.getFormList().then(_=>{const{code:c,data:o,msg:l}=_;c==200&&(w.value=o.map(r=>({value:r.id,label:r.name})))});const{tableCfg:x,currentColumn:h}=G(d);return(_,c)=>{const o=_e,l=Fe,r=$e;return y(),T(r,{activeKey:g.value,"onUpdate:activeKey":c[0]||(c[0]=m=>g.value=m)},{default:a(()=>[e(l,{key:"column",tab:"列配置"},{default:a(()=>[n(h).id?(y(),T(n(L),{layout:u.value.layout,properties:u.value.properties,formData:n(h),key:n(h).id},null,8,["layout","properties","formData"])):(y(),$("div",je,[e(o)]))]),_:1}),e(l,{key:"global",tab:"全局配置"},{default:a(()=>[e(n(L),{layout:t.value.layout,properties:t.value.properties,formData:n(x).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),ae=D=>(we("data-v-d9219f6e"),D=D(),ke(),D),Ge={class:"table-design"},Qe={class:"left-part"},Xe={class:"right-part"},Ye=ae(()=>F("span",null,"(res)=>{",-1)),Ze=ae(()=>F("span",null,"}",-1)),We=q({__name:"TableEditor",props:{id:{}},setup(D){const d=D,{id:u}=ve(d),g=Q(),{tableCfg:t,tableData:w,saveLoading:x}=G(g),{onRefreshData:h,onSave:_}=g,c=i({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),o=i("");u.value?N.getDetail(u.value).then(V=>{const{code:s,data:k,msg:U}=V;s==200&&(t.value=k,h().then(P=>{const{data:z}=P;z&&(w.value=z)}))}):(t.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:{add:{show:!1,formId:""},edit:{show:!1,formId:""},view:{show:!1,formId:""}},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"},{key:"pageSize",defaultValue:"10"}]},c.value=t.value.dataSource,w.value=[]);const l=j(()=>t.value.name?t.value.name:"新建表格"),r=j(()=>t.value.description?t.value.description:""),m=i(!1),f=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),C=()=>{m.value=!0},S=be(),O=()=>{S.go(-1)},K=()=>{_(),m.value=!1,O()},A=()=>{S.push({path:"/low-code/preview-table",query:{id:t.value.id}})},I=i(!1),B=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:V,data:s,msg:k}=await N.getApiList();return V==200?s.map(U=>({value:U.id,label:U.apiName})):[]}}}}}),v=()=>{c.value=t.value.dataSource,I.value=!0},R=()=>{t.value.dataSource=c.value,X()},X=()=>{I.value=!1},E=i(!1),te=async()=>await h(),oe=async()=>{E.value=!0;const V=await te();E.value=!1,o.value=JSON.stringify(V,null,2)},M=i(!1),le=i([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),ne=()=>{M.value=!0};return(V,s)=>{const k=W,U=Pe,P=ze,z=Le,J=he,se=De,re=Ne,ie=ye("loading");return y(),$(ge,null,[e(z,{title:l.value,subTitle:r.value,onBack:O,ghost:!1,style:{padding:"10px 24px"}},{extra:a(()=>[e(U,null,{default:a(()=>[e(k,{onClick:v},{default:a(()=>[b(" 数据源配置 ")]),_:1}),e(k,{onClick:ne},{default:a(()=>[b(" 变量池配置 ")]),_:1}),Y(e(k,{onClick:A},{default:a(()=>[b(" 预览 ")]),_:1},512),[[Ce,n(t).id]]),e(k,{onClick:C,type:"primary"},{default:a(()=>[b(" 保存 ")]),_:1})]),_:1})]),tags:a(()=>[n(t).status?(y(),T(P,{key:0,color:"#87d068"},{default:a(()=>[b("启用")]),_:1})):(y(),T(P,{key:1,color:"#f50"},{default:a(()=>[b("停用")]),_:1}))]),_:1},8,["title","subTitle"]),Y((y(),$("div",Ge,[F("div",Qe,[e(He)]),F("div",Xe,[e(qe)])])),[[ie,n(x),void 0,{fullscreen:!0}]]),e(J,{open:m.value,"onUpdate:open":s[1]||(s[1]=p=>m.value=p),title:"保存",onOk:K},{default:a(()=>[e(n(L),{formData:n(t),"onUpdate:formData":s[0]||(s[0]=p=>Se(t)?t.value=p:null),layout:f.value.layout,properties:f.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e(J,{open:I.value,"onUpdate:open":s[5]||(s[5]=p=>I.value=p),title:"数据源配置",onOk:R,onCancel:X},{default:a(()=>[e(n(L),{layout:B.value.layout,properties:B.value.properties,formData:c.value,"onUpdate:formData":s[2]||(s[2]=p=>c.value=p)},null,8,["layout","properties","formData"]),e(se,{label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}"},{default:a(()=>[Ye,e(Z,{height:200,modelValue:c.value.handlerFunc,"onUpdate:modelValue":s[3]||(s[3]=p=>c.value.handlerFunc=p)},null,8,["modelValue"]),Ze]),_:1}),e(re,null,{default:a(()=>[b("结果区")]),_:1}),e(k,{type:"primary",style:{"margin-bottom":"5px"},onClick:oe,loading:E.value},{default:a(()=>[b("运行")]),_:1},8,["loading"]),e(Z,{height:200,disabled:"",modelValue:o.value,"onUpdate:modelValue":s[4]||(s[4]=p=>o.value=p)},null,8,["modelValue"])]),_:1},8,["open"]),e(J,{title:"变量池配置",open:M.value,footer:!1,onCancel:s[7]||(s[7]=p=>M.value=!1)},{default:a(()=>[e(Be,{columns:le.value,modelValue:n(t).variablePool,"onUpdate:modelValue":s[6]||(s[6]=p=>n(t).variablePool=p)},null,8,["columns","modelValue"])]),_:1},8,["open"])],64)}}}),Aa=ee(We,[["__scopeId","data-v-d9219f6e"]]);export{Aa as default};
