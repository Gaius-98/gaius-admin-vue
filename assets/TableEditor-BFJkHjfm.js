import{r as u,d as V,N as re,V as C,W as A,c as e,u as o,X as O,aa as ie,a5 as r,_ as De,af as fe,q,a4 as U,Z as ve,F as Y,L as k,S as me,U as ke,ab as Ie,h as $e,w as Te,A as ee,H as se,B as Re,M as Ae}from"./@vue-BvA2MXdg.js";import{S as H}from"./SchemaForm-DQbILHvz.js";import{d as Fe,s as K}from"./pinia-DlKznUG5.js";import{h as Oe}from"./http-CQxA5yto.js";import{t as P}from"./table-BR-8UBHL.js";import{v as _e}from"./uuid-CQkTLCs1.js";import{a as ue,j as Ue,t as ce,Q as Pe,f as Ve,M as be,B as ge,h as Ne,i as Le,P as qe,w as Be,K as ze,v as Me,L as Ee,N as je,T as He,_ as Ke}from"./ant-design-vue-BSZA2eEx.js";import{_ as Ge}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BeMZwvw0.js";import"./ag-grid-community-pc37hWba.js";import{A as Qe}from"./ag-grid-vue3-CeGLuGwf.js";import{d as We}from"./gaius-utils-DO2PX8Qd.js";import{s as Je,N as Xe,P as de,a0 as Ze,a1 as Ye}from"./@ant-design-yYwXvx57.js";import{_ as te}from"./index-CgqLVpwJ.js";import{c as ne}from"./lodash-es-PU94eZQX.js";import{u as et}from"./vue-router-iEIkon04.js";import{_ as tt}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-DFzCptQN.js";import{E as at}from"./EditTable-CNwn4bTN.js";import"./axios-BimPEqV4.js";import"./@babel-BiFW4_mA.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-B73STPP_.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-C5fUfLeo.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-OW4gUFyn.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-MMs2D_ke.js";import"./common-BikFPhou.js";import"./form-BkS5If9Q.js";/* empty css                      */import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-CbJ3uXWy.js";import"./echarts-DetEu2Tg.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CDo53BfZ.js";import"./vue-codemirror-BENg5eLO.js";import"./codemirror-DbSqjR0q.js";import"./@codemirror-Bw0AUzsQ.js";import"./@lezer-Cp1Os4ub.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";const B=Fe("tableDesign",()=>{const I=u([]),_=u({name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:[],filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),s=u([]),f=u({}),n=()=>{const c=new Date().getTime().toString().slice(-4);_.value.columns.push({id:_e(),dataIndex:"field"+c,title:"列"+c,width:200})},m=(c,t)=>{const a=t.findIndex(p=>p.id===c);a!=-1&&(f.value=t[a])},v=(c,t)=>{const a=t.findIndex(p=>p.id===c);a!=-1&&t.splice(a,1)},D=()=>{const c={};return _.value.variablePool.reduce((t,a)=>(t[a.key]=a.defaultValue,t),c),c},g=async c=>{try{const t=await Oe.run(_.value.dataSource.interfaceUrl,D());return new Function("res",c||_.value.dataSource.handlerFunc)(t.data)}catch(t){return t}},w=u(!1);return{tableCfg:_,currentColumn:f,onSelectColumn:m,onRemoveColumn:v,onAddColumn:n,tableData:I,onRefreshData:g,saveLoading:w,onSave:async()=>{w.value=!0;const{code:c,msg:t}=await P.add(_.value);c==200&&ue.success(t),w.value=!1},columnFields:s}}),ae=new We,ot={class:"custom-header-label",style:{flex:"1"}},lt=V({__name:"CustomTableHeader",props:{params:{}},emits:["onRemove"],setup(I,{emit:_}){const s=B(),{currentColumn:f}=K(s),n=I,{params:m}=re(n),v=()=>{ae.onPublish("removeEvent",m.value)};return(D,g)=>{const w=Ue;return C(),A("div",{class:De(["custom-header-item",o(f).dataIndex==o(m).column.getColId()?"active":""]),style:fe([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:o(f).dataIndex==o(m).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[e(o(Je),{class:"move",style:{width:"20px",cursor:"move"}}),O("div",ot,ie(o(m).displayName),1),e(w,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:g[0]||(g[0]=S=>v())},{default:r(()=>[e(o(Xe),{class:"remove",style:{width:"20px"}})]),_:1})],6)}}}),nt=["onClick"],st=V({__name:"CustomOptCell",setup(I){const _=B(),{tableCfg:s}=K(_),f=q(()=>{var m;return(m=s.value.global.actionCfg)==null?void 0:m.filter(v=>v.position=="row")}),n=(m,v)=>{ae.onPublish("action",{position:m,data:v})};return(m,v)=>{const D=ce;return C(),U(D,null,{default:r(()=>[(C(!0),A(Y,null,ve(f.value,g=>(C(),A("div",{class:"btn",key:g.id,onClick:w=>n("row",g)},[O("a",null,ie(g.name),1)],8,nt))),128)),e(o(de),{style:{cursor:"pointer"},onClick:v[0]||(v[0]=g=>n("row"))})]),_:1})}}}),rt=te(st,[["__scopeId","data-v-6489421a"]]),it={class:"custom-header-label",style:{flex:"1"}},ut=V({__name:"CustomAddColumnHeader",setup(I){const _=B(),{onAddColumn:s}=_;return(f,n)=>{const m=Pe;return C(),A("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:n[0]||(n[0]=v=>o(s)())},[O("div",it,[e(o(de)),k(" 新增列 "),e(m,null,{title:r(()=>[k("用于新增列配置")]),default:r(()=>[e(o(Ze))]),_:1})])])}}}),ct=V({__name:"AgTable",props:me({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:me(["onRemove","onClick"],["update:columns"]),setup(I,{emit:_}){ae.onSubscribe("removeEvent",t=>{let a=t.column.getColId(),p=s.value.find(y=>y.dataIndex==a);p&&S(p)});const s=ke(I,"columns"),f=I,{columnId:n,tableData:m}=re(f),v=q(()=>{let t=s.value.map(a=>({field:a.dataIndex,colId:a.dataIndex,headerName:a.title,pinned:a.fixed,lockVisible:!0,headerComponent:lt}));return t.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:ut}),t.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:rt}),t}),D=t=>{if(!t.finished)return;let a=t.api.getColumnState().map(p=>s.value.find(y=>y.dataIndex==p.colId));s.value=a},g=t=>{if(!t.finished)return;let a=t.column.getColId(),p=s.value.findIndex(y=>y.dataIndex==a);p!=-1&&(s.value[p].width=t.column.getActualWidth())},w=_,S=t=>{w("onRemove",t)},c=t=>{let a=t.column.getId(),p=s.value.find(y=>y.dataIndex==a);w("onClick",p)};return(t,a)=>(C(),U(o(Qe),{rowData:o(m),columnDefs:v.value,style:fe({height:t.height+"px"}),class:"ag-theme-quartz",onColumnMoved:D,onColumnResized:g,onColumnHeaderClicked:c},null,8,["rowData","columnDefs","style"]))}}),dt=te(ct,[["__scopeId","data-v-60204abb"]]),pt={class:"table-design-container"},mt={class:"tools",style:{"margin-bottom":"5px"}},ft=["onClick"],vt=V({__name:"TableDesign",setup(I){const _=B(),{tableCfg:s,tableData:f,columnFields:n}=K(_),{onSelectColumn:m,onRemoveColumn:v,onAddColumn:D,onRefreshData:g}=_,w=i=>{m(i.id,s.value.columns)},S=i=>{v(i.id,s.value.columns)},c=u(0),t=()=>{g().then(i=>{const{data:l,total:b}=i;if(l){f.value=l;try{n.value=Object.keys(l[0]).map(h=>({value:h,label:h}))}catch{ue.warning("接口数据解析失败")}}b&&(c.value=b)})},a=q(()=>{var i,l;return((i=s.value.global.filterCfg)==null?void 0:i.show)&&((l=s.value.global.filterCfg)==null?void 0:l.formId)}),p=u({}),y=u(!1),G=u({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{id:{type:"string",label:"按钮标识",component:{disabled:!0}},name:{type:"string",label:"按钮名称"},position:{type:"radio",label:"按钮位置",component:{dataSource:[{value:"row",label:"行内"},{value:"header",label:"表头"}],buttonStyle:"solid"}},request:{type:"switch",label:"请求接口",tooltip:"是否在点击按钮后请求接口获取数据"},interfaceUrl:{show:"${formData.request}",type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:i,data:l,msg:b}=await P.getApiList();return i==200?l.map(h=>({value:h.id,label:h.apiName})):[]}}},AfterHandleFunc:{show:"${formData.request}",type:"string",label:"处理函数",tooltip:"处理接口返回的数据,数据用于表单渲染或地址拼接",component:{name:"code-editor",height:100,prepend:"(res)=>{",append:"}"}},event:{type:"radio",label:"触发事件",component:{dataSource:[{value:"modal",label:"弹窗"},{value:"link",label:"链接"}],buttonStyle:"solid"}},linkUrl:{show:"'${formData.event}' == 'link'",type:"string",label:"链接地址",tooltip:"可以通过${name}的方式拼接变量,name为变量名称"},formId:{show:"'${formData.event}' == 'modal'",type:"select",label:"表单",component:{asyncData:async()=>await new Promise(i=>{setTimeout(()=>{i(Q.value)},100)})}},"actionCfg.interfaceUrl":{show:"'${formData.event}' == 'modal'",type:"select",label:"接口地址",tooltip:"一般用于提交数据,新增后保存当前的表单数据",component:{asyncData:async()=>{const{code:i,data:l,msg:b}=await P.getApiList();return i==200?l.map(h=>({value:h.id,label:h.apiName})):[]}}}}});u("");const Q=u([]);P.getFormList().then(i=>{const{code:l,data:b,msg:h}=i;l==200&&(Q.value=b.map(L=>({value:L.id,label:L.name})))});const N=q(()=>{var i;return(i=s.value.global.actionCfg)==null?void 0:i.filter(l=>l.position=="header")}),R=u({}),z=(i,l)=>{R.value=ne({id:_e(),position:i,...l}),y.value=!0};ae.onSubscribe("action",({position:i,data:l})=>{z(i,l)});const W=()=>{var b;const{id:i}=R.value,l=s.value.global.actionCfg.findIndex(h=>h.id==i);l!=-1?s.value.global.actionCfg[l]=ne(R.value):(b=s.value.global.actionCfg)==null||b.push(ne(R.value)),M()},M=()=>{y.value=!1,R.value={}};return(i,l)=>{const b=ge,h=Ne,L=Le,J=Ve,X=ce,E=qe,oe=be;return C(),A(Y,null,[O("div",pt,[a.value?(C(),U(J,{key:0,class:"filter-panel"},{default:r(()=>[e(Ge,{formData:p.value,id:o(s).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),e(L,null,{default:r(()=>[e(h,{span:24,style:{"text-align":"right"}},{default:r(()=>[e(b,{type:"primary","html-type":"submit"},{default:r(()=>[k("搜索")]),_:1}),e(b,{style:{margin:"0 8px"}},{default:r(()=>[k("重置")]),_:1})]),_:1})]),_:1})]),_:1})):Ie("",!0),e(J,{class:"table-container"},{default:r(()=>[O("div",mt,[e(X,null,{default:r(()=>[(C(!0),A(Y,null,ve(N.value,$=>(C(),A("div",{class:"btn",key:$.id,onClick:Z=>z("header",$)},[e(b,null,{default:r(()=>[k(ie($.name),1)]),_:2},1024)],8,ft))),128)),e(b,{onClick:l[0]||(l[0]=$=>z("header")),class:"add-btn"},{default:r(()=>[e(o(de))]),_:1})]),_:1}),e(b,{icon:$e(o(Ye)),type:"link",title:"刷新数据",style:{float:"right"},onClick:t},null,8,["icon"])]),e(dt,{columns:o(s).columns,"onUpdate:columns":l[1]||(l[1]=$=>o(s).columns=$),"table-data":o(f),height:a.value?400:600,onOnRemove:S,onOnClick:w},null,8,["columns","table-data","height"]),e(E,{total:c.value,"show-less-items":"",style:{"margin-top":"10px",float:"right"}},null,8,["total"])]),_:1})]),e(oe,{open:y.value,"onUpdate:open":l[2]||(l[2]=$=>y.value=$),onOk:l[3]||(l[3]=$=>W()),onClose:l[4]||(l[4]=$=>M()),title:"交互配置"},{default:r(()=>[(C(),U(o(H),{layout:G.value.layout,properties:G.value.properties,formData:R.value,key:R.value.id},null,8,["layout","properties","formData"]))]),_:1},8,["open"])],64)}}}),_t=te(vt,[["__scopeId","data-v-cefb563d"]]),bt=V({__name:"TableCfg",setup(I){const _=B(),{tableCfg:s,currentColumn:f,columnFields:n}=K(_),m=u({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(S=>{setTimeout(()=>{S(n.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:!1,label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),v=u();Te(()=>n,()=>{v.value&&v.value.refreshOption("dataIndex")},{deep:!0,immediate:!0});const D=u("column"),g=u({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(S=>{setTimeout(()=>{S(w.value)},100)})}}}}),w=u([]);return P.getFormList().then(S=>{const{code:c,data:t,msg:a}=S;c==200&&(w.value=t.map(p=>({value:p.id,label:p.name})))}),(S,c)=>{const t=ze,a=Me,p=Be;return C(),U(p,{activeKey:D.value,"onUpdate:activeKey":c[0]||(c[0]=y=>D.value=y)},{default:r(()=>[e(a,{key:"column",tab:"列配置"},{default:r(()=>[ee((C(),U(o(H),{layout:m.value.layout,properties:m.value.properties,formData:o(f),key:o(f).id,ref_key:"columnForm",ref:v},null,8,["layout","properties","formData"])),[[se,o(f).id]]),ee(O("div",null,[e(t)],512),[[se,!o(f).id]])]),_:1}),e(a,{key:"global",tab:"全局配置"},{default:r(()=>[e(o(H),{layout:g.value.layout,properties:g.value.properties,formData:o(s).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),gt={class:"table-design"},yt={class:"left-part"},ht={class:"right-part"},Ct=V({__name:"TableEditor",props:{id:{}},setup(I){const _=I,{id:s}=re(_),f=B(),{tableCfg:n,tableData:m,saveLoading:v,columnFields:D}=K(f),{onRefreshData:g,onSave:w}=f,S=u(!1),c=u(0),t=[{title:"数据配置",description:"在开始配置列表前，请先配置数据源",target:()=>document.querySelector(".data-source-btn")},{title:"变量配置",description:"配置数据源后,为保证数据源的正常获取数据,还需要配置对应的参数",target:()=>document.querySelector(".variable-btn")},{title:"表格布局区",description:"在此区域可以编辑、预览您配置的表格整体样式",target:()=>document.querySelector(".left-part")},{title:"列配置",description:"此处可以为表格增加列,列之间可以进行拖拽排序",target:()=>document.querySelector(".add-column")},{title:"配置区",description:"可以对表格整体或者表格单独的列进行配置,满足您的需求",target:()=>document.querySelector(".right-part")},{title:"按钮配置",description:"如果是一个可以交互的表格,点击此处增加表格的交互功能",target:()=>document.querySelector(".add-btn")},{title:"最后",description:"保存您刚刚的配置",target:()=>document.querySelector(".save-btn")}],a=u({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),p=u(""),y=()=>{g().then(F=>{const{data:d}=F;if(d){m.value=d;try{D.value=Object.keys(d[0]).map(T=>({value:T,label:T}))}catch{ue.warning("接口数据解析失败")}}})};s.value?P.getDetail(s.value).then(F=>{const{code:d,data:T,msg:j}=F;d==200&&(n.value=T,y())}):(n.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:[],filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"},{key:"pageSize",defaultValue:"10"}]},a.value=n.value.dataSource,m.value=[],D.value=[],S.value=!0);const G=q(()=>n.value.name?n.value.name:"新建表格"),Q=q(()=>n.value.description?n.value.description:""),N=u(!1),R=u({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),z=()=>{N.value=!0},W=et(),M=()=>{W.go(-1)},i=()=>{w(),N.value=!1,M()},l=()=>{W.push({path:"/low-code/preview-table",query:{id:n.value.id}})},b=u(!1),h=u({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:5}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:F,data:d,msg:T}=await P.getApiList();return F==200?d.map(j=>({value:j.id,label:j.apiName})):[]}}},handlerFunc:{type:"string",label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}",component:{name:"code-editor",height:200,prepend:"(res)=>{",append:"}"}}}}),L=()=>{a.value=n.value.dataSource,b.value=!0},J=()=>{n.value.dataSource=a.value,y(),X()},X=()=>{b.value=!1},E=u(!1),oe=async()=>await g(),$=async()=>{E.value=!0;const F=await oe();E.value=!1,p.value=JSON.stringify(F,null,2)},Z=u(!1),ye=u([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),he=()=>{Z.value=!0};return(F,d)=>{const T=ge,j=ce,pe=He,Ce=Ee,le=be,we=Ke,Se=je,xe=Re("loading");return C(),A(Y,null,[e(Ce,{title:G.value,subTitle:Q.value,onBack:M,ghost:!1,style:{padding:"10px 24px"}},{extra:r(()=>[e(j,null,{default:r(()=>[e(T,{onClick:L,class:"data-source-btn"},{default:r(()=>[k(" 数据源配置 ")]),_:1}),e(T,{onClick:he,class:"variable-btn"},{default:r(()=>[k(" 变量池配置 ")]),_:1}),ee(e(T,{onClick:l},{default:r(()=>[k(" 预览 ")]),_:1},512),[[se,o(n).id]]),e(T,{onClick:z,type:"primary",class:"save-btn"},{default:r(()=>[k(" 保存 ")]),_:1})]),_:1})]),tags:r(()=>[o(n).status?(C(),U(pe,{key:0,color:"#87d068"},{default:r(()=>[k("启用")]),_:1})):(C(),U(pe,{key:1,color:"#f50"},{default:r(()=>[k("停用")]),_:1}))]),_:1},8,["title","subTitle"]),ee((C(),A("div",gt,[O("div",yt,[e(_t)]),O("div",ht,[e(bt)])])),[[xe,o(v),void 0,{fullscreen:!0}]]),e(le,{open:N.value,"onUpdate:open":d[1]||(d[1]=x=>N.value=x),title:"保存",onOk:i},{default:r(()=>[e(o(H),{formData:o(n),"onUpdate:formData":d[0]||(d[0]=x=>Ae(n)?n.value=x:null),layout:R.value.layout,properties:R.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e(le,{open:b.value,"onUpdate:open":d[4]||(d[4]=x=>b.value=x),title:"数据源配置",onOk:J,onCancel:X},{default:r(()=>[e(o(H),{layout:h.value.layout,properties:h.value.properties,formData:a.value,"onUpdate:formData":d[2]||(d[2]=x=>a.value=x)},null,8,["layout","properties","formData"]),e(we,null,{default:r(()=>[k("结果区")]),_:1}),e(T,{type:"primary",style:{"margin-bottom":"5px"},onClick:$,loading:E.value},{default:r(()=>[k("运行")]),_:1},8,["loading"]),e(tt,{height:200,disabled:"",value:p.value,"onUpdate:value":d[3]||(d[3]=x=>p.value=x)},null,8,["value"])]),_:1},8,["open"]),e(le,{title:"变量池配置",open:Z.value,footer:!1,onCancel:d[6]||(d[6]=x=>Z.value=!1)},{default:r(()=>[e(at,{columns:ye.value,modelValue:o(n).variablePool,"onUpdate:modelValue":d[5]||(d[5]=x=>o(n).variablePool=x)},null,8,["columns","modelValue"])]),_:1},8,["open"]),e(Se,{current:c.value,"onUpdate:current":d[7]||(d[7]=x=>c.value=x),open:S.value,steps:t,onClose:d[8]||(d[8]=x=>S.value=!1)},null,8,["current","open"])],64)}}}),fa=te(Ct,[["__scopeId","data-v-c2e7f354"]]);export{fa as default};
