import{r as k,_ as ne}from"./index-C2YmM_0H.js";import{a as se}from"./menu-DK3mEF32.js";import{g as re,a9 as ue,m as de,r as _,n as B,L as _e,U as ce,o as r,q as C,l as t,w as e,e as $,V as ie,W as me,J as u,P as z,X as F,i as m,F as I,Y as b,Z as pe,$ as ve,a0 as fe,a1 as ye,a2 as ge,a3 as ke,a5 as be,K as he,a4 as xe,a6 as Ce,a7 as Ne,a8 as we,al as Fe}from"./.pnpm-BDh_-suK.js";const h={getList:d=>k({method:"get",url:"role/list",params:d}),getDetail:d=>k({method:"get",url:"role/detail",params:{id:d}}),remove:d=>k({method:"get",url:"role/remove",params:{id:d}}),add:d=>k({method:"post",url:"role/add",data:d}),update:d=>k({method:"post",url:"role/update",data:d})},Ie={class:"role"},Me={class:"tools"},Te={style:{height:"200px","overflow-y":"auto"}},Ke=re({__name:"RoleView",setup(d){ue.SHOW_ALL;const c=de({keyword:"",pageNumber:1,pageSize:10}),M=_([]),A=_([{title:"角色名",key:"roleName",dataIndex:"roleName"},{title:"角色ID",key:"roleKey",dataIndex:"roleKey"},{title:"备注",key:"remark",dataIndex:"remark"},{title:"状态",key:"status",dataIndex:"status"},{title:"创建时间",key:"createTime",dataIndex:"createTime"},{title:"操作",key:"action",dataIndex:"action"}]),N=_(!1),T=_(),P=()=>{var o;(o=T.value)==null||o.resetFields(),p()},K=_(0),j=()=>{c.pageNumber=1,c.pageSize=10,p()},q=o=>{const{current:a,pageSize:s}=o;c.pageNumber=a,c.pageSize=s,p()},p=()=>{N.value=!0,h.getList(c).then(o=>{const{code:a,data:s}=o;a==200&&(M.value=s.data,K.value=s.total),N.value=!1})};B(()=>{p()});const v=_(!1),l=_({roleName:"",roleKey:"",status:1,remark:"",roleMenus:[]}),f=_("add"),E=_e(()=>({add:"新增角色",edit:"编辑角色"})[f.value]),D=_(),W=()=>{f.value="add",v.value=!0,l.value={roleName:"",roleKey:"",status:1,remark:"",roleMenus:[]}},H=async o=>{const{code:a,data:s}=await h.getDetail(o.roleId);a==200&&(l.value=s,f.value="edit",v.value=!0)},J=async o=>{const{code:a,msg:s,data:i}=await h.remove(o.roleId);a==200&&($.success(i),p())},S=()=>{var o;(o=D.value)==null||o.resetFields()},X=()=>{let o;f.value=="add"?o=h.add:o=h.update,l.value.roleMenus instanceof Array||(l.value.roleMenus=l.value.roleMenus.checked),o(l.value).then(a=>{const{code:s}=a;s==200&&($.success(f.value=="add"?"新增成功":"编辑成功"),p()),S(),v.value=!1})},U=_([]),Y=()=>{se.getAllMenu().then(o=>{const{code:a,data:s,msg:i}=o;a==200&&(U.value=s)})};return B(()=>{Y()}),(o,a)=>{const s=pe,i=ve,O=fe,y=ye,Z=ge,V=ke,L=ie,x=be,G=he,Q=xe,ee=Ce,R=Ne,te=we,ae=Fe,oe=me,w=ce("has-perm");return r(),C("div",Ie,[t(L,{class:"search-area"},{default:e(()=>[t(V,{ref_key:"searchFormRef",ref:T,model:c,onFinish:j},{default:e(()=>[t(Z,{gutter:24},{default:e(()=>[t(O,{span:4},{default:e(()=>[t(i,{label:"角色名称",name:"keyword"},{default:e(()=>[t(s,{value:c.keyword,"onUpdate:value":a[0]||(a[0]=n=>c.keyword=n)},null,8,["value"])]),_:1})]),_:1}),t(O,{span:4,style:{"text-align":"right"}},{default:e(()=>[t(y,{type:"primary","html-type":"submit"},{default:e(()=>[u("搜索")]),_:1}),t(y,{style:{margin:"0 8px"},onClick:P},{default:e(()=>[u(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(L,null,{default:e(()=>[z("div",Me,[F((r(),m(y,{type:"primary",onClick:W},{default:e(()=>[u("新增")]),_:1})),[[w,"system:role:add"]])]),t(ee,{loading:N.value,columns:A.value,"data-source":M.value,scroll:{y:440},onChange:q,pagination:{current:c.pageNumber,total:K.value}},{bodyCell:e(({column:n,record:g})=>[n.key=="status"?(r(),C(I,{key:0},[g.status?(r(),m(x,{key:0,color:"#87d068"},{default:e(()=>[u("启用")]),_:1})):(r(),m(x,{key:1,color:"#f50"},{default:e(()=>[u("停用")]),_:1}))],64)):b("",!0),n.key=="action"?(r(),C(I,{key:1},[F((r(),m(y,{type:"link",onClick:le=>H(g)},{default:e(()=>[u("编辑")]),_:2},1032,["onClick"])),[[w,"system:role:update"]]),t(G,{type:"vertical"}),t(Q,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:le=>J(g)},{default:e(()=>[F((r(),m(y,{type:"link",danger:""},{default:e(()=>[u("删除")]),_:1})),[[w,"system:role:remove"]])]),_:2},1032,["onConfirm"])],64)):b("",!0),n.key=="roleType"?(r(),C(I,{key:2},[g.roleType=="app"?(r(),m(x,{key:0,color:"#2db7f5"},{default:e(()=>[u("菜单")]),_:1})):b("",!0),g.roleType=="directory"?(r(),m(x,{key:1,color:"#87d068"},{default:e(()=>[u("目录")]),_:1})):b("",!0)],64)):b("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),t(oe,{open:v.value,"onUpdate:open":a[6]||(a[6]=n=>v.value=n),onOk:X,title:E.value,onCancel:S},{default:e(()=>[t(V,{model:l.value,"label-col":{span:8},ref_key:"modalFormRef",ref:D},{default:e(()=>[t(i,{label:"角色名"},{default:e(()=>[t(s,{value:l.value.roleName,"onUpdate:value":a[1]||(a[1]=n=>l.value.roleName=n)},null,8,["value"])]),_:1}),t(i,{label:"角色ID"},{default:e(()=>[t(s,{value:l.value.roleKey,"onUpdate:value":a[2]||(a[2]=n=>l.value.roleKey=n)},null,8,["value"])]),_:1}),t(i,{label:"状态"},{default:e(()=>[t(te,{value:l.value.status,"onUpdate:value":a[3]||(a[3]=n=>l.value.status=n),"button-style":"solid"},{default:e(()=>[t(R,{value:1},{default:e(()=>[u("启用 ")]),_:1}),t(R,{value:0},{default:e(()=>[u("停用 ")]),_:1})]),_:1},8,["value"])]),_:1}),t(i,{label:"权限"},{default:e(()=>[z("div",Te,[t(ae,{checkedKeys:l.value.roleMenus,"onUpdate:checkedKeys":a[4]||(a[4]=n=>l.value.roleMenus=n),"tree-data":U.value,checkStrictly:!0,checkable:"","field-names":{children:"children",title:"label",key:"id"}},null,8,["checkedKeys","tree-data"])])]),_:1}),t(i,{label:"备注"},{default:e(()=>[t(s,{value:l.value.remark,"onUpdate:value":a[5]||(a[5]=n=>l.value.remark=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),Oe=ne(Ke,[["__scopeId","data-v-5e79b34d"]]);export{Oe as default};
