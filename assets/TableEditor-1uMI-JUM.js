import{r as i,d as B,N as ae,V as I,W as M,c as t,u as s,X as A,aa as we,S as ie,U as Se,q as G,a4 as N,af as De,a5 as n,ab as xe,F as ee,L as k,h as ke,Z as Ie,w as Te,A as W,H as te,B as $e,M as Fe}from"./@vue-BvA2MXdg.js";import{S as z}from"./SchemaForm-CCqiTjHx.js";import{d as Re,s as oe}from"./pinia-DlKznUG5.js";import{h as Ue}from"./http-BwYZjU_x.js";import{t as V}from"./table-Bp0MiyXj.js";import{v as ue}from"./uuid-CQkTLCs1.js";import{a as le,f as Ae,M as ce,B as de,h as Ve,i as Ne,t as me,v as pe,w as fe,K as Oe,L as Le,N as Pe,T as qe,_ as Me}from"./ant-design-vue-CYBwGk2d.js";import{_ as ze}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-DXAWFq-i.js";import"./ag-grid-community-pc37hWba.js";import{A as Be}from"./ag-grid-vue3-CeGLuGwf.js";import{d as Ee}from"./gaius-utils-DO2PX8Qd.js";import{s as Ke,N as He,a0 as je}from"./@ant-design-DjS9GqSD.js";import{_ as ne}from"./index-BuOOkONL.js";import{u as Ge}from"./vue-router-iEIkon04.js";import{_ as We}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-DFzCptQN.js";import{E as Je}from"./EditTable-DFiHEwg6.js";import"./lodash-es-PU94eZQX.js";import"./axios-BimPEqV4.js";import"./@babel-BiFW4_mA.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-B73STPP_.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-C5fUfLeo.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-OW4gUFyn.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-B15wvzJm.js";import"./common-iiMfQhj3.js";import"./form-BJ0QAlY5.js";/* empty css                      */import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-CbJ3uXWy.js";import"./echarts-DetEu2Tg.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CDo53BfZ.js";import"./vue-codemirror-BENg5eLO.js";import"./codemirror-DbSqjR0q.js";import"./@codemirror-Bw0AUzsQ.js";import"./@lezer-Cp1Os4ub.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";const se=Re("tableDesign",()=>{const $=i([]),b=i({name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:[],filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),a=i([]),f=i({}),r=()=>{const d=new Date().getTime().toString().slice(-4);b.value.columns.push({id:ue(),dataIndex:"field"+d,title:"列"+d})},w=(d,e)=>{const o=e.findIndex(m=>m.id===d);o!=-1&&(f.value=e[o])},h=(d,e)=>{const o=e.findIndex(m=>m.id===d);o!=-1&&e.splice(o,1)},S=()=>{const d={};return b.value.variablePool.reduce((e,o)=>(e[o.key]=o.defaultValue,e),d),d},T=async d=>{try{const e=await Ue.run(b.value.dataSource.interfaceUrl,S());return new Function("res",d||b.value.dataSource.handlerFunc)(e.data)}catch(e){return e}},C=i(!1);return{tableCfg:b,currentColumn:f,onSelectColumn:w,onRemoveColumn:h,onAddColumn:r,tableData:$,onRefreshData:T,saveLoading:C,onSave:async()=>{C.value=!0;const{code:d,msg:e}=await V.add(b.value);d==200&&le.success(e),C.value=!1},columnFields:a}}),ve=new Ee,Xe={class:"custom-header-item",style:{width:"100%",display:"flex","justify-content":"space-between"}},Ze={class:"custom-header-label",style:{flex:"1"}},Qe=B({__name:"CustomTableHeader",props:{params:{}},emits:["onRemove"],setup($,{emit:b}){const a=$,{params:f}=ae(a),r=()=>{ve.onPublish("removeEvent",f.value)};return(w,h)=>(I(),M("div",Xe,[t(s(Ke),{class:"move",style:{width:"20px",cursor:"pointer"}}),A("div",Ze,we(s(f).displayName),1),t(s(He),{class:"remove",style:{width:"20px"},onClick:h[0]||(h[0]=S=>r())})]))}}),Ye=B({__name:"AgTable",props:ie({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:ie(["onRemove","onClick"],["update:columns"]),setup($,{emit:b}){ve.onSubscribe("removeEvent",e=>{let o=e.column.getColId(),m=a.value.find(_=>_.dataIndex==o);m&&y(m)});const a=Se($,"columns"),f=$,{columnId:r,tableData:w}=ae(f),h=G(()=>a.value.map(e=>({field:e.dataIndex,colId:e.dataIndex,headerName:e.title,pinned:e.fixed,lockVisible:!0,headerComponent:Qe}))),S=e=>{if(!e.finished)return;let o=e.api.getColumnState().map(m=>a.value.find(_=>_.dataIndex==m.colId));a.value=o},T=e=>{if(!e.finished)return;let o=e.column.getColId(),m=a.value.findIndex(_=>_.dataIndex==o);m!=-1&&(a.value[m].width=e.column.getActualWidth())},C=b,y=e=>{C("onRemove",e)},d=e=>{let o=e.column.getId(),m=a.value.find(_=>_.dataIndex==o);C("onClick",m)};return(e,o)=>(I(),N(s(Be),{rowData:s(w),columnDefs:h.value,style:De({height:e.height+"px"}),class:"ag-theme-quartz",onColumnMoved:S,onColumnResized:T,onColumnHeaderClicked:d},null,8,["rowData","columnDefs","style"]))}}),et=ne(Ye,[["__scopeId","data-v-c8447d6c"]]),tt={class:"table-design-container"},at={class:"tools",style:{"margin-bottom":"5px"}},ot={class:"action-container"},lt=B({__name:"TableDesign",setup($){const b=se(),{tableCfg:a,tableData:f,columnFields:r}=oe(b),{onSelectColumn:w,onRemoveColumn:h,onAddColumn:S,onRefreshData:T}=b,C=u=>{w(u.id,a.value.columns)},y=u=>{h(u.id,a.value.columns)},d=i(0),e=()=>{T().then(u=>{const{data:l,total:v}=u;if(l){f.value=l;try{r.value=Object.keys(l[0]).map(p=>({value:p,label:p}))}catch{le.warning("接口数据解析失败")}}v&&(d.value=v)})},o=G(()=>{var u,l;return((u=a.value.global.filterCfg)==null?void 0:u.show)&&((l=a.value.global.filterCfg)==null?void 0:l.formId)}),m=i({}),_=i(!1),E=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{id:{type:"string",label:"按钮标识",component:{disabled:!0}},name:{type:"string",label:"按钮名称"},position:{type:"radio",label:"按钮位置",component:{dataSource:[{value:"row",label:"行内"},{value:"header",label:"表头"}],buttonStyle:"solid"}},request:{type:"switch",label:"请求接口",tooltip:"是否在点击按钮后请求接口获取数据"},interfaceUrl:{show:"${formData.request}",type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:u,data:l,msg:v}=await V.getApiList();return u==200?l.map(p=>({value:p.id,label:p.apiName})):[]}}},AfterHandleFunc:{show:"${formData.request}",type:"string",label:"处理函数",tooltip:"处理接口返回的数据,数据用于表单渲染或地址拼接",component:{name:"code-editor",height:100,prepend:"(res)=>{",append:"}"}},event:{type:"radio",label:"触发事件",component:{dataSource:[{value:"modal",label:"弹窗"},{value:"link",label:"链接"}],buttonStyle:"solid"}},linkUrl:{show:"'${formData.event}' == 'link'",type:"string",label:"链接地址",tooltip:"可以通过${name}的方式拼接变量,name为变量名称"},formId:{show:"'${formData.event}' == 'modal'",type:"select",label:"表单",component:{asyncData:async()=>await new Promise(u=>{setTimeout(()=>{u(L.value)},100)})}},"actionCfg.interfaceUrl":{show:"'${formData.event}' == 'modal'",type:"select",label:"接口地址",tooltip:"一般用于提交数据,新增后保存当前的表单数据",component:{asyncData:async()=>{const{code:u,data:l,msg:v}=await V.getApiList();return u==200?l.map(p=>({value:p.id,label:p.apiName})):[]}}}}}),F=i(""),O=()=>{F.value=ue(),a.value.global.actionCfg.push({name:"按钮",id:F.value,actionCfg:{interfaceUrl:""}})},K=u=>{let l=0;a.value.global.actionCfg.forEach((v,p)=>{v.id===u&&(l=p-1)}),a.value.global.actionCfg=a.value.global.actionCfg.filter(v=>v.id!==u),a.value.global.actionCfg.length&&F.value===u&&(l>=0?F.value=a.value.global.actionCfg[l].id:F.value=a.value.global.actionCfg[0].id)},J=(u,l)=>{l==="add"?O():K(u)},L=i([]);return V.getFormList().then(u=>{const{code:l,data:v,msg:p}=u;l==200&&(L.value=v.map(U=>({value:U.id,label:U.name})))}),(u,l)=>{const v=de,p=Ve,U=Ne,H=Ae,X=me,j=pe,P=fe,Z=ce;return I(),M(ee,null,[A("div",tt,[o.value?(I(),N(H,{key:0,class:"filter-panel"},{default:n(()=>[t(ze,{formData:m.value,id:s(a).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),t(U,null,{default:n(()=>[t(p,{span:24,style:{"text-align":"right"}},{default:n(()=>[t(v,{type:"primary","html-type":"submit"},{default:n(()=>[k("搜索")]),_:1}),t(v,{style:{margin:"0 8px"}},{default:n(()=>[k("重置")]),_:1})]),_:1})]),_:1})]),_:1})):xe("",!0),t(H,{class:"table-container"},{default:n(()=>[A("div",at,[t(X,null,{default:n(()=>[t(v,{type:"primary",onClick:s(S)},{default:n(()=>[k("新增列")]),_:1},8,["onClick"]),t(v,{type:"primary",onClick:l[0]||(l[0]=D=>_.value=!0)},{default:n(()=>[k("交互配置")]),_:1})]),_:1}),t(v,{icon:ke(s(je)),type:"link",title:"刷新数据",style:{float:"right"},onClick:e},null,8,["icon"])]),t(et,{columns:s(a).columns,"onUpdate:columns":l[1]||(l[1]=D=>s(a).columns=D),"table-data":s(f),height:o.value?300:500,onOnRemove:y,onOnClick:C},null,8,["columns","table-data","height"])]),_:1})]),t(Z,{open:_.value,"onUpdate:open":l[3]||(l[3]=D=>_.value=D),footer:null,title:"交互配置"},{default:n(()=>[t(P,{activeKey:F.value,"onUpdate:activeKey":l[2]||(l[2]=D=>F.value=D),type:"editable-card",onEdit:J},{default:n(()=>[(I(!0),M(ee,null,Ie(s(a).global.actionCfg,D=>(I(),N(j,{key:D.id,tab:D.name},{default:n(()=>[A("div",ot,[t(s(z),{layout:E.value.layout,properties:E.value.properties,formData:D},null,8,["layout","properties","formData"])])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])]),_:1},8,["open"])],64)}}}),nt=ne(lt,[["__scopeId","data-v-b14e833c"]]),st=B({__name:"TableCfg",setup($){const b=se(),{tableCfg:a,currentColumn:f,columnFields:r}=oe(b),w=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(y=>{setTimeout(()=>{y(r.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:!1,label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),h=i();Te(()=>r,()=>{h.value&&h.value.refreshOption("dataIndex")},{deep:!0,immediate:!0});const S=i("column"),T=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(y=>{setTimeout(()=>{y(C.value)},100)})}}}}),C=i([]);return V.getFormList().then(y=>{const{code:d,data:e,msg:o}=y;d==200&&(C.value=e.map(m=>({value:m.id,label:m.name})))}),(y,d)=>{const e=Oe,o=pe,m=fe;return I(),N(m,{activeKey:S.value,"onUpdate:activeKey":d[0]||(d[0]=_=>S.value=_)},{default:n(()=>[t(o,{key:"column",tab:"列配置"},{default:n(()=>[W((I(),N(s(z),{layout:w.value.layout,properties:w.value.properties,formData:s(f),key:s(f).id,ref_key:"columnForm",ref:h},null,8,["layout","properties","formData"])),[[te,s(f).id]]),W(A("div",null,[t(e)],512),[[te,!s(f).id]])]),_:1}),t(o,{key:"global",tab:"全局配置"},{default:n(()=>[t(s(z),{layout:T.value.layout,properties:T.value.properties,formData:s(a).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),rt={class:"table-design"},it={class:"left-part"},ut={class:"right-part"},ct=B({__name:"TableEditor",props:{id:{}},setup($){const b=$,{id:a}=ae(b),f=se(),{tableCfg:r,tableData:w,saveLoading:h,columnFields:S}=oe(f),{onRefreshData:T,onSave:C}=f,y=i(!1),d=i(0),e=[{title:"数据配置",description:"在开始配置列表前，请先配置数据源",target:()=>document.querySelector(".data-source-btn")},{title:"变量配置",description:"配置数据源后,为保证数据源的正常获取数据,还需要配置对应的参数",target:()=>document.querySelector(".variable-btn")},{title:"表格布局区",description:"现在可以通过新增列,来增加表格的列,支持拖拽表头改变列的位置及列宽",target:()=>document.querySelector(".left-part")},{title:"配置区",description:"可以对表格整体或者表格单独的列进行配置,满足您的需求",target:()=>document.querySelector(".right-part")},{title:"最后",description:"保存您刚刚的配置",target:()=>document.querySelector(".save-btn")}],o=i({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),m=i(""),_=()=>{T().then(R=>{const{data:c}=R;if(c){w.value=c;try{S.value=Object.keys(c[0]).map(x=>({value:x,label:x}))}catch{le.warning("接口数据解析失败")}}})};a.value?V.getDetail(a.value).then(R=>{const{code:c,data:x,msg:q}=R;c==200&&(r.value=x,_())}):(r.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:[],filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"},{key:"pageSize",defaultValue:"10"}]},o.value=r.value.dataSource,w.value=[],S.value=[],y.value=!0);const E=G(()=>r.value.name?r.value.name:"新建表格"),F=G(()=>r.value.description?r.value.description:""),O=i(!1),K=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),J=()=>{O.value=!0},L=Ge(),u=()=>{L.go(-1)},l=()=>{C(),O.value=!1,u()},v=()=>{L.push({path:"/low-code/preview-table",query:{id:r.value.id}})},p=i(!1),U=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:5}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:R,data:c,msg:x}=await V.getApiList();return R==200?c.map(q=>({value:q.id,label:q.apiName})):[]}}},handlerFunc:{type:"string",label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}",component:{name:"code-editor",height:200,prepend:"(res)=>{",append:"}"}}}}),H=()=>{o.value=r.value.dataSource,p.value=!0},X=()=>{r.value.dataSource=o.value,_(),j()},j=()=>{p.value=!1},P=i(!1),Z=async()=>await T(),D=async()=>{P.value=!0;const R=await Z();P.value=!1,m.value=JSON.stringify(R,null,2)},Q=i(!1),be=i([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),_e=()=>{Q.value=!0};return(R,c)=>{const x=de,q=me,re=qe,ye=Le,Y=ce,ge=Me,he=Pe,Ce=$e("loading");return I(),M(ee,null,[t(ye,{title:E.value,subTitle:F.value,onBack:u,ghost:!1,style:{padding:"10px 24px"}},{extra:n(()=>[t(q,null,{default:n(()=>[t(x,{onClick:H,class:"data-source-btn"},{default:n(()=>[k(" 数据源配置 ")]),_:1}),t(x,{onClick:_e,class:"variable-btn"},{default:n(()=>[k(" 变量池配置 ")]),_:1}),W(t(x,{onClick:v},{default:n(()=>[k(" 预览 ")]),_:1},512),[[te,s(r).id]]),t(x,{onClick:J,type:"primary",class:"save-btn"},{default:n(()=>[k(" 保存 ")]),_:1})]),_:1})]),tags:n(()=>[s(r).status?(I(),N(re,{key:0,color:"#87d068"},{default:n(()=>[k("启用")]),_:1})):(I(),N(re,{key:1,color:"#f50"},{default:n(()=>[k("停用")]),_:1}))]),_:1},8,["title","subTitle"]),W((I(),M("div",rt,[A("div",it,[t(nt)]),A("div",ut,[t(st)])])),[[Ce,s(h),void 0,{fullscreen:!0}]]),t(Y,{open:O.value,"onUpdate:open":c[1]||(c[1]=g=>O.value=g),title:"保存",onOk:l},{default:n(()=>[t(s(z),{formData:s(r),"onUpdate:formData":c[0]||(c[0]=g=>Fe(r)?r.value=g:null),layout:K.value.layout,properties:K.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),t(Y,{open:p.value,"onUpdate:open":c[4]||(c[4]=g=>p.value=g),title:"数据源配置",onOk:X,onCancel:j},{default:n(()=>[t(s(z),{layout:U.value.layout,properties:U.value.properties,formData:o.value,"onUpdate:formData":c[2]||(c[2]=g=>o.value=g)},null,8,["layout","properties","formData"]),t(ge,null,{default:n(()=>[k("结果区")]),_:1}),t(x,{type:"primary",style:{"margin-bottom":"5px"},onClick:D,loading:P.value},{default:n(()=>[k("运行")]),_:1},8,["loading"]),t(We,{height:200,disabled:"",value:m.value,"onUpdate:value":c[3]||(c[3]=g=>m.value=g)},null,8,["value"])]),_:1},8,["open"]),t(Y,{title:"变量池配置",open:Q.value,footer:!1,onCancel:c[6]||(c[6]=g=>Q.value=!1)},{default:n(()=>[t(Je,{columns:be.value,modelValue:s(r).variablePool,"onUpdate:modelValue":c[5]||(c[5]=g=>s(r).variablePool=g)},null,8,["columns","modelValue"])]),_:1},8,["open"]),t(he,{current:d.value,"onUpdate:current":c[7]||(c[7]=g=>d.value=g),open:y.value,steps:e,onClose:c[8]||(c[8]=g=>y.value=!1)},null,8,["current","open"])],64)}}}),oa=ne(ct,[["__scopeId","data-v-0fa3ecde"]]);export{oa as default};
