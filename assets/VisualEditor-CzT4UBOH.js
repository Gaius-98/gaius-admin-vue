var ee=Object.defineProperty;var te=(n,t,e)=>t in n?ee(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var b=(n,t,e)=>te(n,typeof t!="symbol"?t+"":t,e);import{u as oe}from"./vue-router-C97ZxxSg.js";import{_ as ae}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-Da6iIWNx.js";import{d as ne,s as K}from"./pinia-DMSgKyd8.js";import{c as B,d as se}from"./lodash-es-PU94eZQX.js";import{r as C,d as M,U as h,V as k,u as w,a4 as S,ad as q,F as z,Y as N,a5 as y,af as O,G as Y,x as ie,E as le,W as g,aa as H,a7 as ce,m as F,Z as L,J as I,a6 as G,c as x}from"./@vue-Ckf1Z535.js";import{b as $}from"./index-OKZIVRvr.js";import{s as re}from"./gaius-utils-Zl0NLw_z.js";import{v as pe}from"./uuid-CQkTLCs1.js";import{u as de,z as ue,A as me,L as fe,B as he,t as ve,T as _e}from"./ant-design-vue-nZFTCpdE.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-q1gXaRT_.js";import"./common-DkufscNP.js";import"./form-CrLQCRL0.js";/* empty css                      */import"./axios-B4uVmeYG.js";import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-BDAzFyRD.js";import"./vue-codemirror-Ck6_nnQ5.js";import"./codemirror-Bjp_x31m.js";import"./@codemirror-ByoHOglS.js";import"./@lezer-CciglqRQ.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./@ant-design-C9fRTiaf.js";import"./@ctrl-DOFZgDuz.js";import"./echarts-DetEu2Tg.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CDo53BfZ.js";import"./@babel-BiFW4_mA.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-X-x4l2Bb.js";import"./throttle-debounce-CUWDS_la.js";import"./async-validator-DKvM95Vc.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-C5fUfLeo.js";import"./dom-align-CRCehRfe.js";import"./@emotion-BtrR-yrm.js";import"./stylis-DsJDcYJc.js";const R=10,E=ne("visual",()=>{const n=C({componentData:[],name:"",id:"",img:"",height:1080,width:1920}),t=C({name:"",type:"",id:"",props:{},tag:"",position:{top:0,left:0},size:{width:0,height:0},formId:""}),e=C([]),o=C(0),a=()=>{e.value[o.value++]=B(n.value.componentData),e.value.length>R&&(e.value=e.value.slice(e.value.length-R),o.value=R)},s=()=>{o.value>0&&(o.value--,n.value.componentData=B(e.value[o.value]))},d=()=>{o.value<e.value.length-1&&(o.value++,n.value.componentData=B(e.value[o.value]))},m=f=>{const r=n.value.componentData.findIndex(v=>v.id===f.id);r!=-1&&(t.value=n.value.componentData[r])};return{undo:s,redo:d,setSnapshot:a,onClickComp:m,visualData:n,curCompData:t,addComp:f=>{n.value.componentData.push(f),m(f),a()},removeComp:f=>{const r=n.value.componentData.findIndex(v=>v.id===f.id);r!=-1&&(n.value.componentData.splice(r,1),a())},snapshotData:e,curSnapshotIdx:o,updateComp:f=>{const r=n.value.componentData.findIndex(v=>v.id===f.id);r!=-1&&(n.value.componentData[r]=f,a())}}}),ge={class:"cfg"},ye=M({__name:"CfgArea",setup(n){const t=E(),{visualData:e,curCompData:o}=K(t);return(a,s)=>(h(),k("div",ge,[w(o).formId?(h(),S(ae,{"form-data":w(o),id:w(o).formId,key:w(o).formId},null,8,["form-data","id"])):q("",!0)]))}}),xe=$(ye,[["__scopeId","data-v-4dd99f10"]]),Ce=[{name:"图片",type:"img",tag:"img",icon:"icon-image1",props:{src:"https://avatars.githubusercontent.com/u/59641156?v=4",draggable:!1},style:{width:"100%",height:"100%"},formId:"c0c67e96-858b-4303-999c-92d0d39cb792"},{name:"文本",type:"text",tag:"span",icon:"icon-text",props:{value:"text"}},{name:"视频",type:"video",tag:"video",icon:"icon-video",props:{src:"",controls:!0,draggable:!1},style:{position:"relative",width:"100%",height:"100%","object-fit":"fill","z-index":-1}},{name:"嵌入页",type:"iframe",tag:"iframe",icon:"icon-HTML",props:{src:"http://120.26.161.36:8080/",draggable:!1},style:{position:"relative",width:"100%",height:"100%","z-index":-1},formId:"6ba21979-d5ec-4715-831e-62046fbfb0d9"},{name:"柱状图",type:"bar",tag:"g-echart",icon:"icon-barchart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"bar"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"折线图",type:"line",tag:"g-echart",icon:"icon-linechart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"line"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"组",type:"group",tag:"visual-group",icon:"icon-deploymentunit",props:{data:[]}}];class P{constructor(t,e){b(this,"name","组件");b(this,"id");b(this,"type");b(this,"tag");b(this,"icon");b(this,"props");b(this,"style");b(this,"formId","");b(this,"position",{top:0,left:0});b(this,"size",{width:0,height:0});this.id=e||pe(),this.type=t;const o=Ce.find(s=>s.type===t),a=B(o);o?(this.tag=a.tag,this.props=a.props,this.name=a.name,this.style=a.style,this.icon=a.icon,this.formId=a.formId):(this.tag="div",this.icon="icon")}}const De=n=>{let t=null,e=null,o=0,a=0;return n.forEach(s=>{t=t==null?s.position.left:Math.min(t,s.position.left),e=e==null?s.position.top:Math.min(e,s.position.top),o=Math.max(o,s.position.left+s.size.width),a=Math.max(a,s.position.top+s.size.height)}),{left:t,top:e,width:o-t,height:a-e}},we=n=>{const{left:t,top:e,width:o,height:a}=De(n),s=new P("group");return s.position={top:e,left:t},s.size={width:o,height:a},s.props={data:n.map(d=>({...d,position:{left:d.position.left-t,top:d.position.top-e}}))},s},be=(n,t,e)=>{const{height:o,width:a}=n,{height:s,width:d}=t,m=(d-a)/a,c=(s-o)/o,p=e.props.data;return e.props.data=p.map(u=>({...u,position:{left:(u.position.left*(1+m)).toFixed(2),top:(u.position.top*(1+c)).toFixed(2)},size:{width:(u.size.width*(1+m)).toFixed(2),height:(u.size.height*(1+c)).toFixed(2)}})),e},ke=M({__name:"DesignArea",setup(n){const t=E(),{visualData:e,curCompData:o}=K(t),{onClickComp:a,setSnapshot:s,addComp:d,removeComp:m,updateComp:c}=t,p=C(),u=C([]),f=C(!1),r=C({x:0,y:0}),v=C({x:0,y:0}),T=i=>{f.value=!0,r.value.x=i.offsetX,r.value.y=i.offsetY;const _=A=>{let D=A;v.value.x=D.offsetX,v.value.y=D.offsetY},l=()=>{document.querySelector(".container").removeEventListener("mousemove",_),document.querySelector(".container").removeEventListener("mouseup",l),U()};document.querySelector(".container").addEventListener("mousemove",_),document.querySelector(".container").addEventListener("mouseup",l)},U=()=>{e.value.componentData.map(i=>{i.position.left>=r.value.x&&i.position.left+i.size.width<=v.value.x&&i.position.top>=r.value.y&&i.position.top+i.size.height<=v.value.y&&u.value.push(i.id)}),v.value={x:0,y:0},r.value={x:0,y:0}},W=()=>{u.value=[]},X=i=>{i.preventDefault()},J=i=>{i.preventDefault();let _=JSON.parse(i.dataTransfer.getData("componentData"));_&&(_=new P(_.name),_.position={top:i.offsetY,left:i.offsetX},_.size={width:100,height:100},d(_))},V=C({}),j=i=>{V.value=i},Z=se(i=>{const{nodeKey:_}=i;let l=e.value.componentData.findIndex(A=>A.id===_);l!=-1&&e.value.componentData[l].type=="group"&&_==V.value.nodeKey&&c(be(V.value,i,e.value.componentData[l])),s()},100),Q=()=>{if(u.value.length){let i=e.value.componentData.filter(l=>u.value.includes(l.id));const _=we(i);i.forEach(l=>{m(l)}),d(_),W()}};return document.body.addEventListener("keydown",i=>{i.ctrlKey&&i.key==="g"&&(i.preventDefault(),Q())}),(i,_)=>(h(),k("div",{ref_key:"container",ref:p,class:"container",onDragover:X,onDrop:J,onMousedown:T},[(h(!0),k(z,null,N(w(e).componentData,(l,A)=>(h(),S(w(re),{key:l.id,minh:20,minw:20,width:l.size.width,"onUpdate:width":D=>l.size.width=D,height:l.size.height,"onUpdate:height":D=>l.size.height=D,top:l.position.top,"onUpdate:top":D=>l.position.top=D,left:l.position.left,"onUpdate:left":D=>l.position.left=D,"node-key":l.id,active:l.id==w(o).id||u.value.includes(l.id),class:"drag",style:O({zIndex:`${A+100}`}),wait:10,onUpdate:w(Z),onClick:Y(D=>w(a)(l),["stop"]),onMousedown:Y(D=>w(a)(l),["stop"]),onBeforeTransform:j},{default:y(()=>[(h(),S(H(l.tag),ce({ref_for:!0},l.props,{style:l.style||{}}),null,16,["style"]))]),_:2},1032,["width","onUpdate:width","height","onUpdate:height","top","onUpdate:top","left","onUpdate:left","node-key","active","style","onUpdate","onClick","onMousedown"]))),128)),ie(g("div",{class:"mask",style:O({width:v.value.x-r.value.x+"px",height:v.value.y-r.value.y+"px",top:r.value.y+"px",left:r.value.x+"px"})},null,4),[[le,f.value]])],544))}}),Ie=$(ke,[["__scopeId","data-v-88de1675"]]),Se=["title"],ze=M({__name:"NodeRelationship",setup(n){const t=E(),{visualData:e}=K(t),{onClickComp:o}=t,a=(c,p)=>{o(p.node.dataRef)},s=c=>{},d=c=>{let p={id:c.id,type:c.type,children:[],icon:c.icon,name:c.name};return p.type=="group"&&c.props.data.length>0&&(p.children=c.props.data.map(u=>d(u))),p},m=F(()=>{let c=[];return e.value.componentData.map(p=>{c.push(d(p))}),c});return(c,p)=>{const u=de;return h(),S(u,{class:"draggable-tree",draggable:"","block-node":"","tree-data":m.value,showIcon:!1,onSelect:a,onDrop:s,fieldNames:{title:"name",key:"id",children:"children"}},{title:y(({name:f,data:r})=>[g("div",{title:`${f}(${r.id})`},[g("i",{class:L(["iconfont",r.icon])},null,2),I(" "+G(f),1)],8,Se)]),_:1},8,["tree-data"])}}}),Me=$(ze,[["__scopeId","data-v-d6059f81"]]),$e={class:"component-layout"},Ae=["data-component"],Le={class:"component-item-text"},Te=M({__name:"MaterialArea",setup(n){const t=C(),e=[{title:"基础组件",value:"base",list:[{label:"图片",icon:"icon-image1",name:"img"},{label:"文本",icon:"icon-text",name:"text"},{label:"视频",name:"video",icon:"icon-video"},{label:"嵌入页",name:"iframe",icon:"icon-HTML"}]},{title:"图表",value:"echart",list:[{label:"柱状图",icon:"icon-barchart",name:"bar"},{label:"折线图",icon:"icon-linechart",name:"line"}]}],o=a=>{a&&a.target&&a.dataTransfer&&a.dataTransfer.setData("componentData",a.target.getAttribute("data-component"))};return(a,s)=>{const d=ue,m=me;return h(),S(m,{activeKey:t.value,"onUpdate:activeKey":s[0]||(s[0]=c=>t.value=c),class:"material-area",ghost:!0},{default:y(()=>[(h(),k(z,null,N(e,c=>x(d,{header:c.title,key:c.value},{default:y(()=>[g("div",$e,[(h(!0),k(z,null,N(c.list,p=>(h(),k("div",{class:"component-item",key:p.name,draggable:"true",onDragstart:o,"data-component":JSON.stringify(p)},[g("span",{class:L(["iconfont component-item-icon",p.icon])},null,2),g("span",Le,G(p.label),1)],40,Ae))),128))])]),_:2},1032,["header"])),64))]),_:1},8,["activeKey"])}}}),Be=$(Te,[["__scopeId","data-v-625d7f87"]]),Ne={class:"left-side-bar"},Ee={class:"bar-top"},Ue=["title","onClick"],Ve={class:"header"},Re={class:"title"},Fe={class:"container"},Ke=M({__name:"LeftSideBar",setup(n){const t=[{label:"素材库",value:"componentLib",icon:"appstoreadd",component:Be},{label:"节点关系",value:"nodeRelationship",icon:"link",component:Me}],e=C(),o=C(!1),a=()=>{o.value=!o.value},s=m=>{e.value=m},d=()=>{e.value=void 0};return(m,c)=>(h(),k(z,null,[g("div",Ne,[g("ul",Ee,[(h(),k(z,null,N(t,p=>g("li",{key:p.value,title:p.label,class:L([`iconfont icon-${p.icon}`,e.value&&e.value.value===p.value?"active":""]),onClick:u=>s(p)},null,10,Ue)),64))])]),e.value?(h(),k("div",{class:L(["left-part",o.value?"affix":""]),key:e.value.value},[g("div",Ve,[g("div",Re,G(e.value.label),1),g("div",{class:L(["affix iconfont",o.value?"icon-pushpin-fill":"icon-pushpin"]),onClick:a},null,2),g("div",{class:"close iconfont icon-close",onClick:d})]),g("div",Fe,[(h(),S(H(e.value.component)))])],2)):q("",!0)],64))}}),Ge=$(Ke,[["__scopeId","data-v-49c5d324"]]),Oe={class:"design-container"},Ye=M({__name:"VisualEditor",setup(n){const t=E(),{undo:e,redo:o}=t,a=oe(),s=F(()=>"title"),d=F(()=>"desc"),m=()=>{},c=()=>{},p=()=>{a.go(-1)};return(u,f)=>{const r=he,v=ve,T=_e,U=fe;return h(),k(z,null,[x(U,{title:s.value,subTitle:d.value,onBack:p,ghost:!1,style:{padding:"10px 24px"}},{extra:y(()=>[x(v,null,{default:y(()=>[x(r,{onClick:w(e)},{default:y(()=>[I("撤销")]),_:1},8,["onClick"]),x(r,{onClick:w(o)},{default:y(()=>[I("重做")]),_:1},8,["onClick"]),x(r,null,{default:y(()=>[I("加载外部组件")]),_:1}),x(r,{onClick:m,class:"variable-btn"},{default:y(()=>[I(" 变量池配置 ")]),_:1}),x(r,{onClick:c,type:"primary",class:"save-btn"},{default:y(()=>[I(" 保存 ")]),_:1})]),_:1})]),tags:y(()=>[x(T,{color:"#87d068"},{default:y(()=>[I("启用")]),_:1}),x(T,{color:"#f50"},{default:y(()=>[I("停用")]),_:1})]),_:1},8,["title","subTitle"]),g("div",Oe,[x(Ge,{class:"left-sider"}),x(Ie),x(xe)])],64)}}}),Lt=$(Ye,[["__scopeId","data-v-97ca49e8"]]);export{Lt as default};
