var ee=Object.defineProperty;var te=(n,o,e)=>o in n?ee(n,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[o]=e;var I=(n,o,e)=>(te(n,typeof o!="symbol"?o+"":o,e),e);import{v as oe,aq as E,d as ae,r as x,e as N,s as G,o as g,q as $,j as u,w as f,am as ne,h,g as L,W as j,J as S,al as se,b2 as ie,F as T,y as K,aR as X,aA as W,A as le,aH as ce,aX as re,P as y,B as J,C as pe,L as O,Q as U,R as P,ak as de,as as ue,at as fe,aF as _e,aI as ve,$ as he,b3 as me,aj as ge,a3 as ye}from"./.pnpm-0Jz4sC39.js";import{_ as Y}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BRTz-iaM.js";import{_ as B}from"./index-L8l6AuQJ.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-C40djqjM.js";import"./common-CV6N7aVc.js";import"./form-E2MEbSB6.js";const be=[{name:"图片",type:"img",tag:"img",icon:"icon-image1",props:{src:"https://avatars.githubusercontent.com/u/59641156?v=4",draggable:!1},style:{width:"100%",height:"100%"},formId:"c0c67e96-858b-4303-999c-92d0d39cb792"},{name:"文本",type:"text",tag:"span",icon:"icon-text",props:{value:"text"}},{name:"视频",type:"video",tag:"video",icon:"icon-video",props:{src:"",controls:!0,draggable:!1},style:{position:"relative",width:"100%",height:"100%","object-fit":"fill","z-index":-1}},{name:"嵌入页",type:"iframe",tag:"iframe",icon:"icon-HTML",props:{src:"http://120.26.161.36:8080/",draggable:!1},style:{position:"relative",width:"100%",height:"100%","z-index":-1},formId:"6ba21979-d5ec-4715-831e-62046fbfb0d9"},{name:"柱状图",type:"bar",tag:"g-echart",icon:"icon-barchart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"bar"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"折线图",type:"line",tag:"g-echart",icon:"icon-linechart",props:{option:{xAxis:{type:"category"},yAxis:{type:"value"},series:[{type:"line"}],dataset:{source:[["product","2015","2016","2017"],["Matcha Latte",43.3,85.8,93.7],["Milk Tea",83.1,73.4,55.1],["Cheese Cocoa",86.4,65.2,82.5],["Walnut Brownie",72.4,53.9,39.1]]}}},style:{width:"100%",height:"100%"}},{name:"组",type:"group",tag:"visual-group",icon:"icon-deploymentunit",props:{data:[]}}];class Q{constructor(o,e){I(this,"name","组件");I(this,"id");I(this,"type");I(this,"tag");I(this,"icon");I(this,"props");I(this,"style");I(this,"formId","");I(this,"position",{top:0,left:0});I(this,"size",{width:0,height:0});this.id=e||oe(),this.type=o;const t=be.find(s=>s.type===o),a=E(t);t?(this.tag=a.tag,this.props=a.props,this.name=a.name,this.style=a.style,this.icon=a.icon,this.formId=a.formId):(this.tag="div",this.icon="icon")}}const xe=n=>{let o=null,e=null,t=0,a=0;return n.forEach(s=>{o=o==null?s.position.left:Math.min(o,s.position.left),e=e==null?s.position.top:Math.min(e,s.position.top),t=Math.max(t,s.position.left+s.size.width),a=Math.max(a,s.position.top+s.size.height)}),{left:o,top:e,width:t-o,height:a-e}},Ce=n=>{const{left:o,top:e,width:t,height:a}=xe(n),s=new Q("group");return s.position={top:e,left:o},s.size={width:t,height:a},s.props={data:n.map(_=>({..._,position:{left:_.position.left-o,top:_.position.top-e}}))},s},we=n=>{const{position:{left:o,top:e}}=n;return n.props.data.map(t=>(t.position.left=Number(t.position.left)+o,t.position.top=Number(t.position.top)+e,t))},De=(n,o,e)=>{const{height:t,width:a}=n,{height:s,width:_}=o,i=(_-a)/a,l=(s-t)/t,r=e.props.data;return e.props.data=r.map(m=>({...m,position:{left:(m.position.left*(1+i)).toFixed(2),top:(m.position.top*(1+l)).toFixed(2)},size:{width:(m.size.width*(1+i)).toFixed(2),height:(m.size.height*(1+l)).toFixed(2)}})),e},H=10,V=ae("visual",()=>{const n=x({componentData:[],name:"",id:"",img:"",height:1080,width:1920}),o=x({name:"",type:"",id:"",props:{},tag:"",position:{top:0,left:0},size:{width:0,height:0},formId:""}),e=x([]),t=x(0),a=()=>{e.value[t.value++]=E(n.value.componentData),e.value.length>H&&(e.value=e.value.slice(e.value.length-H),t.value=H)},s=()=>{t.value>0&&(t.value--,n.value.componentData=E(e.value[t.value]))},_=()=>{t.value<e.value.length-1&&(t.value++,n.value.componentData=E(e.value[t.value]))},i=v=>{const d=n.value.componentData.findIndex(b=>b.id===v.id);d!=-1&&(o.value=n.value.componentData[d])},l=v=>{n.value.componentData.push(v),i(v),a()},r=v=>{const d=n.value.componentData.findIndex(b=>b.id===v.id);d!=-1&&(n.value.componentData[d]=v,a())},m=v=>{const d=n.value.componentData.findIndex(b=>b.id===v.id);d!=-1&&(n.value.componentData.splice(d,1),a())},k=x([]),M=()=>{if(k.value.length){const v=n.value.componentData.filter(b=>k.value.includes(b.id)),d=Ce(v);v.forEach(b=>{m(b)}),l(d),z()}},C=()=>{const v=we(o.value);m(o.value),v&&v.map(d=>{l(d)})},z=()=>{k.value=[]};return{undo:s,redo:_,setSnapshot:a,onClickComp:i,visualData:n,curCompData:o,addComp:l,removeComp:m,snapshotData:e,curSnapshotIdx:t,updateComp:r,frameSelection:k,addGroup:M,reduceGroup:C}}),ke={class:"cfg"},Ie=N({__name:"CfgArea",setup(n){const o=V(),{visualData:e,curCompData:t}=G(o),a=x("position");return(s,_)=>{const i=se,l=ne;return g(),$("div",ke,[u(l,{activeKey:a.value,"onUpdate:activeKey":_[0]||(_[0]=r=>a.value=r)},{default:f(()=>[u(i,{key:"position",tab:"位置信息"},{default:f(()=>[u(Y,{"form-data":h(t),id:"77c39b52-fde7-491f-9e94-9f2f1d65fb69"},null,8,["form-data"])]),_:1}),u(i,{key:"props",tab:"属性配置"},{default:f(()=>[h(t).formId?(g(),L(Y,{"form-data":h(t),id:h(t).formId,key:h(t).formId},null,8,["form-data","id"])):j("",!0)]),_:1}),u(i,{key:"data",tab:"数据配置"},{default:f(()=>[S("Content of Tab 3")]),_:1})]),_:1},8,["activeKey"])])}}}),Se=B(Ie,[["__scopeId","data-v-f0d0ccaa"]]),ze=N({__name:"DesignArea",setup(n){const o=V(),{visualData:e,curCompData:t,frameSelection:a}=G(o),{onClickComp:s,setSnapshot:_,addComp:i,removeComp:l,updateComp:r,addGroup:m}=o,k=x(),M=x(!1),C=x({x:0,y:0}),z=x({x:0,y:0}),v=c=>{M.value=!0,C.value.x=c.offsetX,C.value.y=c.offsetY;const w=R=>{let D=R;z.value.x=D.offsetX,z.value.y=D.offsetY},p=()=>{document.querySelector(".container").removeEventListener("mousemove",w),document.querySelector(".container").removeEventListener("mouseup",p),d()};document.querySelector(".container").addEventListener("mousemove",w),document.querySelector(".container").addEventListener("mouseup",p)},d=()=>{e.value.componentData.map(c=>{c.position.left>=C.value.x&&c.position.left+c.size.width<=z.value.x&&c.position.top>=C.value.y&&c.position.top+c.size.height<=z.value.y&&a.value.push(c.id)}),z.value={x:0,y:0},C.value={x:0,y:0}},b=c=>{c.preventDefault()},F=c=>{c.preventDefault();let w=JSON.parse(c.dataTransfer.getData("componentData"));w&&(w=new Q(w.name),w.position={top:c.offsetY,left:c.offsetX},w.size={width:100,height:100},i(w))},A=x({}),q=c=>{A.value=c},Z=ie(c=>{const{nodeKey:w}=c;let p=e.value.componentData.findIndex(R=>R.id===w);p!=-1&&e.value.componentData[p].type=="group"&&w==A.value.nodeKey&&r(De(A.value,c,e.value.componentData[p])),_()},100);return document.body.addEventListener("keydown",c=>{c.ctrlKey&&c.key==="g"&&(c.preventDefault(),m())}),(c,w)=>(g(),$("div",{ref_key:"container",ref:k,class:"container",onDragover:b,onDrop:F,onMousedown:v},[(g(!0),$(T,null,K(h(e).componentData,(p,R)=>(g(),L(h(le),{key:p.id,minh:20,minw:20,width:p.size.width,"onUpdate:width":D=>p.size.width=D,height:p.size.height,"onUpdate:height":D=>p.size.height=D,top:p.position.top,"onUpdate:top":D=>p.position.top=D,left:p.position.left,"onUpdate:left":D=>p.position.left=D,"node-key":p.id,active:p.id==h(t).id||h(a).includes(p.id),class:"drag",style:X({zIndex:`${R+100}`}),wait:10,onUpdate:h(Z),onClick:W(D=>h(s)(p),["stop"]),onMousedown:W(D=>h(s)(p),["stop"]),onBeforeTransform:q},{default:f(()=>[(g(),L(J(p.tag),pe(p.props,{style:p.style||{}}),null,16,["style"]))]),_:2},1032,["width","onUpdate:width","height","onUpdate:height","top","onUpdate:top","left","onUpdate:left","node-key","active","style","onUpdate","onClick","onMousedown"]))),128)),ce(y("div",{class:"mask",style:X({width:z.value.x-C.value.x+"px",height:z.value.y-C.value.y+"px",top:C.value.y+"px",left:C.value.x+"px"})},null,4),[[re,M.value]])],544))}}),$e=B(ze,[["__scopeId","data-v-e8948fe6"]]),Me=["title"],Ae=N({__name:"NodeRelationship",setup(n){const o=V(),{visualData:e}=G(o),{onClickComp:t}=o,a=(i,l)=>{t(l.node.dataRef)},s=i=>{let l={id:i.id,type:i.type,children:[],icon:i.icon,name:i.name};return l.type=="group"&&i.props.data.length>0&&(l.children=i.props.data.map(r=>s(r))),l},_=O(()=>{let i=[];return e.value.componentData.map(l=>{i.push(s(l))}),i});return(i,l)=>{const r=de;return g(),L(r,{class:"draggable-tree","block-node":"","tree-data":_.value,showIcon:!1,onSelect:a,fieldNames:{title:"name",key:"id",children:"children"}},{title:f(({name:m,data:k})=>[y("div",{title:`${m}(${k.id})`},[y("i",{class:U(["iconfont",k.icon])},null,2),S(" "+P(m),1)],8,Me)]),_:1},8,["tree-data"])}}}),Le=B(Ae,[["__scopeId","data-v-2ebb698b"]]),Te={class:"component-layout"},Ne=["data-component"],Be={class:"component-item-text"},Re=N({__name:"MaterialArea",setup(n){const o=x(),e=[{title:"基础组件",value:"base",list:[{label:"图片",icon:"icon-image1",name:"img"},{label:"文本",icon:"icon-text",name:"text"},{label:"视频",name:"video",icon:"icon-video"},{label:"嵌入页",name:"iframe",icon:"icon-HTML"}]},{title:"图表",value:"echart",list:[{label:"柱状图",icon:"icon-barchart",name:"bar"},{label:"折线图",icon:"icon-linechart",name:"line"}]}],t=a=>{a&&a.target&&a.dataTransfer&&a.dataTransfer.setData("componentData",a.target.getAttribute("data-component"))};return(a,s)=>{const _=ue,i=fe;return g(),L(i,{activeKey:o.value,"onUpdate:activeKey":s[0]||(s[0]=l=>o.value=l),class:"material-area",ghost:!0},{default:f(()=>[(g(),$(T,null,K(e,l=>u(_,{header:l.title,key:l.value},{default:f(()=>[y("div",Te,[(g(!0),$(T,null,K(l.list,r=>(g(),$("div",{class:"component-item",key:r.name,draggable:"true",onDragstart:t,"data-component":JSON.stringify(r)},[y("span",{class:U(["iconfont component-item-icon",r.icon])},null,2),y("span",Be,P(r.label),1)],40,Ne))),128))])]),_:2},1032,["header"])),64))]),_:1},8,["activeKey"])}}}),Ue=B(Re,[["__scopeId","data-v-625d7f87"]]),Ee={class:"left-side-bar"},Ke={class:"bar-top"},Ge=["title","onClick"],Ve={class:"header"},Fe={class:"title"},qe={class:"container"},He=N({__name:"LeftSideBar",setup(n){const o=[{label:"素材库",value:"componentLib",icon:"appstoreadd",component:Ue},{label:"节点关系",value:"nodeRelationship",icon:"link",component:Le}],e=x(),t=x(!0),a=()=>{t.value=!t.value},s=i=>{e.value=i},_=()=>{e.value=void 0};return(i,l)=>(g(),$(T,null,[y("div",Ee,[y("ul",Ke,[(g(),$(T,null,K(o,r=>y("li",{key:r.value,title:r.label,class:U([`iconfont icon-${r.icon}`,e.value&&e.value.value===r.value?"active":""]),onClick:m=>s(r)},null,10,Ge)),64))])]),e.value?(g(),$("div",{class:U(["left-part",t.value?"affix":""]),key:e.value.value},[y("div",Ve,[y("div",Fe,P(e.value.label),1),y("div",{class:U(["affix iconfont",t.value?"icon-pushpin-fill":"icon-pushpin"]),onClick:a},null,2),y("div",{class:"close iconfont icon-close",onClick:_})]),y("div",qe,[(g(),L(J(e.value.component)))])],2)):j("",!0)],64))}}),Oe=B(He,[["__scopeId","data-v-28502db2"]]),Pe={class:"design-container"},Xe=N({__name:"VisualEditor",setup(n){const o=V(),{undo:e,redo:t,addGroup:a,reduceGroup:s}=o,{curCompData:_,frameSelection:i}=G(o),l=_e(),r=O(()=>"title"),m=O(()=>"desc"),k=()=>{},M=()=>{},C=()=>{l.go(-1)};return(z,v)=>{const d=he,b=me,F=ge,A=ye,q=ve;return g(),$(T,null,[u(q,{title:r.value,subTitle:m.value,onBack:C,ghost:!1,style:{padding:"10px 24px"}},{extra:f(()=>[u(F,null,{default:f(()=>[u(b,null,{default:f(()=>[u(d,{disabled:!h(i).length,onClick:h(a)},{default:f(()=>[S(" 成组 ")]),_:1},8,["disabled","onClick"]),u(d,{disabled:h(_).type!="group",onClick:h(s)},{default:f(()=>[S(" 取消分组 ")]),_:1},8,["disabled","onClick"])]),_:1}),u(b,null,{default:f(()=>[u(d,{onClick:h(e)},{default:f(()=>[S("撤销")]),_:1},8,["onClick"]),u(d,{onClick:h(t)},{default:f(()=>[S("重做")]),_:1},8,["onClick"])]),_:1}),u(d,null,{default:f(()=>[S("加载外部组件")]),_:1}),u(d,{onClick:k,class:"variable-btn"},{default:f(()=>[S(" 变量池配置 ")]),_:1}),u(d,{onClick:M,type:"primary",class:"save-btn"},{default:f(()=>[S(" 保存 ")]),_:1})]),_:1})]),tags:f(()=>[u(A,{color:"#87d068"},{default:f(()=>[S("启用")]),_:1}),u(A,{color:"#f50"},{default:f(()=>[S("停用")]),_:1})]),_:1},8,["title","subTitle"]),y("div",Pe,[u(Oe,{class:"left-sider"}),u($e),u(Se)])],64)}}}),ot=B(Xe,[["__scopeId","data-v-cf4f0c0b"]]);export{ot as default};
