import{_ as J}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-YcOZhYmm.js";import{t as ea}from"./table-D9UrevvW.js";import{h as ta}from"./http-BatdAtI8.js";import{d as oa,ak as na,r,t as Q,w as X,J as d,L as U,a2 as V,U as I,M as s,a3 as S,g as l,R as T,a0 as j,a1 as la,as as ra,O as F,aa as Z,Q as A,X as B,a9 as G,Z as sa,ah as ia,a6 as ua}from"./index-Dpd769QJ.js";import{C as ca,_ as pa,a as ma}from"./index-Kf33GTI6.js";import{U as da}from"./index-BzZ9GIEh.js";import{D as fa}from"./index-aqndV6Qt.js";import{S as _a}from"./index-Cql7BtW1.js";import{S as va}from"./SyncOutlined-3mL7upRC.js";import{_ as ga,a as ya}from"./index-BmOe8Cqg.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-D5ooq4VF.js";import"./common-Bi8geLIP.js";import"./index-PSRKKzv7.js";import"./index-NBOtWNyE.js";import"./index-Ce6Cv3cf.js";import"./SwapRightOutlined--NvG7dm3.js";import"./index-efGdvrSx.js";import"./form-DbVmsWHV.js";import"./index-CKZARt0z.js";import"./EllipsisOutlined-CD4Jj4Qr.js";import"./index-C5n_QDDt.js";import"./index-CHG5UCnH.js";import"./FolderOutlined-BTwGGdoc.js";import"./useBreakpoint-B5wx1Mqz.js";import"./index-C9AoIfC_.js";const ha=i=>{const c={};return i.reduce((p,a)=>(p[a.key]=a.defaultValue,p),c),c},ka=async(i,c,p)=>{try{const a=await ta.run(i.interfaceUrl,{...c,...p});let v;return i.handlerFunc?v=new Function("res",i.handlerFunc)(a.data):v=a,v}catch(a){return a}},Ca=(i,c)=>i.replace(/\${(.*?)}/g,(p,a)=>c[a.trim()]),w={getProxyData:ka,transformParamsData:ha,parseString:Ca},ba={class:"low-code-table"},wa={style:{"font-size":"12px"}},xa={class:"tools"},Da=["href"],Ua=oa({__name:"LowCodeTable",props:{id:{}},setup(i){const c=i,{id:p}=na(c),a=r({}),v=r([]),x=r({}),P=r(!1),K=()=>{x.value={},k()},h=r(!1),M=Q(()=>{var t,e,n,f,u,m;return((n=(e=(t=a.value)==null?void 0:t.global)==null?void 0:e.filterCfg)==null?void 0:n.show)&&((m=(u=(f=a.value)==null?void 0:f.global)==null?void 0:u.filterCfg)==null?void 0:m.formId)}),W=Q(()=>$.value.length>0?[...a.value.columns,{title:"操作",dataIndex:"_action",key:"_action",width:200,fixed:"right"}]:a.value.columns),g=r({}),R=r([]),$=r([]);X(()=>p.value,()=>{ea.getDetail(p.value).then(t=>{var u;const{code:e,data:n,msg:f}=t;e==200&&(a.value=n,a.value.global.actionCfg&&((u=a.value.global.actionCfg)==null?void 0:u.length)>0&&a.value.global.actionCfg.map(_=>{_.position=="header"?R.value.push(_):$.value.push(_)}),g.value=w.transformParamsData(a.value.variablePool),k())})},{immediate:!0}),X(()=>g.value,()=>{k()},{deep:!0});const q=r(0),k=async()=>{P.value=!0;try{const{data:t,total:e}=await w.getProxyData(a.value.dataSource,g.value,x.value);v.value=t,e&&(q.value=e)}catch(t){j.error("获取数据失败:"+t)}P.value=!1},D=r(!1),y=r({}),N=r({}),E=async(t,e)=>{const{formId:n,event:f,interfaceUrl:u,AfterHandleFunc:m,request:_,linkUrl:O,actionCfg:C}=t;if(_){const z=await w.getProxyData({type:"dynamic",interfaceUrl:u,handlerFunc:m},{},{...e});y.value=z}else y.value=e||{};switch(f){case"modal":N.value={id:n,modalUrl:C==null?void 0:C.interfaceUrl},D.value=!0;break;case"link":window.open(w.parseString(O,y.value),"_blank");break}},H=()=>{y.value={},D.value=!1},Y=()=>{w.getProxyData({type:"dynamic",interfaceUrl:N.value.modalUrl,handlerFunc:""},{},{...y.value}).then(t=>{var e;j.info((e=t==null?void 0:t.data)==null?void 0:e.msg),H()}).catch(t=>{j.error(t)})};return(t,e)=>{const n=sa,f=pa,u=ma,m=ca,_=_a,O=ia,C=ga,z=ya,aa=la;return d(),U(T,null,[V("div",ba,[M.value?(d(),I(m,{key:0,class:"filter-panel"},{default:s(()=>[l(J,{formData:x.value,id:a.value.global.filterCfg.formId,class:ra(["filter-form",h.value?"expand":""])},null,8,["formData","id","class"]),l(u,null,{default:s(()=>[l(f,{span:24,style:{"text-align":"right"}},{default:s(()=>[l(n,{type:"primary","html-type":"submit",onClick:k},{default:s(()=>[F("搜索")]),_:1}),l(n,{style:{margin:"0 8px"},onClick:K},{default:s(()=>[F("重置")]),_:1}),l(n,{type:"link",icon:Z(h.value?A(da):A(fa)),onClick:e[0]||(e[0]=o=>h.value=!h.value)},{default:s(()=>[V("span",wa,B(h.value?"收起":"展开"),1)]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})):S("",!0),l(m,{class:"table-container"},{default:s(()=>[V("div",xa,[l(_,null,{default:s(()=>[(d(!0),U(T,null,G(R.value,o=>(d(),I(n,{key:o.id,onClick:b=>E(o)},{default:s(()=>[F(B(o.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),l(n,{icon:Z(A(va)),type:"link",title:"刷新数据",style:{float:"right"},onClick:k},null,8,["icon"])]),l(C,{columns:W.value,"data-source":v.value,scroll:{y:M.value?400:650},loading:P.value,pagination:!1},{bodyCell:s(({column:o,record:b})=>[o.type=="image"?(d(),I(O,{key:0,src:`${b[o.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):S("",!0),o.type=="link"?(d(),U("a",{key:1,href:`${b[o.dataIndex]}`,target:"_blank"},B(b[o.dataIndex]),9,Da)):S("",!0),o.key=="_action"?(d(!0),U(T,{key:2},G($.value,L=>(d(),I(n,{type:"link",onClick:Ia=>E(L,b),key:L.id},{default:s(()=>[F(B(L.name),1)]),_:2},1032,["onClick"]))),128)):S("",!0)]),_:1},8,["columns","data-source","scroll","loading"]),l(z,{style:{display:"flex","justify-content":"flex-end","margin-top":"20px"},current:g.value.pageNumber,"onUpdate:current":e[1]||(e[1]=o=>g.value.pageNumber=o),pageSize:g.value.pageSize||10,total:q.value,"show-less-items":""},null,8,["current","pageSize","total"])]),_:1})]),l(aa,{open:D.value,"onUpdate:open":e[2]||(e[2]=o=>D.value=o),onOk:Y,onCancel:H},{default:s(()=>[l(J,{formData:y.value,id:N.value.id},null,8,["formData","id"])]),_:1},8,["open"])],64)}}}),Ya=ua(Ua,[["__scopeId","data-v-fb8602ee"]]);export{Ya as default};
