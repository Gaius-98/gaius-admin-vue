import{aA as ue,r as i,ay as ce,U as pe,d as q,E as J,l as j,F as y,M as U,G as T,H as t,W as H,g as e,I as n,N as b,V as $,a0 as de,O as me,X as Z,aE as fe,av as _e,aF as ve,aG as be,h as X,R as ye,v as ge,az as he,Q as Y,a2 as Se,a3 as Ce}from"./index-DBvavrl4.js";import{S as z}from"./SchemaForm-Cj8jC-Tu.js";import{D as De}from"./DragTableHeader-ButaRztE.js";import{h as we}from"./http-DlIDHlKe.js";import{t as E}from"./table-Cr5Oe34j.js";import{_ as ke}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-CCpeV5QJ.js";import{C as xe,_ as Ie,a as Ve,T as Te,b as Fe}from"./index-D3tz_IuI.js";import{S as Re}from"./SyncOutlined--RepSyxa.js";import{B as ee,_ as Ue}from"./index-DAGcGbMr.js";import{I as $e}from"./index-BxU6gPb3.js";import{_ as Ae}from"./index-BacOjwHg.js";import{E as Oe}from"./EditTable-CU7un1po.js";import{M as Be}from"./index-COU5MUdz.js";import{S as Ne}from"./index-ajrj1XQi.js";import{T as Pe}from"./index-Gnlru6qg.js";import{_ as ze}from"./index-DefPhBDq.js";import{_ as Ee}from"./index-DUQh8Act.js";import"./index-DkNoPK5x.js";import"./SwapRightOutlined-DKzuAbtf.js";import"./index-DgqE6CCS.js";import"./initDefaultProps-B16bGYVp.js";import"./index-GBZWbRmY.js";import"./index-CY08g9WH.js";import"./index-Cc25PI9G.js";import"./vue-draggable-next.esm-bundler-jKx15RdZ.js";import"./SwapOutlined-BENC58zi.js";import"./DeleteOutlined-C8A3Lx6s.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-BA-GZqds.js";import"./index-BX8_qfW5.js";import"./common-B5-K1HTv.js";import"./form-5nZ0ggrj.js";import"./index-WcLF7Acp.js";import"./PlusOutlined-DLOqF6K1.js";import"./index-CJPtdA_V.js";import"./FolderOutlined-BWfFzhXv.js";import"./index-OgT7q4Df.js";import"./useBreakpoint-CMuEWdAM.js";import"./PlusCircleOutlined-Bhp8MQwE.js";import"./ActionButton-Cdk-Q_Nl.js";import"./useDestroyed-DivsZDkl.js";import"./ArrowRightOutlined-DE_c2l_4.js";import"./index-DEKXkQu9.js";import"./index-sDrP8k2S.js";const Q=ue("tableDesign",()=>{const D=i([]),d=i({name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),u=i({}),g=()=>{const o=new Date().getTime().toString().slice(-4);d.value.columns.push({id:ce(),dataIndex:"field"+o,title:"列"+o})},a=(o,l)=>{const r=l.findIndex(m=>m.id===o);r!=-1&&(u.value=l[r])},w=(o,l)=>{const r=l.findIndex(m=>m.id===o);r!=-1&&l.splice(r,1)},x=()=>{const o={};return d.value.variablePool.reduce((l,r)=>(l[r.key]=r.defaultValue,l),o),o},h=async o=>{try{const l=await we.run(d.value.dataSource.interfaceUrl,x());return new Function("res",o||d.value.dataSource.handlerFunc)(l.data)}catch(l){return l}},_=i(!1);return{tableCfg:d,currentColumn:u,onSelectColumn:a,onRemoveColumn:w,onAddColumn:g,tableData:D,onRefreshData:h,saveLoading:_,onSave:async()=>{_.value=!0;const{code:o,msg:l}=await E.add(d.value);o==200&&pe.success(l),_.value=!1}}}),Le={class:"table-design-container"},Me={class:"tools",style:{"margin-bottom":"5px"}},Ke=["href"],Ge=q({__name:"TableDesign",setup(D){const d=Q(),{tableCfg:u,tableData:g}=J(d),{onSelectColumn:a,onRemoveColumn:w,onAddColumn:x,onRefreshData:h}=d,_=f=>{a(f.id,u.value.columns)},c=f=>{w(f.id,u.value.columns)},o=i(0),l=()=>{h().then(f=>{const{data:S,total:C}=f;S&&(g.value=S),C&&(o.value=C)})},r=j(()=>{var f,S;return((f=u.value.global.filterCfg)==null?void 0:f.show)&&((S=u.value.global.filterCfg)==null?void 0:S.formId)}),m=i({});return(f,S)=>{const C=ee,A=Ie,L=Ve,O=xe,I=$e,B=Ae;return y(),U("div",Le,[r.value?(y(),T(O,{key:0,class:"filter-panel"},{default:t(()=>[e(ke,{formData:m.value,id:n(u).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),e(L,null,{default:t(()=>[e(A,{span:24,style:{"text-align":"right"}},{default:t(()=>[e(C,{type:"primary","html-type":"submit"},{default:t(()=>[b("搜索")]),_:1}),e(C,{style:{margin:"0 8px"}},{default:t(()=>[b("重置")]),_:1})]),_:1})]),_:1})]),_:1})):H("",!0),e(O,{class:"table-container"},{default:t(()=>[$("div",Me,[e(C,{type:"primary",onClick:n(x)},{default:t(()=>[b("新增列")]),_:1},8,["onClick"]),e(C,{icon:de(n(Re)),type:"link",title:"刷新数据",style:{float:"right"},onClick:l},null,8,["icon"])]),e(De,{modelValue:n(u).columns,"onUpdate:modelValue":S[0]||(S[0]=v=>n(u).columns=v),onOnClick:_,onOnRemove:c},null,8,["modelValue"]),e(B,{showHeader:!1,columns:n(u).columns,"data-source":n(g),scroll:{y:r.value?300:500},pagination:{total:o.value}},{bodyCell:t(({column:v,record:F})=>[v&&v.type=="image"?(y(),T(I,{key:0,src:`${F[v.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):H("",!0),v&&v.type=="link"?(y(),U("a",{key:1,href:`${F[v.dataIndex]}`,target:"_blank"},me(F[v.dataIndex]),9,Ke)):H("",!0)]),_:1},8,["columns","data-source","scroll","pagination"])]),_:1})])}}}),He=Z(Ge,[["__scopeId","data-v-e747d4c1"]]),je={key:1},qe=q({__name:"TableCfg",setup(D){const d=Q(),u=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"string",label:"字段名"},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:!1,label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),g=i("column"),a=i({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"pagination.pageSize":{type:"number",label:"每页条数"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(c=>{setTimeout(()=>{c(w.value)},100)})}}}}),w=i([]);E.getFormList().then(_=>{const{code:c,data:o,msg:l}=_;c==200&&(w.value=o.map(r=>({value:r.id,label:r.name})))});const{tableCfg:x,currentColumn:h}=J(d);return(_,c)=>{const o=fe,l=Fe,r=Te;return y(),T(r,{activeKey:g.value,"onUpdate:activeKey":c[0]||(c[0]=m=>g.value=m)},{default:t(()=>[e(l,{key:"column",tab:"列配置"},{default:t(()=>[n(h).id?(y(),T(n(z),{layout:u.value.layout,properties:u.value.properties,formData:n(h),key:n(h).id},null,8,["layout","properties","formData"])):(y(),U("div",je,[e(o)]))]),_:1}),e(l,{key:"global",tab:"全局配置"},{default:t(()=>[e(n(z),{layout:a.value.layout,properties:a.value.properties,formData:n(x).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),te=D=>(Se("data-v-d9219f6e"),D=D(),Ce(),D),Je={class:"table-design"},Qe={class:"left-part"},We={class:"right-part"},Xe=te(()=>$("span",null,"(res)=>{",-1)),Ye=te(()=>$("span",null,"}",-1)),Ze=q({__name:"TableEditor",props:{id:{}},setup(D){const d=D,{id:u}=_e(d),g=Q(),{tableCfg:a,tableData:w,saveLoading:x}=J(g),{onRefreshData:h,onSave:_}=g,c=i({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),o=i("");u.value?E.getDetail(u.value).then(V=>{const{code:s,data:k,msg:R}=V;s==200&&(a.value=k,h().then(N=>{const{data:P}=N;P&&(w.value=P)}))}):(a.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,actionCfg:{add:{show:!1,formId:""},edit:{show:!1,formId:""},view:{show:!1,formId:""}},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[{key:"pageNumber",defaultValue:"1"},{key:"pageSize",defaultValue:"10"}]},c.value=a.value.dataSource,w.value=[]);const l=j(()=>a.value.name?a.value.name:"新建表格"),r=j(()=>a.value.description?a.value.description:""),m=i(!1),f=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),S=()=>{m.value=!0},C=ve(),A=()=>{C.go(-1)},L=()=>{_(),m.value=!1,A()},O=()=>{C.push({path:"/low-code/preview-table",query:{id:a.value.id}})},I=i(!1),B=i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:V,data:s,msg:k}=await E.getApiList();return V==200?s.map(R=>({value:R.id,label:R.apiName})):[]}}}}}),v=()=>{c.value=a.value.dataSource,I.value=!0},F=()=>{a.value.dataSource=c.value,W()},W=()=>{I.value=!1},M=i(!1),ae=async()=>await h(),oe=async()=>{M.value=!0;const V=await ae();M.value=!1,o.value=JSON.stringify(V,null,2)},K=i(!1),le=i([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),ne=()=>{K.value=!0};return(V,s)=>{const k=ee,R=Ne,N=Pe,P=ze,G=Be,se=Ue,re=Ee,ie=be("loading");return y(),U(ye,null,[e(P,{title:l.value,subTitle:r.value,onBack:A,ghost:!1,style:{padding:"10px 24px"}},{extra:t(()=>[e(R,null,{default:t(()=>[e(k,{onClick:v},{default:t(()=>[b(" 数据源配置 ")]),_:1}),e(k,{onClick:ne},{default:t(()=>[b(" 变量池配置 ")]),_:1}),X(e(k,{onClick:O},{default:t(()=>[b(" 预览 ")]),_:1},512),[[ge,n(a).id]]),e(k,{onClick:S,type:"primary"},{default:t(()=>[b(" 保存 ")]),_:1})]),_:1})]),tags:t(()=>[n(a).status?(y(),T(N,{key:0,color:"#87d068"},{default:t(()=>[b("启用")]),_:1})):(y(),T(N,{key:1,color:"#f50"},{default:t(()=>[b("停用")]),_:1}))]),_:1},8,["title","subTitle"]),X((y(),U("div",Je,[$("div",Qe,[e(He)]),$("div",We,[e(qe)])])),[[ie,n(x),void 0,{fullscreen:!0}]]),e(G,{open:m.value,"onUpdate:open":s[1]||(s[1]=p=>m.value=p),title:"保存",onOk:L},{default:t(()=>[e(n(z),{formData:n(a),"onUpdate:formData":s[0]||(s[0]=p=>he(a)?a.value=p:null),layout:f.value.layout,properties:f.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e(G,{open:I.value,"onUpdate:open":s[5]||(s[5]=p=>I.value=p),title:"数据源配置",onOk:F,onCancel:W},{default:t(()=>[e(n(z),{layout:B.value.layout,properties:B.value.properties,formData:c.value,"onUpdate:formData":s[2]||(s[2]=p=>c.value=p)},null,8,["layout","properties","formData"]),e(se,{label:"数据预处理",tooltip:"请保证输出的数据格式为:{data:any[],total:number}"},{default:t(()=>[Xe,e(Y,{height:200,modelValue:c.value.handlerFunc,"onUpdate:modelValue":s[3]||(s[3]=p=>c.value.handlerFunc=p)},null,8,["modelValue"]),Ye]),_:1}),e(re,null,{default:t(()=>[b("结果区")]),_:1}),e(k,{type:"primary",style:{"margin-bottom":"5px"},onClick:oe,loading:M.value},{default:t(()=>[b("运行")]),_:1},8,["loading"]),e(Y,{height:200,disabled:"",modelValue:o.value,"onUpdate:modelValue":s[4]||(s[4]=p=>o.value=p)},null,8,["modelValue"])]),_:1},8,["open"]),e(G,{title:"变量池配置",open:K.value,footer:!1,onCancel:s[7]||(s[7]=p=>K.value=!1)},{default:t(()=>[e(Oe,{columns:le.value,modelValue:n(a).variablePool,"onUpdate:modelValue":s[6]||(s[6]=p=>n(a).variablePool=p)},null,8,["columns","modelValue"])]),_:1},8,["open"])],64)}}}),Kt=Z(Ze,[["__scopeId","data-v-d9219f6e"]]);export{Kt as default};
