import{r as f,c as x,_ as ae}from"./index-Ov7V3_zZ.js";import{g as oe,m as le,r as d,n as S,K as ne,o as k,q as Y,l as t,w as l,e as z,ac as re,ad as se,ae as ue,I as T,F as de,Q as N,h as R,af as ie,aD as pe,a0 as me,ag as ce,X as ve,J as _e,ai as fe,aj as ge,a1 as be,a6 as ye}from"./.pnpm-8LtkOrH2.js";const g={getList:i=>f({method:"get",url:"business/report/list",params:i}),getDetail:i=>f({method:"get",url:"business/report/detail",params:{id:i}}),remove:i=>f({method:"get",url:"business/report/remove",params:{id:i}}),add:i=>f({method:"post",url:"business/report/add",data:i}),update:i=>f({method:"post",url:"business/report/update",data:i})},ke={class:"report"},Te=oe({__name:"ReportView",setup(i){const u=le({keyword:"",pageNumber:1,pageSize:10,startTime:"",endTime:""}),m=d(""),V=()=>{m.value?(u.startTime=m.value[0],u.endTime=m.value[1]):(u.startTime="",u.endTime="")},I=d([]),B=d([{title:"采集设备编号",key:"deviceId",dataIndex:"deviceId",width:"250px"},{title:"PM2.5浓度",key:"pm",dataIndex:"pm"},{title:"甲醛浓度",key:"fa",dataIndex:"fa"},{title:"TOVC",key:"tovc",dataIndex:"tovc"},{title:"温度",key:"temp",dataIndex:"temp"},{title:"湿度",key:"rh",dataIndex:"rh"},{title:"采集时间",key:"createTime",dataIndex:"createTime"},{title:"操作",key:"action",dataIndex:"action",width:"250px"}]),h=d(!1),D=d(),P=()=>{var a;(a=D.value)==null||a.resetFields(),u.startTime="",u.endTime="",m.value="",c()},F=d(0),L=()=>{u.pageNumber=1,u.pageSize=10,c()},$=a=>{const{current:e,pageSize:r}=a;u.pageNumber=e,u.pageSize=r,c()},c=()=>{h.value=!0,g.getList(u).then(a=>{const{code:e,data:r}=a;e==200&&(I.value=r.data,F.value=r.total),h.value=!1})},w=d([]),j=d({}),E=d([]),H=d([]);S(()=>{c(),x.getOrgTree().then(a=>{const{code:e,data:r,msg:s}=a;e==200&&(E.value=r)}),x.getAllUser().then(a=>{const{code:e,data:r,msg:s}=a;e==200&&(H.value=r)}),x.getDict(["reportBelongType"]).then(a=>{const{code:e,data:r,msg:s}=a;e==200&&(w.value=r.reportBelongType,j.value=w.value.reduce((p,_)=>(p[_.value]=_.label,p),{}))})});const b=d(!1),n=d({deviceId:"",fa:"",rh:"",temp:"",createTime:"",tovc:"",pm:""}),y=d("add"),A=ne(()=>({add:"新增记录",edit:"编辑记录"})[y.value]),C=d(),J=async a=>{const{code:e,data:r}=await g.getDetail(a.id);e==200&&(n.value=r,y.value="edit",b.value=!0)},K=async a=>{const{code:e,msg:r,data:s}=await g.remove(a.id);e==200&&(z.success(s),c())},U=()=>{var a;(a=C.value)==null||a.resetFields()},Q=()=>{var a;(a=C.value)==null||a.validate().then(()=>{let e;y.value=="add"?e=g.add:e=g.update,e(n.value).then(r=>{const{code:s}=r;s==200&&(z.success(y.value=="add"?"新增成功":"编辑成功"),c()),U(),b.value=!1})})};return S(()=>{}),(a,e)=>{const r=pe,s=me,p=ce,_=ve,q=re,X=_e,G=fe,W=ge,v=be,Z=ye,ee=se,M=ue("has-perm");return k(),Y("div",ke,[t(q,{class:"search-area"},{default:l(()=>[t(_,{ref_key:"searchFormRef",ref:D,model:u,layout:"inline",onFinish:L},{default:l(()=>[t(s,{label:"记录时间"},{default:l(()=>[t(r,{value:m.value,"onUpdate:value":e[0]||(e[0]=o=>m.value=o),valueFormat:"YYYY-MM-DD",onChange:e[1]||(e[1]=o=>V())},null,8,["value"])]),_:1}),t(s,null,{default:l(()=>[t(p,{type:"primary","html-type":"submit"},{default:l(()=>[T("搜索")]),_:1}),t(p,{style:{margin:"0 8px"},onClick:P},{default:l(()=>[T(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(q,null,{default:l(()=>[t(W,{loading:h.value,columns:B.value,"data-source":I.value,scroll:{y:560},onChange:$,pagination:{current:u.pageNumber,total:F.value,showSizeChanger:!0,pageSize:u.pageSize}},{bodyCell:l(({column:o,record:O})=>[o.key=="action"?(k(),Y(de,{key:0},[N((k(),R(p,{type:"link",onClick:te=>J(O)},{default:l(()=>[T("编辑")]),_:2},1032,["onClick"])),[[M,"business:report:update"]]),t(X,{type:"vertical"}),t(G,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:te=>K(O)},{default:l(()=>[N((k(),R(p,{type:"link",danger:""},{default:l(()=>[T("删除")]),_:1})),[[M,"business:report:remove"]])]),_:2},1032,["onConfirm"])],64)):ie("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),t(ee,{open:b.value,"onUpdate:open":e[9]||(e[9]=o=>b.value=o),onOk:Q,title:A.value,onCancel:U},{default:l(()=>[t(_,{model:n.value,"label-col":{span:8},ref_key:"modalFormRef",ref:C},{default:l(()=>[t(s,{label:"采集设备编号",required:"",prop:"deviceId"},{default:l(()=>[t(v,{value:n.value.deviceId,"onUpdate:value":e[2]||(e[2]=o=>n.value.deviceId=o),disabled:""},null,8,["value"])]),_:1}),t(s,{label:"PM2.5浓度",required:"",prop:"pm"},{default:l(()=>[t(v,{value:n.value.pm,"onUpdate:value":e[3]||(e[3]=o=>n.value.pm=o)},null,8,["value"])]),_:1}),t(s,{label:"甲醛浓度",required:"",prop:"fa"},{default:l(()=>[t(v,{value:n.value.fa,"onUpdate:value":e[4]||(e[4]=o=>n.value.fa=o)},null,8,["value"])]),_:1}),t(s,{label:"TOVC",required:"",prop:"tovc"},{default:l(()=>[t(v,{value:n.value.tovc,"onUpdate:value":e[5]||(e[5]=o=>n.value.tovc=o)},null,8,["value"])]),_:1}),t(s,{label:"温度",required:"",prop:"temp"},{default:l(()=>[t(v,{value:n.value.temp,"onUpdate:value":e[6]||(e[6]=o=>n.value.temp=o)},null,8,["value"])]),_:1}),t(s,{label:"湿度",required:"",prop:"rh"},{default:l(()=>[t(v,{value:n.value.rh,"onUpdate:value":e[7]||(e[7]=o=>n.value.rh=o)},null,8,["value"])]),_:1}),t(s,{label:"采集时间",prop:"createTime",required:""},{default:l(()=>[t(Z,{value:n.value.createTime,"onUpdate:value":e[8]||(e[8]=o=>n.value.createTime=o),valueFormat:"YYYY-MM-DD HH:mm:ss",showTime:"",disabled:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),xe=ae(Te,[["__scopeId","data-v-2b472a0b"]]);export{xe as default};
