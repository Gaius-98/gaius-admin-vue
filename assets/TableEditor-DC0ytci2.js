import{S as w}from"./SchemaForm-BnpUs6YG.js";import{D as ae,_ as F}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-XgRatv7t.js";import{ax as oe,r as s,d as O,H as $,D as S,E as z,g as e,J as o,K as u,F as N,I as k,aB as le,at as ne,p as E,aC as se,V as C,N as re,t as ue,Q as v,$ as ie,a0 as pe}from"./index-DIkwqaEE.js";import{C as ce,T as de,_ as me}from"./ActionButton-NwnU_d6L.js";import{_ as fe}from"./index-Dbf5_CLT.js";import{a as K}from"./table-DBm7hz1L.js";import{E as _e,h as ve}from"./EditTable-DECEMEsT.js";import{M as be}from"./index-C5T6uAjf.js";import{B as ye,_ as ge}from"./index-BkIIxGqr.js";import{S as Se}from"./index-DN_qLpea.js";import{T as he}from"./index-CkmgvE2e.js";import{_ as Ce}from"./index-DxrKeQxp.js";import{_ as xe}from"./index-BQuAZ-e4.js";import"./index-B9n-8M05.js";import"./index-DQzf80sK.js";import"./SwapRightOutlined-CSeOIzR_.js";import"./index-BJXTzkju.js";import"./vue-draggable-next.esm-bundler-Ium-4wIw.js";import"./SwapOutlined-BvIjkjrw.js";import"./index-CVDqtBLV.js";import"./PlusOutlined-iYm7Nlcs.js";import"./FolderOutlined-DycXbaRz.js";import"./PlusCircleOutlined-CIXKynwQ.js";import"./ArrowRightOutlined-DFjGrDD-.js";import"./index-V2S14gwi.js";const B=oe("tableDesign",()=>{const d=s({name:"",description:"",status:1,columns:[{id:"1",title:"测试",dataIndex:"test",type:"text"},{id:"2",title:"测试3",dataIndex:"test4",type:"text"}],global:{bordered:!1,pagination:{show:!1,current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[],img:""}),m=s({});return{tableCfg:d,currentColumn:m,onSelectColumn:(a,l)=>{const n=l.findIndex(f=>f.id===a);n!=-1&&(m.value=l[n])},onRemoveColumn:(a,l)=>{const n=l.findIndex(f=>f.id===a);n!=-1&&l.splice(n,1)}}}),De={class:"table-design-container"},we=O({__name:"TableDesign",setup(d){const m=B(),{tableCfg:p}=$(m),{onSelectColumn:b}=m,a=s([{test:1,test4:"e"}]),l=n=>{b(n.id,p.value.columns)};return(n,f)=>{const y=ce,_=fe;return S(),z("div",De,[e(y,{class:"filter-panel"}),e(y,{class:"table-container"},{default:o(()=>[e(ae,{modelValue:u(p).columns,"onUpdate:modelValue":f[0]||(f[0]=g=>u(p).columns=g),onOnClick:l},null,8,["modelValue"]),e(_,{showHeader:!1,columns:u(p).columns,"data-source":a.value},null,8,["columns","data-source"])]),_:1})])}}}),ke=N(we,[["__scopeId","data-v-2c841b33"]]),Ve={key:1},Te=O({__name:"TableCfg",setup(d){const m=B(),p=s({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"string",label:"字段名"},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左固定"},{value:"right",label:"右固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),b=s("column"),a=s({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"pagination.show":{type:"switch",label:"是否分页"},"pagination.pageSize":{type:"number",label:"每页条数",show:"${formData.pagination.show}"}}}),{tableCfg:l,currentColumn:n}=$(m);return(f,y)=>{const _=le,g=me,V=de;return S(),k(V,{activeKey:b.value,"onUpdate:activeKey":y[0]||(y[0]=T=>b.value=T)},{default:o(()=>[e(g,{key:"column",tab:"列配置"},{default:o(()=>[u(n).id?(S(),k(u(w),{layout:p.value.layout,properties:p.value.properties,formData:u(n),key:u(n).id},null,8,["layout","properties","formData"])):(S(),z("div",Ve,[e(_)]))]),_:1}),e(g,{key:"global",tab:"全局配置"},{default:o(()=>[e(u(w),{layout:a.value.layout,properties:a.value.properties,formData:u(l).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),M=d=>(ie("data-v-96fb0fc1"),d=d(),pe(),d),Ie={class:"table-design"},Ue={class:"left-part"},Fe={class:"right-part"},Oe=M(()=>C("span",null,"(res)=>{",-1)),$e=M(()=>C("span",null,"}",-1)),ze=O({__name:"TableEditor",props:{id:{}},setup(d){const m=d,{id:p}=ne(m),b=B(),{tableCfg:a}=$(b),l=s({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),n=s("");p.value?K.getDetail(p.value).then(c=>{const{code:t,data:i,msg:h}=c;t==200&&(a.value=i)}):(a.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,pagination:{show:!1,current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},img:"",variablePool:[]},l.value=a.value.dataSource),ue("registeredComponents",{"code-editor":F});const f=E(()=>a.value.name?a.value.name:"新建表格"),y=E(()=>a.value.description?a.value.description:""),_=s(!1),g=s({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),V=()=>{_.value=!0},T=se(),H=()=>{T.go(-1)},J=()=>{_.value=!1},I=s(!1);s({});const j=()=>{I.value=!0},x=s(!1),P=s({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:c,data:t,msg:i}=await K.getApiList();return c==200?t.map(h=>({value:h.id,label:h.apiName})):[]}}}}}),G=()=>{x.value=!0},L=()=>{a.value.dataSource=l.value,R()},R=()=>{l.value={type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},x.value=!1},Q=()=>{let c={};return a.value.variablePool.reduce((t,i)=>(t[i.key]=i.defaultValue,t),c),c},q=async()=>{const c=await ve.run(a.value.dataSource.interfaceUrl,Q());return new Function("res",`${l.value.handlerFunc}`)(c.data)},W=async()=>{const c=await q();n.value=JSON.stringify(c,null,2)},U=s(!1),X=s([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),Y=()=>{U.value=!0};return(c,t)=>{const i=ye,h=Se,A=he,Z=Ce,D=be,ee=ge,te=xe;return S(),z(re,null,[e(Z,{title:f.value,subTitle:y.value,onBack:H,ghost:!1,style:{padding:"10px 24px"}},{extra:o(()=>[e(h,null,{default:o(()=>[e(i,{onClick:G},{default:o(()=>[v(" 数据源配置 ")]),_:1}),e(i,{onClick:Y},{default:o(()=>[v(" 变量池配置 ")]),_:1}),e(i,{onClick:j},{default:o(()=>[v(" 预览 ")]),_:1}),e(i,{onClick:V,type:"primary"},{default:o(()=>[v(" 保存 ")]),_:1})]),_:1})]),tags:o(()=>[u(a).status?(S(),k(A,{key:0,color:"#87d068"},{default:o(()=>[v("启用")]),_:1})):(S(),k(A,{key:1,color:"#f50"},{default:o(()=>[v("停用")]),_:1}))]),_:1},8,["title","subTitle"]),C("div",Ie,[C("div",Ue,[e(ke)]),C("div",Fe,[e(Te)])]),e(D,{open:_.value,"onUpdate:open":t[0]||(t[0]=r=>_.value=r),title:"保存",onOk:J},{default:o(()=>[e(u(w),{layout:g.value.layout,properties:g.value.properties},null,8,["layout","properties"])]),_:1},8,["open"]),e(D,{open:I.value,"onUpdate:open":t[1]||(t[1]=r=>I.value=r),title:"预览"},null,8,["open"]),e(D,{open:x.value,"onUpdate:open":t[5]||(t[5]=r=>x.value=r),title:"数据源配置",onOk:L,onCancel:R},{default:o(()=>[e(u(w),{layout:P.value.layout,properties:P.value.properties,formData:l.value,"onUpdate:formData":t[2]||(t[2]=r=>l.value=r)},null,8,["layout","properties","formData"]),e(ee,{label:"数据预处理"},{default:o(()=>[Oe,e(F,{height:200,modelValue:l.value.handlerFunc,"onUpdate:modelValue":t[3]||(t[3]=r=>l.value.handlerFunc=r)},null,8,["modelValue"]),$e]),_:1}),e(te,null,{default:o(()=>[v("结果区")]),_:1}),e(i,{type:"primary",style:{"margin-bottom":"5px"},onClick:W},{default:o(()=>[v("运行")]),_:1}),e(F,{height:200,disabled:"",modelValue:n.value,"onUpdate:modelValue":t[4]||(t[4]=r=>n.value=r)},null,8,["modelValue"])]),_:1},8,["open"]),e(D,{title:"变量池配置",open:U.value,footer:!1,onCancel:t[7]||(t[7]=r=>U.value=!1)},{default:o(()=>[e(_e,{columns:X.value,modelValue:u(a).variablePool,"onUpdate:modelValue":t[6]||(t[6]=r=>u(a).variablePool=r)},null,8,["columns","modelValue"])]),_:1},8,["open"])],64)}}}),st=N(ze,[["__scopeId","data-v-96fb0fc1"]]);export{st as default};
