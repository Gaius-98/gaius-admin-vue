import{ay as ue,r as u,aw as ce,R as pe,d as H,B as j,p as G,D as g,I as R,E as V,F as a,U as M,g as e,G as s,M as v,S as $,Z as de,N as me,V as W,aC as fe,au as _e,aD as ve,aE as ge,h as Z,K as be,v as ye,ax as he,O as Q,a0 as Se,a1 as Ce}from"./index-BSdDcxy1.js";import{S as B}from"./SchemaForm-D2pLUDgA.js";import{D as we}from"./DragTableHeader-DbH11n9B.js";import{h as De}from"./http-lIHxdq_J.js";import{t as P}from"./table-2Yq-6hmN.js";import"./html2canvas.esm-BfYXEYrK.js";import{_ as xe}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-DSJphvNf.js";import{C as ke,_ as Ie,a as Ve,T as Te,b as Ue}from"./index-8hKc2vZH.js";import{S as Re}from"./SyncOutlined-DtXg2mvK.js";import{B as X,_ as $e}from"./index-oSfz28Wk.js";import{I as Fe}from"./index-8WB2pHwJ.js";import{_ as Oe}from"./index-B0ql1PC7.js";import{E as ze}from"./EditTable-aXCPIYaP.js";import{M as Ae}from"./index-CIgP1QkD.js";import{S as Be}from"./index-CEZ3c-oU.js";import{T as Pe}from"./index-DQQMAY1B.js";import{a as Ee}from"./LowCodeForm.vue_vue_type_script_setup_true_lang-C6dADsNr.js";import{_ as Ne}from"./index-DeAm9cFV.js";import"./index-0Qqqm7Re.js";import"./SwapRightOutlined-CZJQlYfE.js";import"./index-CrlCD_R0.js";import"./index-Dp01n4fF.js";import"./index-fZjIwXzh.js";import"./vue-draggable-next.esm-bundler-TU4Khger.js";import"./SwapOutlined-C2I26g_u.js";import"./DeleteOutlined-BDtT9prE.js";import"./form-BtrBBQPD.js";import"./index-CMg9c0Jg.js";import"./PlusOutlined-QSB-UYI-.js";import"./FolderOutlined-xL4zft_w.js";import"./PlusCircleOutlined-BFVwOAFK.js";import"./ActionButton-C8ADpHxy.js";import"./ArrowRightOutlined-hJYgmJJ9.js";import"./index-tjHfoMNm.js";import"./index-C4_jCVHg.js";import"./common-CMFQHmzD.js";const q=ue("tableDesign",()=>{const S=u([]),m=u({name:"",description:"",status:1,columns:[],global:{bordered:!1,pagination:{show:!1,current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:""},variablePool:[]}),c=u({}),b=()=>{const o=new Date().getTime().toString().slice(-4);m.value.columns.push({id:ce(),dataIndex:"field"+o,title:"列"+o})},t=(o,l)=>{const i=l.findIndex(n=>n.id===o);i!=-1&&(c.value=l[i])},C=(o,l)=>{const i=l.findIndex(n=>n.id===o);i!=-1&&l.splice(i,1)},D=()=>{const o={};return m.value.variablePool.reduce((l,i)=>(l[i.key]=i.defaultValue,l),o),o},y=async o=>{try{const l=await De.run(m.value.dataSource.interfaceUrl,D());return new Function("res",o||m.value.dataSource.handlerFunc)(l.data)}catch(l){return l}},_=u(!1);return{tableCfg:m,currentColumn:c,onSelectColumn:t,onRemoveColumn:C,onAddColumn:b,tableData:S,onRefreshData:y,saveLoading:_,onSave:async()=>{_.value=!0;const{code:o,msg:l}=await P.add(m.value);o==200&&pe.success(l),_.value=!1}}}),Ke={class:"table-design-container"},Le={class:"tools"},Me=["href"],Ge=H({__name:"TableDesign",setup(S){const m=q(),{tableCfg:c,tableData:b}=j(m),{onSelectColumn:t,onRemoveColumn:C,onAddColumn:D,onRefreshData:y}=m,_=n=>{t(n.id,c.value.columns)},p=n=>{C(n.id,c.value.columns)},o=()=>{y().then(n=>{b.value=n})},l=G(()=>{var n,h;return((n=c.value.global.filterCfg)==null?void 0:n.show)&&((h=c.value.global.filterCfg)==null?void 0:h.formId)}),i=u({});return(n,h)=>{const x=X,F=Ie,O=Ve,z=ke,E=Fe,k=Oe;return g(),R("div",Ke,[l.value?(g(),V(z,{key:0,class:"filter-panel"},{default:a(()=>[e(xe,{formData:i.value,"onUpdate:formData":h[0]||(h[0]=f=>i.value=f),id:s(c).global.filterCfg.formId,style:{"overflow-y":"auto","max-height":"120px","margin-bottom":"10px"}},null,8,["formData","id"]),e(O,null,{default:a(()=>[e(F,{span:24,style:{"text-align":"right"}},{default:a(()=>[e(x,{type:"primary","html-type":"submit"},{default:a(()=>[v("搜索")]),_:1}),e(x,{style:{margin:"0 8px"}},{default:a(()=>[v("清空")]),_:1})]),_:1})]),_:1})]),_:1})):M("",!0),e(z,{class:"table-container"},{default:a(()=>[$("div",Le,[e(x,{type:"primary",onClick:s(D)},{default:a(()=>[v("新增列")]),_:1},8,["onClick"]),e(x,{icon:de(s(Re)),type:"link",title:"刷新数据",style:{float:"right"},onClick:o},null,8,["icon"])]),e(we,{modelValue:s(c).columns,"onUpdate:modelValue":h[1]||(h[1]=f=>s(c).columns=f),onOnClick:_,onOnRemove:p},null,8,["modelValue"]),e(k,{showHeader:!1,columns:s(c).columns,"data-source":s(b),scroll:{y:l.value?300:500}},{bodyCell:a(({column:f,record:T})=>[f.type=="image"?(g(),V(E,{key:0,src:`${T[f.dataIndex]}`,height:"130px",width:"100%"},null,8,["src"])):M("",!0),f.type=="link"?(g(),R("a",{key:1,href:`${T[f.dataIndex]}`,target:"_blank"},me(T[f.dataIndex]),9,Me)):M("",!0)]),_:1},8,["columns","data-source","scroll"])]),_:1})])}}}),He=W(Ge,[["__scopeId","data-v-fdc81c65"]]),je={key:1},qe=H({__name:"TableCfg",setup(S){const m=q(),c=u({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{dataIndex:{type:"string",label:"字段名"},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左固定"},{value:"right",label:"右固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),b=u("column"),t=u({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"100px"}}},properties:{bordered:{type:"switch",label:"边框"},"pagination.show":{type:"switch",label:"是否分页"},"pagination.pageSize":{type:"number",label:"每页条数",show:"${formData.pagination.show}"},"filterCfg.show":{type:"switch",label:"显示筛选区"},"filterCfg.formId":{type:"select",label:"筛选区表单",show:"${formData.filterCfg.show}",component:{asyncData:async()=>await new Promise(p=>{setTimeout(()=>{p(C.value)},100)})}}}}),C=u([]);P.getFormList().then(_=>{const{code:p,data:o,msg:l}=_;p==200&&(C.value=o.map(i=>({value:i.id,label:i.name})),console.log(C))});const{tableCfg:D,currentColumn:y}=j(m);return(_,p)=>{const o=fe,l=Ue,i=Te;return g(),V(i,{activeKey:b.value,"onUpdate:activeKey":p[0]||(p[0]=n=>b.value=n)},{default:a(()=>[e(l,{key:"column",tab:"列配置"},{default:a(()=>[s(y).id?(g(),V(s(B),{layout:c.value.layout,properties:c.value.properties,formData:s(y),key:s(y).id},null,8,["layout","properties","formData"])):(g(),R("div",je,[e(o)]))]),_:1}),e(l,{key:"global",tab:"全局配置"},{default:a(()=>[e(s(B),{layout:t.value.layout,properties:t.value.properties,formData:s(D).global},null,8,["layout","properties","formData"])]),_:1})]),_:1},8,["activeKey"])}}}),Y=S=>(Se("data-v-ea11017f"),S=S(),Ce(),S),Je={class:"table-design"},Ze={class:"left-part"},Qe={class:"right-part"},We=Y(()=>$("span",null,"(res)=>{",-1)),Xe=Y(()=>$("span",null,"}",-1)),Ye=H({__name:"TableEditor",props:{id:{}},setup(S){const m=S,{id:c}=_e(m),b=q(),{tableCfg:t,tableData:C,saveLoading:D}=j(b),{onRefreshData:y,onSave:_}=b,p=u({interfaceUrl:"",handlerFunc:"return res",type:"dynamic"}),o=u("");c.value?P.getDetail(c.value).then(I=>{const{code:r,data:w,msg:U}=I;r==200&&(t.value=w,y().then(A=>{C.value=A}))}):(t.value={name:"",description:"",status:1,columns:[],global:{bordered:!1,pagination:{show:!1,current:1,pageSize:10,pageSizeOptions:[],total:10},actionCfg:{add:{show:!1,formId:""},edit:{show:!1,formId:""},view:{show:!1,formId:""}},filterCfg:{show:!1,formId:""}},dataSource:{type:"dynamic",interfaceUrl:"",handlerFunc:"return res"},variablePool:[]},p.value=t.value.dataSource);const l=G(()=>t.value.name?t.value.name:"新建表格"),i=G(()=>t.value.description?t.value.description:""),n=u(!1),h=u({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{name:{type:"string",label:"表格名称"},description:{type:"string",label:"备注"},status:{type:"radio",label:"状态",component:{buttonStyle:"solid",dataSource:[{label:"启用",value:1},{label:"停用",value:0}]}}}}),x=()=>{n.value=!0},F=ve(),O=()=>{F.go(-1)},z=()=>{_(),n.value=!1,O()},E=()=>{F.push({path:"/low-code/preview-table",query:{id:t.value.id}})},k=u(!1),f=u({layout:{labelAlign:"left",layout:"horizontal",labelCol:{span:4}},properties:{interfaceUrl:{type:"select",label:"接口地址",component:{asyncData:async()=>{const{code:I,data:r,msg:w}=await P.getApiList();return I==200?r.map(U=>({value:U.id,label:U.apiName})):[]}}}}}),T=()=>{p.value=t.value.dataSource,k.value=!0},ee=()=>{t.value.dataSource=p.value,J()},J=()=>{k.value=!1},N=u(!1),ae=async()=>await y(),te=async()=>{N.value=!0;const I=await ae();N.value=!1,o.value=JSON.stringify(I,null,2)},K=u(!1),oe=u([{title:"Key",dataIndex:"key",type:"input"},{title:"默认值",dataIndex:"defaultValue",type:"input"}]),le=()=>{K.value=!0};return(I,r)=>{const w=X,U=Be,A=Pe,ne=Ee,L=Ae,se=$e,re=Ne,ie=ge("loading");return g(),R(be,null,[e(ne,{title:l.value,subTitle:i.value,onBack:O,ghost:!1,style:{padding:"10px 24px"}},{extra:a(()=>[e(U,null,{default:a(()=>[e(w,{onClick:T},{default:a(()=>[v(" 数据源配置 ")]),_:1}),e(w,{onClick:le},{default:a(()=>[v(" 变量池配置 ")]),_:1}),Z(e(w,{onClick:E},{default:a(()=>[v(" 预览 ")]),_:1},512),[[ye,s(t).id]]),e(w,{onClick:x,type:"primary"},{default:a(()=>[v(" 保存 ")]),_:1})]),_:1})]),tags:a(()=>[s(t).status?(g(),V(A,{key:0,color:"#87d068"},{default:a(()=>[v("启用")]),_:1})):(g(),V(A,{key:1,color:"#f50"},{default:a(()=>[v("停用")]),_:1}))]),_:1},8,["title","subTitle"]),Z((g(),R("div",Je,[$("div",Ze,[e(He)]),$("div",Qe,[e(qe)])])),[[ie,s(D),void 0,{fullscreen:!0}]]),e(L,{open:n.value,"onUpdate:open":r[1]||(r[1]=d=>n.value=d),title:"保存",onOk:z},{default:a(()=>[e(s(B),{formData:s(t),"onUpdate:formData":r[0]||(r[0]=d=>he(t)?t.value=d:null),layout:h.value.layout,properties:h.value.properties},null,8,["formData","layout","properties"])]),_:1},8,["open"]),e(L,{open:k.value,"onUpdate:open":r[5]||(r[5]=d=>k.value=d),title:"数据源配置",onOk:ee,onCancel:J},{default:a(()=>[e(s(B),{layout:f.value.layout,properties:f.value.properties,formData:p.value,"onUpdate:formData":r[2]||(r[2]=d=>p.value=d)},null,8,["layout","properties","formData"]),e(se,{label:"数据预处理"},{default:a(()=>[We,e(Q,{height:200,modelValue:p.value.handlerFunc,"onUpdate:modelValue":r[3]||(r[3]=d=>p.value.handlerFunc=d)},null,8,["modelValue"]),Xe]),_:1}),e(re,null,{default:a(()=>[v("结果区")]),_:1}),e(w,{type:"primary",style:{"margin-bottom":"5px"},onClick:te,loading:N.value},{default:a(()=>[v("运行")]),_:1},8,["loading"]),e(Q,{height:200,disabled:"",modelValue:o.value,"onUpdate:modelValue":r[4]||(r[4]=d=>o.value=d)},null,8,["modelValue"])]),_:1},8,["open"]),e(L,{title:"变量池配置",open:K.value,footer:!1,onCancel:r[7]||(r[7]=d=>K.value=!1)},{default:a(()=>[e(ze,{columns:oe.value,modelValue:s(t).variablePool,"onUpdate:modelValue":r[6]||(r[6]=d=>s(t).variablePool=d)},null,8,["columns","modelValue"])]),_:1},8,["open"])],64)}}}),Aa=W(Ye,[["__scopeId","data-v-ea11017f"]]);export{Aa as default};
